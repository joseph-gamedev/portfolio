
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../ai/">
      
      
        <link rel="next" href="../algorithms/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>Game Engine Architecture - Game Development</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#game-engine-architecture" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Game Development" class="md-header__button md-logo" aria-label="Game Development" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Game Development
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Game Engine Architecture
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../cpp/" class="md-tabs__link">
        
  
    
  
  C++

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../dsa/" class="md-tabs__link">
          
  
  Core Concepts

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../graphics/" class="md-tabs__link">
          
  
  Graphics

        </a>
      </li>
    
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../patterns/" class="md-tabs__link">
        
  
    
  
  Programming Patterns

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../ai/" class="md-tabs__link">
          
  
  AI

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
    
  
  Game Engine Architecture

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../algorithms/" class="md-tabs__link">
        
  
    
  
  Algorithms

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../intersections/" class="md-tabs__link">
        
  
    
  
  Intersections

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../graph/" class="md-tabs__link">
        
  
    
  
  Graph

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../gameplay/" class="md-tabs__link">
        
  
    
  
  Gameplay

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../maths/" class="md-tabs__link">
        
  
    
  
  Maths

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Game Development" class="md-nav__button md-logo" aria-label="Game Development" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Game Development
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../cpp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    C++
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Core Concepts
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Core Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dsa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Data Structures and Algorithms
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../memory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Memory Management
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Graphics
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Graphics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../graphics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Graphics Programming
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../rendering/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Rendering Techniques
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../patterns/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Programming Patterns
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    AI
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            AI
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ai/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Artificial Intelligence in Games
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Game Engine Architecture
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Game Engine Architecture
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      Table of Contents
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Table of Contents">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#introduction-to-game-engines" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction to Game Engines
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Introduction to Game Engines">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#what-is-a-game-engine" class="md-nav__link">
    <span class="md-ellipsis">
      What is a game engine?
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#history-and-evolution-of-game-engines" class="md-nav__link">
    <span class="md-ellipsis">
      History and Evolution of Game Engines
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#types-of-game-engines" class="md-nav__link">
    <span class="md-ellipsis">
      Types of Game Engines
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#core-engine-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Core Engine Systems
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Engine Systems">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#main-game-loop" class="md-nav__link">
    <span class="md-ellipsis">
      Main Game Loop
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#time-management-and-frame-rate" class="md-nav__link">
    <span class="md-ellipsis">
      Time Management and Frame Rate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#memory-management" class="md-nav__link">
    <span class="md-ellipsis">
      Memory Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Memory Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#multithreading-and-concurrency" class="md-nav__link">
    <span class="md-ellipsis">
      Multithreading and Concurrency
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-management" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Management
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Resource Management">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asset-loading-and-unloading" class="md-nav__link">
    <span class="md-ellipsis">
      Asset Loading and Unloading
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-manager" class="md-nav__link">
    <span class="md-ellipsis">
      Resource Manager
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#data-structures-for-efficient-resource-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Data Structures for Efficient Resource Handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#resource-caching" class="md-nav__link">
    <span class="md-ellipsis">
      Resource caching
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#streaming-and-level-of-detail" class="md-nav__link">
    <span class="md-ellipsis">
      Streaming and Level of Detail
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rendering-engine" class="md-nav__link">
    <span class="md-ellipsis">
      Rendering Engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Rendering Engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#graphics-api-abstraction" class="md-nav__link">
    <span class="md-ellipsis">
      Graphics API Abstraction
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scene-graph-and-culling" class="md-nav__link">
    <span class="md-ellipsis">
      Scene Graph and Culling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scene-graph" class="md-nav__link">
    <span class="md-ellipsis">
      Scene Graph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shaders-and-materials" class="md-nav__link">
    <span class="md-ellipsis">
      Shaders and Materials
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#shaders" class="md-nav__link">
    <span class="md-ellipsis">
      Shaders
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#camera" class="md-nav__link">
    <span class="md-ellipsis">
      Camera
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#light" class="md-nav__link">
    <span class="md-ellipsis">
      Light
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#particle-systems" class="md-nav__link">
    <span class="md-ellipsis">
      Particle Systems
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#physics-engine" class="md-nav__link">
    <span class="md-ellipsis">
      Physics Engine
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Physics Engine">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#collision-detection" class="md-nav__link">
    <span class="md-ellipsis">
      Collision Detection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rigid-body-dynamics" class="md-nav__link">
    <span class="md-ellipsis">
      Rigid Body Dynamics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#soft-body-physics" class="md-nav__link">
    <span class="md-ellipsis">
      Soft Body Physics
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ragdoll-physics" class="md-nav__link">
    <span class="md-ellipsis">
      Ragdoll Physics
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audio-system" class="md-nav__link">
    <span class="md-ellipsis">
      Audio System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Audio System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#sound-playback-and-mixing" class="md-nav__link">
    <span class="md-ellipsis">
      Sound Playback and Mixing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3d-spatial-audio" class="md-nav__link">
    <span class="md-ellipsis">
      3D Spatial Audio
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#audio-effects-and-processing" class="md-nav__link">
    <span class="md-ellipsis">
      Audio Effects and Processing
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#input-system" class="md-nav__link">
    <span class="md-ellipsis">
      Input System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Input System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#keyboard-and-mouse-input" class="md-nav__link">
    <span class="md-ellipsis">
      Keyboard and Mouse Input
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#gamepad-and-controller-support" class="md-nav__link">
    <span class="md-ellipsis">
      Gamepad and Controller Support
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#touch-and-gesture-recognition" class="md-nav__link">
    <span class="md-ellipsis">
      Touch and Gesture Recognition
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#overview_1" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#scripting-system" class="md-nav__link">
    <span class="md-ellipsis">
      Scripting System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Scripting System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#scripting-language-integration" class="md-nav__link">
    <span class="md-ellipsis">
      Scripting Language Integration
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#game-logic-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Game Logic Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#modding-support" class="md-nav__link">
    <span class="md-ellipsis">
      Modding Support
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#networking" class="md-nav__link">
    <span class="md-ellipsis">
      Networking
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Networking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#client-server-architecture" class="md-nav__link">
    <span class="md-ellipsis">
      Client-Server Architecture
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#peer-to-peer-networking" class="md-nav__link">
    <span class="md-ellipsis">
      Peer-to-Peer Networking
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#state-synchronization" class="md-nav__link">
    <span class="md-ellipsis">
      State Synchronization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#latency-compensation" class="md-nav__link">
    <span class="md-ellipsis">
      Latency Compensation
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tools-and-asset-pipeline" class="md-nav__link">
    <span class="md-ellipsis">
      Tools and Asset Pipeline
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Tools and Asset Pipeline">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#level-editors" class="md-nav__link">
    <span class="md-ellipsis">
      Level Editors
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Level Editors">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview_2" class="md-nav__link">
    <span class="md-ellipsis">
      Overview
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#animation-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Animation Tools
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asset-conversion-and-optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Asset Conversion and Optimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#build-systems-and-deployment" class="md-nav__link">
    <span class="md-ellipsis">
      Build Systems and Deployment
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../algorithms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Algorithms
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../intersections/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intersections
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../graph/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Graph
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../gameplay/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Gameplay
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../maths/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Maths
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="game-engine-architecture">Game Engine Architecture</h1>
<p>Welcome to the Game Engine Architecture section of our Game Development resource center. This page covers the fundamental concepts and components of game engine design and implementation.</p>
<h2 id="table-of-contents">Table of Contents</h2>
<ol>
<li><a href="#introduction-to-game-engines">Introduction to Game Engines</a></li>
<li><a href="#core-engine-systems">Core Engine Systems</a></li>
<li><a href="#resource-management">Resource Management</a></li>
<li><a href="#rendering-engine">Rendering Engine</a></li>
<li><a href="#physics-engine">Physics Engine</a></li>
<li><a href="#audio-system">Audio System</a></li>
<li><a href="#input-system">Input System</a></li>
<li><a href="#scripting-system">Scripting System</a></li>
<li><a href="#networking">Networking</a></li>
<li><a href="#tools-and-asset-pipeline">Tools and Asset Pipeline</a></li>
</ol>
<h3 id="introduction-to-game-engines">Introduction to Game Engines</h3>
<h4 id="what-is-a-game-engine">What is a game engine?</h4>
<p>A game engine is a software framework designed for the creation and development of video games. It provides a suite of tools and technologies that developers use to build games efficiently, focusing on game logic, content creation, and visual elements without needing to reinvent the underlying technical components for each new project. </p>
<p>Key components of a game engine typically include:</p>
<ol>
<li><strong>Rendering Engine:</strong> Manages the visual output, rendering 2D or 3D graphics.</li>
<li><strong>Physics Engine:</strong> Simulates physical interactions and collisions.</li>
<li><strong>Sound Engine:</strong> Handles audio playback and sound effects.</li>
<li><strong>Scripting:</strong> Allows developers to write game logic using scripts (e.g., Lua, Python, C#).</li>
<li><strong>Animation:</strong> Tools and systems for animating characters and objects.</li>
<li><strong>Artificial Intelligence:</strong> Components for NPC behavior, pathfinding, and decision-making.</li>
<li><strong>Networking:</strong> Support for multiplayer functionalities.</li>
<li><strong>User Interface (UI):</strong> Systems for creating in-game menus, HUDs, and interfaces.</li>
<li><strong>Asset Management:</strong> Tools for importing, organizing, and managing game assets like textures, models, and audio files.</li>
</ol>
<h4 id="history-and-evolution-of-game-engines">History and Evolution of Game Engines</h4>
<ul>
<li>
<p><strong>Early Days (1970s-1980s):</strong> In the early days, games were typically written from scratch, with each game having its own bespoke engine. Early examples include games like "Pong" and "Space Invaders," which had simple, hard-coded logic and rendering routines.</p>
</li>
<li>
<p><strong>1990s:</strong> The concept of reusable game engines began to emerge. Notable early engines include id Software's <strong>Doom Engine</strong> (1993) and <strong>Quake Engine</strong> (1996), which pioneered real-time 3D graphics and modular design, allowing other developers to create games using the same technology.</p>
</li>
<li>
<p><strong>2000s:</strong> Game engines became more sophisticated and widely available. Engines like <strong>Unreal Engine</strong> (1998) and <strong>Unity</strong> (2005) began to dominate the market, offering powerful toolsets for both indie developers and large studios. These engines supported advanced graphics, physics, and cross-platform development.</p>
</li>
<li>
<p><strong>2010s-Present:</strong> Modern game engines offer extensive features, including support for VR/AR, high-fidelity graphics, and real-time global illumination. <strong>Unity</strong> and <strong>Unreal Engine</strong> continue to lead the market, while other engines like <strong>CryEngine</strong> and <strong>Godot</strong> also provide robust alternatives. The industry has seen a push towards more user-friendly and accessible tools, democratizing game development.</p>
</li>
</ul>
<h4 id="types-of-game-engines">Types of Game Engines</h4>
<ol>
<li>
<p><strong>2D Game Engines:</strong></p>
<ul>
<li>Focus on creating 2D games with sprite-based graphics.</li>
<li>Examples: <strong>Godot</strong>, <strong>GameMaker Studio</strong>, <strong>Construct</strong>.</li>
<li>Features: Tilemaps, 2D physics, 2D animation, and simpler rendering pipelines.</li>
</ul>
</li>
<li>
<p><strong>3D Game Engines:</strong></p>
<ul>
<li>Designed for creating 3D games with complex graphics and physics.</li>
<li>Examples: <strong>Unreal Engine</strong>, <strong>Unity</strong>, <strong>CryEngine</strong>.</li>
<li>Features: 3D rendering, advanced physics, complex animations, and tools for creating detailed environments and characters.</li>
</ul>
</li>
</ol>
<p>Understanding the capabilities and focus of different game engines helps developers choose the right tool for their specific project needs, whether they are working on a simple 2D mobile game, a complex 3D AAA title, or an innovative VR experience.</p>
<h3 id="core-engine-systems">Core Engine Systems</h3>
<h4 id="main-game-loop">Main Game Loop</h4>
<p>The main game loop is the backbone of a game engine, responsible for updating the game state and rendering graphics continuously. It ensures that the game runs smoothly and responds to user inputs in real-time.</p>
<p>Typical steps in the main game loop:
1. <strong>Process Input:</strong> Captures and processes user inputs (keyboard, mouse, gamepad).
2. <strong>Update Game State:</strong> Updates game objects, physics, AI, and other game logic.
3. <strong>Render:</strong> Draws the current game state to the screen.
4. <strong>Manage Time:</strong> Keeps track of time to ensure consistent updates and smooth rendering.</p>
<p>Example (pseudo-code):
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">gameRunning</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="w">    </span><span class="n">processInput</span><span class="p">();</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="w">    </span><span class="n">updateGameState</span><span class="p">();</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="w">    </span><span class="n">render</span><span class="p">();</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="w">    </span><span class="n">manageTime</span><span class="p">();</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="p">}</span>
</code></pre></div></p>
<h4 id="time-management-and-frame-rate">Time Management and Frame Rate</h4>
<p>Effective time management is crucial for maintaining a consistent frame rate and smooth gameplay.</p>
<ul>
<li><strong>Delta Time:</strong> The time difference between the current and the previous frame. It ensures that game updates are frame-rate independent.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="n">deltaTime</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">currentFrameTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">previousFrameTime</span><span class="p">;</span>
</code></pre></div>
<ul>
<li><strong>Fixed Time Step:</strong> Ensures that certain updates (like physics) happen at consistent intervals.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="n">accumulatedTime</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">deltaTime</span><span class="p">;</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">accumulatedTime</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">fixedTimeStep</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a><span class="w">    </span><span class="n">updatePhysics</span><span class="p">(</span><span class="n">fixedTimeStep</span><span class="p">);</span>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="w">    </span><span class="n">accumulatedTime</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">fixedTimeStep</span><span class="p">;</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li><strong>Frame Rate Capping:</strong> Limits the maximum frame rate to prevent the game from consuming excessive resources.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">frameTime</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">minFrameTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="n">sleep</span><span class="p">(</span><span class="n">minFrameTime</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">frameTime</span><span class="p">);</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="p">}</span>
</code></pre></div>
<h4 id="memory-management">Memory Management</h4>
<p>Efficient memory management is vital for the performance and stability of a game engine.</p>
<ul>
<li><strong>Dynamic Memory Allocation:</strong> Allocating and deallocating memory at runtime, but it can lead to fragmentation and overhead.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kt">int</span><span class="o">*</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">int</span><span class="p">[</span><span class="m">100</span><span class="p">];</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="n">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
</code></pre></div>
<ul>
<li><strong>Custom Allocators:</strong> Specialized memory allocators can optimize performance and reduce fragmentation. Examples include:</li>
<li><strong>Pool Allocators:</strong> Allocate fixed-size blocks for objects of the same type.</li>
<li><strong>Stack Allocators:</strong> Allocate and deallocate memory in a last-in, first-out manner.</li>
<li><strong>Freelist Allocators:</strong> Maintain a free list of available memory blocks for reuse.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">PoolAllocator</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="k">void</span><span class="o">*</span><span class="w"> </span><span class="n">allocate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/*...*/</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">deallocate</span><span class="p">(</span><span class="k">void</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/*...*/</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="p">};</span>
</code></pre></div>
<ul>
<li><strong>Garbage Collection:</strong> Automatically manages memory deallocation, commonly used in languages like C# and Java. However, it can introduce pauses due to collection cycles.</li>
</ul>
<h5 id="overview">Overview</h5>
<p>Memory management is crucial in game engines for performance and stability. Key aspects include:</p>
<ol>
<li>Custom allocators</li>
<li>Memory pools</li>
<li>Object pooling</li>
<li>Resource caching</li>
<li>Defragmentation</li>
</ol>
<p>Let's implement a basic memory management system focusing on custom allocators and memory pools. Here's a C++ implementation:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstddef&gt;</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cstdint&gt;</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;new&gt;</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;atomic&gt;</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">engine</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">memory</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a>
<a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="c1">// Forward declarations</span>
<a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="k">class</span><span class="w"> </span><span class="nc">Allocator</span><span class="p">;</span>
<a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="k">class</span><span class="w"> </span><span class="nc">PoolAllocator</span><span class="p">;</span>
<a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a>
<a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="c1">// Abstract base class for memory allocators</span>
<a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">Allocator</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">Allocator</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="nf">Allocate</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">alignof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">max_align_t</span><span class="p">))</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Deallocate</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="p">};</span>
<a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a>
<a id="__codelineno-6-22" name="__codelineno-6-22" href="#__codelineno-6-22"></a><span class="c1">// Memory pool for fixed-size allocations</span>
<a id="__codelineno-6-23" name="__codelineno-6-23" href="#__codelineno-6-23"></a><span class="k">class</span><span class="w"> </span><span class="nc">PoolAllocator</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Allocator</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-24" name="__codelineno-6-24" href="#__codelineno-6-24"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-6-25" name="__codelineno-6-25" href="#__codelineno-6-25"></a><span class="w">  </span><span class="n">PoolAllocator</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">block_size</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">block_count</span><span class="p">)</span>
<a id="__codelineno-6-26" name="__codelineno-6-26" href="#__codelineno-6-26"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="n">block_size_</span><span class="p">(</span><span class="n">block_size</span><span class="p">),</span>
<a id="__codelineno-6-27" name="__codelineno-6-27" href="#__codelineno-6-27"></a><span class="w">        </span><span class="n">block_count_</span><span class="p">(</span><span class="n">block_count</span><span class="p">),</span>
<a id="__codelineno-6-28" name="__codelineno-6-28" href="#__codelineno-6-28"></a><span class="w">        </span><span class="n">free_list_</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-29" name="__codelineno-6-29" href="#__codelineno-6-29"></a><span class="w">    </span><span class="n">Initialize</span><span class="p">();</span>
<a id="__codelineno-6-30" name="__codelineno-6-30" href="#__codelineno-6-30"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-31" name="__codelineno-6-31" href="#__codelineno-6-31"></a>
<a id="__codelineno-6-32" name="__codelineno-6-32" href="#__codelineno-6-32"></a><span class="w">  </span><span class="o">~</span><span class="n">PoolAllocator</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-33" name="__codelineno-6-33" href="#__codelineno-6-33"></a><span class="w">    </span><span class="n">Cleanup</span><span class="p">();</span>
<a id="__codelineno-6-34" name="__codelineno-6-34" href="#__codelineno-6-34"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-35" name="__codelineno-6-35" href="#__codelineno-6-35"></a>
<a id="__codelineno-6-36" name="__codelineno-6-36" href="#__codelineno-6-36"></a><span class="w">  </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">Allocate</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">alignof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">max_align_t</span><span class="p">))</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-37" name="__codelineno-6-37" href="#__codelineno-6-37"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">size</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">block_size_</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">alignment</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">block_size_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-38" name="__codelineno-6-38" href="#__codelineno-6-38"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w">  </span><span class="c1">// Allocation request exceeds pool capabilities</span>
<a id="__codelineno-6-39" name="__codelineno-6-39" href="#__codelineno-6-39"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-40" name="__codelineno-6-40" href="#__codelineno-6-40"></a>
<a id="__codelineno-6-41" name="__codelineno-6-41" href="#__codelineno-6-41"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">free_list_</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-42" name="__codelineno-6-42" href="#__codelineno-6-42"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span><span class="w">  </span><span class="c1">// Pool is exhausted</span>
<a id="__codelineno-6-43" name="__codelineno-6-43" href="#__codelineno-6-43"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-44" name="__codelineno-6-44" href="#__codelineno-6-44"></a>
<a id="__codelineno-6-45" name="__codelineno-6-45" href="#__codelineno-6-45"></a><span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">free_list_</span><span class="p">;</span>
<a id="__codelineno-6-46" name="__codelineno-6-46" href="#__codelineno-6-46"></a><span class="w">    </span><span class="n">free_list_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">**&gt;</span><span class="p">(</span><span class="n">free_list_</span><span class="p">);</span>
<a id="__codelineno-6-47" name="__codelineno-6-47" href="#__codelineno-6-47"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ptr</span><span class="p">;</span>
<a id="__codelineno-6-48" name="__codelineno-6-48" href="#__codelineno-6-48"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-49" name="__codelineno-6-49" href="#__codelineno-6-49"></a>
<a id="__codelineno-6-50" name="__codelineno-6-50" href="#__codelineno-6-50"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">Deallocate</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-51" name="__codelineno-6-51" href="#__codelineno-6-51"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ptr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-52" name="__codelineno-6-52" href="#__codelineno-6-52"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-6-53" name="__codelineno-6-53" href="#__codelineno-6-53"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-54" name="__codelineno-6-54" href="#__codelineno-6-54"></a>
<a id="__codelineno-6-55" name="__codelineno-6-55" href="#__codelineno-6-55"></a><span class="w">    </span><span class="o">*</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">**&gt;</span><span class="p">(</span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">free_list_</span><span class="p">;</span>
<a id="__codelineno-6-56" name="__codelineno-6-56" href="#__codelineno-6-56"></a><span class="w">    </span><span class="n">free_list_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ptr</span><span class="p">;</span>
<a id="__codelineno-6-57" name="__codelineno-6-57" href="#__codelineno-6-57"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-58" name="__codelineno-6-58" href="#__codelineno-6-58"></a>
<a id="__codelineno-6-59" name="__codelineno-6-59" href="#__codelineno-6-59"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-6-60" name="__codelineno-6-60" href="#__codelineno-6-60"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">Initialize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-61" name="__codelineno-6-61" href="#__codelineno-6-61"></a><span class="w">    </span><span class="n">memory_block_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">::</span><span class="k">operator</span><span class="w"> </span><span class="k">new</span><span class="p">(</span><span class="n">block_size_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">block_count_</span><span class="p">);</span>
<a id="__codelineno-6-62" name="__codelineno-6-62" href="#__codelineno-6-62"></a><span class="w">    </span><span class="n">free_list_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">memory_block_</span><span class="p">;</span>
<a id="__codelineno-6-63" name="__codelineno-6-63" href="#__codelineno-6-63"></a>
<a id="__codelineno-6-64" name="__codelineno-6-64" href="#__codelineno-6-64"></a><span class="w">    </span><span class="kt">uint8_t</span><span class="o">*</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">memory_block_</span><span class="p">);</span>
<a id="__codelineno-6-65" name="__codelineno-6-65" href="#__codelineno-6-65"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">block_count_</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-66" name="__codelineno-6-66" href="#__codelineno-6-66"></a><span class="w">      </span><span class="o">*</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">**&gt;</span><span class="p">(</span><span class="n">current</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">block_size_</span><span class="p">;</span>
<a id="__codelineno-6-67" name="__codelineno-6-67" href="#__codelineno-6-67"></a><span class="w">      </span><span class="n">current</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">block_size_</span><span class="p">;</span>
<a id="__codelineno-6-68" name="__codelineno-6-68" href="#__codelineno-6-68"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-69" name="__codelineno-6-69" href="#__codelineno-6-69"></a><span class="w">    </span><span class="o">*</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">**&gt;</span><span class="p">(</span><span class="n">current</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-6-70" name="__codelineno-6-70" href="#__codelineno-6-70"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-71" name="__codelineno-6-71" href="#__codelineno-6-71"></a>
<a id="__codelineno-6-72" name="__codelineno-6-72" href="#__codelineno-6-72"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">Cleanup</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-73" name="__codelineno-6-73" href="#__codelineno-6-73"></a><span class="w">    </span><span class="o">::</span><span class="k">operator</span><span class="w"> </span><span class="nf">delete</span><span class="p">(</span><span class="n">memory_block_</span><span class="p">);</span>
<a id="__codelineno-6-74" name="__codelineno-6-74" href="#__codelineno-6-74"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-75" name="__codelineno-6-75" href="#__codelineno-6-75"></a>
<a id="__codelineno-6-76" name="__codelineno-6-76" href="#__codelineno-6-76"></a><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">block_size_</span><span class="p">;</span>
<a id="__codelineno-6-77" name="__codelineno-6-77" href="#__codelineno-6-77"></a><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">block_count_</span><span class="p">;</span>
<a id="__codelineno-6-78" name="__codelineno-6-78" href="#__codelineno-6-78"></a><span class="w">  </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">memory_block_</span><span class="p">;</span>
<a id="__codelineno-6-79" name="__codelineno-6-79" href="#__codelineno-6-79"></a><span class="w">  </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">free_list_</span><span class="p">;</span>
<a id="__codelineno-6-80" name="__codelineno-6-80" href="#__codelineno-6-80"></a><span class="p">};</span>
<a id="__codelineno-6-81" name="__codelineno-6-81" href="#__codelineno-6-81"></a>
<a id="__codelineno-6-82" name="__codelineno-6-82" href="#__codelineno-6-82"></a><span class="c1">// Thread-safe allocator using atomic operations</span>
<a id="__codelineno-6-83" name="__codelineno-6-83" href="#__codelineno-6-83"></a><span class="k">class</span><span class="w"> </span><span class="nc">AtomicAllocator</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Allocator</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-84" name="__codelineno-6-84" href="#__codelineno-6-84"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-6-85" name="__codelineno-6-85" href="#__codelineno-6-85"></a><span class="w">  </span><span class="k">explicit</span><span class="w"> </span><span class="n">AtomicAllocator</span><span class="p">(</span><span class="n">Allocator</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base_allocator</span><span class="p">)</span>
<a id="__codelineno-6-86" name="__codelineno-6-86" href="#__codelineno-6-86"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="n">base_allocator_</span><span class="p">(</span><span class="n">base_allocator</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-6-87" name="__codelineno-6-87" href="#__codelineno-6-87"></a>
<a id="__codelineno-6-88" name="__codelineno-6-88" href="#__codelineno-6-88"></a><span class="w">  </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">Allocate</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="n">alignment</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">alignof</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">max_align_t</span><span class="p">))</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-89" name="__codelineno-6-89" href="#__codelineno-6-89"></a><span class="w">    </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">base_allocator_</span><span class="p">.</span><span class="n">Allocate</span><span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="w"> </span><span class="n">alignment</span><span class="p">);</span>
<a id="__codelineno-6-90" name="__codelineno-6-90" href="#__codelineno-6-90"></a><span class="w">    </span><span class="n">allocated_addresses_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
<a id="__codelineno-6-91" name="__codelineno-6-91" href="#__codelineno-6-91"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ptr</span><span class="p">;</span>
<a id="__codelineno-6-92" name="__codelineno-6-92" href="#__codelineno-6-92"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-93" name="__codelineno-6-93" href="#__codelineno-6-93"></a>
<a id="__codelineno-6-94" name="__codelineno-6-94" href="#__codelineno-6-94"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">Deallocate</span><span class="p">(</span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-95" name="__codelineno-6-95" href="#__codelineno-6-95"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">ptr</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-96" name="__codelineno-6-96" href="#__codelineno-6-96"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-6-97" name="__codelineno-6-97" href="#__codelineno-6-97"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-98" name="__codelineno-6-98" href="#__codelineno-6-98"></a>
<a id="__codelineno-6-99" name="__codelineno-6-99" href="#__codelineno-6-99"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">find</span><span class="p">(</span><span class="n">allocated_addresses_</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">allocated_addresses_</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">ptr</span><span class="p">);</span>
<a id="__codelineno-6-100" name="__codelineno-6-100" href="#__codelineno-6-100"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">allocated_addresses_</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-101" name="__codelineno-6-101" href="#__codelineno-6-101"></a><span class="w">      </span><span class="n">allocated_addresses_</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">it</span><span class="p">);</span>
<a id="__codelineno-6-102" name="__codelineno-6-102" href="#__codelineno-6-102"></a><span class="w">      </span><span class="n">base_allocator_</span><span class="p">.</span><span class="n">Deallocate</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
<a id="__codelineno-6-103" name="__codelineno-6-103" href="#__codelineno-6-103"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-6-104" name="__codelineno-6-104" href="#__codelineno-6-104"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-6-105" name="__codelineno-6-105" href="#__codelineno-6-105"></a>
<a id="__codelineno-6-106" name="__codelineno-6-106" href="#__codelineno-6-106"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-6-107" name="__codelineno-6-107" href="#__codelineno-6-107"></a><span class="w">  </span><span class="n">Allocator</span><span class="o">&amp;</span><span class="w"> </span><span class="n">base_allocator_</span><span class="p">;</span>
<a id="__codelineno-6-108" name="__codelineno-6-108" href="#__codelineno-6-108"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">void</span><span class="o">*&gt;</span><span class="w"> </span><span class="n">allocated_addresses_</span><span class="p">;</span>
<a id="__codelineno-6-109" name="__codelineno-6-109" href="#__codelineno-6-109"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">size_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">allocation_count_</span><span class="p">{</span><span class="mi">0</span><span class="p">};</span>
<a id="__codelineno-6-110" name="__codelineno-6-110" href="#__codelineno-6-110"></a><span class="p">};</span>
<a id="__codelineno-6-111" name="__codelineno-6-111" href="#__codelineno-6-111"></a>
<a id="__codelineno-6-112" name="__codelineno-6-112" href="#__codelineno-6-112"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace memory</span>
<a id="__codelineno-6-113" name="__codelineno-6-113" href="#__codelineno-6-113"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace engine</span>
<a id="__codelineno-6-114" name="__codelineno-6-114" href="#__codelineno-6-114"></a>
<a id="__codelineno-6-115" name="__codelineno-6-115" href="#__codelineno-6-115"></a><span class="c1">// Example usage</span>
<a id="__codelineno-6-116" name="__codelineno-6-116" href="#__codelineno-6-116"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-6-117" name="__codelineno-6-117" href="#__codelineno-6-117"></a><span class="w">  </span><span class="n">engine</span><span class="o">::</span><span class="n">memory</span><span class="o">::</span><span class="n">PoolAllocator</span><span class="w"> </span><span class="nf">pool_allocator</span><span class="p">(</span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="mi">1000</span><span class="p">);</span><span class="w">  </span><span class="c1">// 64-byte blocks, 1000 blocks</span>
<a id="__codelineno-6-118" name="__codelineno-6-118" href="#__codelineno-6-118"></a><span class="w">  </span><span class="n">engine</span><span class="o">::</span><span class="n">memory</span><span class="o">::</span><span class="n">AtomicAllocator</span><span class="w"> </span><span class="nf">atomic_allocator</span><span class="p">(</span><span class="n">pool_allocator</span><span class="p">);</span>
<a id="__codelineno-6-119" name="__codelineno-6-119" href="#__codelineno-6-119"></a>
<a id="__codelineno-6-120" name="__codelineno-6-120" href="#__codelineno-6-120"></a><span class="w">  </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">ptr1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atomic_allocator</span><span class="p">.</span><span class="n">Allocate</span><span class="p">(</span><span class="mi">32</span><span class="p">);</span>
<a id="__codelineno-6-121" name="__codelineno-6-121" href="#__codelineno-6-121"></a><span class="w">  </span><span class="kt">void</span><span class="o">*</span><span class="w"> </span><span class="n">ptr2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">atomic_allocator</span><span class="p">.</span><span class="n">Allocate</span><span class="p">(</span><span class="mi">64</span><span class="p">);</span>
<a id="__codelineno-6-122" name="__codelineno-6-122" href="#__codelineno-6-122"></a>
<a id="__codelineno-6-123" name="__codelineno-6-123" href="#__codelineno-6-123"></a><span class="w">  </span><span class="c1">// Use allocated memory...</span>
<a id="__codelineno-6-124" name="__codelineno-6-124" href="#__codelineno-6-124"></a>
<a id="__codelineno-6-125" name="__codelineno-6-125" href="#__codelineno-6-125"></a><span class="w">  </span><span class="n">atomic_allocator</span><span class="p">.</span><span class="n">Deallocate</span><span class="p">(</span><span class="n">ptr1</span><span class="p">);</span>
<a id="__codelineno-6-126" name="__codelineno-6-126" href="#__codelineno-6-126"></a><span class="w">  </span><span class="n">atomic_allocator</span><span class="p">.</span><span class="n">Deallocate</span><span class="p">(</span><span class="n">ptr2</span><span class="p">);</span>
<a id="__codelineno-6-127" name="__codelineno-6-127" href="#__codelineno-6-127"></a>
<a id="__codelineno-6-128" name="__codelineno-6-128" href="#__codelineno-6-128"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-6-129" name="__codelineno-6-129" href="#__codelineno-6-129"></a><span class="p">}</span>
</code></pre></div>
<p>This implementation demonstrates several key concepts:</p>
<ol>
<li>An abstract <code>Allocator</code> base class that defines the interface for memory allocators.</li>
<li>A <code>PoolAllocator</code> class that manages fixed-size memory blocks for efficient allocation and deallocation.</li>
<li>An <code>AtomicAllocator</code> class that wraps another allocator to provide thread-safe memory management.</li>
</ol>
<p>The code follows best practices such as:</p>
<ul>
<li>Using namespaces to organize code</li>
<li>Implementing RAII (Resource Acquisition Is Initialization) for proper resource management</li>
<li>Using virtual functions for polymorphic behavior</li>
<li>Providing default arguments for alignment</li>
<li>Using <code>nullptr</code> instead of <code>NULL</code></li>
<li>Using <code>override</code> keyword for virtual function overrides</li>
<li>Using <code>std::atomic</code> for thread-safe operations</li>
</ul>
<p>This implementation provides a foundation for memory management in a game engine. In a real-world scenario, you would likely need to expand on this with features like:</p>
<ul>
<li>Multiple pool sizes for different allocation patterns</li>
<li>Alignment handling for SIMD operations</li>
<li>Memory tracking and profiling</li>
<li>Defragmentation strategies</li>
<li>Integration with the engine's resource management system</li>
</ul>
<h4 id="multithreading-and-concurrency">Multithreading and Concurrency</h4>
<p>Utilizing multiple threads can significantly improve performance by parallelizing tasks.</p>
<ul>
<li><strong>Multithreading:</strong> Running multiple threads concurrently to perform different tasks.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">std</span><span class="p">::</span><span class="n">thread</span><span class="w"> </span><span class="n">thread1</span><span class="p">(</span><span class="n">task1</span><span class="p">);</span>
<a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="n">std</span><span class="p">::</span><span class="n">thread</span><span class="w"> </span><span class="n">thread2</span><span class="p">(</span><span class="n">task2</span><span class="p">);</span>
<a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="n">thread1</span><span class="p">.</span><span class="k">join</span><span class="p">();</span>
<a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="n">thread2</span><span class="p">.</span><span class="k">join</span><span class="p">();</span>
</code></pre></div>
<ul>
<li><strong>Task Parallelism:</strong> Breaking down tasks into smaller chunks that can be executed in parallel.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="cp">#pragma omp parallel for</span>
<a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">numTasks</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">    </span><span class="n">tasks</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">execute</span><span class="p">();</span>
<a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li><strong>Synchronization:</strong> Managing access to shared resources to prevent data races and ensure thread safety.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="n">std</span><span class="p">::</span><span class="n">mutex</span><span class="w"> </span><span class="n">mtx</span><span class="p">;</span>
<a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="n">mtx</span><span class="p">.</span><span class="k">lock</span><span class="p">();</span>
<a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="c1">// critical section</span>
<a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="n">mtx</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
</code></pre></div>
<ul>
<li><strong>Thread Pools:</strong> A collection of pre-initialized threads that can be reused to execute tasks, reducing the overhead of creating and destroying threads.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ThreadPool</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">enqueueTask</span><span class="p">(</span><span class="n">std</span><span class="p">::</span><span class="n">function</span><span class="o">&lt;</span><span class="k">void</span><span class="p">()</span><span class="o">&gt;</span><span class="w"> </span><span class="n">task</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/*...*/</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="p">};</span>
</code></pre></div>
<p>By effectively managing these core engine systems, game engines can achieve high performance, stability, and scalability, enabling developers to create complex and immersive gaming experiences.</p>
<h3 id="resource-management">Resource Management</h3>
<h4 id="asset-loading-and-unloading">Asset Loading and Unloading</h4>
<p>Asset management involves efficiently loading, unloading, and managing game resources such as textures, models, sounds, and scripts.</p>
<ul>
<li>
<p><strong>Asset Loading:</strong></p>
<ul>
<li><strong>Synchronous Loading:</strong> Assets are loaded during initialization or as needed, causing the game to pause until the asset is fully loaded.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="n">Texture</span><span class="w"> </span><span class="n">texture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoadTexture</span><span class="p">(</span><span class="s">&quot;path/to/texture.png&quot;</span><span class="p">);</span>
</code></pre></div>
<ul>
<li><strong>Asynchronous Loading:</strong> Assets are loaded in the background, allowing the game to continue running. This helps prevent pauses and improves user experience.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">async</span><span class="w"> </span><span class="n">Task</span><span class="o">&lt;</span><span class="n">Texture</span><span class="o">&gt;</span><span class="w"> </span><span class="n">LoadTextureAsync</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="n">Task</span><span class="p">.</span><span class="n">Run</span><span class="p">(()</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="n">LoadTexture</span><span class="p">(</span><span class="n">path</span><span class="p">));</span>
<a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Asset Unloading:</strong></p>
<ul>
<li><strong>Manual Unloading:</strong> Developers explicitly unload assets when they are no longer needed.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="n">UnloadTexture</span><span class="p">(</span><span class="n">texture</span><span class="p">);</span>
</code></pre></div>
<ul>
<li><strong>Automatic Unloading:</strong> Assets are automatically unloaded when they are no longer referenced, often managed by a resource manager or garbage collector.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">texture</span><span class="p">.</span><span class="n">Dispose</span><span class="p">();</span>
</code></pre></div>
<h4 id="resource-manager">Resource Manager</h4>
</li>
</ul>
<p>Implementation in C++:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="c1">// resource_manager.h</span>
<a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="cp">#ifndef GRAPHICS_RESOURCE_MANAGER_H_</span>
<a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="cp">#define GRAPHICS_RESOURCE_MANAGER_H_</span>
<a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a>
<a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;atomic&gt;</span>
<a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;future&gt;</span>
<a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unordered_map&gt;</span>
<a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a>
<a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;encryption/aes.h&quot;</span><span class="c1">  // Assume this is implemented elsewhere</span>
<a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;threading/thread_pool.h&quot;</span><span class="c1">  // Assume this is implemented elsewhere</span>
<a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a>
<a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">graphics</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a>
<a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="k">class</span><span class="w"> </span><span class="nc">Resource</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">  </span><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Type</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">    </span><span class="n">kTexture</span><span class="p">,</span>
<a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">    </span><span class="n">kModel</span><span class="p">,</span>
<a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">    </span><span class="n">kShader</span><span class="p">,</span>
<a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">    </span><span class="n">kAudio</span><span class="p">,</span>
<a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">    </span><span class="n">kFont</span>
<a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a>
<a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a><span class="w">  </span><span class="n">Resource</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">Resource</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a>
<a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w">  </span><span class="c1">// Disallow copy and assign</span>
<a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="w">  </span><span class="n">Resource</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Resource</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="w">  </span><span class="n">Resource</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Resource</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a>
<a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="w">  </span><span class="n">Type</span><span class="w"> </span><span class="nf">GetType</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">type_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-15-35" name="__codelineno-15-35" href="#__codelineno-15-35"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">GetName</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">name_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-15-36" name="__codelineno-15-36" href="#__codelineno-15-36"></a>
<a id="__codelineno-15-37" name="__codelineno-15-37" href="#__codelineno-15-37"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Load</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-15-38" name="__codelineno-15-38" href="#__codelineno-15-38"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Serialize</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-15-39" name="__codelineno-15-39" href="#__codelineno-15-39"></a>
<a id="__codelineno-15-40" name="__codelineno-15-40" href="#__codelineno-15-40"></a><span class="w"> </span><span class="k">protected</span><span class="o">:</span>
<a id="__codelineno-15-41" name="__codelineno-15-41" href="#__codelineno-15-41"></a><span class="w">  </span><span class="n">Type</span><span class="w"> </span><span class="n">type_</span><span class="p">;</span>
<a id="__codelineno-15-42" name="__codelineno-15-42" href="#__codelineno-15-42"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name_</span><span class="p">;</span>
<a id="__codelineno-15-43" name="__codelineno-15-43" href="#__codelineno-15-43"></a><span class="p">};</span>
<a id="__codelineno-15-44" name="__codelineno-15-44" href="#__codelineno-15-44"></a>
<a id="__codelineno-15-45" name="__codelineno-15-45" href="#__codelineno-15-45"></a><span class="k">class</span><span class="w"> </span><span class="nc">ResourceManager</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-15-46" name="__codelineno-15-46" href="#__codelineno-15-46"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-15-47" name="__codelineno-15-47" href="#__codelineno-15-47"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">&amp;</span><span class="w"> </span><span class="n">GetInstance</span><span class="p">();</span>
<a id="__codelineno-15-48" name="__codelineno-15-48" href="#__codelineno-15-48"></a>
<a id="__codelineno-15-49" name="__codelineno-15-49" href="#__codelineno-15-49"></a><span class="w">  </span><span class="c1">// Disallow copy and assign</span>
<a id="__codelineno-15-50" name="__codelineno-15-50" href="#__codelineno-15-50"></a><span class="w">  </span><span class="n">ResourceManager</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-15-51" name="__codelineno-15-51" href="#__codelineno-15-51"></a><span class="w">  </span><span class="n">ResourceManager</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-15-52" name="__codelineno-15-52" href="#__codelineno-15-52"></a>
<a id="__codelineno-15-53" name="__codelineno-15-53" href="#__codelineno-15-53"></a><span class="w">  </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-15-54" name="__codelineno-15-54" href="#__codelineno-15-54"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GetResource</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-15-55" name="__codelineno-15-55" href="#__codelineno-15-55"></a>
<a id="__codelineno-15-56" name="__codelineno-15-56" href="#__codelineno-15-56"></a><span class="w">  </span><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-15-57" name="__codelineno-15-57" href="#__codelineno-15-57"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">LoadResourceAsync</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-15-58" name="__codelineno-15-58" href="#__codelineno-15-58"></a>
<a id="__codelineno-15-59" name="__codelineno-15-59" href="#__codelineno-15-59"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">UnloadResource</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-15-60" name="__codelineno-15-60" href="#__codelineno-15-60"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">UnloadAllResources</span><span class="p">();</span>
<a id="__codelineno-15-61" name="__codelineno-15-61" href="#__codelineno-15-61"></a>
<a id="__codelineno-15-62" name="__codelineno-15-62" href="#__codelineno-15-62"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">PackResources</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pack_path</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">resource_paths</span><span class="p">);</span>
<a id="__codelineno-15-63" name="__codelineno-15-63" href="#__codelineno-15-63"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">UnpackResources</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pack_path</span><span class="p">);</span>
<a id="__codelineno-15-64" name="__codelineno-15-64" href="#__codelineno-15-64"></a>
<a id="__codelineno-15-65" name="__codelineno-15-65" href="#__codelineno-15-65"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetEncryptionKey</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">key</span><span class="p">);</span>
<a id="__codelineno-15-66" name="__codelineno-15-66" href="#__codelineno-15-66"></a>
<a id="__codelineno-15-67" name="__codelineno-15-67" href="#__codelineno-15-67"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-15-68" name="__codelineno-15-68" href="#__codelineno-15-68"></a><span class="w">  </span><span class="n">ResourceManager</span><span class="p">();</span>
<a id="__codelineno-15-69" name="__codelineno-15-69" href="#__codelineno-15-69"></a><span class="w">  </span><span class="o">~</span><span class="n">ResourceManager</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-15-70" name="__codelineno-15-70" href="#__codelineno-15-70"></a>
<a id="__codelineno-15-71" name="__codelineno-15-71" href="#__codelineno-15-71"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">LoadFile</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-15-72" name="__codelineno-15-72" href="#__codelineno-15-72"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">SaveFile</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-15-73" name="__codelineno-15-73" href="#__codelineno-15-73"></a>
<a id="__codelineno-15-74" name="__codelineno-15-74" href="#__codelineno-15-74"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Encrypt</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-15-75" name="__codelineno-15-75" href="#__codelineno-15-75"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Decrypt</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-15-76" name="__codelineno-15-76" href="#__codelineno-15-76"></a>
<a id="__codelineno-15-77" name="__codelineno-15-77" href="#__codelineno-15-77"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">resources_</span><span class="p">;</span>
<a id="__codelineno-15-78" name="__codelineno-15-78" href="#__codelineno-15-78"></a><span class="w">  </span><span class="n">threading</span><span class="o">::</span><span class="n">ThreadPool</span><span class="w"> </span><span class="n">thread_pool_</span><span class="p">;</span>
<a id="__codelineno-15-79" name="__codelineno-15-79" href="#__codelineno-15-79"></a><span class="w">  </span><span class="n">encryption</span><span class="o">::</span><span class="n">AES</span><span class="w"> </span><span class="n">aes_</span><span class="p">;</span>
<a id="__codelineno-15-80" name="__codelineno-15-80" href="#__codelineno-15-80"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">atomic</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span><span class="w"> </span><span class="n">is_encryption_enabled_</span><span class="p">;</span>
<a id="__codelineno-15-81" name="__codelineno-15-81" href="#__codelineno-15-81"></a><span class="p">};</span>
<a id="__codelineno-15-82" name="__codelineno-15-82" href="#__codelineno-15-82"></a>
<a id="__codelineno-15-83" name="__codelineno-15-83" href="#__codelineno-15-83"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace graphics</span>
<a id="__codelineno-15-84" name="__codelineno-15-84" href="#__codelineno-15-84"></a>
<a id="__codelineno-15-85" name="__codelineno-15-85" href="#__codelineno-15-85"></a><span class="cp">#endif  </span><span class="c1">// GRAPHICS_RESOURCE_MANAGER_H_</span>
</code></pre></div>
<p>Now, let's implement the ResourceManager:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="c1">// resource_manager.cc</span>
<a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;resource_manager.h&quot;</span>
<a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
<a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>
<a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a>
<a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;resources/texture.h&quot;</span>
<a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;resources/model.h&quot;</span>
<a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;resources/shader.h&quot;</span>
<a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;resources/audio.h&quot;</span>
<a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;resources/font.h&quot;</span>
<a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a>
<a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">graphics</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a>
<a id="__codelineno-16-15" name="__codelineno-16-15" href="#__codelineno-16-15"></a><span class="n">Resource</span><span class="o">::</span><span class="n">Resource</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-16-16" name="__codelineno-16-16" href="#__codelineno-16-16"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">type_</span><span class="p">(</span><span class="n">type</span><span class="p">),</span><span class="w"> </span><span class="n">name_</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-16-17" name="__codelineno-16-17" href="#__codelineno-16-17"></a>
<a id="__codelineno-16-18" name="__codelineno-16-18" href="#__codelineno-16-18"></a><span class="n">ResourceManager</span><span class="o">::</span><span class="n">ResourceManager</span><span class="p">()</span>
<a id="__codelineno-16-19" name="__codelineno-16-19" href="#__codelineno-16-19"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">thread_pool_</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span><span class="w">  </span><span class="c1">// Initialize with 4 worker threads</span>
<a id="__codelineno-16-20" name="__codelineno-16-20" href="#__codelineno-16-20"></a><span class="w">      </span><span class="n">is_encryption_enabled_</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-16-21" name="__codelineno-16-21" href="#__codelineno-16-21"></a>
<a id="__codelineno-16-22" name="__codelineno-16-22" href="#__codelineno-16-22"></a><span class="n">ResourceManager</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-23" name="__codelineno-16-23" href="#__codelineno-16-23"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">ResourceManager</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span>
<a id="__codelineno-16-24" name="__codelineno-16-24" href="#__codelineno-16-24"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span>
<a id="__codelineno-16-25" name="__codelineno-16-25" href="#__codelineno-16-25"></a><span class="p">}</span>
<a id="__codelineno-16-26" name="__codelineno-16-26" href="#__codelineno-16-26"></a>
<a id="__codelineno-16-27" name="__codelineno-16-27" href="#__codelineno-16-27"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-16-28" name="__codelineno-16-28" href="#__codelineno-16-28"></a><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetResource</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-29" name="__codelineno-16-29" href="#__codelineno-16-29"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resources_</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-16-30" name="__codelineno-16-30" href="#__codelineno-16-30"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">resources_</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-31" name="__codelineno-16-31" href="#__codelineno-16-31"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">dynamic_pointer_cast</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">);</span>
<a id="__codelineno-16-32" name="__codelineno-16-32" href="#__codelineno-16-32"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-33" name="__codelineno-16-33" href="#__codelineno-16-33"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-16-34" name="__codelineno-16-34" href="#__codelineno-16-34"></a><span class="p">}</span>
<a id="__codelineno-16-35" name="__codelineno-16-35" href="#__codelineno-16-35"></a>
<a id="__codelineno-16-36" name="__codelineno-16-36" href="#__codelineno-16-36"></a><span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-16-37" name="__codelineno-16-37" href="#__codelineno-16-37"></a><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadResourceAsync</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-38" name="__codelineno-16-38" href="#__codelineno-16-38"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">thread_pool_</span><span class="p">.</span><span class="n">Enqueue</span><span class="p">([</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-39" name="__codelineno-16-39" href="#__codelineno-16-39"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoadFile</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-16-40" name="__codelineno-16-40" href="#__codelineno-16-40"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-41" name="__codelineno-16-41" href="#__codelineno-16-41"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to load resource: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-16-42" name="__codelineno-16-42" href="#__codelineno-16-42"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-16-43" name="__codelineno-16-43" href="#__codelineno-16-43"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-44" name="__codelineno-16-44" href="#__codelineno-16-44"></a>
<a id="__codelineno-16-45" name="__codelineno-16-45" href="#__codelineno-16-45"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_encryption_enabled_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-46" name="__codelineno-16-46" href="#__codelineno-16-46"></a><span class="w">      </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-16-47" name="__codelineno-16-47" href="#__codelineno-16-47"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-48" name="__codelineno-16-48" href="#__codelineno-16-48"></a>
<a id="__codelineno-16-49" name="__codelineno-16-49" href="#__codelineno-16-49"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">find_last_of</span><span class="p">(</span><span class="s">&quot;/</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-16-50" name="__codelineno-16-50" href="#__codelineno-16-50"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-16-51" name="__codelineno-16-51" href="#__codelineno-16-51"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">resource</span><span class="o">-&gt;</span><span class="n">Load</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-52" name="__codelineno-16-52" href="#__codelineno-16-52"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to parse resource: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-16-53" name="__codelineno-16-53" href="#__codelineno-16-53"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-16-54" name="__codelineno-16-54" href="#__codelineno-16-54"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-55" name="__codelineno-16-55" href="#__codelineno-16-55"></a>
<a id="__codelineno-16-56" name="__codelineno-16-56" href="#__codelineno-16-56"></a><span class="w">    </span><span class="n">resources_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resource</span><span class="p">;</span>
<a id="__codelineno-16-57" name="__codelineno-16-57" href="#__codelineno-16-57"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">dynamic_pointer_cast</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">resource</span><span class="p">);</span>
<a id="__codelineno-16-58" name="__codelineno-16-58" href="#__codelineno-16-58"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-16-59" name="__codelineno-16-59" href="#__codelineno-16-59"></a><span class="p">}</span>
<a id="__codelineno-16-60" name="__codelineno-16-60" href="#__codelineno-16-60"></a>
<a id="__codelineno-16-61" name="__codelineno-16-61" href="#__codelineno-16-61"></a><span class="kt">void</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">UnloadResource</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-62" name="__codelineno-16-62" href="#__codelineno-16-62"></a><span class="w">  </span><span class="n">resources_</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-16-63" name="__codelineno-16-63" href="#__codelineno-16-63"></a><span class="p">}</span>
<a id="__codelineno-16-64" name="__codelineno-16-64" href="#__codelineno-16-64"></a>
<a id="__codelineno-16-65" name="__codelineno-16-65" href="#__codelineno-16-65"></a><span class="kt">void</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">UnloadAllResources</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-66" name="__codelineno-16-66" href="#__codelineno-16-66"></a><span class="w">  </span><span class="n">resources_</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<a id="__codelineno-16-67" name="__codelineno-16-67" href="#__codelineno-16-67"></a><span class="p">}</span>
<a id="__codelineno-16-68" name="__codelineno-16-68" href="#__codelineno-16-68"></a>
<a id="__codelineno-16-69" name="__codelineno-16-69" href="#__codelineno-16-69"></a><span class="kt">bool</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">PackResources</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pack_path</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">resource_paths</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-70" name="__codelineno-16-70" href="#__codelineno-16-70"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pack_data</span><span class="p">;</span>
<a id="__codelineno-16-71" name="__codelineno-16-71" href="#__codelineno-16-71"></a>
<a id="__codelineno-16-72" name="__codelineno-16-72" href="#__codelineno-16-72"></a><span class="w">  </span><span class="c1">// Write the number of resources</span>
<a id="__codelineno-16-73" name="__codelineno-16-73" href="#__codelineno-16-73"></a><span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_resources</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resource_paths</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<a id="__codelineno-16-74" name="__codelineno-16-74" href="#__codelineno-16-74"></a><span class="w">  </span><span class="n">pack_data</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pack_data</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">num_resources</span><span class="p">),</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">num_resources</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">num_resources</span><span class="p">));</span>
<a id="__codelineno-16-75" name="__codelineno-16-75" href="#__codelineno-16-75"></a>
<a id="__codelineno-16-76" name="__codelineno-16-76" href="#__codelineno-16-76"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">resource_paths</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-77" name="__codelineno-16-77" href="#__codelineno-16-77"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">resource_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoadFile</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-16-78" name="__codelineno-16-78" href="#__codelineno-16-78"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">resource_data</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-79" name="__codelineno-16-79" href="#__codelineno-16-79"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to load resource for packing: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-16-80" name="__codelineno-16-80" href="#__codelineno-16-80"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-16-81" name="__codelineno-16-81" href="#__codelineno-16-81"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-82" name="__codelineno-16-82" href="#__codelineno-16-82"></a>
<a id="__codelineno-16-83" name="__codelineno-16-83" href="#__codelineno-16-83"></a><span class="w">    </span><span class="c1">// Write the resource name</span>
<a id="__codelineno-16-84" name="__codelineno-16-84" href="#__codelineno-16-84"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">path</span><span class="p">.</span><span class="n">substr</span><span class="p">(</span><span class="n">path</span><span class="p">.</span><span class="n">find_last_of</span><span class="p">(</span><span class="s">&quot;/</span><span class="se">\\</span><span class="s">&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-16-85" name="__codelineno-16-85" href="#__codelineno-16-85"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">name_length</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">length</span><span class="p">();</span>
<a id="__codelineno-16-86" name="__codelineno-16-86" href="#__codelineno-16-86"></a><span class="w">    </span><span class="n">pack_data</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pack_data</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name_length</span><span class="p">),</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name_length</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">name_length</span><span class="p">));</span>
<a id="__codelineno-16-87" name="__codelineno-16-87" href="#__codelineno-16-87"></a><span class="w">    </span><span class="n">pack_data</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pack_data</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<a id="__codelineno-16-88" name="__codelineno-16-88" href="#__codelineno-16-88"></a>
<a id="__codelineno-16-89" name="__codelineno-16-89" href="#__codelineno-16-89"></a><span class="w">    </span><span class="c1">// Write the resource data</span>
<a id="__codelineno-16-90" name="__codelineno-16-90" href="#__codelineno-16-90"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">data_size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resource_data</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<a id="__codelineno-16-91" name="__codelineno-16-91" href="#__codelineno-16-91"></a><span class="w">    </span><span class="n">pack_data</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pack_data</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data_size</span><span class="p">),</span><span class="w"> </span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">*&gt;</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data_size</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">data_size</span><span class="p">));</span>
<a id="__codelineno-16-92" name="__codelineno-16-92" href="#__codelineno-16-92"></a><span class="w">    </span><span class="n">pack_data</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">pack_data</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span><span class="w"> </span><span class="n">resource_data</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">resource_data</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<a id="__codelineno-16-93" name="__codelineno-16-93" href="#__codelineno-16-93"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-94" name="__codelineno-16-94" href="#__codelineno-16-94"></a>
<a id="__codelineno-16-95" name="__codelineno-16-95" href="#__codelineno-16-95"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_encryption_enabled_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-96" name="__codelineno-16-96" href="#__codelineno-16-96"></a><span class="w">    </span><span class="n">pack_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Encrypt</span><span class="p">(</span><span class="n">pack_data</span><span class="p">);</span>
<a id="__codelineno-16-97" name="__codelineno-16-97" href="#__codelineno-16-97"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-98" name="__codelineno-16-98" href="#__codelineno-16-98"></a>
<a id="__codelineno-16-99" name="__codelineno-16-99" href="#__codelineno-16-99"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">SaveFile</span><span class="p">(</span><span class="n">pack_path</span><span class="p">,</span><span class="w"> </span><span class="n">pack_data</span><span class="p">);</span>
<a id="__codelineno-16-100" name="__codelineno-16-100" href="#__codelineno-16-100"></a><span class="p">}</span>
<a id="__codelineno-16-101" name="__codelineno-16-101" href="#__codelineno-16-101"></a>
<a id="__codelineno-16-102" name="__codelineno-16-102" href="#__codelineno-16-102"></a><span class="kt">bool</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">UnpackResources</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">pack_path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-103" name="__codelineno-16-103" href="#__codelineno-16-103"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pack_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoadFile</span><span class="p">(</span><span class="n">pack_path</span><span class="p">);</span>
<a id="__codelineno-16-104" name="__codelineno-16-104" href="#__codelineno-16-104"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pack_data</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-105" name="__codelineno-16-105" href="#__codelineno-16-105"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to load resource pack: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pack_path</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-16-106" name="__codelineno-16-106" href="#__codelineno-16-106"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-16-107" name="__codelineno-16-107" href="#__codelineno-16-107"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-108" name="__codelineno-16-108" href="#__codelineno-16-108"></a>
<a id="__codelineno-16-109" name="__codelineno-16-109" href="#__codelineno-16-109"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">is_encryption_enabled_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-110" name="__codelineno-16-110" href="#__codelineno-16-110"></a><span class="w">    </span><span class="n">pack_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Decrypt</span><span class="p">(</span><span class="n">pack_data</span><span class="p">);</span>
<a id="__codelineno-16-111" name="__codelineno-16-111" href="#__codelineno-16-111"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-112" name="__codelineno-16-112" href="#__codelineno-16-112"></a>
<a id="__codelineno-16-113" name="__codelineno-16-113" href="#__codelineno-16-113"></a><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-16-114" name="__codelineno-16-114" href="#__codelineno-16-114"></a>
<a id="__codelineno-16-115" name="__codelineno-16-115" href="#__codelineno-16-115"></a><span class="w">  </span><span class="c1">// Read the number of resources</span>
<a id="__codelineno-16-116" name="__codelineno-16-116" href="#__codelineno-16-116"></a><span class="w">  </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">num_resources</span><span class="p">;</span>
<a id="__codelineno-16-117" name="__codelineno-16-117" href="#__codelineno-16-117"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">num_resources</span><span class="p">,</span><span class="w"> </span><span class="n">pack_data</span><span class="p">.</span><span class="n">data</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">num_resources</span><span class="p">));</span>
<a id="__codelineno-16-118" name="__codelineno-16-118" href="#__codelineno-16-118"></a><span class="w">  </span><span class="n">offset</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">num_resources</span><span class="p">);</span>
<a id="__codelineno-16-119" name="__codelineno-16-119" href="#__codelineno-16-119"></a>
<a id="__codelineno-16-120" name="__codelineno-16-120" href="#__codelineno-16-120"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">num_resources</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-121" name="__codelineno-16-121" href="#__codelineno-16-121"></a><span class="w">    </span><span class="c1">// Read the resource name</span>
<a id="__codelineno-16-122" name="__codelineno-16-122" href="#__codelineno-16-122"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">name_length</span><span class="p">;</span>
<a id="__codelineno-16-123" name="__codelineno-16-123" href="#__codelineno-16-123"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">name_length</span><span class="p">,</span><span class="w"> </span><span class="n">pack_data</span><span class="p">.</span><span class="n">data</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">name_length</span><span class="p">));</span>
<a id="__codelineno-16-124" name="__codelineno-16-124" href="#__codelineno-16-124"></a><span class="w">    </span><span class="n">offset</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">name_length</span><span class="p">);</span>
<a id="__codelineno-16-125" name="__codelineno-16-125" href="#__codelineno-16-125"></a>
<a id="__codelineno-16-126" name="__codelineno-16-126" href="#__codelineno-16-126"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">name</span><span class="p">(</span><span class="n">pack_data</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">pack_data</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">name_length</span><span class="p">);</span>
<a id="__codelineno-16-127" name="__codelineno-16-127" href="#__codelineno-16-127"></a><span class="w">    </span><span class="n">offset</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">name_length</span><span class="p">;</span>
<a id="__codelineno-16-128" name="__codelineno-16-128" href="#__codelineno-16-128"></a>
<a id="__codelineno-16-129" name="__codelineno-16-129" href="#__codelineno-16-129"></a><span class="w">    </span><span class="c1">// Read the resource data</span>
<a id="__codelineno-16-130" name="__codelineno-16-130" href="#__codelineno-16-130"></a><span class="w">    </span><span class="kt">uint32_t</span><span class="w"> </span><span class="n">data_size</span><span class="p">;</span>
<a id="__codelineno-16-131" name="__codelineno-16-131" href="#__codelineno-16-131"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">memcpy</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data_size</span><span class="p">,</span><span class="w"> </span><span class="n">pack_data</span><span class="p">.</span><span class="n">data</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">data_size</span><span class="p">));</span>
<a id="__codelineno-16-132" name="__codelineno-16-132" href="#__codelineno-16-132"></a><span class="w">    </span><span class="n">offset</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">data_size</span><span class="p">);</span>
<a id="__codelineno-16-133" name="__codelineno-16-133" href="#__codelineno-16-133"></a>
<a id="__codelineno-16-134" name="__codelineno-16-134" href="#__codelineno-16-134"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">resource_data</span><span class="p">(</span><span class="n">pack_data</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="p">,</span><span class="w"> </span><span class="n">pack_data</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">offset</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">data_size</span><span class="p">);</span>
<a id="__codelineno-16-135" name="__codelineno-16-135" href="#__codelineno-16-135"></a><span class="w">    </span><span class="n">offset</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">data_size</span><span class="p">;</span>
<a id="__codelineno-16-136" name="__codelineno-16-136" href="#__codelineno-16-136"></a>
<a id="__codelineno-16-137" name="__codelineno-16-137" href="#__codelineno-16-137"></a><span class="w">    </span><span class="c1">// Create and load the resource</span>
<a id="__codelineno-16-138" name="__codelineno-16-138" href="#__codelineno-16-138"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">resource</span><span class="p">;</span>
<a id="__codelineno-16-139" name="__codelineno-16-139" href="#__codelineno-16-139"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="s">&quot;.png&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="s">&quot;.jpg&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-140" name="__codelineno-16-140" href="#__codelineno-16-140"></a><span class="w">      </span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Texture</span><span class="o">&gt;</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-16-141" name="__codelineno-16-141" href="#__codelineno-16-141"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="s">&quot;.obj&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="s">&quot;.fbx&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-142" name="__codelineno-16-142" href="#__codelineno-16-142"></a><span class="w">      </span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Model</span><span class="o">&gt;</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-16-143" name="__codelineno-16-143" href="#__codelineno-16-143"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="s">&quot;.glsl&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-144" name="__codelineno-16-144" href="#__codelineno-16-144"></a><span class="w">      </span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Shader</span><span class="o">&gt;</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-16-145" name="__codelineno-16-145" href="#__codelineno-16-145"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="s">&quot;.wav&quot;</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="s">&quot;.mp3&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-146" name="__codelineno-16-146" href="#__codelineno-16-146"></a><span class="w">      </span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Audio</span><span class="o">&gt;</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-16-147" name="__codelineno-16-147" href="#__codelineno-16-147"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">name</span><span class="p">.</span><span class="n">ends_with</span><span class="p">(</span><span class="s">&quot;.ttf&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-148" name="__codelineno-16-148" href="#__codelineno-16-148"></a><span class="w">      </span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">Font</span><span class="o">&gt;</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-16-149" name="__codelineno-16-149" href="#__codelineno-16-149"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-150" name="__codelineno-16-150" href="#__codelineno-16-150"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Unknown resource type: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-16-151" name="__codelineno-16-151" href="#__codelineno-16-151"></a><span class="w">      </span><span class="k">continue</span><span class="p">;</span>
<a id="__codelineno-16-152" name="__codelineno-16-152" href="#__codelineno-16-152"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-153" name="__codelineno-16-153" href="#__codelineno-16-153"></a>
<a id="__codelineno-16-154" name="__codelineno-16-154" href="#__codelineno-16-154"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">resource</span><span class="o">-&gt;</span><span class="n">Load</span><span class="p">(</span><span class="n">resource_data</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-155" name="__codelineno-16-155" href="#__codelineno-16-155"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to load resource: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">name</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-16-156" name="__codelineno-16-156" href="#__codelineno-16-156"></a><span class="w">      </span><span class="k">continue</span><span class="p">;</span>
<a id="__codelineno-16-157" name="__codelineno-16-157" href="#__codelineno-16-157"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-16-158" name="__codelineno-16-158" href="#__codelineno-16-158"></a>
<a id="__codelineno-16-159" name="__codelineno-16-159" href="#__codelineno-16-159"></a><span class="w">    </span><span class="n">resources_</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resource</span><span class="p">;</span>
<a id="__codelineno-16-160" name="__codelineno-16-160" href="#__codelineno-16-160"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-161" name="__codelineno-16-161" href="#__codelineno-16-161"></a>
<a id="__codelineno-16-162" name="__codelineno-16-162" href="#__codelineno-16-162"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-16-163" name="__codelineno-16-163" href="#__codelineno-16-163"></a><span class="p">}</span>
<a id="__codelineno-16-164" name="__codelineno-16-164" href="#__codelineno-16-164"></a>
<a id="__codelineno-16-165" name="__codelineno-16-165" href="#__codelineno-16-165"></a><span class="kt">void</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">SetEncryptionKey</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-166" name="__codelineno-16-166" href="#__codelineno-16-166"></a><span class="w">  </span><span class="n">aes_</span><span class="p">.</span><span class="n">SetKey</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<a id="__codelineno-16-167" name="__codelineno-16-167" href="#__codelineno-16-167"></a><span class="w">  </span><span class="n">is_encryption_enabled_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-16-168" name="__codelineno-16-168" href="#__codelineno-16-168"></a><span class="p">}</span>
<a id="__codelineno-16-169" name="__codelineno-16-169" href="#__codelineno-16-169"></a>
<a id="__codelineno-16-170" name="__codelineno-16-170" href="#__codelineno-16-170"></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadFile</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-171" name="__codelineno-16-171" href="#__codelineno-16-171"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span><span class="w"> </span><span class="nf">file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">ate</span><span class="p">);</span>
<a id="__codelineno-16-172" name="__codelineno-16-172" href="#__codelineno-16-172"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="p">.</span><span class="n">is_open</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-173" name="__codelineno-16-173" href="#__codelineno-16-173"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-16-174" name="__codelineno-16-174" href="#__codelineno-16-174"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-175" name="__codelineno-16-175" href="#__codelineno-16-175"></a>
<a id="__codelineno-16-176" name="__codelineno-16-176" href="#__codelineno-16-176"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">streamsize</span><span class="w"> </span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file</span><span class="p">.</span><span class="n">tellg</span><span class="p">();</span>
<a id="__codelineno-16-177" name="__codelineno-16-177" href="#__codelineno-16-177"></a><span class="w">  </span><span class="n">file</span><span class="p">.</span><span class="n">seekg</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">beg</span><span class="p">);</span>
<a id="__codelineno-16-178" name="__codelineno-16-178" href="#__codelineno-16-178"></a>
<a id="__codelineno-16-179" name="__codelineno-16-179" href="#__codelineno-16-179"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buffer</span><span class="p">(</span><span class="n">size</span><span class="p">);</span>
<a id="__codelineno-16-180" name="__codelineno-16-180" href="#__codelineno-16-180"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">buffer</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="n">size</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-181" name="__codelineno-16-181" href="#__codelineno-16-181"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{};</span>
<a id="__codelineno-16-182" name="__codelineno-16-182" href="#__codelineno-16-182"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-183" name="__codelineno-16-183" href="#__codelineno-16-183"></a>
<a id="__codelineno-16-184" name="__codelineno-16-184" href="#__codelineno-16-184"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span>
<a id="__codelineno-16-185" name="__codelineno-16-185" href="#__codelineno-16-185"></a><span class="p">}</span>
<a id="__codelineno-16-186" name="__codelineno-16-186" href="#__codelineno-16-186"></a>
<a id="__codelineno-16-187" name="__codelineno-16-187" href="#__codelineno-16-187"></a><span class="kt">bool</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">SaveFile</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-188" name="__codelineno-16-188" href="#__codelineno-16-188"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="w"> </span><span class="nf">file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">ios</span><span class="o">::</span><span class="n">binary</span><span class="p">);</span>
<a id="__codelineno-16-189" name="__codelineno-16-189" href="#__codelineno-16-189"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file</span><span class="p">.</span><span class="n">is_open</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-190" name="__codelineno-16-190" href="#__codelineno-16-190"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-16-191" name="__codelineno-16-191" href="#__codelineno-16-191"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-16-192" name="__codelineno-16-192" href="#__codelineno-16-192"></a>
<a id="__codelineno-16-193" name="__codelineno-16-193" href="#__codelineno-16-193"></a><span class="w">  </span><span class="n">file</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">data</span><span class="p">.</span><span class="n">data</span><span class="p">()),</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">());</span>
<a id="__codelineno-16-194" name="__codelineno-16-194" href="#__codelineno-16-194"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-16-195" name="__codelineno-16-195" href="#__codelineno-16-195"></a><span class="p">}</span>
<a id="__codelineno-16-196" name="__codelineno-16-196" href="#__codelineno-16-196"></a>
<a id="__codelineno-16-197" name="__codelineno-16-197" href="#__codelineno-16-197"></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">Encrypt</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-198" name="__codelineno-16-198" href="#__codelineno-16-198"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">aes_</span><span class="p">.</span><span class="n">Encrypt</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-16-199" name="__codelineno-16-199" href="#__codelineno-16-199"></a><span class="p">}</span>
<a id="__codelineno-16-200" name="__codelineno-16-200" href="#__codelineno-16-200"></a>
<a id="__codelineno-16-201" name="__codelineno-16-201" href="#__codelineno-16-201"></a><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">Decrypt</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">uint8_t</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-16-202" name="__codelineno-16-202" href="#__codelineno-16-202"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">aes_</span><span class="p">.</span><span class="n">Decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-16-203" name="__codelineno-16-203" href="#__codelineno-16-203"></a><span class="p">}</span>
<a id="__codelineno-16-204" name="__codelineno-16-204" href="#__codelineno-16-204"></a>
<a id="__codelineno-16-205" name="__codelineno-16-205" href="#__codelineno-16-205"></a><span class="c1">// Explicit template instantiations</span>
<a id="__codelineno-16-206" name="__codelineno-16-206" href="#__codelineno-16-206"></a><span class="k">template</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Texture</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetResource</span><span class="o">&lt;</span><span class="n">Texture</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-16-207" name="__codelineno-16-207" href="#__codelineno-16-207"></a><span class="k">template</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Model</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetResource</span><span class="o">&lt;</span><span class="n">Model</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-16-208" name="__codelineno-16-208" href="#__codelineno-16-208"></a><span class="k">template</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Shader</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetResource</span><span class="o">&lt;</span><span class="n">Shader</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-16-209" name="__codelineno-16-209" href="#__codelineno-16-209"></a><span class="k">template</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Audio</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetResource</span><span class="o">&lt;</span><span class="n">Audio</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-16-210" name="__codelineno-16-210" href="#__codelineno-16-210"></a><span class="k">template</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Font</span><span class="o">&gt;</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetResource</span><span class="o">&lt;</span><span class="n">Font</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-16-211" name="__codelineno-16-211" href="#__codelineno-16-211"></a>
<a id="__codelineno-16-212" name="__codelineno-16-212" href="#__codelineno-16-212"></a><span class="k">template</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Texture</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadResourceAsync</span><span class="o">&lt;</span><span class="n">Texture</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-16-213" name="__codelineno-16-213" href="#__codelineno-16-213"></a><span class="k">template</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Model</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadResourceAsync</span><span class="o">&lt;</span><span class="n">Model</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-16-214" name="__codelineno-16-214" href="#__codelineno-16-214"></a><span class="k">template</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Shader</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadResourceAsync</span><span class="o">&lt;</span><span class="n">Shader</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-16-215" name="__codelineno-16-215" href="#__codelineno-16-215"></a><span class="k">template</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Audio</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadResourceAsync</span><span class="o">&lt;</span><span class="n">Audio</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-16-216" name="__codelineno-16-216" href="#__codelineno-16-216"></a><span class="k">template</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">future</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Font</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">LoadResourceAsync</span><span class="o">&lt;</span><span class="n">Font</span><span class="o">&gt;</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-16-217" name="__codelineno-16-217" href="#__codelineno-16-217"></a>
<a id="__codelineno-16-218" name="__codelineno-16-218" href="#__codelineno-16-218"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace graphics</span>
</code></pre></div>
<p>This implementation follows several best practices:</p>
<ol>
<li>Use of namespaces to avoid naming conflicts.</li>
<li>Clear separation of interface (header) and implementation (source) files.</li>
<li>Consistent naming conventions (e.g., method names are CamelCase, member variables end with underscore).</li>
<li>Use of <code>const</code> for methods that don't modify object state.</li>
<li>Virtual destructor in the base class to ensure proper cleanup of derived classes.</li>
<li>Use of <code>std::shared_ptr</code> for memory management of resources.</li>
<li>Use of templates for type-safe resource retrieval and loading.</li>
<li>Asynchronous loading using <code>std::future</code> and a thread pool.</li>
<li>Singleton pattern for ResourceManager implemented in a thread-safe manner.</li>
<li>Support for resource packing and unpacking.</li>
<li>Optional encryption using AES.</li>
</ol>
<p>To use this ResourceManager in your application:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a><span class="c1">// main.cc</span>
<a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;resource_manager.h&quot;</span>
<a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>
<a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w">  </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">resource_manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">graphics</span><span class="o">::</span><span class="n">ResourceManager</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">();</span>
<a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a>
<a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w">  </span><span class="c1">// Set encryption key (optional)</span>
<a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w">  </span><span class="n">resource_manager</span><span class="p">.</span><span class="n">SetEncryptionKey</span><span class="p">(</span><span class="s">&quot;MySecretKey123&quot;</span><span class="p">);</span>
<a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a>
<a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w">  </span><span class="c1">// Async loading of a texture</span>
<a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">texture_future</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resource_manager</span><span class="p">.</span><span class="n">LoadResourceAsync</span><span class="o">&lt;</span><span class="n">graphics</span><span class="o">::</span><span class="n">Texture</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;textures/example.png&quot;</span><span class="p">);</span>
<a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a>
<a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="w">  </span><span class="c1">// Do other work while the texture is loading...</span>
<a id="__codelineno-17-15" name="__codelineno-17-15" href="#__codelineno-17-15"></a>
<a id="__codelineno-17-16" name="__codelineno-17-16" href="#__codelineno-17-16"></a><span class="w">  </span><span class="c1">// Get the loaded texture</span>
<a id="__codelineno-17-17" name="__codelineno-17-17" href="#__codelineno-17-17"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">texture</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">texture_future</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<a id="__codelineno-17-18" name="__codelineno-17-18" href="#__codelineno-17-18"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">texture</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-19" name="__codelineno-17-19" href="#__codelineno-17-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Texture loaded successfully: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">texture</span><span class="o">-&gt;</span><span class="n">GetName</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-17-20" name="__codelineno-17-20" href="#__codelineno-17-20"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-21" name="__codelineno-17-21" href="#__codelineno-17-21"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to load texture&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-17-22" name="__codelineno-17-22" href="#__codelineno-17-22"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-17-23" name="__codelineno-17-23" href="#__codelineno-17-23"></a>
<a id="__codelineno-17-24" name="__codelineno-17-24" href="#__codelineno-17-24"></a><span class="w">  </span><span class="c1">// Pack resources</span>
<a id="__codelineno-17-25" name="__codelineno-17-25" href="#__codelineno-17-25"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">resource_paths</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-26" name="__codelineno-17-26" href="#__codelineno-17-26"></a><span class="w">    </span><span class="s">&quot;textures/example.png&quot;</span><span class="p">,</span>
<a id="__codelineno-17-27" name="__codelineno-17-27" href="#__codelineno-17-27"></a><span class="w">    </span><span class="s">&quot;models/character.obj&quot;</span><span class="p">,</span>
<a id="__codelineno-17-28" name="__codelineno-17-28" href="#__codelineno-17-28"></a><span class="w">    </span><span class="s">&quot;shaders/lighting.glsl&quot;</span><span class="p">,</span>
<a id="__codelineno-17-29" name="__codelineno-17-29" href="#__codelineno-17-29"></a><span class="w">    </span><span class="s">&quot;audio/background.mp3&quot;</span><span class="p">,</span>
<a id="__codelineno-17-30" name="__codelineno-17-30" href="#__codelineno-17-30"></a><span class="w">    </span><span class="s">&quot;fonts/arial.ttf&quot;</span>
<a id="__codelineno-17-31" name="__codelineno-17-31" href="#__codelineno-17-31"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-17-32" name="__codelineno-17-32" href="#__codelineno-17-32"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">resource_manager</span><span class="p">.</span><span class="n">PackResources</span><span class="p">(</span><span class="s">&quot;resources.pack&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">resource_paths</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-33" name="__codelineno-17-33" href="#__codelineno-17-33"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Resources packed successfully&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-17-34" name="__codelineno-17-34" href="#__codelineno-17-34"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-35" name="__codelineno-17-35" href="#__codelineno-17-35"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to pack resources&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-17-36" name="__codelineno-17-36" href="#__codelineno-17-36"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-17-37" name="__codelineno-17-37" href="#__codelineno-17-37"></a>
<a id="__codelineno-17-38" name="__codelineno-17-38" href="#__codelineno-17-38"></a><span class="w">  </span><span class="c1">// Unpack resources</span>
<a id="__codelineno-17-39" name="__codelineno-17-39" href="#__codelineno-17-39"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">resource_manager</span><span class="p">.</span><span class="n">UnpackResources</span><span class="p">(</span><span class="s">&quot;resources.pack&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-40" name="__codelineno-17-40" href="#__codelineno-17-40"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Resources unpacked successfully&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-17-41" name="__codelineno-17-41" href="#__codelineno-17-41"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-42" name="__codelineno-17-42" href="#__codelineno-17-42"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to unpack resources&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-17-43" name="__codelineno-17-43" href="#__codelineno-17-43"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-17-44" name="__codelineno-17-44" href="#__codelineno-17-44"></a>
<a id="__codelineno-17-45" name="__codelineno-17-45" href="#__codelineno-17-45"></a><span class="w">  </span><span class="c1">// Get a resource</span>
<a id="__codelineno-17-46" name="__codelineno-17-46" href="#__codelineno-17-46"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resource_manager</span><span class="p">.</span><span class="n">GetResource</span><span class="o">&lt;</span><span class="n">graphics</span><span class="o">::</span><span class="n">Model</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;character.obj&quot;</span><span class="p">);</span>
<a id="__codelineno-17-47" name="__codelineno-17-47" href="#__codelineno-17-47"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-48" name="__codelineno-17-48" href="#__codelineno-17-48"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Model retrieved successfully: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">model</span><span class="o">-&gt;</span><span class="n">GetName</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-17-49" name="__codelineno-17-49" href="#__codelineno-17-49"></a><span class="w">  </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-17-50" name="__codelineno-17-50" href="#__codelineno-17-50"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to retrieve model&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-17-51" name="__codelineno-17-51" href="#__codelineno-17-51"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-17-52" name="__codelineno-17-52" href="#__codelineno-17-52"></a>
<a id="__codelineno-17-53" name="__codelineno-17-53" href="#__codelineno-17-53"></a><span class="w">  </span><span class="c1">// Unload a specific resource</span>
<a id="__codelineno-17-54" name="__codelineno-17-54" href="#__codelineno-17-54"></a><span class="w">  </span><span class="n">resource_manager</span><span class="p">.</span><span class="n">UnloadResource</span><span class="p">(</span><span class="s">&quot;example.png&quot;</span><span class="p">);</span>
<a id="__codelineno-17-55" name="__codelineno-17-55" href="#__codelineno-17-55"></a>
<a id="__codelineno-17-56" name="__codelineno-17-56" href="#__codelineno-17-56"></a><span class="w">  </span><span class="c1">// Unload all resources</span>
<a id="__codelineno-17-57" name="__codelineno-17-57" href="#__codelineno-17-57"></a><span class="w">  </span><span class="n">resource_manager</span><span class="p">.</span><span class="n">UnloadAllResources</span><span class="p">();</span>
<a id="__codelineno-17-58" name="__codelineno-17-58" href="#__codelineno-17-58"></a>
<a id="__codelineno-17-59" name="__codelineno-17-59" href="#__codelineno-17-59"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-17-60" name="__codelineno-17-60" href="#__codelineno-17-60"></a><span class="p">}</span>
</code></pre></div>
<p>This ResourceManager system provides a comprehensive solution for managing game resources. It supports:</p>
<ol>
<li>Asynchronous loading of resources</li>
<li>Type-safe resource retrieval</li>
<li>Resource packing and unpacking for efficient storage and distribution</li>
<li>Optional encryption for protecting sensitive resources</li>
<li>Multiple resource types (Texture, Model, Shader, Audio, Font)</li>
<li>Easy extension to support new resource types</li>
</ol>
<p>Remember to implement the specific resource classes (Texture, Model, Shader, Audio, Font) with their respective Load and Serialize methods. The ResourceManager provides a flexible and robust foundation for managing game resources in a professional, production-ready manner.</p>
<h4 id="data-structures-for-efficient-resource-handling">Data Structures for Efficient Resource Handling</h4>
<p>Choosing the right data structures is crucial for efficient resource management.</p>
<ul>
<li>
<p><strong>Resource Cache:</strong> A cache stores recently used assets to avoid redundant loading and improve performance.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ResourceCache</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="w">    </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="kt">string</span><span class="p">,</span><span class="w"> </span><span class="n">Texture</span><span class="o">&gt;</span><span class="w"> </span><span class="n">cache</span><span class="p">;</span>
<a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a><span class="w">    </span><span class="n">Texture</span><span class="w"> </span><span class="nf">GetTexture</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">cache</span><span class="p">.</span><span class="n">ContainsKey</span><span class="p">(</span><span class="n">path</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">            </span><span class="n">cache</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">LoadTexture</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">cache</span><span class="p">[</span><span class="n">path</span><span class="p">];</span>
<a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="p">};</span>
</code></pre></div>
</li>
<li>
<p><strong>Reference Counting:</strong> Keeps track of how many times an asset is referenced. When the reference count drops to zero, the asset is unloaded.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Texture</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-2" name="__codelineno-19-2" href="#__codelineno-19-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">referenceCount</span><span class="p">;</span>
<a id="__codelineno-19-3" name="__codelineno-19-3" href="#__codelineno-19-3"></a><span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">AddReference</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">referenceCount</span><span class="o">++</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-19-4" name="__codelineno-19-4" href="#__codelineno-19-4"></a><span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">RemoveReference</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-5" name="__codelineno-19-5" href="#__codelineno-19-5"></a><span class="w">        </span><span class="n">referenceCount</span><span class="o">--</span><span class="p">;</span>
<a id="__codelineno-19-6" name="__codelineno-19-6" href="#__codelineno-19-6"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">referenceCount</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="m">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-19-7" name="__codelineno-19-7" href="#__codelineno-19-7"></a><span class="w">            </span><span class="n">UnloadTexture</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
<a id="__codelineno-19-8" name="__codelineno-19-8" href="#__codelineno-19-8"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-19-9" name="__codelineno-19-9" href="#__codelineno-19-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-19-10" name="__codelineno-19-10" href="#__codelineno-19-10"></a><span class="p">};</span>
</code></pre></div>
</li>
<li>
<p><strong>Resource Pools:</strong> Pre-allocate a pool of objects and reuse them to reduce the overhead of frequent allocations and deallocations.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ObjectPool</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="k">where</span><span class="w"> </span><span class="n">T</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w">    </span><span class="n">Stack</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">pool</span><span class="p">;</span>
<a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a><span class="w">    </span><span class="n">T</span><span class="w"> </span><span class="nf">GetObject</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">pool</span><span class="p">.</span><span class="n">Count</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="m">0</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">pool</span><span class="p">.</span><span class="n">Pop</span><span class="p">()</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">T</span><span class="p">();</span>
<a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w">    </span><span class="k">void</span><span class="w"> </span><span class="nf">ReturnObject</span><span class="p">(</span><span class="n">T</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w">        </span><span class="n">pool</span><span class="p">.</span><span class="n">Push</span><span class="p">(</span><span class="n">obj</span><span class="p">);</span>
<a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="p">};</span>
</code></pre></div>
</li>
</ul>
<h4 id="resource-caching">Resource caching</h4>
<p>Resource caching is a crucial optimization technique in game engines that helps manage and reuse frequently accessed assets such as textures, models, sounds, and other game data. The main goals of resource caching are:</p>
<ol>
<li>Reduce load times</li>
<li>Minimize memory usage</li>
<li>Optimize resource access</li>
<li>Manage resource lifetimes</li>
</ol>
<p>Let's implement a basic resource caching system that demonstrates these concepts:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-21-2" name="__codelineno-21-2" href="#__codelineno-21-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unordered_map&gt;</span>
<a id="__codelineno-21-3" name="__codelineno-21-3" href="#__codelineno-21-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-21-4" name="__codelineno-21-4" href="#__codelineno-21-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;chrono&gt;</span>
<a id="__codelineno-21-5" name="__codelineno-21-5" href="#__codelineno-21-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-21-6" name="__codelineno-21-6" href="#__codelineno-21-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;mutex&gt;</span>
<a id="__codelineno-21-7" name="__codelineno-21-7" href="#__codelineno-21-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;shared_mutex&gt;</span>
<a id="__codelineno-21-8" name="__codelineno-21-8" href="#__codelineno-21-8"></a>
<a id="__codelineno-21-9" name="__codelineno-21-9" href="#__codelineno-21-9"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">engine</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-10" name="__codelineno-21-10" href="#__codelineno-21-10"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">resource</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-11" name="__codelineno-21-11" href="#__codelineno-21-11"></a>
<a id="__codelineno-21-12" name="__codelineno-21-12" href="#__codelineno-21-12"></a><span class="c1">// Forward declarations</span>
<a id="__codelineno-21-13" name="__codelineno-21-13" href="#__codelineno-21-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">Resource</span><span class="p">;</span>
<a id="__codelineno-21-14" name="__codelineno-21-14" href="#__codelineno-21-14"></a><span class="k">class</span><span class="w"> </span><span class="nc">ResourceLoader</span><span class="p">;</span>
<a id="__codelineno-21-15" name="__codelineno-21-15" href="#__codelineno-21-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">ResourceCache</span><span class="p">;</span>
<a id="__codelineno-21-16" name="__codelineno-21-16" href="#__codelineno-21-16"></a>
<a id="__codelineno-21-17" name="__codelineno-21-17" href="#__codelineno-21-17"></a><span class="c1">// Base class for all cacheable resources</span>
<a id="__codelineno-21-18" name="__codelineno-21-18" href="#__codelineno-21-18"></a><span class="k">class</span><span class="w"> </span><span class="nc">Resource</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-19" name="__codelineno-21-19" href="#__codelineno-21-19"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-21-20" name="__codelineno-21-20" href="#__codelineno-21-20"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">Resource</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-21-21" name="__codelineno-21-21" href="#__codelineno-21-21"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">size_t</span><span class="w"> </span><span class="nf">GetMemoryUsage</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-21-22" name="__codelineno-21-22" href="#__codelineno-21-22"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Unload</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-21-23" name="__codelineno-21-23" href="#__codelineno-21-23"></a><span class="p">};</span>
<a id="__codelineno-21-24" name="__codelineno-21-24" href="#__codelineno-21-24"></a>
<a id="__codelineno-21-25" name="__codelineno-21-25" href="#__codelineno-21-25"></a><span class="c1">// Interface for resource loaders</span>
<a id="__codelineno-21-26" name="__codelineno-21-26" href="#__codelineno-21-26"></a><span class="k">class</span><span class="w"> </span><span class="nc">ResourceLoader</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-27" name="__codelineno-21-27" href="#__codelineno-21-27"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-21-28" name="__codelineno-21-28" href="#__codelineno-21-28"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">ResourceLoader</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-21-29" name="__codelineno-21-29" href="#__codelineno-21-29"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Load</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-21-30" name="__codelineno-21-30" href="#__codelineno-21-30"></a><span class="p">};</span>
<a id="__codelineno-21-31" name="__codelineno-21-31" href="#__codelineno-21-31"></a>
<a id="__codelineno-21-32" name="__codelineno-21-32" href="#__codelineno-21-32"></a><span class="c1">// Resource cache management class</span>
<a id="__codelineno-21-33" name="__codelineno-21-33" href="#__codelineno-21-33"></a><span class="k">class</span><span class="w"> </span><span class="nc">ResourceCache</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-34" name="__codelineno-21-34" href="#__codelineno-21-34"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-21-35" name="__codelineno-21-35" href="#__codelineno-21-35"></a><span class="w">  </span><span class="n">ResourceCache</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">capacity</span><span class="p">)</span>
<a id="__codelineno-21-36" name="__codelineno-21-36" href="#__codelineno-21-36"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="n">capacity_</span><span class="p">(</span><span class="n">capacity</span><span class="p">),</span><span class="w"> </span><span class="n">current_usage_</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-21-37" name="__codelineno-21-37" href="#__codelineno-21-37"></a>
<a id="__codelineno-21-38" name="__codelineno-21-38" href="#__codelineno-21-38"></a><span class="w">  </span><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">T</span><span class="o">&gt;</span>
<a id="__codelineno-21-39" name="__codelineno-21-39" href="#__codelineno-21-39"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Get</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">ResourceLoader</span><span class="o">&amp;</span><span class="w"> </span><span class="n">loader</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-40" name="__codelineno-21-40" href="#__codelineno-21-40"></a><span class="w">    </span><span class="k">static_assert</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">is_base_of</span><span class="o">&lt;</span><span class="n">Resource</span><span class="p">,</span><span class="w"> </span><span class="n">T</span><span class="o">&gt;::</span><span class="n">value</span><span class="p">,</span>
<a id="__codelineno-21-41" name="__codelineno-21-41" href="#__codelineno-21-41"></a><span class="w">                  </span><span class="s">&quot;T must inherit from Resource&quot;</span><span class="p">);</span>
<a id="__codelineno-21-42" name="__codelineno-21-42" href="#__codelineno-21-42"></a>
<a id="__codelineno-21-43" name="__codelineno-21-43" href="#__codelineno-21-43"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">read_lock</span><span class="p">(</span><span class="n">mutex_</span><span class="p">);</span>
<a id="__codelineno-21-44" name="__codelineno-21-44" href="#__codelineno-21-44"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resources_</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-21-45" name="__codelineno-21-45" href="#__codelineno-21-45"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">resources_</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-46" name="__codelineno-21-46" href="#__codelineno-21-46"></a><span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">dynamic_pointer_cast</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">resource</span><span class="p">);</span>
<a id="__codelineno-21-47" name="__codelineno-21-47" href="#__codelineno-21-47"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">resource</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-48" name="__codelineno-21-48" href="#__codelineno-21-48"></a><span class="w">        </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">last_used</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">steady_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
<a id="__codelineno-21-49" name="__codelineno-21-49" href="#__codelineno-21-49"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">resource</span><span class="p">;</span>
<a id="__codelineno-21-50" name="__codelineno-21-50" href="#__codelineno-21-50"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-21-51" name="__codelineno-21-51" href="#__codelineno-21-51"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-52" name="__codelineno-21-52" href="#__codelineno-21-52"></a><span class="w">    </span><span class="n">read_lock</span><span class="p">.</span><span class="n">unlock</span><span class="p">();</span>
<a id="__codelineno-21-53" name="__codelineno-21-53" href="#__codelineno-21-53"></a>
<a id="__codelineno-21-54" name="__codelineno-21-54" href="#__codelineno-21-54"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">write_lock</span><span class="p">(</span><span class="n">mutex_</span><span class="p">);</span>
<a id="__codelineno-21-55" name="__codelineno-21-55" href="#__codelineno-21-55"></a><span class="w">    </span><span class="c1">// Check again in case another thread loaded the resource</span>
<a id="__codelineno-21-56" name="__codelineno-21-56" href="#__codelineno-21-56"></a><span class="w">    </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">resources_</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-21-57" name="__codelineno-21-57" href="#__codelineno-21-57"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">resources_</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-58" name="__codelineno-21-58" href="#__codelineno-21-58"></a><span class="w">      </span><span class="k">auto</span><span class="w"> </span><span class="n">resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">dynamic_pointer_cast</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">resource</span><span class="p">);</span>
<a id="__codelineno-21-59" name="__codelineno-21-59" href="#__codelineno-21-59"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">resource</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-60" name="__codelineno-21-60" href="#__codelineno-21-60"></a><span class="w">        </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">last_used</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">steady_clock</span><span class="o">::</span><span class="n">now</span><span class="p">();</span>
<a id="__codelineno-21-61" name="__codelineno-21-61" href="#__codelineno-21-61"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">resource</span><span class="p">;</span>
<a id="__codelineno-21-62" name="__codelineno-21-62" href="#__codelineno-21-62"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-21-63" name="__codelineno-21-63" href="#__codelineno-21-63"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-64" name="__codelineno-21-64" href="#__codelineno-21-64"></a>
<a id="__codelineno-21-65" name="__codelineno-21-65" href="#__codelineno-21-65"></a><span class="w">    </span><span class="c1">// Load the resource</span>
<a id="__codelineno-21-66" name="__codelineno-21-66" href="#__codelineno-21-66"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">new_resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">loader</span><span class="p">.</span><span class="n">Load</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-21-67" name="__codelineno-21-67" href="#__codelineno-21-67"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">new_resource</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-68" name="__codelineno-21-68" href="#__codelineno-21-68"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-21-69" name="__codelineno-21-69" href="#__codelineno-21-69"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-70" name="__codelineno-21-70" href="#__codelineno-21-70"></a>
<a id="__codelineno-21-71" name="__codelineno-21-71" href="#__codelineno-21-71"></a><span class="w">    </span><span class="c1">// Make room for the new resource if necessary</span>
<a id="__codelineno-21-72" name="__codelineno-21-72" href="#__codelineno-21-72"></a><span class="w">    </span><span class="n">MakeRoom</span><span class="p">(</span><span class="n">new_resource</span><span class="o">-&gt;</span><span class="n">GetMemoryUsage</span><span class="p">());</span>
<a id="__codelineno-21-73" name="__codelineno-21-73" href="#__codelineno-21-73"></a>
<a id="__codelineno-21-74" name="__codelineno-21-74" href="#__codelineno-21-74"></a><span class="w">    </span><span class="c1">// Add the new resource to the cache</span>
<a id="__codelineno-21-75" name="__codelineno-21-75" href="#__codelineno-21-75"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">shared_resource</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">(</span>
<a id="__codelineno-21-76" name="__codelineno-21-76" href="#__codelineno-21-76"></a><span class="w">        </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">T</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">new_resource</span><span class="p">.</span><span class="n">release</span><span class="p">()),</span>
<a id="__codelineno-21-77" name="__codelineno-21-77" href="#__codelineno-21-77"></a><span class="w">        </span><span class="p">[</span><span class="k">this</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">](</span><span class="n">T</span><span class="o">*</span><span class="w"> </span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-78" name="__codelineno-21-78" href="#__codelineno-21-78"></a><span class="w">          </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex_</span><span class="p">);</span>
<a id="__codelineno-21-79" name="__codelineno-21-79" href="#__codelineno-21-79"></a><span class="w">          </span><span class="n">current_usage_</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">ptr</span><span class="o">-&gt;</span><span class="n">GetMemoryUsage</span><span class="p">();</span>
<a id="__codelineno-21-80" name="__codelineno-21-80" href="#__codelineno-21-80"></a><span class="w">          </span><span class="n">resources_</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-21-81" name="__codelineno-21-81" href="#__codelineno-21-81"></a><span class="w">          </span><span class="k">delete</span><span class="w"> </span><span class="n">ptr</span><span class="p">;</span>
<a id="__codelineno-21-82" name="__codelineno-21-82" href="#__codelineno-21-82"></a><span class="w">        </span><span class="p">});</span>
<a id="__codelineno-21-83" name="__codelineno-21-83" href="#__codelineno-21-83"></a>
<a id="__codelineno-21-84" name="__codelineno-21-84" href="#__codelineno-21-84"></a><span class="w">    </span><span class="n">resources_</span><span class="p">[</span><span class="n">path</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">shared_resource</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">steady_clock</span><span class="o">::</span><span class="n">now</span><span class="p">()};</span>
<a id="__codelineno-21-85" name="__codelineno-21-85" href="#__codelineno-21-85"></a><span class="w">    </span><span class="n">current_usage_</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">shared_resource</span><span class="o">-&gt;</span><span class="n">GetMemoryUsage</span><span class="p">();</span>
<a id="__codelineno-21-86" name="__codelineno-21-86" href="#__codelineno-21-86"></a>
<a id="__codelineno-21-87" name="__codelineno-21-87" href="#__codelineno-21-87"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">shared_resource</span><span class="p">;</span>
<a id="__codelineno-21-88" name="__codelineno-21-88" href="#__codelineno-21-88"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-21-89" name="__codelineno-21-89" href="#__codelineno-21-89"></a>
<a id="__codelineno-21-90" name="__codelineno-21-90" href="#__codelineno-21-90"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">Clear</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-91" name="__codelineno-21-91" href="#__codelineno-21-91"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex_</span><span class="p">);</span>
<a id="__codelineno-21-92" name="__codelineno-21-92" href="#__codelineno-21-92"></a><span class="w">    </span><span class="n">resources_</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<a id="__codelineno-21-93" name="__codelineno-21-93" href="#__codelineno-21-93"></a><span class="w">    </span><span class="n">current_usage_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-21-94" name="__codelineno-21-94" href="#__codelineno-21-94"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-21-95" name="__codelineno-21-95" href="#__codelineno-21-95"></a>
<a id="__codelineno-21-96" name="__codelineno-21-96" href="#__codelineno-21-96"></a><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">GetCurrentUsage</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-97" name="__codelineno-21-97" href="#__codelineno-21-97"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_lock</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">shared_mutex</span><span class="o">&gt;</span><span class="w"> </span><span class="n">lock</span><span class="p">(</span><span class="n">mutex_</span><span class="p">);</span>
<a id="__codelineno-21-98" name="__codelineno-21-98" href="#__codelineno-21-98"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">current_usage_</span><span class="p">;</span>
<a id="__codelineno-21-99" name="__codelineno-21-99" href="#__codelineno-21-99"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-21-100" name="__codelineno-21-100" href="#__codelineno-21-100"></a>
<a id="__codelineno-21-101" name="__codelineno-21-101" href="#__codelineno-21-101"></a><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">GetCapacity</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">capacity_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-21-102" name="__codelineno-21-102" href="#__codelineno-21-102"></a>
<a id="__codelineno-21-103" name="__codelineno-21-103" href="#__codelineno-21-103"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-21-104" name="__codelineno-21-104" href="#__codelineno-21-104"></a><span class="w">  </span><span class="k">struct</span><span class="w"> </span><span class="nc">CachedResource</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-105" name="__codelineno-21-105" href="#__codelineno-21-105"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">resource</span><span class="p">;</span>
<a id="__codelineno-21-106" name="__codelineno-21-106" href="#__codelineno-21-106"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">chrono</span><span class="o">::</span><span class="n">steady_clock</span><span class="o">::</span><span class="n">time_point</span><span class="w"> </span><span class="n">last_used</span><span class="p">;</span>
<a id="__codelineno-21-107" name="__codelineno-21-107" href="#__codelineno-21-107"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-21-108" name="__codelineno-21-108" href="#__codelineno-21-108"></a>
<a id="__codelineno-21-109" name="__codelineno-21-109" href="#__codelineno-21-109"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">MakeRoom</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">required_space</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-110" name="__codelineno-21-110" href="#__codelineno-21-110"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">current_usage_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">required_space</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">capacity_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-111" name="__codelineno-21-111" href="#__codelineno-21-111"></a><span class="w">      </span><span class="k">return</span><span class="p">;</span>
<a id="__codelineno-21-112" name="__codelineno-21-112" href="#__codelineno-21-112"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-113" name="__codelineno-21-113" href="#__codelineno-21-113"></a>
<a id="__codelineno-21-114" name="__codelineno-21-114" href="#__codelineno-21-114"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">pair</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">CachedResource</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">sorted_resources</span><span class="p">(</span>
<a id="__codelineno-21-115" name="__codelineno-21-115" href="#__codelineno-21-115"></a><span class="w">        </span><span class="n">resources_</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">resources_</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<a id="__codelineno-21-116" name="__codelineno-21-116" href="#__codelineno-21-116"></a>
<a id="__codelineno-21-117" name="__codelineno-21-117" href="#__codelineno-21-117"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">sort</span><span class="p">(</span><span class="n">sorted_resources</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">sorted_resources</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
<a id="__codelineno-21-118" name="__codelineno-21-118" href="#__codelineno-21-118"></a><span class="w">              </span><span class="p">[](</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-119" name="__codelineno-21-119" href="#__codelineno-21-119"></a><span class="w">                </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">last_used</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">b</span><span class="p">.</span><span class="n">second</span><span class="p">.</span><span class="n">last_used</span><span class="p">;</span>
<a id="__codelineno-21-120" name="__codelineno-21-120" href="#__codelineno-21-120"></a><span class="w">              </span><span class="p">});</span>
<a id="__codelineno-21-121" name="__codelineno-21-121" href="#__codelineno-21-121"></a>
<a id="__codelineno-21-122" name="__codelineno-21-122" href="#__codelineno-21-122"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">cached_resource</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">sorted_resources</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-123" name="__codelineno-21-123" href="#__codelineno-21-123"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">current_usage_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">required_space</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">capacity_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-124" name="__codelineno-21-124" href="#__codelineno-21-124"></a><span class="w">        </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-21-125" name="__codelineno-21-125" href="#__codelineno-21-125"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-21-126" name="__codelineno-21-126" href="#__codelineno-21-126"></a>
<a id="__codelineno-21-127" name="__codelineno-21-127" href="#__codelineno-21-127"></a><span class="w">      </span><span class="n">current_usage_</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">cached_resource</span><span class="p">.</span><span class="n">resource</span><span class="o">-&gt;</span><span class="n">GetMemoryUsage</span><span class="p">();</span>
<a id="__codelineno-21-128" name="__codelineno-21-128" href="#__codelineno-21-128"></a><span class="w">      </span><span class="n">cached_resource</span><span class="p">.</span><span class="n">resource</span><span class="o">-&gt;</span><span class="n">Unload</span><span class="p">();</span>
<a id="__codelineno-21-129" name="__codelineno-21-129" href="#__codelineno-21-129"></a><span class="w">      </span><span class="n">resources_</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-21-130" name="__codelineno-21-130" href="#__codelineno-21-130"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-21-131" name="__codelineno-21-131" href="#__codelineno-21-131"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-21-132" name="__codelineno-21-132" href="#__codelineno-21-132"></a>
<a id="__codelineno-21-133" name="__codelineno-21-133" href="#__codelineno-21-133"></a><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">capacity_</span><span class="p">;</span>
<a id="__codelineno-21-134" name="__codelineno-21-134" href="#__codelineno-21-134"></a><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">current_usage_</span><span class="p">;</span>
<a id="__codelineno-21-135" name="__codelineno-21-135" href="#__codelineno-21-135"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">CachedResource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">resources_</span><span class="p">;</span>
<a id="__codelineno-21-136" name="__codelineno-21-136" href="#__codelineno-21-136"></a><span class="w">  </span><span class="k">mutable</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">shared_mutex</span><span class="w"> </span><span class="n">mutex_</span><span class="p">;</span>
<a id="__codelineno-21-137" name="__codelineno-21-137" href="#__codelineno-21-137"></a><span class="p">};</span>
<a id="__codelineno-21-138" name="__codelineno-21-138" href="#__codelineno-21-138"></a>
<a id="__codelineno-21-139" name="__codelineno-21-139" href="#__codelineno-21-139"></a><span class="c1">// Example resource types</span>
<a id="__codelineno-21-140" name="__codelineno-21-140" href="#__codelineno-21-140"></a><span class="k">class</span><span class="w"> </span><span class="nc">Texture</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Resource</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-141" name="__codelineno-21-141" href="#__codelineno-21-141"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-21-142" name="__codelineno-21-142" href="#__codelineno-21-142"></a><span class="w">  </span><span class="k">explicit</span><span class="w"> </span><span class="n">Texture</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">size_</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-21-143" name="__codelineno-21-143" href="#__codelineno-21-143"></a><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">GetMemoryUsage</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">size_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-21-144" name="__codelineno-21-144" href="#__codelineno-21-144"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">Unload</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Unloading texture</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-21-145" name="__codelineno-21-145" href="#__codelineno-21-145"></a>
<a id="__codelineno-21-146" name="__codelineno-21-146" href="#__codelineno-21-146"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-21-147" name="__codelineno-21-147" href="#__codelineno-21-147"></a><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size_</span><span class="p">;</span>
<a id="__codelineno-21-148" name="__codelineno-21-148" href="#__codelineno-21-148"></a><span class="p">};</span>
<a id="__codelineno-21-149" name="__codelineno-21-149" href="#__codelineno-21-149"></a>
<a id="__codelineno-21-150" name="__codelineno-21-150" href="#__codelineno-21-150"></a><span class="k">class</span><span class="w"> </span><span class="nc">Model</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Resource</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-151" name="__codelineno-21-151" href="#__codelineno-21-151"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-21-152" name="__codelineno-21-152" href="#__codelineno-21-152"></a><span class="w">  </span><span class="k">explicit</span><span class="w"> </span><span class="n">Model</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">size_</span><span class="p">(</span><span class="n">size</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-21-153" name="__codelineno-21-153" href="#__codelineno-21-153"></a><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">GetMemoryUsage</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">size_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-21-154" name="__codelineno-21-154" href="#__codelineno-21-154"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">Unload</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Unloading model</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-21-155" name="__codelineno-21-155" href="#__codelineno-21-155"></a>
<a id="__codelineno-21-156" name="__codelineno-21-156" href="#__codelineno-21-156"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-21-157" name="__codelineno-21-157" href="#__codelineno-21-157"></a><span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">size_</span><span class="p">;</span>
<a id="__codelineno-21-158" name="__codelineno-21-158" href="#__codelineno-21-158"></a><span class="p">};</span>
<a id="__codelineno-21-159" name="__codelineno-21-159" href="#__codelineno-21-159"></a>
<a id="__codelineno-21-160" name="__codelineno-21-160" href="#__codelineno-21-160"></a><span class="c1">// Example resource loaders</span>
<a id="__codelineno-21-161" name="__codelineno-21-161" href="#__codelineno-21-161"></a><span class="k">class</span><span class="w"> </span><span class="nc">TextureLoader</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">ResourceLoader</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-162" name="__codelineno-21-162" href="#__codelineno-21-162"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-21-163" name="__codelineno-21-163" href="#__codelineno-21-163"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Load</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-164" name="__codelineno-21-164" href="#__codelineno-21-164"></a><span class="w">    </span><span class="c1">// Simulate loading a texture</span>
<a id="__codelineno-21-165" name="__codelineno-21-165" href="#__codelineno-21-165"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Loading texture: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<a id="__codelineno-21-166" name="__codelineno-21-166" href="#__codelineno-21-166"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Texture</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1024</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1024</span><span class="p">);</span><span class="w">  </span><span class="c1">// 1MB texture</span>
<a id="__codelineno-21-167" name="__codelineno-21-167" href="#__codelineno-21-167"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-21-168" name="__codelineno-21-168" href="#__codelineno-21-168"></a><span class="p">};</span>
<a id="__codelineno-21-169" name="__codelineno-21-169" href="#__codelineno-21-169"></a>
<a id="__codelineno-21-170" name="__codelineno-21-170" href="#__codelineno-21-170"></a><span class="k">class</span><span class="w"> </span><span class="nc">ModelLoader</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">ResourceLoader</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-171" name="__codelineno-21-171" href="#__codelineno-21-171"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-21-172" name="__codelineno-21-172" href="#__codelineno-21-172"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Resource</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Load</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-173" name="__codelineno-21-173" href="#__codelineno-21-173"></a><span class="w">    </span><span class="c1">// Simulate loading a model</span>
<a id="__codelineno-21-174" name="__codelineno-21-174" href="#__codelineno-21-174"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Loading model: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">path</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="sc">&#39;\n&#39;</span><span class="p">;</span>
<a id="__codelineno-21-175" name="__codelineno-21-175" href="#__codelineno-21-175"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Model</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">5</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1024</span><span class="p">);</span><span class="w">  </span><span class="c1">// 5MB model</span>
<a id="__codelineno-21-176" name="__codelineno-21-176" href="#__codelineno-21-176"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-21-177" name="__codelineno-21-177" href="#__codelineno-21-177"></a><span class="p">};</span>
<a id="__codelineno-21-178" name="__codelineno-21-178" href="#__codelineno-21-178"></a>
<a id="__codelineno-21-179" name="__codelineno-21-179" href="#__codelineno-21-179"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace resource</span>
<a id="__codelineno-21-180" name="__codelineno-21-180" href="#__codelineno-21-180"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace engine</span>
<a id="__codelineno-21-181" name="__codelineno-21-181" href="#__codelineno-21-181"></a>
<a id="__codelineno-21-182" name="__codelineno-21-182" href="#__codelineno-21-182"></a><span class="c1">// Example usage</span>
<a id="__codelineno-21-183" name="__codelineno-21-183" href="#__codelineno-21-183"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-21-184" name="__codelineno-21-184" href="#__codelineno-21-184"></a><span class="w">  </span><span class="n">engine</span><span class="o">::</span><span class="n">resource</span><span class="o">::</span><span class="n">ResourceCache</span><span class="w"> </span><span class="nf">cache</span><span class="p">(</span><span class="mi">10</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1024</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">1024</span><span class="p">);</span><span class="w">  </span><span class="c1">// 10MB cache</span>
<a id="__codelineno-21-185" name="__codelineno-21-185" href="#__codelineno-21-185"></a><span class="w">  </span><span class="n">engine</span><span class="o">::</span><span class="n">resource</span><span class="o">::</span><span class="n">TextureLoader</span><span class="w"> </span><span class="n">texture_loader</span><span class="p">;</span>
<a id="__codelineno-21-186" name="__codelineno-21-186" href="#__codelineno-21-186"></a><span class="w">  </span><span class="n">engine</span><span class="o">::</span><span class="n">resource</span><span class="o">::</span><span class="n">ModelLoader</span><span class="w"> </span><span class="n">model_loader</span><span class="p">;</span>
<a id="__codelineno-21-187" name="__codelineno-21-187" href="#__codelineno-21-187"></a>
<a id="__codelineno-21-188" name="__codelineno-21-188" href="#__codelineno-21-188"></a><span class="w">  </span><span class="c1">// Load and cache resources</span>
<a id="__codelineno-21-189" name="__codelineno-21-189" href="#__codelineno-21-189"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">texture1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="n">Get</span><span class="o">&lt;</span><span class="n">engine</span><span class="o">::</span><span class="n">resource</span><span class="o">::</span><span class="n">Texture</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;texture1.png&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">texture_loader</span><span class="p">);</span>
<a id="__codelineno-21-190" name="__codelineno-21-190" href="#__codelineno-21-190"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">texture2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="n">Get</span><span class="o">&lt;</span><span class="n">engine</span><span class="o">::</span><span class="n">resource</span><span class="o">::</span><span class="n">Texture</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;texture2.png&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">texture_loader</span><span class="p">);</span>
<a id="__codelineno-21-191" name="__codelineno-21-191" href="#__codelineno-21-191"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">model1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="n">Get</span><span class="o">&lt;</span><span class="n">engine</span><span class="o">::</span><span class="n">resource</span><span class="o">::</span><span class="n">Model</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;model1.obj&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">model_loader</span><span class="p">);</span>
<a id="__codelineno-21-192" name="__codelineno-21-192" href="#__codelineno-21-192"></a>
<a id="__codelineno-21-193" name="__codelineno-21-193" href="#__codelineno-21-193"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Current cache usage: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="n">GetCurrentUsage</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">1024.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1024.0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; MB</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-21-194" name="__codelineno-21-194" href="#__codelineno-21-194"></a>
<a id="__codelineno-21-195" name="__codelineno-21-195" href="#__codelineno-21-195"></a><span class="w">  </span><span class="c1">// Access a cached resource</span>
<a id="__codelineno-21-196" name="__codelineno-21-196" href="#__codelineno-21-196"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">texture1_again</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="n">Get</span><span class="o">&lt;</span><span class="n">engine</span><span class="o">::</span><span class="n">resource</span><span class="o">::</span><span class="n">Texture</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;texture1.png&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">texture_loader</span><span class="p">);</span>
<a id="__codelineno-21-197" name="__codelineno-21-197" href="#__codelineno-21-197"></a>
<a id="__codelineno-21-198" name="__codelineno-21-198" href="#__codelineno-21-198"></a><span class="w">  </span><span class="c1">// Load another resource, which will cause the cache to evict the least recently used item</span>
<a id="__codelineno-21-199" name="__codelineno-21-199" href="#__codelineno-21-199"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">model2</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="n">Get</span><span class="o">&lt;</span><span class="n">engine</span><span class="o">::</span><span class="n">resource</span><span class="o">::</span><span class="n">Model</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;model2.obj&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">model_loader</span><span class="p">);</span>
<a id="__codelineno-21-200" name="__codelineno-21-200" href="#__codelineno-21-200"></a>
<a id="__codelineno-21-201" name="__codelineno-21-201" href="#__codelineno-21-201"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Final cache usage: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">cache</span><span class="p">.</span><span class="n">GetCurrentUsage</span><span class="p">()</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="mf">1024.0</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mf">1024.0</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; MB</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-21-202" name="__codelineno-21-202" href="#__codelineno-21-202"></a>
<a id="__codelineno-21-203" name="__codelineno-21-203" href="#__codelineno-21-203"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-21-204" name="__codelineno-21-204" href="#__codelineno-21-204"></a><span class="p">}</span>
</code></pre></div>
<p>This implementation demonstrates several key concepts:</p>
<ol>
<li>A <code>Resource</code> base class for all cacheable resources.</li>
<li>A <code>ResourceLoader</code> interface for loading different types of resources.</li>
<li>A <code>ResourceCache</code> class that manages the caching of resources, including:</li>
<li>Thread-safe resource access using <code>std::shared_mutex</code>.</li>
<li>Least Recently Used (LRU) eviction policy.</li>
<li>Automatic resource cleanup using shared pointers and custom deleters.</li>
<li>
<p>Type-safe resource retrieval using templates.</p>
</li>
<li>
<p>Example resource types (<code>Texture</code> and <code>Model</code>) and their corresponding loaders.</p>
</li>
</ol>
<p>The code follows best practices such as:</p>
<ul>
<li>Using namespaces to organize code.</li>
<li>Implementing RAII for proper resource management.</li>
<li>Using smart pointers (<code>std::unique_ptr</code> and <code>std::shared_ptr</code>) for memory management.</li>
<li>Utilizing templates for type safety and code reuse.</li>
<li>Employing const-correctness.</li>
<li>Using <code>override</code> keyword for virtual function overrides.</li>
<li>Implementing thread-safety using <code>std::shared_mutex</code> for read-write locks.</li>
</ul>
<p>This implementation provides a foundation for resource caching in a game engine. In a real-world scenario, you might want to extend this system with features like:</p>
<ul>
<li>Asynchronous resource loading.</li>
<li>Preloading and streaming of resources.</li>
<li>More sophisticated eviction policies based on priority or predicted usage.</li>
<li>Integration with file I/O and compression systems.</li>
<li>Support for hot-reloading of resources during development.</li>
</ul>
<h4 id="streaming-and-level-of-detail">Streaming and Level of Detail</h4>
<p>Streaming and Level of Detail (LOD) techniques help manage resources dynamically, ensuring smooth gameplay and optimal performance.</p>
<ul>
<li>
<p><strong>Streaming:</strong></p>
<ul>
<li><strong>Asset Streaming:</strong> Continuously load and unload assets based on the player's position and visibility. Commonly used in open-world games to handle large environments.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a><span class="k">void</span><span class="w"> </span><span class="nf">Update</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">asset</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">assets</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IsAssetInRange</span><span class="p">(</span><span class="n">asset</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w">            </span><span class="n">LoadAsset</span><span class="p">(</span><span class="n">asset</span><span class="p">);</span>
<a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w">            </span><span class="n">UnloadAsset</span><span class="p">(</span><span class="n">asset</span><span class="p">);</span>
<a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Level of Detail (LOD):</strong> Reduces the complexity of models and textures based on their distance from the camera to improve performance without sacrificing visual quality.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">LODModel</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a><span class="w">    </span><span class="n">Mesh</span><span class="w"> </span><span class="n">highDetailMesh</span><span class="p">;</span>
<a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="w">    </span><span class="n">Mesh</span><span class="w"> </span><span class="n">mediumDetailMesh</span><span class="p">;</span>
<a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="w">    </span><span class="n">Mesh</span><span class="w"> </span><span class="n">lowDetailMesh</span><span class="p">;</span>
<a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">    </span><span class="n">Mesh</span><span class="w"> </span><span class="nf">GetLODMesh</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">distance</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">distance</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">highDetailThreshold</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">highDetailMesh</span><span class="p">;</span>
<a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">distance</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">mediumDetailThreshold</span><span class="p">)</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">mediumDetailMesh</span><span class="p">;</span>
<a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">lowDetailMesh</span><span class="p">;</span>
<a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Mipmap Levels:</strong> A technique used for textures where multiple precomputed levels of detail are stored. The appropriate level is selected based on the texture's screen size.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="n">glTexParameteri</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span><span class="w"> </span><span class="n">GL_TEXTURE_MIN_FILTER</span><span class="p">,</span><span class="w"> </span><span class="n">GL_LINEAR_MIPMAP_LINEAR</span><span class="p">);</span>
</code></pre></div>
</li>
<li>
<p><strong>Occlusion Culling:</strong> Determines which objects are visible and which are not, rendering only the visible objects to save resources.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">IsVisible</span><span class="p">(</span><span class="n">Object</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">    </span><span class="c1">// Determine if obj is visible based on camera position and occluders</span>
<a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">visible</span><span class="p">;</span>
<a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<p>By effectively managing resources through these techniques, game engines can handle large and complex game worlds while maintaining performance and providing a seamless experience for players.</p>
<h3 id="rendering-engine">Rendering Engine</h3>
<h4 id="graphics-api-abstraction">Graphics API Abstraction</h4>
<p>Graphics API abstraction provides a layer that decouples the game engine from the underlying graphics API (such as DirectX, OpenGL, Vulkan, or Metal), enabling the engine to support multiple APIs and platforms with minimal code changes.</p>
<ul>
<li>
<p><strong>Abstraction Layer:</strong> Abstracts common graphics operations like rendering, texture management, and buffer handling.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">abstract</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">GraphicsAPI</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-2" name="__codelineno-26-2" href="#__codelineno-26-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Initialize</span><span class="p">();</span>
<a id="__codelineno-26-3" name="__codelineno-26-3" href="#__codelineno-26-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DrawMesh</span><span class="p">(</span><span class="n">Mesh</span><span class="w"> </span><span class="n">mesh</span><span class="p">);</span>
<a id="__codelineno-26-4" name="__codelineno-26-4" href="#__codelineno-26-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">abstract</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CreateTexture</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">);</span>
<a id="__codelineno-26-5" name="__codelineno-26-5" href="#__codelineno-26-5"></a><span class="p">}</span>
<a id="__codelineno-26-6" name="__codelineno-26-6" href="#__codelineno-26-6"></a>
<a id="__codelineno-26-7" name="__codelineno-26-7" href="#__codelineno-26-7"></a><span class="k">class</span><span class="w"> </span><span class="nc">OpenGLAPI</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-8" name="__codelineno-26-8" href="#__codelineno-26-8"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Initialize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* OpenGL initialization */</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-26-9" name="__codelineno-26-9" href="#__codelineno-26-9"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DrawMesh</span><span class="p">(</span><span class="n">Mesh</span><span class="w"> </span><span class="n">mesh</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* OpenGL draw call */</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-26-10" name="__codelineno-26-10" href="#__codelineno-26-10"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CreateTexture</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* OpenGL texture creation */</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-26-11" name="__codelineno-26-11" href="#__codelineno-26-11"></a><span class="p">}</span>
<a id="__codelineno-26-12" name="__codelineno-26-12" href="#__codelineno-26-12"></a>
<a id="__codelineno-26-13" name="__codelineno-26-13" href="#__codelineno-26-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">DirectXAPI</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-26-14" name="__codelineno-26-14" href="#__codelineno-26-14"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Initialize</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* DirectX initialization */</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-26-15" name="__codelineno-26-15" href="#__codelineno-26-15"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DrawMesh</span><span class="p">(</span><span class="n">Mesh</span><span class="w"> </span><span class="n">mesh</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* DirectX draw call */</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-26-16" name="__codelineno-26-16" href="#__codelineno-26-16"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CreateTexture</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="cm">/* DirectX texture creation */</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-26-17" name="__codelineno-26-17" href="#__codelineno-26-17"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Platform Independence:</strong> Allows the engine to run on different platforms without rewriting rendering code.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Renderer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">GraphicsAPI</span><span class="w"> </span><span class="n">graphicsAPI</span><span class="p">;</span>
<a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>
<a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">Renderer</span><span class="p">(</span><span class="n">GraphicsAPI</span><span class="w"> </span><span class="n">api</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w">        </span><span class="n">graphicsAPI</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api</span><span class="p">;</span>
<a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w">        </span><span class="n">graphicsAPI</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>
<a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a>
<a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Render</span><span class="p">(</span><span class="n">Mesh</span><span class="w"> </span><span class="n">mesh</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w">        </span><span class="n">graphicsAPI</span><span class="p">.</span><span class="n">DrawMesh</span><span class="p">(</span><span class="n">mesh</span><span class="p">);</span>
<a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="scene-graph-and-culling">Scene Graph and Culling</h4>
<p>A scene graph is a hierarchical structure that organizes the objects in a scene, making it easier to manage transformations, visibility, and rendering.</p>
<ul>
<li>
<p><strong>Scene Graph:</strong> Organizes objects hierarchically, where each node can represent a transform, a mesh, or a light source.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SceneNode</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-2" name="__codelineno-28-2" href="#__codelineno-28-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Transform</span><span class="w"> </span><span class="n">transform</span><span class="p">;</span>
<a id="__codelineno-28-3" name="__codelineno-28-3" href="#__codelineno-28-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">SceneNode</span><span class="o">&gt;</span><span class="w"> </span><span class="n">children</span><span class="p">;</span>
<a id="__codelineno-28-4" name="__codelineno-28-4" href="#__codelineno-28-4"></a>
<a id="__codelineno-28-5" name="__codelineno-28-5" href="#__codelineno-28-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AddChild</span><span class="p">(</span><span class="n">SceneNode</span><span class="w"> </span><span class="n">child</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-6" name="__codelineno-28-6" href="#__codelineno-28-6"></a><span class="w">        </span><span class="n">children</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">child</span><span class="p">);</span>
<a id="__codelineno-28-7" name="__codelineno-28-7" href="#__codelineno-28-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-28-8" name="__codelineno-28-8" href="#__codelineno-28-8"></a>
<a id="__codelineno-28-9" name="__codelineno-28-9" href="#__codelineno-28-9"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-10" name="__codelineno-28-10" href="#__codelineno-28-10"></a><span class="w">        </span><span class="n">ApplyTransform</span><span class="p">();</span>
<a id="__codelineno-28-11" name="__codelineno-28-11" href="#__codelineno-28-11"></a><span class="w">        </span><span class="n">Draw</span><span class="p">();</span>
<a id="__codelineno-28-12" name="__codelineno-28-12" href="#__codelineno-28-12"></a><span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">children</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-28-13" name="__codelineno-28-13" href="#__codelineno-28-13"></a><span class="w">            </span><span class="n">child</span><span class="p">.</span><span class="n">Render</span><span class="p">();</span>
<a id="__codelineno-28-14" name="__codelineno-28-14" href="#__codelineno-28-14"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-28-15" name="__codelineno-28-15" href="#__codelineno-28-15"></a><span class="w">        </span><span class="n">RevertTransform</span><span class="p">();</span>
<a id="__codelineno-28-16" name="__codelineno-28-16" href="#__codelineno-28-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-28-17" name="__codelineno-28-17" href="#__codelineno-28-17"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Culling:</strong></p>
<ul>
<li><strong>View Frustum Culling:</strong> Determines which objects are within the camera's view and only renders those.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-29-1" name="__codelineno-29-1" href="#__codelineno-29-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">IsInViewFrustum</span><span class="p">(</span><span class="n">BoundingBox</span><span class="w"> </span><span class="n">box</span><span class="p">,</span><span class="w"> </span><span class="n">Camera</span><span class="w"> </span><span class="n">camera</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-29-2" name="__codelineno-29-2" href="#__codelineno-29-2"></a><span class="w">    </span><span class="c1">// Check if the bounding box is within the camera&#39;s frustum</span>
<a id="__codelineno-29-3" name="__codelineno-29-3" href="#__codelineno-29-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">isVisible</span><span class="p">;</span>
<a id="__codelineno-29-4" name="__codelineno-29-4" href="#__codelineno-29-4"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li><strong>Occlusion Culling:</strong> Skips rendering objects blocked by other objects.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-30-1" name="__codelineno-30-1" href="#__codelineno-30-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">IsVisible</span><span class="p">(</span><span class="n">SceneNode</span><span class="w"> </span><span class="n">node</span><span class="p">,</span><span class="w"> </span><span class="n">Camera</span><span class="w"> </span><span class="n">camera</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-30-2" name="__codelineno-30-2" href="#__codelineno-30-2"></a><span class="w">    </span><span class="c1">// Determine visibility based on occlusion data</span>
<a id="__codelineno-30-3" name="__codelineno-30-3" href="#__codelineno-30-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">isVisible</span><span class="p">;</span>
<a id="__codelineno-30-4" name="__codelineno-30-4" href="#__codelineno-30-4"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Level of Detail (LOD):</strong> Renders different levels of detail based on the distance from the camera.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-31-1" name="__codelineno-31-1" href="#__codelineno-31-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">LODNode</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">SceneNode</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-2" name="__codelineno-31-2" href="#__codelineno-31-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Mesh</span><span class="w"> </span><span class="n">highDetailMesh</span><span class="p">;</span>
<a id="__codelineno-31-3" name="__codelineno-31-3" href="#__codelineno-31-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Mesh</span><span class="w"> </span><span class="n">mediumDetailMesh</span><span class="p">;</span>
<a id="__codelineno-31-4" name="__codelineno-31-4" href="#__codelineno-31-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Mesh</span><span class="w"> </span><span class="n">lowDetailMesh</span><span class="p">;</span>
<a id="__codelineno-31-5" name="__codelineno-31-5" href="#__codelineno-31-5"></a>
<a id="__codelineno-31-6" name="__codelineno-31-6" href="#__codelineno-31-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-7" name="__codelineno-31-7" href="#__codelineno-31-7"></a><span class="w">        </span><span class="n">Mesh</span><span class="w"> </span><span class="n">mesh</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetLODMesh</span><span class="p">();</span>
<a id="__codelineno-31-8" name="__codelineno-31-8" href="#__codelineno-31-8"></a><span class="w">        </span><span class="c1">// Render mesh</span>
<a id="__codelineno-31-9" name="__codelineno-31-9" href="#__codelineno-31-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-31-10" name="__codelineno-31-10" href="#__codelineno-31-10"></a>
<a id="__codelineno-31-11" name="__codelineno-31-11" href="#__codelineno-31-11"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">Mesh</span><span class="w"> </span><span class="nf">GetLODMesh</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-31-12" name="__codelineno-31-12" href="#__codelineno-31-12"></a><span class="w">        </span><span class="c1">// Determine which LOD mesh to use</span>
<a id="__codelineno-31-13" name="__codelineno-31-13" href="#__codelineno-31-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">selectedMesh</span><span class="p">;</span>
<a id="__codelineno-31-14" name="__codelineno-31-14" href="#__codelineno-31-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-31-15" name="__codelineno-31-15" href="#__codelineno-31-15"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="scene-graph">Scene Graph</h4>
<p>A Scene Graph is a tree-like data structure used in computer graphics to organize the logical and spatial representation of a graphical scene. It's particularly useful in game development and 3D rendering for efficiently managing and rendering complex scenes.</p>
<p>Key concepts of a Scene Graph:</p>
<ol>
<li>Nodes: Represent objects or groups of objects in the scene.</li>
<li>Hierarchy: Nodes are organized in a parent-child relationship.</li>
<li>Transformations: Each node can have its own transformation (position, rotation, scale).</li>
<li>Rendering: The graph is typically traversed depth-first for rendering.</li>
</ol>
<p>Now, let's implement a Scene Graph in C++:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-32-1" name="__codelineno-32-1" href="#__codelineno-32-1"></a><span class="c1">// scene_graph.h</span>
<a id="__codelineno-32-2" name="__codelineno-32-2" href="#__codelineno-32-2"></a><span class="cp">#ifndef SCENE_GRAPH_H_</span>
<a id="__codelineno-32-3" name="__codelineno-32-3" href="#__codelineno-32-3"></a><span class="cp">#define SCENE_GRAPH_H_</span>
<a id="__codelineno-32-4" name="__codelineno-32-4" href="#__codelineno-32-4"></a>
<a id="__codelineno-32-5" name="__codelineno-32-5" href="#__codelineno-32-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-32-6" name="__codelineno-32-6" href="#__codelineno-32-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-32-7" name="__codelineno-32-7" href="#__codelineno-32-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-32-8" name="__codelineno-32-8" href="#__codelineno-32-8"></a>
<a id="__codelineno-32-9" name="__codelineno-32-9" href="#__codelineno-32-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;matrix4x4.h&quot;</span><span class="c1">  // Assume this is implemented elsewhere</span>
<a id="__codelineno-32-10" name="__codelineno-32-10" href="#__codelineno-32-10"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;vector3.h&quot;</span><span class="c1">    // Assume this is implemented elsewhere</span>
<a id="__codelineno-32-11" name="__codelineno-32-11" href="#__codelineno-32-11"></a>
<a id="__codelineno-32-12" name="__codelineno-32-12" href="#__codelineno-32-12"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">graphics</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-13" name="__codelineno-32-13" href="#__codelineno-32-13"></a>
<a id="__codelineno-32-14" name="__codelineno-32-14" href="#__codelineno-32-14"></a><span class="k">class</span><span class="w"> </span><span class="nc">SceneNode</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-15" name="__codelineno-32-15" href="#__codelineno-32-15"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-32-16" name="__codelineno-32-16" href="#__codelineno-32-16"></a><span class="w">  </span><span class="k">explicit</span><span class="w"> </span><span class="n">SceneNode</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-32-17" name="__codelineno-32-17" href="#__codelineno-32-17"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">SceneNode</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-32-18" name="__codelineno-32-18" href="#__codelineno-32-18"></a>
<a id="__codelineno-32-19" name="__codelineno-32-19" href="#__codelineno-32-19"></a><span class="w">  </span><span class="c1">// Disallow copy and assign</span>
<a id="__codelineno-32-20" name="__codelineno-32-20" href="#__codelineno-32-20"></a><span class="w">  </span><span class="n">SceneNode</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">SceneNode</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-32-21" name="__codelineno-32-21" href="#__codelineno-32-21"></a><span class="w">  </span><span class="n">SceneNode</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">SceneNode</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-32-22" name="__codelineno-32-22" href="#__codelineno-32-22"></a>
<a id="__codelineno-32-23" name="__codelineno-32-23" href="#__codelineno-32-23"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">AddChild</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">SceneNode</span><span class="o">&gt;</span><span class="w"> </span><span class="n">child</span><span class="p">);</span>
<a id="__codelineno-32-24" name="__codelineno-32-24" href="#__codelineno-32-24"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">RemoveChild</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">SceneNode</span><span class="o">*</span><span class="w"> </span><span class="n">child</span><span class="p">);</span>
<a id="__codelineno-32-25" name="__codelineno-32-25" href="#__codelineno-32-25"></a>
<a id="__codelineno-32-26" name="__codelineno-32-26" href="#__codelineno-32-26"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetLocalTransform</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Matrix4x4</span><span class="o">&amp;</span><span class="w"> </span><span class="n">transform</span><span class="p">);</span>
<a id="__codelineno-32-27" name="__codelineno-32-27" href="#__codelineno-32-27"></a><span class="w">  </span><span class="n">Matrix4x4</span><span class="w"> </span><span class="nf">GetWorldTransform</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-32-28" name="__codelineno-32-28" href="#__codelineno-32-28"></a>
<a id="__codelineno-32-29" name="__codelineno-32-29" href="#__codelineno-32-29"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetPosition</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">position</span><span class="p">);</span>
<a id="__codelineno-32-30" name="__codelineno-32-30" href="#__codelineno-32-30"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetRotation</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rotation</span><span class="p">);</span>
<a id="__codelineno-32-31" name="__codelineno-32-31" href="#__codelineno-32-31"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetScale</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scale</span><span class="p">);</span>
<a id="__codelineno-32-32" name="__codelineno-32-32" href="#__codelineno-32-32"></a>
<a id="__codelineno-32-33" name="__codelineno-32-33" href="#__codelineno-32-33"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Update</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">delta_time</span><span class="p">);</span>
<a id="__codelineno-32-34" name="__codelineno-32-34" href="#__codelineno-32-34"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Render</span><span class="p">();</span>
<a id="__codelineno-32-35" name="__codelineno-32-35" href="#__codelineno-32-35"></a>
<a id="__codelineno-32-36" name="__codelineno-32-36" href="#__codelineno-32-36"></a><span class="w"> </span><span class="k">protected</span><span class="o">:</span>
<a id="__codelineno-32-37" name="__codelineno-32-37" href="#__codelineno-32-37"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">name_</span><span class="p">;</span>
<a id="__codelineno-32-38" name="__codelineno-32-38" href="#__codelineno-32-38"></a><span class="w">  </span><span class="n">Matrix4x4</span><span class="w"> </span><span class="n">local_transform_</span><span class="p">;</span>
<a id="__codelineno-32-39" name="__codelineno-32-39" href="#__codelineno-32-39"></a><span class="w">  </span><span class="n">SceneNode</span><span class="o">*</span><span class="w"> </span><span class="n">parent_</span><span class="p">;</span>
<a id="__codelineno-32-40" name="__codelineno-32-40" href="#__codelineno-32-40"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">SceneNode</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">children_</span><span class="p">;</span>
<a id="__codelineno-32-41" name="__codelineno-32-41" href="#__codelineno-32-41"></a><span class="p">};</span>
<a id="__codelineno-32-42" name="__codelineno-32-42" href="#__codelineno-32-42"></a>
<a id="__codelineno-32-43" name="__codelineno-32-43" href="#__codelineno-32-43"></a><span class="k">class</span><span class="w"> </span><span class="nc">SceneGraph</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-32-44" name="__codelineno-32-44" href="#__codelineno-32-44"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-32-45" name="__codelineno-32-45" href="#__codelineno-32-45"></a><span class="w">  </span><span class="n">SceneGraph</span><span class="p">();</span>
<a id="__codelineno-32-46" name="__codelineno-32-46" href="#__codelineno-32-46"></a><span class="w">  </span><span class="o">~</span><span class="n">SceneGraph</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-32-47" name="__codelineno-32-47" href="#__codelineno-32-47"></a>
<a id="__codelineno-32-48" name="__codelineno-32-48" href="#__codelineno-32-48"></a><span class="w">  </span><span class="c1">// Disallow copy and assign</span>
<a id="__codelineno-32-49" name="__codelineno-32-49" href="#__codelineno-32-49"></a><span class="w">  </span><span class="n">SceneGraph</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">SceneGraph</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-32-50" name="__codelineno-32-50" href="#__codelineno-32-50"></a><span class="w">  </span><span class="n">SceneGraph</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">SceneGraph</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-32-51" name="__codelineno-32-51" href="#__codelineno-32-51"></a>
<a id="__codelineno-32-52" name="__codelineno-32-52" href="#__codelineno-32-52"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetRoot</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">SceneNode</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="p">);</span>
<a id="__codelineno-32-53" name="__codelineno-32-53" href="#__codelineno-32-53"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">Update</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">delta_time</span><span class="p">);</span>
<a id="__codelineno-32-54" name="__codelineno-32-54" href="#__codelineno-32-54"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">Render</span><span class="p">();</span>
<a id="__codelineno-32-55" name="__codelineno-32-55" href="#__codelineno-32-55"></a>
<a id="__codelineno-32-56" name="__codelineno-32-56" href="#__codelineno-32-56"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-32-57" name="__codelineno-32-57" href="#__codelineno-32-57"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">SceneNode</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root_</span><span class="p">;</span>
<a id="__codelineno-32-58" name="__codelineno-32-58" href="#__codelineno-32-58"></a><span class="p">};</span>
<a id="__codelineno-32-59" name="__codelineno-32-59" href="#__codelineno-32-59"></a>
<a id="__codelineno-32-60" name="__codelineno-32-60" href="#__codelineno-32-60"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace graphics</span>
<a id="__codelineno-32-61" name="__codelineno-32-61" href="#__codelineno-32-61"></a>
<a id="__codelineno-32-62" name="__codelineno-32-62" href="#__codelineno-32-62"></a><span class="cp">#endif  </span><span class="c1">// SCENE_GRAPH_H_</span>
</code></pre></div>
<p>Now, let's implement the SceneNode and SceneGraph classes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-33-1" name="__codelineno-33-1" href="#__codelineno-33-1"></a><span class="c1">// scene_graph.cc</span>
<a id="__codelineno-33-2" name="__codelineno-33-2" href="#__codelineno-33-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;scene_graph.h&quot;</span>
<a id="__codelineno-33-3" name="__codelineno-33-3" href="#__codelineno-33-3"></a>
<a id="__codelineno-33-4" name="__codelineno-33-4" href="#__codelineno-33-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
<a id="__codelineno-33-5" name="__codelineno-33-5" href="#__codelineno-33-5"></a>
<a id="__codelineno-33-6" name="__codelineno-33-6" href="#__codelineno-33-6"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">graphics</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-7" name="__codelineno-33-7" href="#__codelineno-33-7"></a>
<a id="__codelineno-33-8" name="__codelineno-33-8" href="#__codelineno-33-8"></a><span class="n">SceneNode</span><span class="o">::</span><span class="n">SceneNode</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-33-9" name="__codelineno-33-9" href="#__codelineno-33-9"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">name_</span><span class="p">(</span><span class="n">name</span><span class="p">),</span><span class="w"> </span><span class="n">local_transform_</span><span class="p">(</span><span class="n">Matrix4x4</span><span class="o">::</span><span class="n">Identity</span><span class="p">()),</span><span class="w"> </span><span class="n">parent_</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-33-10" name="__codelineno-33-10" href="#__codelineno-33-10"></a>
<a id="__codelineno-33-11" name="__codelineno-33-11" href="#__codelineno-33-11"></a><span class="kt">void</span><span class="w"> </span><span class="n">SceneNode</span><span class="o">::</span><span class="n">AddChild</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">SceneNode</span><span class="o">&gt;</span><span class="w"> </span><span class="n">child</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-12" name="__codelineno-33-12" href="#__codelineno-33-12"></a><span class="w">  </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">parent_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">this</span><span class="p">;</span>
<a id="__codelineno-33-13" name="__codelineno-33-13" href="#__codelineno-33-13"></a><span class="w">  </span><span class="n">children_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">child</span><span class="p">));</span>
<a id="__codelineno-33-14" name="__codelineno-33-14" href="#__codelineno-33-14"></a><span class="p">}</span>
<a id="__codelineno-33-15" name="__codelineno-33-15" href="#__codelineno-33-15"></a>
<a id="__codelineno-33-16" name="__codelineno-33-16" href="#__codelineno-33-16"></a><span class="kt">void</span><span class="w"> </span><span class="n">SceneNode</span><span class="o">::</span><span class="n">RemoveChild</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">SceneNode</span><span class="o">*</span><span class="w"> </span><span class="n">child</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-17" name="__codelineno-33-17" href="#__codelineno-33-17"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">find_if</span><span class="p">(</span><span class="n">children_</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">children_</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
<a id="__codelineno-33-18" name="__codelineno-33-18" href="#__codelineno-33-18"></a><span class="w">                         </span><span class="p">[</span><span class="n">child</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">c</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">c</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">child</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-33-19" name="__codelineno-33-19" href="#__codelineno-33-19"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">children_</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-20" name="__codelineno-33-20" href="#__codelineno-33-20"></a><span class="w">    </span><span class="n">children_</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">it</span><span class="p">);</span>
<a id="__codelineno-33-21" name="__codelineno-33-21" href="#__codelineno-33-21"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-33-22" name="__codelineno-33-22" href="#__codelineno-33-22"></a><span class="p">}</span>
<a id="__codelineno-33-23" name="__codelineno-33-23" href="#__codelineno-33-23"></a>
<a id="__codelineno-33-24" name="__codelineno-33-24" href="#__codelineno-33-24"></a><span class="kt">void</span><span class="w"> </span><span class="n">SceneNode</span><span class="o">::</span><span class="n">SetLocalTransform</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Matrix4x4</span><span class="o">&amp;</span><span class="w"> </span><span class="n">transform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-25" name="__codelineno-33-25" href="#__codelineno-33-25"></a><span class="w">  </span><span class="n">local_transform_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">transform</span><span class="p">;</span>
<a id="__codelineno-33-26" name="__codelineno-33-26" href="#__codelineno-33-26"></a><span class="p">}</span>
<a id="__codelineno-33-27" name="__codelineno-33-27" href="#__codelineno-33-27"></a>
<a id="__codelineno-33-28" name="__codelineno-33-28" href="#__codelineno-33-28"></a><span class="n">Matrix4x4</span><span class="w"> </span><span class="n">SceneNode</span><span class="o">::</span><span class="n">GetWorldTransform</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-29" name="__codelineno-33-29" href="#__codelineno-33-29"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">parent_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-30" name="__codelineno-33-30" href="#__codelineno-33-30"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">parent_</span><span class="o">-&gt;</span><span class="n">GetWorldTransform</span><span class="p">()</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">local_transform_</span><span class="p">;</span>
<a id="__codelineno-33-31" name="__codelineno-33-31" href="#__codelineno-33-31"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-33-32" name="__codelineno-33-32" href="#__codelineno-33-32"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">local_transform_</span><span class="p">;</span>
<a id="__codelineno-33-33" name="__codelineno-33-33" href="#__codelineno-33-33"></a><span class="p">}</span>
<a id="__codelineno-33-34" name="__codelineno-33-34" href="#__codelineno-33-34"></a>
<a id="__codelineno-33-35" name="__codelineno-33-35" href="#__codelineno-33-35"></a><span class="kt">void</span><span class="w"> </span><span class="n">SceneNode</span><span class="o">::</span><span class="n">SetPosition</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-36" name="__codelineno-33-36" href="#__codelineno-33-36"></a><span class="w">  </span><span class="n">local_transform_</span><span class="p">.</span><span class="n">SetTranslation</span><span class="p">(</span><span class="n">position</span><span class="p">);</span>
<a id="__codelineno-33-37" name="__codelineno-33-37" href="#__codelineno-33-37"></a><span class="p">}</span>
<a id="__codelineno-33-38" name="__codelineno-33-38" href="#__codelineno-33-38"></a>
<a id="__codelineno-33-39" name="__codelineno-33-39" href="#__codelineno-33-39"></a><span class="kt">void</span><span class="w"> </span><span class="n">SceneNode</span><span class="o">::</span><span class="n">SetRotation</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">rotation</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-40" name="__codelineno-33-40" href="#__codelineno-33-40"></a><span class="w">  </span><span class="n">local_transform_</span><span class="p">.</span><span class="n">SetRotation</span><span class="p">(</span><span class="n">rotation</span><span class="p">);</span>
<a id="__codelineno-33-41" name="__codelineno-33-41" href="#__codelineno-33-41"></a><span class="p">}</span>
<a id="__codelineno-33-42" name="__codelineno-33-42" href="#__codelineno-33-42"></a>
<a id="__codelineno-33-43" name="__codelineno-33-43" href="#__codelineno-33-43"></a><span class="kt">void</span><span class="w"> </span><span class="n">SceneNode</span><span class="o">::</span><span class="n">SetScale</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">scale</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-44" name="__codelineno-33-44" href="#__codelineno-33-44"></a><span class="w">  </span><span class="n">local_transform_</span><span class="p">.</span><span class="n">SetScale</span><span class="p">(</span><span class="n">scale</span><span class="p">);</span>
<a id="__codelineno-33-45" name="__codelineno-33-45" href="#__codelineno-33-45"></a><span class="p">}</span>
<a id="__codelineno-33-46" name="__codelineno-33-46" href="#__codelineno-33-46"></a>
<a id="__codelineno-33-47" name="__codelineno-33-47" href="#__codelineno-33-47"></a><span class="kt">void</span><span class="w"> </span><span class="n">SceneNode</span><span class="o">::</span><span class="n">Update</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">delta_time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-48" name="__codelineno-33-48" href="#__codelineno-33-48"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">children_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-49" name="__codelineno-33-49" href="#__codelineno-33-49"></a><span class="w">    </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">Update</span><span class="p">(</span><span class="n">delta_time</span><span class="p">);</span>
<a id="__codelineno-33-50" name="__codelineno-33-50" href="#__codelineno-33-50"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-33-51" name="__codelineno-33-51" href="#__codelineno-33-51"></a><span class="p">}</span>
<a id="__codelineno-33-52" name="__codelineno-33-52" href="#__codelineno-33-52"></a>
<a id="__codelineno-33-53" name="__codelineno-33-53" href="#__codelineno-33-53"></a><span class="kt">void</span><span class="w"> </span><span class="n">SceneNode</span><span class="o">::</span><span class="n">Render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-54" name="__codelineno-33-54" href="#__codelineno-33-54"></a><span class="w">  </span><span class="c1">// Implement rendering logic here</span>
<a id="__codelineno-33-55" name="__codelineno-33-55" href="#__codelineno-33-55"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">child</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">children_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-56" name="__codelineno-33-56" href="#__codelineno-33-56"></a><span class="w">    </span><span class="n">child</span><span class="o">-&gt;</span><span class="n">Render</span><span class="p">();</span>
<a id="__codelineno-33-57" name="__codelineno-33-57" href="#__codelineno-33-57"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-33-58" name="__codelineno-33-58" href="#__codelineno-33-58"></a><span class="p">}</span>
<a id="__codelineno-33-59" name="__codelineno-33-59" href="#__codelineno-33-59"></a>
<a id="__codelineno-33-60" name="__codelineno-33-60" href="#__codelineno-33-60"></a><span class="n">SceneGraph</span><span class="o">::</span><span class="n">SceneGraph</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">root_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">SceneNode</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;Root&quot;</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-33-61" name="__codelineno-33-61" href="#__codelineno-33-61"></a>
<a id="__codelineno-33-62" name="__codelineno-33-62" href="#__codelineno-33-62"></a><span class="kt">void</span><span class="w"> </span><span class="n">SceneGraph</span><span class="o">::</span><span class="n">SetRoot</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">SceneNode</span><span class="o">&gt;</span><span class="w"> </span><span class="n">root</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-63" name="__codelineno-33-63" href="#__codelineno-33-63"></a><span class="w">  </span><span class="n">root_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">root</span><span class="p">);</span>
<a id="__codelineno-33-64" name="__codelineno-33-64" href="#__codelineno-33-64"></a><span class="p">}</span>
<a id="__codelineno-33-65" name="__codelineno-33-65" href="#__codelineno-33-65"></a>
<a id="__codelineno-33-66" name="__codelineno-33-66" href="#__codelineno-33-66"></a><span class="kt">void</span><span class="w"> </span><span class="n">SceneGraph</span><span class="o">::</span><span class="n">Update</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">delta_time</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-67" name="__codelineno-33-67" href="#__codelineno-33-67"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">root_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-68" name="__codelineno-33-68" href="#__codelineno-33-68"></a><span class="w">    </span><span class="n">root_</span><span class="o">-&gt;</span><span class="n">Update</span><span class="p">(</span><span class="n">delta_time</span><span class="p">);</span>
<a id="__codelineno-33-69" name="__codelineno-33-69" href="#__codelineno-33-69"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-33-70" name="__codelineno-33-70" href="#__codelineno-33-70"></a><span class="p">}</span>
<a id="__codelineno-33-71" name="__codelineno-33-71" href="#__codelineno-33-71"></a>
<a id="__codelineno-33-72" name="__codelineno-33-72" href="#__codelineno-33-72"></a><span class="kt">void</span><span class="w"> </span><span class="n">SceneGraph</span><span class="o">::</span><span class="n">Render</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-73" name="__codelineno-33-73" href="#__codelineno-33-73"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">root_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-33-74" name="__codelineno-33-74" href="#__codelineno-33-74"></a><span class="w">    </span><span class="n">root_</span><span class="o">-&gt;</span><span class="n">Render</span><span class="p">();</span>
<a id="__codelineno-33-75" name="__codelineno-33-75" href="#__codelineno-33-75"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-33-76" name="__codelineno-33-76" href="#__codelineno-33-76"></a><span class="p">}</span>
<a id="__codelineno-33-77" name="__codelineno-33-77" href="#__codelineno-33-77"></a>
<a id="__codelineno-33-78" name="__codelineno-33-78" href="#__codelineno-33-78"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace graphics</span>
</code></pre></div>
<p>This implementation follows several best practices:</p>
<ol>
<li>Use of namespaces to avoid naming conflicts.</li>
<li>Clear separation of interface (header) and implementation (source) files.</li>
<li>Use of modern C++ features like <code>std::unique_ptr</code> for memory management.</li>
<li>Consistent naming conventions (e.g., method names are CamelCase).</li>
<li>Use of <code>const</code> for methods that don't modify object state.</li>
<li>Explicit constructor and deleted copy constructor/assignment operator to prevent accidental copies.</li>
<li>Virtual destructor in the base class to ensure proper cleanup of derived classes.</li>
</ol>
<p>To use this Scene Graph, you would typically create custom node types that inherit from SceneNode:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-34-1" name="__codelineno-34-1" href="#__codelineno-34-1"></a><span class="c1">// game_objects.h</span>
<a id="__codelineno-34-2" name="__codelineno-34-2" href="#__codelineno-34-2"></a><span class="cp">#ifndef GAME_OBJECTS_H_</span>
<a id="__codelineno-34-3" name="__codelineno-34-3" href="#__codelineno-34-3"></a><span class="cp">#define GAME_OBJECTS_H_</span>
<a id="__codelineno-34-4" name="__codelineno-34-4" href="#__codelineno-34-4"></a>
<a id="__codelineno-34-5" name="__codelineno-34-5" href="#__codelineno-34-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;scene_graph.h&quot;</span>
<a id="__codelineno-34-6" name="__codelineno-34-6" href="#__codelineno-34-6"></a>
<a id="__codelineno-34-7" name="__codelineno-34-7" href="#__codelineno-34-7"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">game</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-8" name="__codelineno-34-8" href="#__codelineno-34-8"></a>
<a id="__codelineno-34-9" name="__codelineno-34-9" href="#__codelineno-34-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">PlayerNode</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">graphics</span><span class="o">::</span><span class="n">SceneNode</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-10" name="__codelineno-34-10" href="#__codelineno-34-10"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-34-11" name="__codelineno-34-11" href="#__codelineno-34-11"></a><span class="w">  </span><span class="k">explicit</span><span class="w"> </span><span class="n">PlayerNode</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-34-12" name="__codelineno-34-12" href="#__codelineno-34-12"></a>
<a id="__codelineno-34-13" name="__codelineno-34-13" href="#__codelineno-34-13"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">Update</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">delta_time</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<a id="__codelineno-34-14" name="__codelineno-34-14" href="#__codelineno-34-14"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">Render</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<a id="__codelineno-34-15" name="__codelineno-34-15" href="#__codelineno-34-15"></a>
<a id="__codelineno-34-16" name="__codelineno-34-16" href="#__codelineno-34-16"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-34-17" name="__codelineno-34-17" href="#__codelineno-34-17"></a><span class="w">  </span><span class="c1">// Add player-specific members</span>
<a id="__codelineno-34-18" name="__codelineno-34-18" href="#__codelineno-34-18"></a><span class="p">};</span>
<a id="__codelineno-34-19" name="__codelineno-34-19" href="#__codelineno-34-19"></a>
<a id="__codelineno-34-20" name="__codelineno-34-20" href="#__codelineno-34-20"></a><span class="k">class</span><span class="w"> </span><span class="nc">EnemyNode</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">graphics</span><span class="o">::</span><span class="n">SceneNode</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-34-21" name="__codelineno-34-21" href="#__codelineno-34-21"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-34-22" name="__codelineno-34-22" href="#__codelineno-34-22"></a><span class="w">  </span><span class="k">explicit</span><span class="w"> </span><span class="n">EnemyNode</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-34-23" name="__codelineno-34-23" href="#__codelineno-34-23"></a>
<a id="__codelineno-34-24" name="__codelineno-34-24" href="#__codelineno-34-24"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">Update</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">delta_time</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<a id="__codelineno-34-25" name="__codelineno-34-25" href="#__codelineno-34-25"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">Render</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<a id="__codelineno-34-26" name="__codelineno-34-26" href="#__codelineno-34-26"></a>
<a id="__codelineno-34-27" name="__codelineno-34-27" href="#__codelineno-34-27"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-34-28" name="__codelineno-34-28" href="#__codelineno-34-28"></a><span class="w">  </span><span class="c1">// Add enemy-specific members</span>
<a id="__codelineno-34-29" name="__codelineno-34-29" href="#__codelineno-34-29"></a><span class="p">};</span>
<a id="__codelineno-34-30" name="__codelineno-34-30" href="#__codelineno-34-30"></a>
<a id="__codelineno-34-31" name="__codelineno-34-31" href="#__codelineno-34-31"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace game</span>
<a id="__codelineno-34-32" name="__codelineno-34-32" href="#__codelineno-34-32"></a>
<a id="__codelineno-34-33" name="__codelineno-34-33" href="#__codelineno-34-33"></a><span class="cp">#endif  </span><span class="c1">// GAME_OBJECTS_H_</span>
</code></pre></div>
<p>And then use them in your game:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-35-1" name="__codelineno-35-1" href="#__codelineno-35-1"></a><span class="c1">// main.cc</span>
<a id="__codelineno-35-2" name="__codelineno-35-2" href="#__codelineno-35-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;scene_graph.h&quot;</span>
<a id="__codelineno-35-3" name="__codelineno-35-3" href="#__codelineno-35-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;game_objects.h&quot;</span>
<a id="__codelineno-35-4" name="__codelineno-35-4" href="#__codelineno-35-4"></a>
<a id="__codelineno-35-5" name="__codelineno-35-5" href="#__codelineno-35-5"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-6" name="__codelineno-35-6" href="#__codelineno-35-6"></a><span class="w">  </span><span class="n">graphics</span><span class="o">::</span><span class="n">SceneGraph</span><span class="w"> </span><span class="n">scene</span><span class="p">;</span>
<a id="__codelineno-35-7" name="__codelineno-35-7" href="#__codelineno-35-7"></a>
<a id="__codelineno-35-8" name="__codelineno-35-8" href="#__codelineno-35-8"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">player</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">game</span><span class="o">::</span><span class="n">PlayerNode</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;Player&quot;</span><span class="p">);</span>
<a id="__codelineno-35-9" name="__codelineno-35-9" href="#__codelineno-35-9"></a><span class="w">  </span><span class="n">player</span><span class="o">-&gt;</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-35-10" name="__codelineno-35-10" href="#__codelineno-35-10"></a>
<a id="__codelineno-35-11" name="__codelineno-35-11" href="#__codelineno-35-11"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">enemy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">game</span><span class="o">::</span><span class="n">EnemyNode</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;Enemy&quot;</span><span class="p">);</span>
<a id="__codelineno-35-12" name="__codelineno-35-12" href="#__codelineno-35-12"></a><span class="w">  </span><span class="n">enemy</span><span class="o">-&gt;</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">Vector3</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">));</span>
<a id="__codelineno-35-13" name="__codelineno-35-13" href="#__codelineno-35-13"></a>
<a id="__codelineno-35-14" name="__codelineno-35-14" href="#__codelineno-35-14"></a><span class="w">  </span><span class="n">scene</span><span class="p">.</span><span class="n">GetRoot</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">AddChild</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">player</span><span class="p">));</span>
<a id="__codelineno-35-15" name="__codelineno-35-15" href="#__codelineno-35-15"></a><span class="w">  </span><span class="n">scene</span><span class="p">.</span><span class="n">GetRoot</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">AddChild</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">enemy</span><span class="p">));</span>
<a id="__codelineno-35-16" name="__codelineno-35-16" href="#__codelineno-35-16"></a>
<a id="__codelineno-35-17" name="__codelineno-35-17" href="#__codelineno-35-17"></a><span class="w">  </span><span class="c1">// Game loop</span>
<a id="__codelineno-35-18" name="__codelineno-35-18" href="#__codelineno-35-18"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-35-19" name="__codelineno-35-19" href="#__codelineno-35-19"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">delta_time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ComputeDeltaTime</span><span class="p">();</span>
<a id="__codelineno-35-20" name="__codelineno-35-20" href="#__codelineno-35-20"></a><span class="w">    </span><span class="n">scene</span><span class="p">.</span><span class="n">Update</span><span class="p">(</span><span class="n">delta_time</span><span class="p">);</span>
<a id="__codelineno-35-21" name="__codelineno-35-21" href="#__codelineno-35-21"></a><span class="w">    </span><span class="n">scene</span><span class="p">.</span><span class="n">Render</span><span class="p">();</span>
<a id="__codelineno-35-22" name="__codelineno-35-22" href="#__codelineno-35-22"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-35-23" name="__codelineno-35-23" href="#__codelineno-35-23"></a>
<a id="__codelineno-35-24" name="__codelineno-35-24" href="#__codelineno-35-24"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-35-25" name="__codelineno-35-25" href="#__codelineno-35-25"></a><span class="p">}</span>
</code></pre></div>
<p>This Scene Graph implementation provides a solid foundation for organizing and managing complex scenes in a game or graphics application. It allows for easy traversal of the scene hierarchy, efficient updates and rendering, and flexible extension through custom node types.</p>
<h4 id="shaders-and-materials">Shaders and Materials</h4>
<p>Shaders and materials define how objects are rendered, providing control over visual effects and surface properties.</p>
<ul>
<li>
<p><strong>Shaders:</strong></p>
<ul>
<li><strong>Vertex Shaders:</strong> Process each vertex's position, color, and texture coordinates.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-36-1" name="__codelineno-36-1" href="#__codelineno-36-1"></a><span class="c1">// Vertex shader example</span>
<a id="__codelineno-36-2" name="__codelineno-36-2" href="#__codelineno-36-2"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-36-3" name="__codelineno-36-3" href="#__codelineno-36-3"></a><span class="k">layout</span><span class="p">(</span><span class="n">location</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mo">0</span><span class="p">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="kt">vec3</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-36-4" name="__codelineno-36-4" href="#__codelineno-36-4"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">mat4</span><span class="w"> </span><span class="n">modelViewProjectionMatrix</span><span class="p">;</span>
<a id="__codelineno-36-5" name="__codelineno-36-5" href="#__codelineno-36-5"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-36-6" name="__codelineno-36-6" href="#__codelineno-36-6"></a><span class="w">    </span><span class="nb">gl_Position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">modelViewProjectionMatrix</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="kt">vec4</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0</span><span class="p">);</span>
<a id="__codelineno-36-7" name="__codelineno-36-7" href="#__codelineno-36-7"></a><span class="p">}</span>
</code></pre></div>
<ul>
<li><strong>Fragment Shaders:</strong> Define the color and other attributes of each pixel.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-37-1" name="__codelineno-37-1" href="#__codelineno-37-1"></a><span class="c1">// Fragment shader example</span>
<a id="__codelineno-37-2" name="__codelineno-37-2" href="#__codelineno-37-2"></a><span class="cp">#version 330 core</span>
<a id="__codelineno-37-3" name="__codelineno-37-3" href="#__codelineno-37-3"></a><span class="k">out</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">fragColor</span><span class="p">;</span>
<a id="__codelineno-37-4" name="__codelineno-37-4" href="#__codelineno-37-4"></a><span class="k">uniform</span><span class="w"> </span><span class="kt">vec4</span><span class="w"> </span><span class="n">color</span><span class="p">;</span>
<a id="__codelineno-37-5" name="__codelineno-37-5" href="#__codelineno-37-5"></a><span class="kt">void</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-37-6" name="__codelineno-37-6" href="#__codelineno-37-6"></a><span class="w">    </span><span class="n">fragColor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="p">;</span>
<a id="__codelineno-37-7" name="__codelineno-37-7" href="#__codelineno-37-7"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Materials:</strong> Define the properties of a surface, including which shaders to use and the textures or constants to pass to those shaders.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-38-1" name="__codelineno-38-1" href="#__codelineno-38-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Material</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-2" name="__codelineno-38-2" href="#__codelineno-38-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Shader</span><span class="w"> </span><span class="n">shader</span><span class="p">;</span>
<a id="__codelineno-38-3" name="__codelineno-38-3" href="#__codelineno-38-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Texture</span><span class="w"> </span><span class="n">texture</span><span class="p">;</span>
<a id="__codelineno-38-4" name="__codelineno-38-4" href="#__codelineno-38-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="n">color</span><span class="p">;</span>
<a id="__codelineno-38-5" name="__codelineno-38-5" href="#__codelineno-38-5"></a>
<a id="__codelineno-38-6" name="__codelineno-38-6" href="#__codelineno-38-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Apply</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-38-7" name="__codelineno-38-7" href="#__codelineno-38-7"></a><span class="w">        </span><span class="n">shader</span><span class="p">.</span><span class="n">SetUniform</span><span class="p">(</span><span class="s">&quot;color&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="p">);</span>
<a id="__codelineno-38-8" name="__codelineno-38-8" href="#__codelineno-38-8"></a><span class="w">        </span><span class="n">shader</span><span class="p">.</span><span class="n">SetTexture</span><span class="p">(</span><span class="s">&quot;texture&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">texture</span><span class="p">);</span>
<a id="__codelineno-38-9" name="__codelineno-38-9" href="#__codelineno-38-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-38-10" name="__codelineno-38-10" href="#__codelineno-38-10"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="shaders">Shaders</h4>
<p>Shaders are programs that run on the GPU and define how to render graphics. They are crucial in modern computer graphics for creating various visual effects and optimizing rendering performance. There are mainly three types of shaders:</p>
<ol>
<li>Vertex Shaders: Process individual vertices.</li>
<li>Fragment (or Pixel) Shaders: Process individual fragments (pixels).</li>
<li>Geometry Shaders: Process entire primitives.</li>
</ol>
<p>Let's implement a shader system that can load, compile, and manage shaders:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-39-1" name="__codelineno-39-1" href="#__codelineno-39-1"></a><span class="c1">// shader.h</span>
<a id="__codelineno-39-2" name="__codelineno-39-2" href="#__codelineno-39-2"></a><span class="cp">#ifndef GRAPHICS_SHADER_H_</span>
<a id="__codelineno-39-3" name="__codelineno-39-3" href="#__codelineno-39-3"></a><span class="cp">#define GRAPHICS_SHADER_H_</span>
<a id="__codelineno-39-4" name="__codelineno-39-4" href="#__codelineno-39-4"></a>
<a id="__codelineno-39-5" name="__codelineno-39-5" href="#__codelineno-39-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-39-6" name="__codelineno-39-6" href="#__codelineno-39-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unordered_map&gt;</span>
<a id="__codelineno-39-7" name="__codelineno-39-7" href="#__codelineno-39-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-39-8" name="__codelineno-39-8" href="#__codelineno-39-8"></a>
<a id="__codelineno-39-9" name="__codelineno-39-9" href="#__codelineno-39-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;gl_headers.h&quot;</span><span class="c1">  // Assume this includes necessary OpenGL headers</span>
<a id="__codelineno-39-10" name="__codelineno-39-10" href="#__codelineno-39-10"></a>
<a id="__codelineno-39-11" name="__codelineno-39-11" href="#__codelineno-39-11"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">graphics</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-12" name="__codelineno-39-12" href="#__codelineno-39-12"></a>
<a id="__codelineno-39-13" name="__codelineno-39-13" href="#__codelineno-39-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">Shader</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-14" name="__codelineno-39-14" href="#__codelineno-39-14"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-39-15" name="__codelineno-39-15" href="#__codelineno-39-15"></a><span class="w">  </span><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Type</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-16" name="__codelineno-39-16" href="#__codelineno-39-16"></a><span class="w">    </span><span class="n">kVertex</span><span class="p">,</span>
<a id="__codelineno-39-17" name="__codelineno-39-17" href="#__codelineno-39-17"></a><span class="w">    </span><span class="n">kFragment</span><span class="p">,</span>
<a id="__codelineno-39-18" name="__codelineno-39-18" href="#__codelineno-39-18"></a><span class="w">    </span><span class="n">kGeometry</span>
<a id="__codelineno-39-19" name="__codelineno-39-19" href="#__codelineno-39-19"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-39-20" name="__codelineno-39-20" href="#__codelineno-39-20"></a>
<a id="__codelineno-39-21" name="__codelineno-39-21" href="#__codelineno-39-21"></a><span class="w">  </span><span class="n">Shader</span><span class="p">();</span>
<a id="__codelineno-39-22" name="__codelineno-39-22" href="#__codelineno-39-22"></a><span class="w">  </span><span class="o">~</span><span class="n">Shader</span><span class="p">();</span>
<a id="__codelineno-39-23" name="__codelineno-39-23" href="#__codelineno-39-23"></a>
<a id="__codelineno-39-24" name="__codelineno-39-24" href="#__codelineno-39-24"></a><span class="w">  </span><span class="c1">// Disallow copy and assign</span>
<a id="__codelineno-39-25" name="__codelineno-39-25" href="#__codelineno-39-25"></a><span class="w">  </span><span class="n">Shader</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Shader</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-39-26" name="__codelineno-39-26" href="#__codelineno-39-26"></a><span class="w">  </span><span class="n">Shader</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Shader</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-39-27" name="__codelineno-39-27" href="#__codelineno-39-27"></a>
<a id="__codelineno-39-28" name="__codelineno-39-28" href="#__codelineno-39-28"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">LoadFromFile</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">file_path</span><span class="p">);</span>
<a id="__codelineno-39-29" name="__codelineno-39-29" href="#__codelineno-39-29"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">LoadFromString</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">source</span><span class="p">);</span>
<a id="__codelineno-39-30" name="__codelineno-39-30" href="#__codelineno-39-30"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Link</span><span class="p">();</span>
<a id="__codelineno-39-31" name="__codelineno-39-31" href="#__codelineno-39-31"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">Use</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-39-32" name="__codelineno-39-32" href="#__codelineno-39-32"></a>
<a id="__codelineno-39-33" name="__codelineno-39-33" href="#__codelineno-39-33"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetBool</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-39-34" name="__codelineno-39-34" href="#__codelineno-39-34"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetInt</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-39-35" name="__codelineno-39-35" href="#__codelineno-39-35"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetFloat</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-39-36" name="__codelineno-39-36" href="#__codelineno-39-36"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetVec2</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-39-37" name="__codelineno-39-37" href="#__codelineno-39-37"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetVec3</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-39-38" name="__codelineno-39-38" href="#__codelineno-39-38"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetVec4</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-39-39" name="__codelineno-39-39" href="#__codelineno-39-39"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetMat4</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-39-40" name="__codelineno-39-40" href="#__codelineno-39-40"></a>
<a id="__codelineno-39-41" name="__codelineno-39-41" href="#__codelineno-39-41"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-39-42" name="__codelineno-39-42" href="#__codelineno-39-42"></a><span class="w">  </span><span class="n">GLuint</span><span class="w"> </span><span class="n">program_id_</span><span class="p">;</span>
<a id="__codelineno-39-43" name="__codelineno-39-43" href="#__codelineno-39-43"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">GLuint</span><span class="o">&gt;</span><span class="w"> </span><span class="n">shader_ids_</span><span class="p">;</span>
<a id="__codelineno-39-44" name="__codelineno-39-44" href="#__codelineno-39-44"></a>
<a id="__codelineno-39-45" name="__codelineno-39-45" href="#__codelineno-39-45"></a><span class="w">  </span><span class="kt">bool</span><span class="w"> </span><span class="nf">CompileShader</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">source</span><span class="p">);</span>
<a id="__codelineno-39-46" name="__codelineno-39-46" href="#__codelineno-39-46"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">DeleteShaders</span><span class="p">();</span>
<a id="__codelineno-39-47" name="__codelineno-39-47" href="#__codelineno-39-47"></a><span class="p">};</span>
<a id="__codelineno-39-48" name="__codelineno-39-48" href="#__codelineno-39-48"></a>
<a id="__codelineno-39-49" name="__codelineno-39-49" href="#__codelineno-39-49"></a><span class="k">class</span><span class="w"> </span><span class="nc">ShaderManager</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-39-50" name="__codelineno-39-50" href="#__codelineno-39-50"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-39-51" name="__codelineno-39-51" href="#__codelineno-39-51"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">ShaderManager</span><span class="o">&amp;</span><span class="w"> </span><span class="n">GetInstance</span><span class="p">();</span>
<a id="__codelineno-39-52" name="__codelineno-39-52" href="#__codelineno-39-52"></a>
<a id="__codelineno-39-53" name="__codelineno-39-53" href="#__codelineno-39-53"></a><span class="w">  </span><span class="c1">// Disallow copy and assign</span>
<a id="__codelineno-39-54" name="__codelineno-39-54" href="#__codelineno-39-54"></a><span class="w">  </span><span class="n">ShaderManager</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ShaderManager</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-39-55" name="__codelineno-39-55" href="#__codelineno-39-55"></a><span class="w">  </span><span class="n">ShaderManager</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">ShaderManager</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-39-56" name="__codelineno-39-56" href="#__codelineno-39-56"></a>
<a id="__codelineno-39-57" name="__codelineno-39-57" href="#__codelineno-39-57"></a><span class="w">  </span><span class="n">Shader</span><span class="o">*</span><span class="w"> </span><span class="n">LoadShader</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-39-58" name="__codelineno-39-58" href="#__codelineno-39-58"></a><span class="w">                     </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">vertex_path</span><span class="p">,</span>
<a id="__codelineno-39-59" name="__codelineno-39-59" href="#__codelineno-39-59"></a><span class="w">                     </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">fragment_path</span><span class="p">,</span>
<a id="__codelineno-39-60" name="__codelineno-39-60" href="#__codelineno-39-60"></a><span class="w">                     </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">geometry_path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">);</span>
<a id="__codelineno-39-61" name="__codelineno-39-61" href="#__codelineno-39-61"></a><span class="w">  </span><span class="n">Shader</span><span class="o">*</span><span class="w"> </span><span class="nf">GetShader</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-39-62" name="__codelineno-39-62" href="#__codelineno-39-62"></a>
<a id="__codelineno-39-63" name="__codelineno-39-63" href="#__codelineno-39-63"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-39-64" name="__codelineno-39-64" href="#__codelineno-39-64"></a><span class="w">  </span><span class="n">ShaderManager</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-39-65" name="__codelineno-39-65" href="#__codelineno-39-65"></a><span class="w">  </span><span class="o">~</span><span class="n">ShaderManager</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-39-66" name="__codelineno-39-66" href="#__codelineno-39-66"></a>
<a id="__codelineno-39-67" name="__codelineno-39-67" href="#__codelineno-39-67"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Shader</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">shaders_</span><span class="p">;</span>
<a id="__codelineno-39-68" name="__codelineno-39-68" href="#__codelineno-39-68"></a><span class="p">};</span>
<a id="__codelineno-39-69" name="__codelineno-39-69" href="#__codelineno-39-69"></a>
<a id="__codelineno-39-70" name="__codelineno-39-70" href="#__codelineno-39-70"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace graphics</span>
<a id="__codelineno-39-71" name="__codelineno-39-71" href="#__codelineno-39-71"></a>
<a id="__codelineno-39-72" name="__codelineno-39-72" href="#__codelineno-39-72"></a><span class="cp">#endif  </span><span class="c1">// GRAPHICS_SHADER_H_</span>
</code></pre></div>
<p>Now, let's implement the Shader and ShaderManager classes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-40-1" name="__codelineno-40-1" href="#__codelineno-40-1"></a><span class="c1">// shader.cc</span>
<a id="__codelineno-40-2" name="__codelineno-40-2" href="#__codelineno-40-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;shader.h&quot;</span>
<a id="__codelineno-40-3" name="__codelineno-40-3" href="#__codelineno-40-3"></a>
<a id="__codelineno-40-4" name="__codelineno-40-4" href="#__codelineno-40-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>
<a id="__codelineno-40-5" name="__codelineno-40-5" href="#__codelineno-40-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-40-6" name="__codelineno-40-6" href="#__codelineno-40-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sstream&gt;</span>
<a id="__codelineno-40-7" name="__codelineno-40-7" href="#__codelineno-40-7"></a>
<a id="__codelineno-40-8" name="__codelineno-40-8" href="#__codelineno-40-8"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">graphics</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-9" name="__codelineno-40-9" href="#__codelineno-40-9"></a>
<a id="__codelineno-40-10" name="__codelineno-40-10" href="#__codelineno-40-10"></a><span class="k">namespace</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-11" name="__codelineno-40-11" href="#__codelineno-40-11"></a>
<a id="__codelineno-40-12" name="__codelineno-40-12" href="#__codelineno-40-12"></a><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="nf">ReadFile</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">file_path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-13" name="__codelineno-40-13" href="#__codelineno-40-13"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span><span class="w"> </span><span class="n">file_stream</span><span class="p">(</span><span class="n">file_path</span><span class="p">);</span>
<a id="__codelineno-40-14" name="__codelineno-40-14" href="#__codelineno-40-14"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">file_stream</span><span class="p">.</span><span class="n">is_open</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-15" name="__codelineno-40-15" href="#__codelineno-40-15"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to open file: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">file_path</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-40-16" name="__codelineno-40-16" href="#__codelineno-40-16"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">;</span>
<a id="__codelineno-40-17" name="__codelineno-40-17" href="#__codelineno-40-17"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-40-18" name="__codelineno-40-18" href="#__codelineno-40-18"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">stringstream</span><span class="w"> </span><span class="n">buffer</span><span class="p">;</span>
<a id="__codelineno-40-19" name="__codelineno-40-19" href="#__codelineno-40-19"></a><span class="w">  </span><span class="n">buffer</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">file_stream</span><span class="p">.</span><span class="n">rdbuf</span><span class="p">();</span>
<a id="__codelineno-40-20" name="__codelineno-40-20" href="#__codelineno-40-20"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">buffer</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
<a id="__codelineno-40-21" name="__codelineno-40-21" href="#__codelineno-40-21"></a><span class="p">}</span>
<a id="__codelineno-40-22" name="__codelineno-40-22" href="#__codelineno-40-22"></a>
<a id="__codelineno-40-23" name="__codelineno-40-23" href="#__codelineno-40-23"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace</span>
<a id="__codelineno-40-24" name="__codelineno-40-24" href="#__codelineno-40-24"></a>
<a id="__codelineno-40-25" name="__codelineno-40-25" href="#__codelineno-40-25"></a><span class="n">Shader</span><span class="o">::</span><span class="n">Shader</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">program_id_</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-26" name="__codelineno-40-26" href="#__codelineno-40-26"></a><span class="w">  </span><span class="n">program_id_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glCreateProgram</span><span class="p">();</span>
<a id="__codelineno-40-27" name="__codelineno-40-27" href="#__codelineno-40-27"></a><span class="p">}</span>
<a id="__codelineno-40-28" name="__codelineno-40-28" href="#__codelineno-40-28"></a>
<a id="__codelineno-40-29" name="__codelineno-40-29" href="#__codelineno-40-29"></a><span class="n">Shader</span><span class="o">::~</span><span class="n">Shader</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-30" name="__codelineno-40-30" href="#__codelineno-40-30"></a><span class="w">  </span><span class="n">DeleteShaders</span><span class="p">();</span>
<a id="__codelineno-40-31" name="__codelineno-40-31" href="#__codelineno-40-31"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">program_id_</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-32" name="__codelineno-40-32" href="#__codelineno-40-32"></a><span class="w">    </span><span class="n">glDeleteProgram</span><span class="p">(</span><span class="n">program_id_</span><span class="p">);</span>
<a id="__codelineno-40-33" name="__codelineno-40-33" href="#__codelineno-40-33"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-40-34" name="__codelineno-40-34" href="#__codelineno-40-34"></a><span class="p">}</span>
<a id="__codelineno-40-35" name="__codelineno-40-35" href="#__codelineno-40-35"></a>
<a id="__codelineno-40-36" name="__codelineno-40-36" href="#__codelineno-40-36"></a><span class="kt">bool</span><span class="w"> </span><span class="n">Shader</span><span class="o">::</span><span class="n">LoadFromFile</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">file_path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-37" name="__codelineno-40-37" href="#__codelineno-40-37"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ReadFile</span><span class="p">(</span><span class="n">file_path</span><span class="p">);</span>
<a id="__codelineno-40-38" name="__codelineno-40-38" href="#__codelineno-40-38"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">source</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-39" name="__codelineno-40-39" href="#__codelineno-40-39"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-40-40" name="__codelineno-40-40" href="#__codelineno-40-40"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-40-41" name="__codelineno-40-41" href="#__codelineno-40-41"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">LoadFromString</span><span class="p">(</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">source</span><span class="p">);</span>
<a id="__codelineno-40-42" name="__codelineno-40-42" href="#__codelineno-40-42"></a><span class="p">}</span>
<a id="__codelineno-40-43" name="__codelineno-40-43" href="#__codelineno-40-43"></a>
<a id="__codelineno-40-44" name="__codelineno-40-44" href="#__codelineno-40-44"></a><span class="kt">bool</span><span class="w"> </span><span class="n">Shader</span><span class="o">::</span><span class="n">LoadFromString</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">source</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-45" name="__codelineno-40-45" href="#__codelineno-40-45"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">CompileShader</span><span class="p">(</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">source</span><span class="p">);</span>
<a id="__codelineno-40-46" name="__codelineno-40-46" href="#__codelineno-40-46"></a><span class="p">}</span>
<a id="__codelineno-40-47" name="__codelineno-40-47" href="#__codelineno-40-47"></a>
<a id="__codelineno-40-48" name="__codelineno-40-48" href="#__codelineno-40-48"></a><span class="kt">bool</span><span class="w"> </span><span class="n">Shader</span><span class="o">::</span><span class="n">Link</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-49" name="__codelineno-40-49" href="#__codelineno-40-49"></a><span class="w">  </span><span class="n">glLinkProgram</span><span class="p">(</span><span class="n">program_id_</span><span class="p">);</span>
<a id="__codelineno-40-50" name="__codelineno-40-50" href="#__codelineno-40-50"></a>
<a id="__codelineno-40-51" name="__codelineno-40-51" href="#__codelineno-40-51"></a><span class="w">  </span><span class="n">GLint</span><span class="w"> </span><span class="n">success</span><span class="p">;</span>
<a id="__codelineno-40-52" name="__codelineno-40-52" href="#__codelineno-40-52"></a><span class="w">  </span><span class="n">glGetProgramiv</span><span class="p">(</span><span class="n">program_id_</span><span class="p">,</span><span class="w"> </span><span class="n">GL_LINK_STATUS</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">success</span><span class="p">);</span>
<a id="__codelineno-40-53" name="__codelineno-40-53" href="#__codelineno-40-53"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-54" name="__codelineno-40-54" href="#__codelineno-40-54"></a><span class="w">    </span><span class="n">GLchar</span><span class="w"> </span><span class="n">info_log</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
<a id="__codelineno-40-55" name="__codelineno-40-55" href="#__codelineno-40-55"></a><span class="w">    </span><span class="n">glGetProgramInfoLog</span><span class="p">(</span><span class="n">program_id_</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">info_log</span><span class="p">),</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">info_log</span><span class="p">);</span>
<a id="__codelineno-40-56" name="__codelineno-40-56" href="#__codelineno-40-56"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Shader program linking failed: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">info_log</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-40-57" name="__codelineno-40-57" href="#__codelineno-40-57"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-40-58" name="__codelineno-40-58" href="#__codelineno-40-58"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-40-59" name="__codelineno-40-59" href="#__codelineno-40-59"></a>
<a id="__codelineno-40-60" name="__codelineno-40-60" href="#__codelineno-40-60"></a><span class="w">  </span><span class="n">DeleteShaders</span><span class="p">();</span>
<a id="__codelineno-40-61" name="__codelineno-40-61" href="#__codelineno-40-61"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-40-62" name="__codelineno-40-62" href="#__codelineno-40-62"></a><span class="p">}</span>
<a id="__codelineno-40-63" name="__codelineno-40-63" href="#__codelineno-40-63"></a>
<a id="__codelineno-40-64" name="__codelineno-40-64" href="#__codelineno-40-64"></a><span class="kt">void</span><span class="w"> </span><span class="n">Shader</span><span class="o">::</span><span class="n">Use</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-65" name="__codelineno-40-65" href="#__codelineno-40-65"></a><span class="w">  </span><span class="n">glUseProgram</span><span class="p">(</span><span class="n">program_id_</span><span class="p">);</span>
<a id="__codelineno-40-66" name="__codelineno-40-66" href="#__codelineno-40-66"></a><span class="p">}</span>
<a id="__codelineno-40-67" name="__codelineno-40-67" href="#__codelineno-40-67"></a>
<a id="__codelineno-40-68" name="__codelineno-40-68" href="#__codelineno-40-68"></a><span class="kt">void</span><span class="w"> </span><span class="n">Shader</span><span class="o">::</span><span class="n">SetBool</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-69" name="__codelineno-40-69" href="#__codelineno-40-69"></a><span class="w">  </span><span class="n">glUniform1i</span><span class="p">(</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">program_id_</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">()),</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">value</span><span class="p">);</span>
<a id="__codelineno-40-70" name="__codelineno-40-70" href="#__codelineno-40-70"></a><span class="p">}</span>
<a id="__codelineno-40-71" name="__codelineno-40-71" href="#__codelineno-40-71"></a>
<a id="__codelineno-40-72" name="__codelineno-40-72" href="#__codelineno-40-72"></a><span class="kt">void</span><span class="w"> </span><span class="n">Shader</span><span class="o">::</span><span class="n">SetInt</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-73" name="__codelineno-40-73" href="#__codelineno-40-73"></a><span class="w">  </span><span class="n">glUniform1i</span><span class="p">(</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">program_id_</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">()),</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<a id="__codelineno-40-74" name="__codelineno-40-74" href="#__codelineno-40-74"></a><span class="p">}</span>
<a id="__codelineno-40-75" name="__codelineno-40-75" href="#__codelineno-40-75"></a>
<a id="__codelineno-40-76" name="__codelineno-40-76" href="#__codelineno-40-76"></a><span class="kt">void</span><span class="w"> </span><span class="n">Shader</span><span class="o">::</span><span class="n">SetFloat</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-77" name="__codelineno-40-77" href="#__codelineno-40-77"></a><span class="w">  </span><span class="n">glUniform1f</span><span class="p">(</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">program_id_</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">()),</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<a id="__codelineno-40-78" name="__codelineno-40-78" href="#__codelineno-40-78"></a><span class="p">}</span>
<a id="__codelineno-40-79" name="__codelineno-40-79" href="#__codelineno-40-79"></a>
<a id="__codelineno-40-80" name="__codelineno-40-80" href="#__codelineno-40-80"></a><span class="kt">void</span><span class="w"> </span><span class="n">Shader</span><span class="o">::</span><span class="n">SetVec2</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-81" name="__codelineno-40-81" href="#__codelineno-40-81"></a><span class="w">  </span><span class="n">glUniform2fv</span><span class="p">(</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">program_id_</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">()),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<a id="__codelineno-40-82" name="__codelineno-40-82" href="#__codelineno-40-82"></a><span class="p">}</span>
<a id="__codelineno-40-83" name="__codelineno-40-83" href="#__codelineno-40-83"></a>
<a id="__codelineno-40-84" name="__codelineno-40-84" href="#__codelineno-40-84"></a><span class="kt">void</span><span class="w"> </span><span class="n">Shader</span><span class="o">::</span><span class="n">SetVec3</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-85" name="__codelineno-40-85" href="#__codelineno-40-85"></a><span class="w">  </span><span class="n">glUniform3fv</span><span class="p">(</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">program_id_</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">()),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<a id="__codelineno-40-86" name="__codelineno-40-86" href="#__codelineno-40-86"></a><span class="p">}</span>
<a id="__codelineno-40-87" name="__codelineno-40-87" href="#__codelineno-40-87"></a>
<a id="__codelineno-40-88" name="__codelineno-40-88" href="#__codelineno-40-88"></a><span class="kt">void</span><span class="w"> </span><span class="n">Shader</span><span class="o">::</span><span class="n">SetVec4</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-89" name="__codelineno-40-89" href="#__codelineno-40-89"></a><span class="w">  </span><span class="n">glUniform4fv</span><span class="p">(</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">program_id_</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">()),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<a id="__codelineno-40-90" name="__codelineno-40-90" href="#__codelineno-40-90"></a><span class="p">}</span>
<a id="__codelineno-40-91" name="__codelineno-40-91" href="#__codelineno-40-91"></a>
<a id="__codelineno-40-92" name="__codelineno-40-92" href="#__codelineno-40-92"></a><span class="kt">void</span><span class="w"> </span><span class="n">Shader</span><span class="o">::</span><span class="n">SetMat4</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="kt">float</span><span class="o">*</span><span class="w"> </span><span class="n">value</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-93" name="__codelineno-40-93" href="#__codelineno-40-93"></a><span class="w">  </span><span class="n">glUniformMatrix4fv</span><span class="p">(</span><span class="n">glGetUniformLocation</span><span class="p">(</span><span class="n">program_id_</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">.</span><span class="n">c_str</span><span class="p">()),</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">GL_FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">value</span><span class="p">);</span>
<a id="__codelineno-40-94" name="__codelineno-40-94" href="#__codelineno-40-94"></a><span class="p">}</span>
<a id="__codelineno-40-95" name="__codelineno-40-95" href="#__codelineno-40-95"></a>
<a id="__codelineno-40-96" name="__codelineno-40-96" href="#__codelineno-40-96"></a><span class="kt">bool</span><span class="w"> </span><span class="n">Shader</span><span class="o">::</span><span class="n">CompileShader</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">source</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-97" name="__codelineno-40-97" href="#__codelineno-40-97"></a><span class="w">  </span><span class="n">GLuint</span><span class="w"> </span><span class="n">shader_id</span><span class="p">;</span>
<a id="__codelineno-40-98" name="__codelineno-40-98" href="#__codelineno-40-98"></a><span class="w">  </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">type</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-99" name="__codelineno-40-99" href="#__codelineno-40-99"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">Type</span><span class="o">::</span><span class="no">kVertex</span><span class="p">:</span>
<a id="__codelineno-40-100" name="__codelineno-40-100" href="#__codelineno-40-100"></a><span class="w">      </span><span class="n">shader_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glCreateShader</span><span class="p">(</span><span class="n">GL_VERTEX_SHADER</span><span class="p">);</span>
<a id="__codelineno-40-101" name="__codelineno-40-101" href="#__codelineno-40-101"></a><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-40-102" name="__codelineno-40-102" href="#__codelineno-40-102"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">Type</span><span class="o">::</span><span class="no">kFragment</span><span class="p">:</span>
<a id="__codelineno-40-103" name="__codelineno-40-103" href="#__codelineno-40-103"></a><span class="w">      </span><span class="n">shader_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glCreateShader</span><span class="p">(</span><span class="n">GL_FRAGMENT_SHADER</span><span class="p">);</span>
<a id="__codelineno-40-104" name="__codelineno-40-104" href="#__codelineno-40-104"></a><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-40-105" name="__codelineno-40-105" href="#__codelineno-40-105"></a><span class="w">    </span><span class="k">case</span><span class="w"> </span><span class="no">Type</span><span class="o">::</span><span class="no">kGeometry</span><span class="p">:</span>
<a id="__codelineno-40-106" name="__codelineno-40-106" href="#__codelineno-40-106"></a><span class="w">      </span><span class="n">shader_id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glCreateShader</span><span class="p">(</span><span class="n">GL_GEOMETRY_SHADER</span><span class="p">);</span>
<a id="__codelineno-40-107" name="__codelineno-40-107" href="#__codelineno-40-107"></a><span class="w">      </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-40-108" name="__codelineno-40-108" href="#__codelineno-40-108"></a><span class="w">    </span><span class="k">default</span><span class="o">:</span>
<a id="__codelineno-40-109" name="__codelineno-40-109" href="#__codelineno-40-109"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Unknown shader type&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-40-110" name="__codelineno-40-110" href="#__codelineno-40-110"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-40-111" name="__codelineno-40-111" href="#__codelineno-40-111"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-40-112" name="__codelineno-40-112" href="#__codelineno-40-112"></a>
<a id="__codelineno-40-113" name="__codelineno-40-113" href="#__codelineno-40-113"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">char</span><span class="o">*</span><span class="w"> </span><span class="n">source_cstr</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">source</span><span class="p">.</span><span class="n">c_str</span><span class="p">();</span>
<a id="__codelineno-40-114" name="__codelineno-40-114" href="#__codelineno-40-114"></a><span class="w">  </span><span class="n">glShaderSource</span><span class="p">(</span><span class="n">shader_id</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">source_cstr</span><span class="p">,</span><span class="w"> </span><span class="k">nullptr</span><span class="p">);</span>
<a id="__codelineno-40-115" name="__codelineno-40-115" href="#__codelineno-40-115"></a><span class="w">  </span><span class="n">glCompileShader</span><span class="p">(</span><span class="n">shader_id</span><span class="p">);</span>
<a id="__codelineno-40-116" name="__codelineno-40-116" href="#__codelineno-40-116"></a>
<a id="__codelineno-40-117" name="__codelineno-40-117" href="#__codelineno-40-117"></a><span class="w">  </span><span class="n">GLint</span><span class="w"> </span><span class="n">success</span><span class="p">;</span>
<a id="__codelineno-40-118" name="__codelineno-40-118" href="#__codelineno-40-118"></a><span class="w">  </span><span class="n">glGetShaderiv</span><span class="p">(</span><span class="n">shader_id</span><span class="p">,</span><span class="w"> </span><span class="n">GL_COMPILE_STATUS</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">success</span><span class="p">);</span>
<a id="__codelineno-40-119" name="__codelineno-40-119" href="#__codelineno-40-119"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">success</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-120" name="__codelineno-40-120" href="#__codelineno-40-120"></a><span class="w">    </span><span class="n">GLchar</span><span class="w"> </span><span class="n">info_log</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
<a id="__codelineno-40-121" name="__codelineno-40-121" href="#__codelineno-40-121"></a><span class="w">    </span><span class="n">glGetShaderInfoLog</span><span class="p">(</span><span class="n">shader_id</span><span class="p">,</span><span class="w"> </span><span class="k">sizeof</span><span class="p">(</span><span class="n">info_log</span><span class="p">),</span><span class="w"> </span><span class="k">nullptr</span><span class="p">,</span><span class="w"> </span><span class="n">info_log</span><span class="p">);</span>
<a id="__codelineno-40-122" name="__codelineno-40-122" href="#__codelineno-40-122"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Shader compilation failed: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">info_log</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-40-123" name="__codelineno-40-123" href="#__codelineno-40-123"></a><span class="w">    </span><span class="n">glDeleteShader</span><span class="p">(</span><span class="n">shader_id</span><span class="p">);</span>
<a id="__codelineno-40-124" name="__codelineno-40-124" href="#__codelineno-40-124"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<a id="__codelineno-40-125" name="__codelineno-40-125" href="#__codelineno-40-125"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-40-126" name="__codelineno-40-126" href="#__codelineno-40-126"></a>
<a id="__codelineno-40-127" name="__codelineno-40-127" href="#__codelineno-40-127"></a><span class="w">  </span><span class="n">glAttachShader</span><span class="p">(</span><span class="n">program_id_</span><span class="p">,</span><span class="w"> </span><span class="n">shader_id</span><span class="p">);</span>
<a id="__codelineno-40-128" name="__codelineno-40-128" href="#__codelineno-40-128"></a><span class="w">  </span><span class="n">shader_ids_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">shader_id</span><span class="p">);</span>
<a id="__codelineno-40-129" name="__codelineno-40-129" href="#__codelineno-40-129"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<a id="__codelineno-40-130" name="__codelineno-40-130" href="#__codelineno-40-130"></a><span class="p">}</span>
<a id="__codelineno-40-131" name="__codelineno-40-131" href="#__codelineno-40-131"></a>
<a id="__codelineno-40-132" name="__codelineno-40-132" href="#__codelineno-40-132"></a><span class="kt">void</span><span class="w"> </span><span class="n">Shader</span><span class="o">::</span><span class="n">DeleteShaders</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-133" name="__codelineno-40-133" href="#__codelineno-40-133"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="n">GLuint</span><span class="w"> </span><span class="n">shader_id</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">shader_ids_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-134" name="__codelineno-40-134" href="#__codelineno-40-134"></a><span class="w">    </span><span class="n">glDetachShader</span><span class="p">(</span><span class="n">program_id_</span><span class="p">,</span><span class="w"> </span><span class="n">shader_id</span><span class="p">);</span>
<a id="__codelineno-40-135" name="__codelineno-40-135" href="#__codelineno-40-135"></a><span class="w">    </span><span class="n">glDeleteShader</span><span class="p">(</span><span class="n">shader_id</span><span class="p">);</span>
<a id="__codelineno-40-136" name="__codelineno-40-136" href="#__codelineno-40-136"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-40-137" name="__codelineno-40-137" href="#__codelineno-40-137"></a><span class="w">  </span><span class="n">shader_ids_</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<a id="__codelineno-40-138" name="__codelineno-40-138" href="#__codelineno-40-138"></a><span class="p">}</span>
<a id="__codelineno-40-139" name="__codelineno-40-139" href="#__codelineno-40-139"></a>
<a id="__codelineno-40-140" name="__codelineno-40-140" href="#__codelineno-40-140"></a><span class="n">ShaderManager</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ShaderManager</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-141" name="__codelineno-40-141" href="#__codelineno-40-141"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">ShaderManager</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span>
<a id="__codelineno-40-142" name="__codelineno-40-142" href="#__codelineno-40-142"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span>
<a id="__codelineno-40-143" name="__codelineno-40-143" href="#__codelineno-40-143"></a><span class="p">}</span>
<a id="__codelineno-40-144" name="__codelineno-40-144" href="#__codelineno-40-144"></a>
<a id="__codelineno-40-145" name="__codelineno-40-145" href="#__codelineno-40-145"></a><span class="n">Shader</span><span class="o">*</span><span class="w"> </span><span class="n">ShaderManager</span><span class="o">::</span><span class="n">LoadShader</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">,</span>
<a id="__codelineno-40-146" name="__codelineno-40-146" href="#__codelineno-40-146"></a><span class="w">                                  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">vertex_path</span><span class="p">,</span>
<a id="__codelineno-40-147" name="__codelineno-40-147" href="#__codelineno-40-147"></a><span class="w">                                  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">fragment_path</span><span class="p">,</span>
<a id="__codelineno-40-148" name="__codelineno-40-148" href="#__codelineno-40-148"></a><span class="w">                                  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">geometry_path</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-149" name="__codelineno-40-149" href="#__codelineno-40-149"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">shader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Shader</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-40-150" name="__codelineno-40-150" href="#__codelineno-40-150"></a>
<a id="__codelineno-40-151" name="__codelineno-40-151" href="#__codelineno-40-151"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">shader</span><span class="o">-&gt;</span><span class="n">LoadFromFile</span><span class="p">(</span><span class="n">Shader</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">kVertex</span><span class="p">,</span><span class="w"> </span><span class="n">vertex_path</span><span class="p">)</span><span class="w"> </span><span class="o">||</span>
<a id="__codelineno-40-152" name="__codelineno-40-152" href="#__codelineno-40-152"></a><span class="w">      </span><span class="o">!</span><span class="n">shader</span><span class="o">-&gt;</span><span class="n">LoadFromFile</span><span class="p">(</span><span class="n">Shader</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">kFragment</span><span class="p">,</span><span class="w"> </span><span class="n">fragment_path</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-153" name="__codelineno-40-153" href="#__codelineno-40-153"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-40-154" name="__codelineno-40-154" href="#__codelineno-40-154"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-40-155" name="__codelineno-40-155" href="#__codelineno-40-155"></a>
<a id="__codelineno-40-156" name="__codelineno-40-156" href="#__codelineno-40-156"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">geometry_path</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-157" name="__codelineno-40-157" href="#__codelineno-40-157"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">shader</span><span class="o">-&gt;</span><span class="n">LoadFromFile</span><span class="p">(</span><span class="n">Shader</span><span class="o">::</span><span class="n">Type</span><span class="o">::</span><span class="n">kGeometry</span><span class="p">,</span><span class="w"> </span><span class="n">geometry_path</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-158" name="__codelineno-40-158" href="#__codelineno-40-158"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-40-159" name="__codelineno-40-159" href="#__codelineno-40-159"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-40-160" name="__codelineno-40-160" href="#__codelineno-40-160"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-40-161" name="__codelineno-40-161" href="#__codelineno-40-161"></a>
<a id="__codelineno-40-162" name="__codelineno-40-162" href="#__codelineno-40-162"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">shader</span><span class="o">-&gt;</span><span class="n">Link</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-163" name="__codelineno-40-163" href="#__codelineno-40-163"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-40-164" name="__codelineno-40-164" href="#__codelineno-40-164"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-40-165" name="__codelineno-40-165" href="#__codelineno-40-165"></a>
<a id="__codelineno-40-166" name="__codelineno-40-166" href="#__codelineno-40-166"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="p">[</span><span class="n">it</span><span class="p">,</span><span class="w"> </span><span class="n">success</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shaders_</span><span class="p">.</span><span class="n">emplace</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">shader</span><span class="p">));</span>
<a id="__codelineno-40-167" name="__codelineno-40-167" href="#__codelineno-40-167"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">success</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-40-168" name="__codelineno-40-168" href="#__codelineno-40-168"></a><span class="p">}</span>
<a id="__codelineno-40-169" name="__codelineno-40-169" href="#__codelineno-40-169"></a>
<a id="__codelineno-40-170" name="__codelineno-40-170" href="#__codelineno-40-170"></a><span class="n">Shader</span><span class="o">*</span><span class="w"> </span><span class="n">ShaderManager</span><span class="o">::</span><span class="n">GetShader</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-40-171" name="__codelineno-40-171" href="#__codelineno-40-171"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shaders_</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
<a id="__codelineno-40-172" name="__codelineno-40-172" href="#__codelineno-40-172"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">shaders_</span><span class="p">.</span><span class="n">end</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-40-173" name="__codelineno-40-173" href="#__codelineno-40-173"></a><span class="p">}</span>
<a id="__codelineno-40-174" name="__codelineno-40-174" href="#__codelineno-40-174"></a>
<a id="__codelineno-40-175" name="__codelineno-40-175" href="#__codelineno-40-175"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace graphics</span>
</code></pre></div>
<p>This implementation follows several best practices:</p>
<ol>
<li>Use of namespaces to avoid naming conflicts.</li>
<li>Clear separation of interface (header) and implementation (source) files.</li>
<li>Use of modern C++ features like <code>std::unique_ptr</code> for memory management.</li>
<li>Consistent naming conventions (e.g., method names are CamelCase, member variables end with underscore).</li>
<li>Use of <code>const</code> for methods that don't modify object state.</li>
<li>Explicit constructor and deleted copy constructor/assignment operator to prevent accidental copies.</li>
<li>Use of RAII (Resource Acquisition Is Initialization) for managing OpenGL resources.</li>
<li>Singleton pattern for ShaderManager implemented in a thread-safe manner.</li>
</ol>
<p>To use this Shader system in your application:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-41-1" name="__codelineno-41-1" href="#__codelineno-41-1"></a><span class="c1">// main.cc</span>
<a id="__codelineno-41-2" name="__codelineno-41-2" href="#__codelineno-41-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;shader.h&quot;</span>
<a id="__codelineno-41-3" name="__codelineno-41-3" href="#__codelineno-41-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;GL/glew.h&gt;</span>
<a id="__codelineno-41-4" name="__codelineno-41-4" href="#__codelineno-41-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;GLFW/glfw3.h&gt;</span>
<a id="__codelineno-41-5" name="__codelineno-41-5" href="#__codelineno-41-5"></a>
<a id="__codelineno-41-6" name="__codelineno-41-6" href="#__codelineno-41-6"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-7" name="__codelineno-41-7" href="#__codelineno-41-7"></a><span class="w">  </span><span class="c1">// Initialize GLFW and GLEW here...</span>
<a id="__codelineno-41-8" name="__codelineno-41-8" href="#__codelineno-41-8"></a>
<a id="__codelineno-41-9" name="__codelineno-41-9" href="#__codelineno-41-9"></a><span class="w">  </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">shader_manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">graphics</span><span class="o">::</span><span class="n">ShaderManager</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">();</span>
<a id="__codelineno-41-10" name="__codelineno-41-10" href="#__codelineno-41-10"></a>
<a id="__codelineno-41-11" name="__codelineno-41-11" href="#__codelineno-41-11"></a><span class="w">  </span><span class="n">graphics</span><span class="o">::</span><span class="n">Shader</span><span class="o">*</span><span class="w"> </span><span class="n">basic_shader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shader_manager</span><span class="p">.</span><span class="n">LoadShader</span><span class="p">(</span>
<a id="__codelineno-41-12" name="__codelineno-41-12" href="#__codelineno-41-12"></a><span class="w">      </span><span class="s">&quot;BasicShader&quot;</span><span class="p">,</span>
<a id="__codelineno-41-13" name="__codelineno-41-13" href="#__codelineno-41-13"></a><span class="w">      </span><span class="s">&quot;shaders/basic_vertex.glsl&quot;</span><span class="p">,</span>
<a id="__codelineno-41-14" name="__codelineno-41-14" href="#__codelineno-41-14"></a><span class="w">      </span><span class="s">&quot;shaders/basic_fragment.glsl&quot;</span>
<a id="__codelineno-41-15" name="__codelineno-41-15" href="#__codelineno-41-15"></a><span class="w">  </span><span class="p">);</span>
<a id="__codelineno-41-16" name="__codelineno-41-16" href="#__codelineno-41-16"></a>
<a id="__codelineno-41-17" name="__codelineno-41-17" href="#__codelineno-41-17"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">basic_shader</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-18" name="__codelineno-41-18" href="#__codelineno-41-18"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to load basic shader&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-41-19" name="__codelineno-41-19" href="#__codelineno-41-19"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-41-20" name="__codelineno-41-20" href="#__codelineno-41-20"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-41-21" name="__codelineno-41-21" href="#__codelineno-41-21"></a>
<a id="__codelineno-41-22" name="__codelineno-41-22" href="#__codelineno-41-22"></a><span class="w">  </span><span class="c1">// Main render loop</span>
<a id="__codelineno-41-23" name="__codelineno-41-23" href="#__codelineno-41-23"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">glfwWindowShouldClose</span><span class="p">(</span><span class="n">window</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-41-24" name="__codelineno-41-24" href="#__codelineno-41-24"></a><span class="w">    </span><span class="c1">// Clear the screen</span>
<a id="__codelineno-41-25" name="__codelineno-41-25" href="#__codelineno-41-25"></a><span class="w">    </span><span class="n">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">);</span>
<a id="__codelineno-41-26" name="__codelineno-41-26" href="#__codelineno-41-26"></a>
<a id="__codelineno-41-27" name="__codelineno-41-27" href="#__codelineno-41-27"></a><span class="w">    </span><span class="c1">// Use the shader</span>
<a id="__codelineno-41-28" name="__codelineno-41-28" href="#__codelineno-41-28"></a><span class="w">    </span><span class="n">basic_shader</span><span class="o">-&gt;</span><span class="n">Use</span><span class="p">();</span>
<a id="__codelineno-41-29" name="__codelineno-41-29" href="#__codelineno-41-29"></a>
<a id="__codelineno-41-30" name="__codelineno-41-30" href="#__codelineno-41-30"></a><span class="w">    </span><span class="c1">// Set uniforms</span>
<a id="__codelineno-41-31" name="__codelineno-41-31" href="#__codelineno-41-31"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">time</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">glfwGetTime</span><span class="p">();</span>
<a id="__codelineno-41-32" name="__codelineno-41-32" href="#__codelineno-41-32"></a><span class="w">    </span><span class="n">basic_shader</span><span class="o">-&gt;</span><span class="n">SetFloat</span><span class="p">(</span><span class="s">&quot;uTime&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">time</span><span class="p">);</span>
<a id="__codelineno-41-33" name="__codelineno-41-33" href="#__codelineno-41-33"></a>
<a id="__codelineno-41-34" name="__codelineno-41-34" href="#__codelineno-41-34"></a><span class="w">    </span><span class="c1">// Draw your objects here...</span>
<a id="__codelineno-41-35" name="__codelineno-41-35" href="#__codelineno-41-35"></a>
<a id="__codelineno-41-36" name="__codelineno-41-36" href="#__codelineno-41-36"></a><span class="w">    </span><span class="n">glfwSwapBuffers</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
<a id="__codelineno-41-37" name="__codelineno-41-37" href="#__codelineno-41-37"></a><span class="w">    </span><span class="n">glfwPollEvents</span><span class="p">();</span>
<a id="__codelineno-41-38" name="__codelineno-41-38" href="#__codelineno-41-38"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-41-39" name="__codelineno-41-39" href="#__codelineno-41-39"></a>
<a id="__codelineno-41-40" name="__codelineno-41-40" href="#__codelineno-41-40"></a><span class="w">  </span><span class="c1">// Cleanup and exit</span>
<a id="__codelineno-41-41" name="__codelineno-41-41" href="#__codelineno-41-41"></a><span class="w">  </span><span class="n">glfwTerminate</span><span class="p">();</span>
<a id="__codelineno-41-42" name="__codelineno-41-42" href="#__codelineno-41-42"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-41-43" name="__codelineno-41-43" href="#__codelineno-41-43"></a><span class="p">}</span>
</code></pre></div>
<p>This Shader system provides a robust foundation for managing and using shaders in a C++ OpenGL application. It allows for easy loading, compiling, and usage of shaders, with error checking at each step. The ShaderManager class provides a centralized way to manage multiple shaders in your application.</p>
<h4 id="camera">Camera</h4>
<p>A camera in computer graphics represents the viewer's perspective in a 3D scene. It defines how the 3D world is projected onto a 2D screen. Key aspects of a camera include:</p>
<ol>
<li>Position: Where the camera is in the 3D world.</li>
<li>Direction: Where the camera is looking.</li>
<li>Up vector: Defines the camera's orientation.</li>
<li>Field of View: The extent of the observable world at any given moment.</li>
<li>Aspect Ratio: The ratio of width to height of the viewing frustum.</li>
<li>Near and Far planes: Define the boundaries of the viewing frustum.</li>
</ol>
<p>Let's implement a flexible camera system:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-42-1" name="__codelineno-42-1" href="#__codelineno-42-1"></a><span class="c1">// camera.h</span>
<a id="__codelineno-42-2" name="__codelineno-42-2" href="#__codelineno-42-2"></a><span class="cp">#ifndef GRAPHICS_CAMERA_H_</span>
<a id="__codelineno-42-3" name="__codelineno-42-3" href="#__codelineno-42-3"></a><span class="cp">#define GRAPHICS_CAMERA_H_</span>
<a id="__codelineno-42-4" name="__codelineno-42-4" href="#__codelineno-42-4"></a>
<a id="__codelineno-42-5" name="__codelineno-42-5" href="#__codelineno-42-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;cmath&gt;</span>
<a id="__codelineno-42-6" name="__codelineno-42-6" href="#__codelineno-42-6"></a>
<a id="__codelineno-42-7" name="__codelineno-42-7" href="#__codelineno-42-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;math/matrix4x4.h&quot;</span><span class="c1">  // Assume this is implemented elsewhere</span>
<a id="__codelineno-42-8" name="__codelineno-42-8" href="#__codelineno-42-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;math/vector3.h&quot;</span><span class="c1">    // Assume this is implemented elsewhere</span>
<a id="__codelineno-42-9" name="__codelineno-42-9" href="#__codelineno-42-9"></a>
<a id="__codelineno-42-10" name="__codelineno-42-10" href="#__codelineno-42-10"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">graphics</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-11" name="__codelineno-42-11" href="#__codelineno-42-11"></a>
<a id="__codelineno-42-12" name="__codelineno-42-12" href="#__codelineno-42-12"></a><span class="k">class</span><span class="w"> </span><span class="nc">Camera</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-13" name="__codelineno-42-13" href="#__codelineno-42-13"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-42-14" name="__codelineno-42-14" href="#__codelineno-42-14"></a><span class="w">  </span><span class="n">Camera</span><span class="p">();</span>
<a id="__codelineno-42-15" name="__codelineno-42-15" href="#__codelineno-42-15"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">Camera</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-42-16" name="__codelineno-42-16" href="#__codelineno-42-16"></a>
<a id="__codelineno-42-17" name="__codelineno-42-17" href="#__codelineno-42-17"></a><span class="w">  </span><span class="c1">// Disallow copy and assign</span>
<a id="__codelineno-42-18" name="__codelineno-42-18" href="#__codelineno-42-18"></a><span class="w">  </span><span class="n">Camera</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Camera</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-42-19" name="__codelineno-42-19" href="#__codelineno-42-19"></a><span class="w">  </span><span class="n">Camera</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Camera</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-42-20" name="__codelineno-42-20" href="#__codelineno-42-20"></a>
<a id="__codelineno-42-21" name="__codelineno-42-21" href="#__codelineno-42-21"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetPosition</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">position</span><span class="p">);</span>
<a id="__codelineno-42-22" name="__codelineno-42-22" href="#__codelineno-42-22"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetTarget</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">target</span><span class="p">);</span>
<a id="__codelineno-42-23" name="__codelineno-42-23" href="#__codelineno-42-23"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetUp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">up</span><span class="p">);</span>
<a id="__codelineno-42-24" name="__codelineno-42-24" href="#__codelineno-42-24"></a>
<a id="__codelineno-42-25" name="__codelineno-42-25" href="#__codelineno-42-25"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetFov</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">fov</span><span class="p">);</span>
<a id="__codelineno-42-26" name="__codelineno-42-26" href="#__codelineno-42-26"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetAspectRatio</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">aspect_ratio</span><span class="p">);</span>
<a id="__codelineno-42-27" name="__codelineno-42-27" href="#__codelineno-42-27"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetClipPlanes</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">near</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">far</span><span class="p">);</span>
<a id="__codelineno-42-28" name="__codelineno-42-28" href="#__codelineno-42-28"></a>
<a id="__codelineno-42-29" name="__codelineno-42-29" href="#__codelineno-42-29"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">GetPosition</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">position_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-42-30" name="__codelineno-42-30" href="#__codelineno-42-30"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">GetTarget</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">target_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-42-31" name="__codelineno-42-31" href="#__codelineno-42-31"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">GetUp</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">up_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-42-32" name="__codelineno-42-32" href="#__codelineno-42-32"></a>
<a id="__codelineno-42-33" name="__codelineno-42-33" href="#__codelineno-42-33"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="nf">GetFov</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">fov_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-42-34" name="__codelineno-42-34" href="#__codelineno-42-34"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="nf">GetAspectRatio</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">aspect_ratio_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-42-35" name="__codelineno-42-35" href="#__codelineno-42-35"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="nf">GetNearPlane</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">near_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-42-36" name="__codelineno-42-36" href="#__codelineno-42-36"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="nf">GetFarPlane</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">far_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-42-37" name="__codelineno-42-37" href="#__codelineno-42-37"></a>
<a id="__codelineno-42-38" name="__codelineno-42-38" href="#__codelineno-42-38"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Matrix4x4</span><span class="w"> </span><span class="nf">GetViewMatrix</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-42-39" name="__codelineno-42-39" href="#__codelineno-42-39"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Matrix4x4</span><span class="w"> </span><span class="nf">GetProjectionMatrix</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<a id="__codelineno-42-40" name="__codelineno-42-40" href="#__codelineno-42-40"></a>
<a id="__codelineno-42-41" name="__codelineno-42-41" href="#__codelineno-42-41"></a><span class="w"> </span><span class="k">protected</span><span class="o">:</span>
<a id="__codelineno-42-42" name="__codelineno-42-42" href="#__codelineno-42-42"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="n">position_</span><span class="p">;</span>
<a id="__codelineno-42-43" name="__codelineno-42-43" href="#__codelineno-42-43"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="n">target_</span><span class="p">;</span>
<a id="__codelineno-42-44" name="__codelineno-42-44" href="#__codelineno-42-44"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="n">up_</span><span class="p">;</span>
<a id="__codelineno-42-45" name="__codelineno-42-45" href="#__codelineno-42-45"></a>
<a id="__codelineno-42-46" name="__codelineno-42-46" href="#__codelineno-42-46"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">fov_</span><span class="p">;</span>
<a id="__codelineno-42-47" name="__codelineno-42-47" href="#__codelineno-42-47"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">aspect_ratio_</span><span class="p">;</span>
<a id="__codelineno-42-48" name="__codelineno-42-48" href="#__codelineno-42-48"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">near_</span><span class="p">;</span>
<a id="__codelineno-42-49" name="__codelineno-42-49" href="#__codelineno-42-49"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">far_</span><span class="p">;</span>
<a id="__codelineno-42-50" name="__codelineno-42-50" href="#__codelineno-42-50"></a><span class="p">};</span>
<a id="__codelineno-42-51" name="__codelineno-42-51" href="#__codelineno-42-51"></a>
<a id="__codelineno-42-52" name="__codelineno-42-52" href="#__codelineno-42-52"></a><span class="k">class</span><span class="w"> </span><span class="nc">FPSCamera</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Camera</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-42-53" name="__codelineno-42-53" href="#__codelineno-42-53"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-42-54" name="__codelineno-42-54" href="#__codelineno-42-54"></a><span class="w">  </span><span class="n">FPSCamera</span><span class="p">();</span>
<a id="__codelineno-42-55" name="__codelineno-42-55" href="#__codelineno-42-55"></a>
<a id="__codelineno-42-56" name="__codelineno-42-56" href="#__codelineno-42-56"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">Rotate</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">yaw</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">pitch</span><span class="p">);</span>
<a id="__codelineno-42-57" name="__codelineno-42-57" href="#__codelineno-42-57"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">Move</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">offset</span><span class="p">);</span>
<a id="__codelineno-42-58" name="__codelineno-42-58" href="#__codelineno-42-58"></a>
<a id="__codelineno-42-59" name="__codelineno-42-59" href="#__codelineno-42-59"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Matrix4x4</span><span class="w"> </span><span class="nf">GetViewMatrix</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<a id="__codelineno-42-60" name="__codelineno-42-60" href="#__codelineno-42-60"></a>
<a id="__codelineno-42-61" name="__codelineno-42-61" href="#__codelineno-42-61"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-42-62" name="__codelineno-42-62" href="#__codelineno-42-62"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">yaw_</span><span class="p">;</span>
<a id="__codelineno-42-63" name="__codelineno-42-63" href="#__codelineno-42-63"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">pitch_</span><span class="p">;</span>
<a id="__codelineno-42-64" name="__codelineno-42-64" href="#__codelineno-42-64"></a>
<a id="__codelineno-42-65" name="__codelineno-42-65" href="#__codelineno-42-65"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">UpdateVectors</span><span class="p">();</span>
<a id="__codelineno-42-66" name="__codelineno-42-66" href="#__codelineno-42-66"></a><span class="p">};</span>
<a id="__codelineno-42-67" name="__codelineno-42-67" href="#__codelineno-42-67"></a>
<a id="__codelineno-42-68" name="__codelineno-42-68" href="#__codelineno-42-68"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace graphics</span>
<a id="__codelineno-42-69" name="__codelineno-42-69" href="#__codelineno-42-69"></a>
<a id="__codelineno-42-70" name="__codelineno-42-70" href="#__codelineno-42-70"></a><span class="cp">#endif  </span><span class="c1">// GRAPHICS_CAMERA_H_</span>
</code></pre></div>
<p>Now, let's implement the Camera and FPSCamera classes:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-43-1" name="__codelineno-43-1" href="#__codelineno-43-1"></a><span class="c1">// camera.cc</span>
<a id="__codelineno-43-2" name="__codelineno-43-2" href="#__codelineno-43-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;camera.h&quot;</span>
<a id="__codelineno-43-3" name="__codelineno-43-3" href="#__codelineno-43-3"></a>
<a id="__codelineno-43-4" name="__codelineno-43-4" href="#__codelineno-43-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
<a id="__codelineno-43-5" name="__codelineno-43-5" href="#__codelineno-43-5"></a>
<a id="__codelineno-43-6" name="__codelineno-43-6" href="#__codelineno-43-6"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">graphics</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-7" name="__codelineno-43-7" href="#__codelineno-43-7"></a>
<a id="__codelineno-43-8" name="__codelineno-43-8" href="#__codelineno-43-8"></a><span class="k">namespace</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-9" name="__codelineno-43-9" href="#__codelineno-43-9"></a>
<a id="__codelineno-43-10" name="__codelineno-43-10" href="#__codelineno-43-10"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">kPi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">3.14159265358979323846f</span><span class="p">;</span>
<a id="__codelineno-43-11" name="__codelineno-43-11" href="#__codelineno-43-11"></a><span class="k">constexpr</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">kEpsilon</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">1e-6f</span><span class="p">;</span>
<a id="__codelineno-43-12" name="__codelineno-43-12" href="#__codelineno-43-12"></a>
<a id="__codelineno-43-13" name="__codelineno-43-13" href="#__codelineno-43-13"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace</span>
<a id="__codelineno-43-14" name="__codelineno-43-14" href="#__codelineno-43-14"></a>
<a id="__codelineno-43-15" name="__codelineno-43-15" href="#__codelineno-43-15"></a><span class="n">Camera</span><span class="o">::</span><span class="n">Camera</span><span class="p">()</span>
<a id="__codelineno-43-16" name="__codelineno-43-16" href="#__codelineno-43-16"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">position_</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">),</span>
<a id="__codelineno-43-17" name="__codelineno-43-17" href="#__codelineno-43-17"></a><span class="w">      </span><span class="n">target_</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">),</span>
<a id="__codelineno-43-18" name="__codelineno-43-18" href="#__codelineno-43-18"></a><span class="w">      </span><span class="n">up_</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">),</span>
<a id="__codelineno-43-19" name="__codelineno-43-19" href="#__codelineno-43-19"></a><span class="w">      </span><span class="n">fov_</span><span class="p">(</span><span class="mf">45.0f</span><span class="p">),</span>
<a id="__codelineno-43-20" name="__codelineno-43-20" href="#__codelineno-43-20"></a><span class="w">      </span><span class="n">aspect_ratio_</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-43-21" name="__codelineno-43-21" href="#__codelineno-43-21"></a><span class="w">      </span><span class="n">near_</span><span class="p">(</span><span class="mf">0.1f</span><span class="p">),</span>
<a id="__codelineno-43-22" name="__codelineno-43-22" href="#__codelineno-43-22"></a><span class="w">      </span><span class="n">far_</span><span class="p">(</span><span class="mf">100.0f</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-43-23" name="__codelineno-43-23" href="#__codelineno-43-23"></a>
<a id="__codelineno-43-24" name="__codelineno-43-24" href="#__codelineno-43-24"></a><span class="kt">void</span><span class="w"> </span><span class="n">Camera</span><span class="o">::</span><span class="n">SetPosition</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-25" name="__codelineno-43-25" href="#__codelineno-43-25"></a><span class="w">  </span><span class="n">position_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-43-26" name="__codelineno-43-26" href="#__codelineno-43-26"></a><span class="p">}</span>
<a id="__codelineno-43-27" name="__codelineno-43-27" href="#__codelineno-43-27"></a>
<a id="__codelineno-43-28" name="__codelineno-43-28" href="#__codelineno-43-28"></a><span class="kt">void</span><span class="w"> </span><span class="n">Camera</span><span class="o">::</span><span class="n">SetTarget</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-29" name="__codelineno-43-29" href="#__codelineno-43-29"></a><span class="w">  </span><span class="n">target_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">target</span><span class="p">;</span>
<a id="__codelineno-43-30" name="__codelineno-43-30" href="#__codelineno-43-30"></a><span class="p">}</span>
<a id="__codelineno-43-31" name="__codelineno-43-31" href="#__codelineno-43-31"></a>
<a id="__codelineno-43-32" name="__codelineno-43-32" href="#__codelineno-43-32"></a><span class="kt">void</span><span class="w"> </span><span class="n">Camera</span><span class="o">::</span><span class="n">SetUp</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">up</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-33" name="__codelineno-43-33" href="#__codelineno-43-33"></a><span class="w">  </span><span class="n">up_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">up</span><span class="p">.</span><span class="n">Normalized</span><span class="p">();</span>
<a id="__codelineno-43-34" name="__codelineno-43-34" href="#__codelineno-43-34"></a><span class="p">}</span>
<a id="__codelineno-43-35" name="__codelineno-43-35" href="#__codelineno-43-35"></a>
<a id="__codelineno-43-36" name="__codelineno-43-36" href="#__codelineno-43-36"></a><span class="kt">void</span><span class="w"> </span><span class="n">Camera</span><span class="o">::</span><span class="n">SetFov</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">fov</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-37" name="__codelineno-43-37" href="#__codelineno-43-37"></a><span class="w">  </span><span class="n">fov_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">clamp</span><span class="p">(</span><span class="n">fov</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">179.0f</span><span class="p">);</span>
<a id="__codelineno-43-38" name="__codelineno-43-38" href="#__codelineno-43-38"></a><span class="p">}</span>
<a id="__codelineno-43-39" name="__codelineno-43-39" href="#__codelineno-43-39"></a>
<a id="__codelineno-43-40" name="__codelineno-43-40" href="#__codelineno-43-40"></a><span class="kt">void</span><span class="w"> </span><span class="n">Camera</span><span class="o">::</span><span class="n">SetAspectRatio</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">aspect_ratio</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-41" name="__codelineno-43-41" href="#__codelineno-43-41"></a><span class="w">  </span><span class="n">aspect_ratio_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="n">aspect_ratio</span><span class="p">,</span><span class="w"> </span><span class="n">kEpsilon</span><span class="p">);</span>
<a id="__codelineno-43-42" name="__codelineno-43-42" href="#__codelineno-43-42"></a><span class="p">}</span>
<a id="__codelineno-43-43" name="__codelineno-43-43" href="#__codelineno-43-43"></a>
<a id="__codelineno-43-44" name="__codelineno-43-44" href="#__codelineno-43-44"></a><span class="kt">void</span><span class="w"> </span><span class="n">Camera</span><span class="o">::</span><span class="n">SetClipPlanes</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">near</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">far</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-45" name="__codelineno-43-45" href="#__codelineno-43-45"></a><span class="w">  </span><span class="n">near_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">near</span><span class="p">;</span>
<a id="__codelineno-43-46" name="__codelineno-43-46" href="#__codelineno-43-46"></a><span class="w">  </span><span class="n">far_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">far</span><span class="p">;</span>
<a id="__codelineno-43-47" name="__codelineno-43-47" href="#__codelineno-43-47"></a><span class="p">}</span>
<a id="__codelineno-43-48" name="__codelineno-43-48" href="#__codelineno-43-48"></a>
<a id="__codelineno-43-49" name="__codelineno-43-49" href="#__codelineno-43-49"></a><span class="n">math</span><span class="o">::</span><span class="n">Matrix4x4</span><span class="w"> </span><span class="n">Camera</span><span class="o">::</span><span class="n">GetViewMatrix</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-50" name="__codelineno-43-50" href="#__codelineno-43-50"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Matrix4x4</span><span class="o">::</span><span class="n">LookAt</span><span class="p">(</span><span class="n">position_</span><span class="p">,</span><span class="w"> </span><span class="n">target_</span><span class="p">,</span><span class="w"> </span><span class="n">up_</span><span class="p">);</span>
<a id="__codelineno-43-51" name="__codelineno-43-51" href="#__codelineno-43-51"></a><span class="p">}</span>
<a id="__codelineno-43-52" name="__codelineno-43-52" href="#__codelineno-43-52"></a>
<a id="__codelineno-43-53" name="__codelineno-43-53" href="#__codelineno-43-53"></a><span class="n">math</span><span class="o">::</span><span class="n">Matrix4x4</span><span class="w"> </span><span class="n">Camera</span><span class="o">::</span><span class="n">GetProjectionMatrix</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-54" name="__codelineno-43-54" href="#__codelineno-43-54"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Matrix4x4</span><span class="o">::</span><span class="n">Perspective</span><span class="p">(</span><span class="n">fov_</span><span class="p">,</span><span class="w"> </span><span class="n">aspect_ratio_</span><span class="p">,</span><span class="w"> </span><span class="n">near_</span><span class="p">,</span><span class="w"> </span><span class="n">far_</span><span class="p">);</span>
<a id="__codelineno-43-55" name="__codelineno-43-55" href="#__codelineno-43-55"></a><span class="p">}</span>
<a id="__codelineno-43-56" name="__codelineno-43-56" href="#__codelineno-43-56"></a>
<a id="__codelineno-43-57" name="__codelineno-43-57" href="#__codelineno-43-57"></a><span class="n">FPSCamera</span><span class="o">::</span><span class="n">FPSCamera</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">Camera</span><span class="p">(),</span><span class="w"> </span><span class="n">yaw_</span><span class="p">(</span><span class="mf">-90.0f</span><span class="p">),</span><span class="w"> </span><span class="n">pitch_</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-58" name="__codelineno-43-58" href="#__codelineno-43-58"></a><span class="w">  </span><span class="n">UpdateVectors</span><span class="p">();</span>
<a id="__codelineno-43-59" name="__codelineno-43-59" href="#__codelineno-43-59"></a><span class="p">}</span>
<a id="__codelineno-43-60" name="__codelineno-43-60" href="#__codelineno-43-60"></a>
<a id="__codelineno-43-61" name="__codelineno-43-61" href="#__codelineno-43-61"></a><span class="kt">void</span><span class="w"> </span><span class="n">FPSCamera</span><span class="o">::</span><span class="n">Rotate</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">yaw</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">pitch</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-62" name="__codelineno-43-62" href="#__codelineno-43-62"></a><span class="w">  </span><span class="n">yaw_</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">yaw</span><span class="p">;</span>
<a id="__codelineno-43-63" name="__codelineno-43-63" href="#__codelineno-43-63"></a><span class="w">  </span><span class="n">pitch_</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">pitch</span><span class="p">;</span>
<a id="__codelineno-43-64" name="__codelineno-43-64" href="#__codelineno-43-64"></a>
<a id="__codelineno-43-65" name="__codelineno-43-65" href="#__codelineno-43-65"></a><span class="w">  </span><span class="c1">// Constrain the pitch</span>
<a id="__codelineno-43-66" name="__codelineno-43-66" href="#__codelineno-43-66"></a><span class="w">  </span><span class="n">pitch_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">clamp</span><span class="p">(</span><span class="n">pitch_</span><span class="p">,</span><span class="w"> </span><span class="mf">-89.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">89.0f</span><span class="p">);</span>
<a id="__codelineno-43-67" name="__codelineno-43-67" href="#__codelineno-43-67"></a>
<a id="__codelineno-43-68" name="__codelineno-43-68" href="#__codelineno-43-68"></a><span class="w">  </span><span class="n">UpdateVectors</span><span class="p">();</span>
<a id="__codelineno-43-69" name="__codelineno-43-69" href="#__codelineno-43-69"></a><span class="p">}</span>
<a id="__codelineno-43-70" name="__codelineno-43-70" href="#__codelineno-43-70"></a>
<a id="__codelineno-43-71" name="__codelineno-43-71" href="#__codelineno-43-71"></a><span class="kt">void</span><span class="w"> </span><span class="n">FPSCamera</span><span class="o">::</span><span class="n">Move</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">offset</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-72" name="__codelineno-43-72" href="#__codelineno-43-72"></a><span class="w">  </span><span class="n">position_</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">offset</span><span class="p">;</span>
<a id="__codelineno-43-73" name="__codelineno-43-73" href="#__codelineno-43-73"></a><span class="w">  </span><span class="n">UpdateVectors</span><span class="p">();</span>
<a id="__codelineno-43-74" name="__codelineno-43-74" href="#__codelineno-43-74"></a><span class="p">}</span>
<a id="__codelineno-43-75" name="__codelineno-43-75" href="#__codelineno-43-75"></a>
<a id="__codelineno-43-76" name="__codelineno-43-76" href="#__codelineno-43-76"></a><span class="n">math</span><span class="o">::</span><span class="n">Matrix4x4</span><span class="w"> </span><span class="n">FPSCamera</span><span class="o">::</span><span class="n">GetViewMatrix</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-77" name="__codelineno-43-77" href="#__codelineno-43-77"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Matrix4x4</span><span class="o">::</span><span class="n">LookAt</span><span class="p">(</span><span class="n">position_</span><span class="p">,</span><span class="w"> </span><span class="n">position_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">target_</span><span class="p">,</span><span class="w"> </span><span class="n">up_</span><span class="p">);</span>
<a id="__codelineno-43-78" name="__codelineno-43-78" href="#__codelineno-43-78"></a><span class="p">}</span>
<a id="__codelineno-43-79" name="__codelineno-43-79" href="#__codelineno-43-79"></a>
<a id="__codelineno-43-80" name="__codelineno-43-80" href="#__codelineno-43-80"></a><span class="kt">void</span><span class="w"> </span><span class="n">FPSCamera</span><span class="o">::</span><span class="n">UpdateVectors</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-43-81" name="__codelineno-43-81" href="#__codelineno-43-81"></a><span class="w">  </span><span class="c1">// Calculate the new target vector</span>
<a id="__codelineno-43-82" name="__codelineno-43-82" href="#__codelineno-43-82"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">yaw_rad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">yaw_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">kPi</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">180.0f</span><span class="p">;</span>
<a id="__codelineno-43-83" name="__codelineno-43-83" href="#__codelineno-43-83"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">pitch_rad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">pitch_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">kPi</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">180.0f</span><span class="p">;</span>
<a id="__codelineno-43-84" name="__codelineno-43-84" href="#__codelineno-43-84"></a>
<a id="__codelineno-43-85" name="__codelineno-43-85" href="#__codelineno-43-85"></a><span class="w">  </span><span class="n">target_</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cos</span><span class="p">(</span><span class="n">yaw_rad</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cos</span><span class="p">(</span><span class="n">pitch_rad</span><span class="p">);</span>
<a id="__codelineno-43-86" name="__codelineno-43-86" href="#__codelineno-43-86"></a><span class="w">  </span><span class="n">target_</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="n">pitch_rad</span><span class="p">);</span>
<a id="__codelineno-43-87" name="__codelineno-43-87" href="#__codelineno-43-87"></a><span class="w">  </span><span class="n">target_</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">sin</span><span class="p">(</span><span class="n">yaw_rad</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">cos</span><span class="p">(</span><span class="n">pitch_rad</span><span class="p">);</span>
<a id="__codelineno-43-88" name="__codelineno-43-88" href="#__codelineno-43-88"></a><span class="w">  </span><span class="n">target_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">target_</span><span class="p">.</span><span class="n">Normalized</span><span class="p">();</span>
<a id="__codelineno-43-89" name="__codelineno-43-89" href="#__codelineno-43-89"></a>
<a id="__codelineno-43-90" name="__codelineno-43-90" href="#__codelineno-43-90"></a><span class="w">  </span><span class="c1">// Re-calculate the Right and Up vector</span>
<a id="__codelineno-43-91" name="__codelineno-43-91" href="#__codelineno-43-91"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">target_</span><span class="p">.</span><span class="n">Cross</span><span class="p">(</span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">)).</span><span class="n">Normalized</span><span class="p">();</span>
<a id="__codelineno-43-92" name="__codelineno-43-92" href="#__codelineno-43-92"></a><span class="w">  </span><span class="n">up_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">right</span><span class="p">.</span><span class="n">Cross</span><span class="p">(</span><span class="n">target_</span><span class="p">).</span><span class="n">Normalized</span><span class="p">();</span>
<a id="__codelineno-43-93" name="__codelineno-43-93" href="#__codelineno-43-93"></a><span class="p">}</span>
<a id="__codelineno-43-94" name="__codelineno-43-94" href="#__codelineno-43-94"></a>
<a id="__codelineno-43-95" name="__codelineno-43-95" href="#__codelineno-43-95"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace graphics</span>
</code></pre></div>
<p>This implementation follows several best practices:</p>
<ol>
<li>Use of namespaces to avoid naming conflicts.</li>
<li>Clear separation of interface (header) and implementation (source) files.</li>
<li>Consistent naming conventions (e.g., method names are CamelCase, member variables end with underscore).</li>
<li>Use of <code>const</code> for methods that don't modify object state.</li>
<li>Virtual destructor in the base class to ensure proper cleanup of derived classes.</li>
<li>Use of <code>override</code> keyword for virtual function overrides.</li>
<li>Explicit constructor and deleted copy constructor/assignment operator to prevent accidental copies.</li>
<li>Use of <code>constexpr</code> for compile-time constants.</li>
<li>Use of <code>std::clamp</code> and <code>std::max</code> for value constraints.</li>
</ol>
<p>To use this Camera system in your application:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-44-1" name="__codelineno-44-1" href="#__codelineno-44-1"></a><span class="c1">// main.cc</span>
<a id="__codelineno-44-2" name="__codelineno-44-2" href="#__codelineno-44-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;camera.h&quot;</span>
<a id="__codelineno-44-3" name="__codelineno-44-3" href="#__codelineno-44-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;shader.h&quot;</span>
<a id="__codelineno-44-4" name="__codelineno-44-4" href="#__codelineno-44-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;GL/glew.h&gt;</span>
<a id="__codelineno-44-5" name="__codelineno-44-5" href="#__codelineno-44-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;GLFW/glfw3.h&gt;</span>
<a id="__codelineno-44-6" name="__codelineno-44-6" href="#__codelineno-44-6"></a>
<a id="__codelineno-44-7" name="__codelineno-44-7" href="#__codelineno-44-7"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-8" name="__codelineno-44-8" href="#__codelineno-44-8"></a><span class="w">  </span><span class="c1">// Initialize GLFW and GLEW here...</span>
<a id="__codelineno-44-9" name="__codelineno-44-9" href="#__codelineno-44-9"></a>
<a id="__codelineno-44-10" name="__codelineno-44-10" href="#__codelineno-44-10"></a><span class="w">  </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">shader_manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">graphics</span><span class="o">::</span><span class="n">ShaderManager</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">();</span>
<a id="__codelineno-44-11" name="__codelineno-44-11" href="#__codelineno-44-11"></a>
<a id="__codelineno-44-12" name="__codelineno-44-12" href="#__codelineno-44-12"></a><span class="w">  </span><span class="n">graphics</span><span class="o">::</span><span class="n">Shader</span><span class="o">*</span><span class="w"> </span><span class="n">basic_shader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shader_manager</span><span class="p">.</span><span class="n">LoadShader</span><span class="p">(</span>
<a id="__codelineno-44-13" name="__codelineno-44-13" href="#__codelineno-44-13"></a><span class="w">      </span><span class="s">&quot;BasicShader&quot;</span><span class="p">,</span>
<a id="__codelineno-44-14" name="__codelineno-44-14" href="#__codelineno-44-14"></a><span class="w">      </span><span class="s">&quot;shaders/basic_vertex.glsl&quot;</span><span class="p">,</span>
<a id="__codelineno-44-15" name="__codelineno-44-15" href="#__codelineno-44-15"></a><span class="w">      </span><span class="s">&quot;shaders/basic_fragment.glsl&quot;</span>
<a id="__codelineno-44-16" name="__codelineno-44-16" href="#__codelineno-44-16"></a><span class="w">  </span><span class="p">);</span>
<a id="__codelineno-44-17" name="__codelineno-44-17" href="#__codelineno-44-17"></a>
<a id="__codelineno-44-18" name="__codelineno-44-18" href="#__codelineno-44-18"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">basic_shader</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-19" name="__codelineno-44-19" href="#__codelineno-44-19"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to load basic shader&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-44-20" name="__codelineno-44-20" href="#__codelineno-44-20"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-44-21" name="__codelineno-44-21" href="#__codelineno-44-21"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-44-22" name="__codelineno-44-22" href="#__codelineno-44-22"></a>
<a id="__codelineno-44-23" name="__codelineno-44-23" href="#__codelineno-44-23"></a><span class="w">  </span><span class="n">graphics</span><span class="o">::</span><span class="n">FPSCamera</span><span class="w"> </span><span class="n">camera</span><span class="p">;</span>
<a id="__codelineno-44-24" name="__codelineno-44-24" href="#__codelineno-44-24"></a><span class="w">  </span><span class="n">camera</span><span class="p">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0f</span><span class="p">));</span>
<a id="__codelineno-44-25" name="__codelineno-44-25" href="#__codelineno-44-25"></a><span class="w">  </span><span class="n">camera</span><span class="p">.</span><span class="n">SetAspectRatio</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">window_width</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">window_height</span><span class="p">);</span>
<a id="__codelineno-44-26" name="__codelineno-44-26" href="#__codelineno-44-26"></a>
<a id="__codelineno-44-27" name="__codelineno-44-27" href="#__codelineno-44-27"></a><span class="w">  </span><span class="c1">// Main render loop</span>
<a id="__codelineno-44-28" name="__codelineno-44-28" href="#__codelineno-44-28"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">glfwWindowShouldClose</span><span class="p">(</span><span class="n">window</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-44-29" name="__codelineno-44-29" href="#__codelineno-44-29"></a><span class="w">    </span><span class="c1">// Clear the screen</span>
<a id="__codelineno-44-30" name="__codelineno-44-30" href="#__codelineno-44-30"></a><span class="w">    </span><span class="n">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">);</span>
<a id="__codelineno-44-31" name="__codelineno-44-31" href="#__codelineno-44-31"></a>
<a id="__codelineno-44-32" name="__codelineno-44-32" href="#__codelineno-44-32"></a><span class="w">    </span><span class="c1">// Use the shader</span>
<a id="__codelineno-44-33" name="__codelineno-44-33" href="#__codelineno-44-33"></a><span class="w">    </span><span class="n">basic_shader</span><span class="o">-&gt;</span><span class="n">Use</span><span class="p">();</span>
<a id="__codelineno-44-34" name="__codelineno-44-34" href="#__codelineno-44-34"></a>
<a id="__codelineno-44-35" name="__codelineno-44-35" href="#__codelineno-44-35"></a><span class="w">    </span><span class="c1">// Update camera (e.g., based on user input)</span>
<a id="__codelineno-44-36" name="__codelineno-44-36" href="#__codelineno-44-36"></a><span class="w">    </span><span class="c1">// camera.Rotate(delta_yaw, delta_pitch);</span>
<a id="__codelineno-44-37" name="__codelineno-44-37" href="#__codelineno-44-37"></a><span class="w">    </span><span class="c1">// camera.Move(movement_offset);</span>
<a id="__codelineno-44-38" name="__codelineno-44-38" href="#__codelineno-44-38"></a>
<a id="__codelineno-44-39" name="__codelineno-44-39" href="#__codelineno-44-39"></a><span class="w">    </span><span class="c1">// Set camera uniforms</span>
<a id="__codelineno-44-40" name="__codelineno-44-40" href="#__codelineno-44-40"></a><span class="w">    </span><span class="n">math</span><span class="o">::</span><span class="n">Matrix4x4</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">GetViewMatrix</span><span class="p">();</span>
<a id="__codelineno-44-41" name="__codelineno-44-41" href="#__codelineno-44-41"></a><span class="w">    </span><span class="n">math</span><span class="o">::</span><span class="n">Matrix4x4</span><span class="w"> </span><span class="n">projection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">GetProjectionMatrix</span><span class="p">();</span>
<a id="__codelineno-44-42" name="__codelineno-44-42" href="#__codelineno-44-42"></a><span class="w">    </span><span class="n">basic_shader</span><span class="o">-&gt;</span><span class="n">SetMat4</span><span class="p">(</span><span class="s">&quot;uView&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">.</span><span class="n">GetData</span><span class="p">());</span>
<a id="__codelineno-44-43" name="__codelineno-44-43" href="#__codelineno-44-43"></a><span class="w">    </span><span class="n">basic_shader</span><span class="o">-&gt;</span><span class="n">SetMat4</span><span class="p">(</span><span class="s">&quot;uProjection&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">projection</span><span class="p">.</span><span class="n">GetData</span><span class="p">());</span>
<a id="__codelineno-44-44" name="__codelineno-44-44" href="#__codelineno-44-44"></a>
<a id="__codelineno-44-45" name="__codelineno-44-45" href="#__codelineno-44-45"></a><span class="w">    </span><span class="c1">// Draw your objects here...</span>
<a id="__codelineno-44-46" name="__codelineno-44-46" href="#__codelineno-44-46"></a>
<a id="__codelineno-44-47" name="__codelineno-44-47" href="#__codelineno-44-47"></a><span class="w">    </span><span class="n">glfwSwapBuffers</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
<a id="__codelineno-44-48" name="__codelineno-44-48" href="#__codelineno-44-48"></a><span class="w">    </span><span class="n">glfwPollEvents</span><span class="p">();</span>
<a id="__codelineno-44-49" name="__codelineno-44-49" href="#__codelineno-44-49"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-44-50" name="__codelineno-44-50" href="#__codelineno-44-50"></a>
<a id="__codelineno-44-51" name="__codelineno-44-51" href="#__codelineno-44-51"></a><span class="w">  </span><span class="c1">// Cleanup and exit</span>
<a id="__codelineno-44-52" name="__codelineno-44-52" href="#__codelineno-44-52"></a><span class="w">  </span><span class="n">glfwTerminate</span><span class="p">();</span>
<a id="__codelineno-44-53" name="__codelineno-44-53" href="#__codelineno-44-53"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-44-54" name="__codelineno-44-54" href="#__codelineno-44-54"></a><span class="p">}</span>
</code></pre></div>
<p>This Camera system provides a flexible foundation for managing camera movement and perspective in a 3D graphics application. The base <code>Camera</code> class can be used for a static camera, while the <code>FPSCamera</code> class extends it to provide first-person style camera controls. </p>
<p>The system is designed to be easily extendable, so you could create other camera types (e.g., <code>OrbitCamera</code>, <code>ThirdPersonCamera</code>) by inheriting from the <code>Camera</code> base class and implementing the necessary behavior.</p>
<h4 id="light">Light</h4>
<p>Lighting is a crucial aspect of 3D rendering that adds depth and realism to a scene. There are several types of lights commonly used in computer graphics:</p>
<ol>
<li>Directional Light: Simulates light coming from a distant source, like the sun.</li>
<li>Point Light: Emits light in all directions from a single point.</li>
<li>Spot Light: Emits a cone of light from a point in a specific direction.</li>
<li>Ambient Light: Represents the overall background illumination of a scene.</li>
</ol>
<p>Let's implement a flexible light system that supports these types:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-45-1" name="__codelineno-45-1" href="#__codelineno-45-1"></a><span class="c1">// light.h</span>
<a id="__codelineno-45-2" name="__codelineno-45-2" href="#__codelineno-45-2"></a><span class="cp">#ifndef GRAPHICS_LIGHT_H_</span>
<a id="__codelineno-45-3" name="__codelineno-45-3" href="#__codelineno-45-3"></a><span class="cp">#define GRAPHICS_LIGHT_H_</span>
<a id="__codelineno-45-4" name="__codelineno-45-4" href="#__codelineno-45-4"></a>
<a id="__codelineno-45-5" name="__codelineno-45-5" href="#__codelineno-45-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-45-6" name="__codelineno-45-6" href="#__codelineno-45-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-45-7" name="__codelineno-45-7" href="#__codelineno-45-7"></a>
<a id="__codelineno-45-8" name="__codelineno-45-8" href="#__codelineno-45-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;math/vector3.h&quot;</span><span class="c1">  // Assume this is implemented elsewhere</span>
<a id="__codelineno-45-9" name="__codelineno-45-9" href="#__codelineno-45-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;math/vector4.h&quot;</span><span class="c1">  // Assume this is implemented elsewhere</span>
<a id="__codelineno-45-10" name="__codelineno-45-10" href="#__codelineno-45-10"></a>
<a id="__codelineno-45-11" name="__codelineno-45-11" href="#__codelineno-45-11"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">graphics</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-12" name="__codelineno-45-12" href="#__codelineno-45-12"></a>
<a id="__codelineno-45-13" name="__codelineno-45-13" href="#__codelineno-45-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">Light</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-14" name="__codelineno-45-14" href="#__codelineno-45-14"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-45-15" name="__codelineno-45-15" href="#__codelineno-45-15"></a><span class="w">  </span><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Type</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-16" name="__codelineno-45-16" href="#__codelineno-45-16"></a><span class="w">    </span><span class="n">kDirectional</span><span class="p">,</span>
<a id="__codelineno-45-17" name="__codelineno-45-17" href="#__codelineno-45-17"></a><span class="w">    </span><span class="n">kPoint</span><span class="p">,</span>
<a id="__codelineno-45-18" name="__codelineno-45-18" href="#__codelineno-45-18"></a><span class="w">    </span><span class="n">kSpot</span><span class="p">,</span>
<a id="__codelineno-45-19" name="__codelineno-45-19" href="#__codelineno-45-19"></a><span class="w">    </span><span class="n">kAmbient</span>
<a id="__codelineno-45-20" name="__codelineno-45-20" href="#__codelineno-45-20"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-45-21" name="__codelineno-45-21" href="#__codelineno-45-21"></a>
<a id="__codelineno-45-22" name="__codelineno-45-22" href="#__codelineno-45-22"></a><span class="w">  </span><span class="n">Light</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">);</span>
<a id="__codelineno-45-23" name="__codelineno-45-23" href="#__codelineno-45-23"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">Light</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-45-24" name="__codelineno-45-24" href="#__codelineno-45-24"></a>
<a id="__codelineno-45-25" name="__codelineno-45-25" href="#__codelineno-45-25"></a><span class="w">  </span><span class="c1">// Disallow copy and assign</span>
<a id="__codelineno-45-26" name="__codelineno-45-26" href="#__codelineno-45-26"></a><span class="w">  </span><span class="n">Light</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Light</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-45-27" name="__codelineno-45-27" href="#__codelineno-45-27"></a><span class="w">  </span><span class="n">Light</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Light</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-45-28" name="__codelineno-45-28" href="#__codelineno-45-28"></a>
<a id="__codelineno-45-29" name="__codelineno-45-29" href="#__codelineno-45-29"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetColor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">color</span><span class="p">);</span>
<a id="__codelineno-45-30" name="__codelineno-45-30" href="#__codelineno-45-30"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetIntensity</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">intensity</span><span class="p">);</span>
<a id="__codelineno-45-31" name="__codelineno-45-31" href="#__codelineno-45-31"></a>
<a id="__codelineno-45-32" name="__codelineno-45-32" href="#__codelineno-45-32"></a><span class="w">  </span><span class="n">Type</span><span class="w"> </span><span class="nf">GetType</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">type_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-45-33" name="__codelineno-45-33" href="#__codelineno-45-33"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">GetColor</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">color_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-45-34" name="__codelineno-45-34" href="#__codelineno-45-34"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="nf">GetIntensity</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">intensity_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-45-35" name="__codelineno-45-35" href="#__codelineno-45-35"></a>
<a id="__codelineno-45-36" name="__codelineno-45-36" href="#__codelineno-45-36"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetPosition</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-45-37" name="__codelineno-45-37" href="#__codelineno-45-37"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetDirection</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">direction</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-45-38" name="__codelineno-45-38" href="#__codelineno-45-38"></a>
<a id="__codelineno-45-39" name="__codelineno-45-39" href="#__codelineno-45-39"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="nf">GetPosition</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-45-40" name="__codelineno-45-40" href="#__codelineno-45-40"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="nf">GetDirection</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="p">();</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-45-41" name="__codelineno-45-41" href="#__codelineno-45-41"></a>
<a id="__codelineno-45-42" name="__codelineno-45-42" href="#__codelineno-45-42"></a><span class="w"> </span><span class="k">protected</span><span class="o">:</span>
<a id="__codelineno-45-43" name="__codelineno-45-43" href="#__codelineno-45-43"></a><span class="w">  </span><span class="n">Type</span><span class="w"> </span><span class="n">type_</span><span class="p">;</span>
<a id="__codelineno-45-44" name="__codelineno-45-44" href="#__codelineno-45-44"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="n">color_</span><span class="p">;</span>
<a id="__codelineno-45-45" name="__codelineno-45-45" href="#__codelineno-45-45"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">intensity_</span><span class="p">;</span>
<a id="__codelineno-45-46" name="__codelineno-45-46" href="#__codelineno-45-46"></a><span class="p">};</span>
<a id="__codelineno-45-47" name="__codelineno-45-47" href="#__codelineno-45-47"></a>
<a id="__codelineno-45-48" name="__codelineno-45-48" href="#__codelineno-45-48"></a><span class="k">class</span><span class="w"> </span><span class="nc">DirectionalLight</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Light</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-49" name="__codelineno-45-49" href="#__codelineno-45-49"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-45-50" name="__codelineno-45-50" href="#__codelineno-45-50"></a><span class="w">  </span><span class="n">DirectionalLight</span><span class="p">();</span>
<a id="__codelineno-45-51" name="__codelineno-45-51" href="#__codelineno-45-51"></a>
<a id="__codelineno-45-52" name="__codelineno-45-52" href="#__codelineno-45-52"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetDirection</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">direction</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<a id="__codelineno-45-53" name="__codelineno-45-53" href="#__codelineno-45-53"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="nf">GetDirection</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">direction_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-45-54" name="__codelineno-45-54" href="#__codelineno-45-54"></a>
<a id="__codelineno-45-55" name="__codelineno-45-55" href="#__codelineno-45-55"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-45-56" name="__codelineno-45-56" href="#__codelineno-45-56"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="n">direction_</span><span class="p">;</span>
<a id="__codelineno-45-57" name="__codelineno-45-57" href="#__codelineno-45-57"></a><span class="p">};</span>
<a id="__codelineno-45-58" name="__codelineno-45-58" href="#__codelineno-45-58"></a>
<a id="__codelineno-45-59" name="__codelineno-45-59" href="#__codelineno-45-59"></a><span class="k">class</span><span class="w"> </span><span class="nc">PointLight</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Light</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-60" name="__codelineno-45-60" href="#__codelineno-45-60"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-45-61" name="__codelineno-45-61" href="#__codelineno-45-61"></a><span class="w">  </span><span class="n">PointLight</span><span class="p">();</span>
<a id="__codelineno-45-62" name="__codelineno-45-62" href="#__codelineno-45-62"></a>
<a id="__codelineno-45-63" name="__codelineno-45-63" href="#__codelineno-45-63"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetPosition</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<a id="__codelineno-45-64" name="__codelineno-45-64" href="#__codelineno-45-64"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="nf">GetPosition</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">position_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-45-65" name="__codelineno-45-65" href="#__codelineno-45-65"></a>
<a id="__codelineno-45-66" name="__codelineno-45-66" href="#__codelineno-45-66"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetAttenuation</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">constant</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">linear</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">quadratic</span><span class="p">);</span>
<a id="__codelineno-45-67" name="__codelineno-45-67" href="#__codelineno-45-67"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="nf">GetAttenuation</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">attenuation_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-45-68" name="__codelineno-45-68" href="#__codelineno-45-68"></a>
<a id="__codelineno-45-69" name="__codelineno-45-69" href="#__codelineno-45-69"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-45-70" name="__codelineno-45-70" href="#__codelineno-45-70"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="n">position_</span><span class="p">;</span>
<a id="__codelineno-45-71" name="__codelineno-45-71" href="#__codelineno-45-71"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="n">attenuation_</span><span class="p">;</span><span class="w">  </span><span class="c1">// (constant, linear, quadratic)</span>
<a id="__codelineno-45-72" name="__codelineno-45-72" href="#__codelineno-45-72"></a><span class="p">};</span>
<a id="__codelineno-45-73" name="__codelineno-45-73" href="#__codelineno-45-73"></a>
<a id="__codelineno-45-74" name="__codelineno-45-74" href="#__codelineno-45-74"></a><span class="k">class</span><span class="w"> </span><span class="nc">SpotLight</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Light</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-75" name="__codelineno-45-75" href="#__codelineno-45-75"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-45-76" name="__codelineno-45-76" href="#__codelineno-45-76"></a><span class="w">  </span><span class="n">SpotLight</span><span class="p">();</span>
<a id="__codelineno-45-77" name="__codelineno-45-77" href="#__codelineno-45-77"></a>
<a id="__codelineno-45-78" name="__codelineno-45-78" href="#__codelineno-45-78"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetPosition</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<a id="__codelineno-45-79" name="__codelineno-45-79" href="#__codelineno-45-79"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetDirection</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">direction</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<a id="__codelineno-45-80" name="__codelineno-45-80" href="#__codelineno-45-80"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="nf">GetPosition</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">position_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-45-81" name="__codelineno-45-81" href="#__codelineno-45-81"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="nf">GetDirection</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">direction_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-45-82" name="__codelineno-45-82" href="#__codelineno-45-82"></a>
<a id="__codelineno-45-83" name="__codelineno-45-83" href="#__codelineno-45-83"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetCutOff</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">inner_cutoff</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">outer_cutoff</span><span class="p">);</span>
<a id="__codelineno-45-84" name="__codelineno-45-84" href="#__codelineno-45-84"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Vector2</span><span class="w"> </span><span class="nf">GetCutOff</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector2</span><span class="p">(</span><span class="n">inner_cutoff_</span><span class="p">,</span><span class="w"> </span><span class="n">outer_cutoff_</span><span class="p">);</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-45-85" name="__codelineno-45-85" href="#__codelineno-45-85"></a>
<a id="__codelineno-45-86" name="__codelineno-45-86" href="#__codelineno-45-86"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-45-87" name="__codelineno-45-87" href="#__codelineno-45-87"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="n">position_</span><span class="p">;</span>
<a id="__codelineno-45-88" name="__codelineno-45-88" href="#__codelineno-45-88"></a><span class="w">  </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="w"> </span><span class="n">direction_</span><span class="p">;</span>
<a id="__codelineno-45-89" name="__codelineno-45-89" href="#__codelineno-45-89"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">inner_cutoff_</span><span class="p">;</span>
<a id="__codelineno-45-90" name="__codelineno-45-90" href="#__codelineno-45-90"></a><span class="w">  </span><span class="kt">float</span><span class="w"> </span><span class="n">outer_cutoff_</span><span class="p">;</span>
<a id="__codelineno-45-91" name="__codelineno-45-91" href="#__codelineno-45-91"></a><span class="p">};</span>
<a id="__codelineno-45-92" name="__codelineno-45-92" href="#__codelineno-45-92"></a>
<a id="__codelineno-45-93" name="__codelineno-45-93" href="#__codelineno-45-93"></a><span class="k">class</span><span class="w"> </span><span class="nc">AmbientLight</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Light</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-94" name="__codelineno-45-94" href="#__codelineno-45-94"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-45-95" name="__codelineno-45-95" href="#__codelineno-45-95"></a><span class="w">  </span><span class="n">AmbientLight</span><span class="p">();</span>
<a id="__codelineno-45-96" name="__codelineno-45-96" href="#__codelineno-45-96"></a><span class="p">};</span>
<a id="__codelineno-45-97" name="__codelineno-45-97" href="#__codelineno-45-97"></a>
<a id="__codelineno-45-98" name="__codelineno-45-98" href="#__codelineno-45-98"></a><span class="k">class</span><span class="w"> </span><span class="nc">LightManager</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-45-99" name="__codelineno-45-99" href="#__codelineno-45-99"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-45-100" name="__codelineno-45-100" href="#__codelineno-45-100"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">LightManager</span><span class="o">&amp;</span><span class="w"> </span><span class="n">GetInstance</span><span class="p">();</span>
<a id="__codelineno-45-101" name="__codelineno-45-101" href="#__codelineno-45-101"></a>
<a id="__codelineno-45-102" name="__codelineno-45-102" href="#__codelineno-45-102"></a><span class="w">  </span><span class="c1">// Disallow copy and assign</span>
<a id="__codelineno-45-103" name="__codelineno-45-103" href="#__codelineno-45-103"></a><span class="w">  </span><span class="n">LightManager</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">LightManager</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-45-104" name="__codelineno-45-104" href="#__codelineno-45-104"></a><span class="w">  </span><span class="n">LightManager</span><span class="o">&amp;</span><span class="w"> </span><span class="k">operator</span><span class="o">=</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">LightManager</span><span class="o">&amp;</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">delete</span><span class="p">;</span>
<a id="__codelineno-45-105" name="__codelineno-45-105" href="#__codelineno-45-105"></a>
<a id="__codelineno-45-106" name="__codelineno-45-106" href="#__codelineno-45-106"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">AddLight</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Light</span><span class="o">&gt;</span><span class="w"> </span><span class="n">light</span><span class="p">);</span>
<a id="__codelineno-45-107" name="__codelineno-45-107" href="#__codelineno-45-107"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">RemoveLight</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Light</span><span class="o">*</span><span class="w"> </span><span class="n">light</span><span class="p">);</span>
<a id="__codelineno-45-108" name="__codelineno-45-108" href="#__codelineno-45-108"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="nf">ClearLights</span><span class="p">();</span>
<a id="__codelineno-45-109" name="__codelineno-45-109" href="#__codelineno-45-109"></a>
<a id="__codelineno-45-110" name="__codelineno-45-110" href="#__codelineno-45-110"></a><span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Light</span><span class="o">&gt;&gt;&amp;</span><span class="w"> </span><span class="n">GetLights</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">lights_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-45-111" name="__codelineno-45-111" href="#__codelineno-45-111"></a>
<a id="__codelineno-45-112" name="__codelineno-45-112" href="#__codelineno-45-112"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-45-113" name="__codelineno-45-113" href="#__codelineno-45-113"></a><span class="w">  </span><span class="n">LightManager</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-45-114" name="__codelineno-45-114" href="#__codelineno-45-114"></a><span class="w">  </span><span class="o">~</span><span class="n">LightManager</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-45-115" name="__codelineno-45-115" href="#__codelineno-45-115"></a>
<a id="__codelineno-45-116" name="__codelineno-45-116" href="#__codelineno-45-116"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Light</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">lights_</span><span class="p">;</span>
<a id="__codelineno-45-117" name="__codelineno-45-117" href="#__codelineno-45-117"></a><span class="p">};</span>
<a id="__codelineno-45-118" name="__codelineno-45-118" href="#__codelineno-45-118"></a>
<a id="__codelineno-45-119" name="__codelineno-45-119" href="#__codelineno-45-119"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace graphics</span>
<a id="__codelineno-45-120" name="__codelineno-45-120" href="#__codelineno-45-120"></a>
<a id="__codelineno-45-121" name="__codelineno-45-121" href="#__codelineno-45-121"></a><span class="cp">#endif  </span><span class="c1">// GRAPHICS_LIGHT_H_</span>
</code></pre></div>
<p>Now, let's implement the Light classes and LightManager:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-46-1" name="__codelineno-46-1" href="#__codelineno-46-1"></a><span class="c1">// light.cc</span>
<a id="__codelineno-46-2" name="__codelineno-46-2" href="#__codelineno-46-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;light.h&quot;</span>
<a id="__codelineno-46-3" name="__codelineno-46-3" href="#__codelineno-46-3"></a>
<a id="__codelineno-46-4" name="__codelineno-46-4" href="#__codelineno-46-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
<a id="__codelineno-46-5" name="__codelineno-46-5" href="#__codelineno-46-5"></a>
<a id="__codelineno-46-6" name="__codelineno-46-6" href="#__codelineno-46-6"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">graphics</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-7" name="__codelineno-46-7" href="#__codelineno-46-7"></a>
<a id="__codelineno-46-8" name="__codelineno-46-8" href="#__codelineno-46-8"></a><span class="n">Light</span><span class="o">::</span><span class="n">Light</span><span class="p">(</span><span class="n">Type</span><span class="w"> </span><span class="n">type</span><span class="p">)</span>
<a id="__codelineno-46-9" name="__codelineno-46-9" href="#__codelineno-46-9"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">type_</span><span class="p">(</span><span class="n">type</span><span class="p">),</span>
<a id="__codelineno-46-10" name="__codelineno-46-10" href="#__codelineno-46-10"></a><span class="w">      </span><span class="n">color_</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">),</span>
<a id="__codelineno-46-11" name="__codelineno-46-11" href="#__codelineno-46-11"></a><span class="w">      </span><span class="n">intensity_</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-46-12" name="__codelineno-46-12" href="#__codelineno-46-12"></a>
<a id="__codelineno-46-13" name="__codelineno-46-13" href="#__codelineno-46-13"></a><span class="kt">void</span><span class="w"> </span><span class="n">Light</span><span class="o">::</span><span class="n">SetColor</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-14" name="__codelineno-46-14" href="#__codelineno-46-14"></a><span class="w">  </span><span class="n">color_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">color</span><span class="p">;</span>
<a id="__codelineno-46-15" name="__codelineno-46-15" href="#__codelineno-46-15"></a><span class="p">}</span>
<a id="__codelineno-46-16" name="__codelineno-46-16" href="#__codelineno-46-16"></a>
<a id="__codelineno-46-17" name="__codelineno-46-17" href="#__codelineno-46-17"></a><span class="kt">void</span><span class="w"> </span><span class="n">Light</span><span class="o">::</span><span class="n">SetIntensity</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">intensity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-18" name="__codelineno-46-18" href="#__codelineno-46-18"></a><span class="w">  </span><span class="n">intensity_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">max</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="n">intensity</span><span class="p">);</span>
<a id="__codelineno-46-19" name="__codelineno-46-19" href="#__codelineno-46-19"></a><span class="p">}</span>
<a id="__codelineno-46-20" name="__codelineno-46-20" href="#__codelineno-46-20"></a>
<a id="__codelineno-46-21" name="__codelineno-46-21" href="#__codelineno-46-21"></a><span class="n">DirectionalLight</span><span class="o">::</span><span class="n">DirectionalLight</span><span class="p">()</span>
<a id="__codelineno-46-22" name="__codelineno-46-22" href="#__codelineno-46-22"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">Light</span><span class="p">(</span><span class="n">Type</span><span class="o">::</span><span class="n">kDirectional</span><span class="p">),</span>
<a id="__codelineno-46-23" name="__codelineno-46-23" href="#__codelineno-46-23"></a><span class="w">      </span><span class="n">direction_</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-46-24" name="__codelineno-46-24" href="#__codelineno-46-24"></a>
<a id="__codelineno-46-25" name="__codelineno-46-25" href="#__codelineno-46-25"></a><span class="kt">void</span><span class="w"> </span><span class="n">DirectionalLight</span><span class="o">::</span><span class="n">SetDirection</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">direction</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-26" name="__codelineno-46-26" href="#__codelineno-46-26"></a><span class="w">  </span><span class="n">direction_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="p">.</span><span class="n">Normalized</span><span class="p">();</span>
<a id="__codelineno-46-27" name="__codelineno-46-27" href="#__codelineno-46-27"></a><span class="p">}</span>
<a id="__codelineno-46-28" name="__codelineno-46-28" href="#__codelineno-46-28"></a>
<a id="__codelineno-46-29" name="__codelineno-46-29" href="#__codelineno-46-29"></a><span class="n">PointLight</span><span class="o">::</span><span class="n">PointLight</span><span class="p">()</span>
<a id="__codelineno-46-30" name="__codelineno-46-30" href="#__codelineno-46-30"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">Light</span><span class="p">(</span><span class="n">Type</span><span class="o">::</span><span class="n">kPoint</span><span class="p">),</span>
<a id="__codelineno-46-31" name="__codelineno-46-31" href="#__codelineno-46-31"></a><span class="w">      </span><span class="n">position_</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">),</span>
<a id="__codelineno-46-32" name="__codelineno-46-32" href="#__codelineno-46-32"></a><span class="w">      </span><span class="n">attenuation_</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.09f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.032f</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-46-33" name="__codelineno-46-33" href="#__codelineno-46-33"></a>
<a id="__codelineno-46-34" name="__codelineno-46-34" href="#__codelineno-46-34"></a><span class="kt">void</span><span class="w"> </span><span class="n">PointLight</span><span class="o">::</span><span class="n">SetPosition</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-35" name="__codelineno-46-35" href="#__codelineno-46-35"></a><span class="w">  </span><span class="n">position_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-46-36" name="__codelineno-46-36" href="#__codelineno-46-36"></a><span class="p">}</span>
<a id="__codelineno-46-37" name="__codelineno-46-37" href="#__codelineno-46-37"></a>
<a id="__codelineno-46-38" name="__codelineno-46-38" href="#__codelineno-46-38"></a><span class="kt">void</span><span class="w"> </span><span class="n">PointLight</span><span class="o">::</span><span class="n">SetAttenuation</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">constant</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">linear</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">quadratic</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-39" name="__codelineno-46-39" href="#__codelineno-46-39"></a><span class="w">  </span><span class="n">attenuation_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="p">(</span><span class="n">constant</span><span class="p">,</span><span class="w"> </span><span class="n">linear</span><span class="p">,</span><span class="w"> </span><span class="n">quadratic</span><span class="p">);</span>
<a id="__codelineno-46-40" name="__codelineno-46-40" href="#__codelineno-46-40"></a><span class="p">}</span>
<a id="__codelineno-46-41" name="__codelineno-46-41" href="#__codelineno-46-41"></a>
<a id="__codelineno-46-42" name="__codelineno-46-42" href="#__codelineno-46-42"></a><span class="n">SpotLight</span><span class="o">::</span><span class="n">SpotLight</span><span class="p">()</span>
<a id="__codelineno-46-43" name="__codelineno-46-43" href="#__codelineno-46-43"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">Light</span><span class="p">(</span><span class="n">Type</span><span class="o">::</span><span class="n">kSpot</span><span class="p">),</span>
<a id="__codelineno-46-44" name="__codelineno-46-44" href="#__codelineno-46-44"></a><span class="w">      </span><span class="n">position_</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">),</span>
<a id="__codelineno-46-45" name="__codelineno-46-45" href="#__codelineno-46-45"></a><span class="w">      </span><span class="n">direction_</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">),</span>
<a id="__codelineno-46-46" name="__codelineno-46-46" href="#__codelineno-46-46"></a><span class="w">      </span><span class="n">inner_cutoff_</span><span class="p">(</span><span class="mf">12.5f</span><span class="p">),</span>
<a id="__codelineno-46-47" name="__codelineno-46-47" href="#__codelineno-46-47"></a><span class="w">      </span><span class="n">outer_cutoff_</span><span class="p">(</span><span class="mf">17.5f</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-46-48" name="__codelineno-46-48" href="#__codelineno-46-48"></a>
<a id="__codelineno-46-49" name="__codelineno-46-49" href="#__codelineno-46-49"></a><span class="kt">void</span><span class="w"> </span><span class="n">SpotLight</span><span class="o">::</span><span class="n">SetPosition</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-50" name="__codelineno-46-50" href="#__codelineno-46-50"></a><span class="w">  </span><span class="n">position_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-46-51" name="__codelineno-46-51" href="#__codelineno-46-51"></a><span class="p">}</span>
<a id="__codelineno-46-52" name="__codelineno-46-52" href="#__codelineno-46-52"></a>
<a id="__codelineno-46-53" name="__codelineno-46-53" href="#__codelineno-46-53"></a><span class="kt">void</span><span class="w"> </span><span class="n">SpotLight</span><span class="o">::</span><span class="n">SetDirection</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">direction</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-54" name="__codelineno-46-54" href="#__codelineno-46-54"></a><span class="w">  </span><span class="n">direction_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">direction</span><span class="p">.</span><span class="n">Normalized</span><span class="p">();</span>
<a id="__codelineno-46-55" name="__codelineno-46-55" href="#__codelineno-46-55"></a><span class="p">}</span>
<a id="__codelineno-46-56" name="__codelineno-46-56" href="#__codelineno-46-56"></a>
<a id="__codelineno-46-57" name="__codelineno-46-57" href="#__codelineno-46-57"></a><span class="kt">void</span><span class="w"> </span><span class="n">SpotLight</span><span class="o">::</span><span class="n">SetCutOff</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">inner_cutoff</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">outer_cutoff</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-58" name="__codelineno-46-58" href="#__codelineno-46-58"></a><span class="w">  </span><span class="n">inner_cutoff_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">clamp</span><span class="p">(</span><span class="n">inner_cutoff</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="n">outer_cutoff</span><span class="p">);</span>
<a id="__codelineno-46-59" name="__codelineno-46-59" href="#__codelineno-46-59"></a><span class="w">  </span><span class="n">outer_cutoff_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">clamp</span><span class="p">(</span><span class="n">outer_cutoff</span><span class="p">,</span><span class="w"> </span><span class="n">inner_cutoff</span><span class="p">,</span><span class="w"> </span><span class="mf">90.0f</span><span class="p">);</span>
<a id="__codelineno-46-60" name="__codelineno-46-60" href="#__codelineno-46-60"></a><span class="p">}</span>
<a id="__codelineno-46-61" name="__codelineno-46-61" href="#__codelineno-46-61"></a>
<a id="__codelineno-46-62" name="__codelineno-46-62" href="#__codelineno-46-62"></a><span class="n">AmbientLight</span><span class="o">::</span><span class="n">AmbientLight</span><span class="p">()</span>
<a id="__codelineno-46-63" name="__codelineno-46-63" href="#__codelineno-46-63"></a><span class="w">    </span><span class="o">:</span><span class="w"> </span><span class="n">Light</span><span class="p">(</span><span class="n">Type</span><span class="o">::</span><span class="n">kAmbient</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-46-64" name="__codelineno-46-64" href="#__codelineno-46-64"></a>
<a id="__codelineno-46-65" name="__codelineno-46-65" href="#__codelineno-46-65"></a><span class="n">LightManager</span><span class="o">&amp;</span><span class="w"> </span><span class="n">LightManager</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-66" name="__codelineno-46-66" href="#__codelineno-46-66"></a><span class="w">  </span><span class="k">static</span><span class="w"> </span><span class="n">LightManager</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span>
<a id="__codelineno-46-67" name="__codelineno-46-67" href="#__codelineno-46-67"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">instance</span><span class="p">;</span>
<a id="__codelineno-46-68" name="__codelineno-46-68" href="#__codelineno-46-68"></a><span class="p">}</span>
<a id="__codelineno-46-69" name="__codelineno-46-69" href="#__codelineno-46-69"></a>
<a id="__codelineno-46-70" name="__codelineno-46-70" href="#__codelineno-46-70"></a><span class="kt">void</span><span class="w"> </span><span class="n">LightManager</span><span class="o">::</span><span class="n">AddLight</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Light</span><span class="o">&gt;</span><span class="w"> </span><span class="n">light</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-71" name="__codelineno-46-71" href="#__codelineno-46-71"></a><span class="w">  </span><span class="n">lights_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">light</span><span class="p">));</span>
<a id="__codelineno-46-72" name="__codelineno-46-72" href="#__codelineno-46-72"></a><span class="p">}</span>
<a id="__codelineno-46-73" name="__codelineno-46-73" href="#__codelineno-46-73"></a>
<a id="__codelineno-46-74" name="__codelineno-46-74" href="#__codelineno-46-74"></a><span class="kt">void</span><span class="w"> </span><span class="n">LightManager</span><span class="o">::</span><span class="n">RemoveLight</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Light</span><span class="o">*</span><span class="w"> </span><span class="n">light</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-75" name="__codelineno-46-75" href="#__codelineno-46-75"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">remove_if</span><span class="p">(</span><span class="n">lights_</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span><span class="w"> </span><span class="n">lights_</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span>
<a id="__codelineno-46-76" name="__codelineno-46-76" href="#__codelineno-46-76"></a><span class="w">                           </span><span class="p">[</span><span class="n">light</span><span class="p">](</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">ptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">ptr</span><span class="p">.</span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">light</span><span class="p">;</span><span class="w"> </span><span class="p">});</span>
<a id="__codelineno-46-77" name="__codelineno-46-77" href="#__codelineno-46-77"></a><span class="w">  </span><span class="n">lights_</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">it</span><span class="p">,</span><span class="w"> </span><span class="n">lights_</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
<a id="__codelineno-46-78" name="__codelineno-46-78" href="#__codelineno-46-78"></a><span class="p">}</span>
<a id="__codelineno-46-79" name="__codelineno-46-79" href="#__codelineno-46-79"></a>
<a id="__codelineno-46-80" name="__codelineno-46-80" href="#__codelineno-46-80"></a><span class="kt">void</span><span class="w"> </span><span class="n">LightManager</span><span class="o">::</span><span class="n">ClearLights</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-46-81" name="__codelineno-46-81" href="#__codelineno-46-81"></a><span class="w">  </span><span class="n">lights_</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<a id="__codelineno-46-82" name="__codelineno-46-82" href="#__codelineno-46-82"></a><span class="p">}</span>
<a id="__codelineno-46-83" name="__codelineno-46-83" href="#__codelineno-46-83"></a>
<a id="__codelineno-46-84" name="__codelineno-46-84" href="#__codelineno-46-84"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace graphics</span>
</code></pre></div>
<p>This implementation follows several best practices:</p>
<ol>
<li>Use of namespaces to avoid naming conflicts.</li>
<li>Clear separation of interface (header) and implementation (source) files.</li>
<li>Consistent naming conventions (e.g., method names are CamelCase, member variables end with underscore).</li>
<li>Use of <code>const</code> for methods that don't modify object state.</li>
<li>Virtual destructor in the base class to ensure proper cleanup of derived classes.</li>
<li>Use of <code>override</code> keyword for virtual function overrides.</li>
<li>Explicit constructor and deleted copy constructor/assignment operator to prevent accidental copies.</li>
<li>Use of <code>std::unique_ptr</code> for memory management in LightManager.</li>
<li>Use of <code>std::clamp</code> and <code>std::max</code> for value constraints.</li>
<li>Singleton pattern for LightManager implemented in a thread-safe manner.</li>
</ol>
<p>To use this Light system in your application:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-47-1" name="__codelineno-47-1" href="#__codelineno-47-1"></a><span class="c1">// main.cc</span>
<a id="__codelineno-47-2" name="__codelineno-47-2" href="#__codelineno-47-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;light.h&quot;</span>
<a id="__codelineno-47-3" name="__codelineno-47-3" href="#__codelineno-47-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;shader.h&quot;</span>
<a id="__codelineno-47-4" name="__codelineno-47-4" href="#__codelineno-47-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;camera.h&quot;</span>
<a id="__codelineno-47-5" name="__codelineno-47-5" href="#__codelineno-47-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;GL/glew.h&gt;</span>
<a id="__codelineno-47-6" name="__codelineno-47-6" href="#__codelineno-47-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;GLFW/glfw3.h&gt;</span>
<a id="__codelineno-47-7" name="__codelineno-47-7" href="#__codelineno-47-7"></a>
<a id="__codelineno-47-8" name="__codelineno-47-8" href="#__codelineno-47-8"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-9" name="__codelineno-47-9" href="#__codelineno-47-9"></a><span class="w">  </span><span class="c1">// Initialize GLFW and GLEW here...</span>
<a id="__codelineno-47-10" name="__codelineno-47-10" href="#__codelineno-47-10"></a>
<a id="__codelineno-47-11" name="__codelineno-47-11" href="#__codelineno-47-11"></a><span class="w">  </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">shader_manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">graphics</span><span class="o">::</span><span class="n">ShaderManager</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">();</span>
<a id="__codelineno-47-12" name="__codelineno-47-12" href="#__codelineno-47-12"></a><span class="w">  </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">light_manager</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">graphics</span><span class="o">::</span><span class="n">LightManager</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">();</span>
<a id="__codelineno-47-13" name="__codelineno-47-13" href="#__codelineno-47-13"></a>
<a id="__codelineno-47-14" name="__codelineno-47-14" href="#__codelineno-47-14"></a><span class="w">  </span><span class="n">graphics</span><span class="o">::</span><span class="n">Shader</span><span class="o">*</span><span class="w"> </span><span class="n">lighting_shader</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">shader_manager</span><span class="p">.</span><span class="n">LoadShader</span><span class="p">(</span>
<a id="__codelineno-47-15" name="__codelineno-47-15" href="#__codelineno-47-15"></a><span class="w">      </span><span class="s">&quot;LightingShader&quot;</span><span class="p">,</span>
<a id="__codelineno-47-16" name="__codelineno-47-16" href="#__codelineno-47-16"></a><span class="w">      </span><span class="s">&quot;shaders/lighting_vertex.glsl&quot;</span><span class="p">,</span>
<a id="__codelineno-47-17" name="__codelineno-47-17" href="#__codelineno-47-17"></a><span class="w">      </span><span class="s">&quot;shaders/lighting_fragment.glsl&quot;</span>
<a id="__codelineno-47-18" name="__codelineno-47-18" href="#__codelineno-47-18"></a><span class="w">  </span><span class="p">);</span>
<a id="__codelineno-47-19" name="__codelineno-47-19" href="#__codelineno-47-19"></a>
<a id="__codelineno-47-20" name="__codelineno-47-20" href="#__codelineno-47-20"></a><span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">lighting_shader</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-21" name="__codelineno-47-21" href="#__codelineno-47-21"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cerr</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Failed to load lighting shader&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<a id="__codelineno-47-22" name="__codelineno-47-22" href="#__codelineno-47-22"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">-1</span><span class="p">;</span>
<a id="__codelineno-47-23" name="__codelineno-47-23" href="#__codelineno-47-23"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-47-24" name="__codelineno-47-24" href="#__codelineno-47-24"></a>
<a id="__codelineno-47-25" name="__codelineno-47-25" href="#__codelineno-47-25"></a><span class="w">  </span><span class="n">graphics</span><span class="o">::</span><span class="n">FPSCamera</span><span class="w"> </span><span class="n">camera</span><span class="p">;</span>
<a id="__codelineno-47-26" name="__codelineno-47-26" href="#__codelineno-47-26"></a><span class="w">  </span><span class="n">camera</span><span class="p">.</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">3.0f</span><span class="p">));</span>
<a id="__codelineno-47-27" name="__codelineno-47-27" href="#__codelineno-47-27"></a><span class="w">  </span><span class="n">camera</span><span class="p">.</span><span class="n">SetAspectRatio</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">window_width</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">window_height</span><span class="p">);</span>
<a id="__codelineno-47-28" name="__codelineno-47-28" href="#__codelineno-47-28"></a>
<a id="__codelineno-47-29" name="__codelineno-47-29" href="#__codelineno-47-29"></a><span class="w">  </span><span class="c1">// Create and add lights</span>
<a id="__codelineno-47-30" name="__codelineno-47-30" href="#__codelineno-47-30"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">directional_light</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">graphics</span><span class="o">::</span><span class="n">DirectionalLight</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-47-31" name="__codelineno-47-31" href="#__codelineno-47-31"></a><span class="w">  </span><span class="n">directional_light</span><span class="o">-&gt;</span><span class="n">SetDirection</span><span class="p">(</span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">-0.2f</span><span class="p">,</span><span class="w"> </span><span class="mf">-1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">-0.3f</span><span class="p">));</span>
<a id="__codelineno-47-32" name="__codelineno-47-32" href="#__codelineno-47-32"></a><span class="w">  </span><span class="n">directional_light</span><span class="o">-&gt;</span><span class="n">SetColor</span><span class="p">(</span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">));</span>
<a id="__codelineno-47-33" name="__codelineno-47-33" href="#__codelineno-47-33"></a><span class="w">  </span><span class="n">directional_light</span><span class="o">-&gt;</span><span class="n">SetIntensity</span><span class="p">(</span><span class="mf">0.5f</span><span class="p">);</span>
<a id="__codelineno-47-34" name="__codelineno-47-34" href="#__codelineno-47-34"></a><span class="w">  </span><span class="n">light_manager</span><span class="p">.</span><span class="n">AddLight</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">directional_light</span><span class="p">));</span>
<a id="__codelineno-47-35" name="__codelineno-47-35" href="#__codelineno-47-35"></a>
<a id="__codelineno-47-36" name="__codelineno-47-36" href="#__codelineno-47-36"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">point_light</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">graphics</span><span class="o">::</span><span class="n">PointLight</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-47-37" name="__codelineno-47-37" href="#__codelineno-47-37"></a><span class="w">  </span><span class="n">point_light</span><span class="o">-&gt;</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">2.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">));</span>
<a id="__codelineno-47-38" name="__codelineno-47-38" href="#__codelineno-47-38"></a><span class="w">  </span><span class="n">point_light</span><span class="o">-&gt;</span><span class="n">SetColor</span><span class="p">(</span><span class="n">math</span><span class="o">::</span><span class="n">Vector3</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">));</span>
<a id="__codelineno-47-39" name="__codelineno-47-39" href="#__codelineno-47-39"></a><span class="w">  </span><span class="n">point_light</span><span class="o">-&gt;</span><span class="n">SetIntensity</span><span class="p">(</span><span class="mf">1.0f</span><span class="p">);</span>
<a id="__codelineno-47-40" name="__codelineno-47-40" href="#__codelineno-47-40"></a><span class="w">  </span><span class="n">light_manager</span><span class="p">.</span><span class="n">AddLight</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">point_light</span><span class="p">));</span>
<a id="__codelineno-47-41" name="__codelineno-47-41" href="#__codelineno-47-41"></a>
<a id="__codelineno-47-42" name="__codelineno-47-42" href="#__codelineno-47-42"></a><span class="w">  </span><span class="c1">// Main render loop</span>
<a id="__codelineno-47-43" name="__codelineno-47-43" href="#__codelineno-47-43"></a><span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">glfwWindowShouldClose</span><span class="p">(</span><span class="n">window</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-44" name="__codelineno-47-44" href="#__codelineno-47-44"></a><span class="w">    </span><span class="c1">// Clear the screen</span>
<a id="__codelineno-47-45" name="__codelineno-47-45" href="#__codelineno-47-45"></a><span class="w">    </span><span class="n">glClear</span><span class="p">(</span><span class="n">GL_COLOR_BUFFER_BIT</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">GL_DEPTH_BUFFER_BIT</span><span class="p">);</span>
<a id="__codelineno-47-46" name="__codelineno-47-46" href="#__codelineno-47-46"></a>
<a id="__codelineno-47-47" name="__codelineno-47-47" href="#__codelineno-47-47"></a><span class="w">    </span><span class="c1">// Use the shader</span>
<a id="__codelineno-47-48" name="__codelineno-47-48" href="#__codelineno-47-48"></a><span class="w">    </span><span class="n">lighting_shader</span><span class="o">-&gt;</span><span class="n">Use</span><span class="p">();</span>
<a id="__codelineno-47-49" name="__codelineno-47-49" href="#__codelineno-47-49"></a>
<a id="__codelineno-47-50" name="__codelineno-47-50" href="#__codelineno-47-50"></a><span class="w">    </span><span class="c1">// Set camera uniforms</span>
<a id="__codelineno-47-51" name="__codelineno-47-51" href="#__codelineno-47-51"></a><span class="w">    </span><span class="n">math</span><span class="o">::</span><span class="n">Matrix4x4</span><span class="w"> </span><span class="n">view</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">GetViewMatrix</span><span class="p">();</span>
<a id="__codelineno-47-52" name="__codelineno-47-52" href="#__codelineno-47-52"></a><span class="w">    </span><span class="n">math</span><span class="o">::</span><span class="n">Matrix4x4</span><span class="w"> </span><span class="n">projection</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">camera</span><span class="p">.</span><span class="n">GetProjectionMatrix</span><span class="p">();</span>
<a id="__codelineno-47-53" name="__codelineno-47-53" href="#__codelineno-47-53"></a><span class="w">    </span><span class="n">lighting_shader</span><span class="o">-&gt;</span><span class="n">SetMat4</span><span class="p">(</span><span class="s">&quot;uView&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">view</span><span class="p">.</span><span class="n">GetData</span><span class="p">());</span>
<a id="__codelineno-47-54" name="__codelineno-47-54" href="#__codelineno-47-54"></a><span class="w">    </span><span class="n">lighting_shader</span><span class="o">-&gt;</span><span class="n">SetMat4</span><span class="p">(</span><span class="s">&quot;uProjection&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">projection</span><span class="p">.</span><span class="n">GetData</span><span class="p">());</span>
<a id="__codelineno-47-55" name="__codelineno-47-55" href="#__codelineno-47-55"></a>
<a id="__codelineno-47-56" name="__codelineno-47-56" href="#__codelineno-47-56"></a><span class="w">    </span><span class="c1">// Set light uniforms</span>
<a id="__codelineno-47-57" name="__codelineno-47-57" href="#__codelineno-47-57"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">light_index</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-47-58" name="__codelineno-47-58" href="#__codelineno-47-58"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">light</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">light_manager</span><span class="p">.</span><span class="n">GetLights</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-59" name="__codelineno-47-59" href="#__codelineno-47-59"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">light_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;uLights[&quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">to_string</span><span class="p">(</span><span class="n">light_index</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;]&quot;</span><span class="p">;</span>
<a id="__codelineno-47-60" name="__codelineno-47-60" href="#__codelineno-47-60"></a><span class="w">      </span><span class="n">lighting_shader</span><span class="o">-&gt;</span><span class="n">SetInt</span><span class="p">(</span><span class="n">light_name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.type&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">light</span><span class="o">-&gt;</span><span class="n">GetType</span><span class="p">()));</span>
<a id="__codelineno-47-61" name="__codelineno-47-61" href="#__codelineno-47-61"></a><span class="w">      </span><span class="n">lighting_shader</span><span class="o">-&gt;</span><span class="n">SetVec3</span><span class="p">(</span><span class="n">light_name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.color&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="o">-&gt;</span><span class="n">GetColor</span><span class="p">().</span><span class="n">GetData</span><span class="p">());</span>
<a id="__codelineno-47-62" name="__codelineno-47-62" href="#__codelineno-47-62"></a><span class="w">      </span><span class="n">lighting_shader</span><span class="o">-&gt;</span><span class="n">SetFloat</span><span class="p">(</span><span class="n">light_name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.intensity&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="o">-&gt;</span><span class="n">GetIntensity</span><span class="p">());</span>
<a id="__codelineno-47-63" name="__codelineno-47-63" href="#__codelineno-47-63"></a>
<a id="__codelineno-47-64" name="__codelineno-47-64" href="#__codelineno-47-64"></a><span class="w">      </span><span class="k">switch</span><span class="w"> </span><span class="p">(</span><span class="n">light</span><span class="o">-&gt;</span><span class="n">GetType</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-47-65" name="__codelineno-47-65" href="#__codelineno-47-65"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">graphics</span><span class="o">::</span><span class="no">Light</span><span class="o">::</span><span class="no">Type</span><span class="o">::</span><span class="no">kDirectional</span><span class="p">:</span>
<a id="__codelineno-47-66" name="__codelineno-47-66" href="#__codelineno-47-66"></a><span class="w">          </span><span class="n">lighting_shader</span><span class="o">-&gt;</span><span class="n">SetVec3</span><span class="p">(</span><span class="n">light_name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.direction&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="o">-&gt;</span><span class="n">GetDirection</span><span class="p">().</span><span class="n">GetData</span><span class="p">());</span>
<a id="__codelineno-47-67" name="__codelineno-47-67" href="#__codelineno-47-67"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-47-68" name="__codelineno-47-68" href="#__codelineno-47-68"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">graphics</span><span class="o">::</span><span class="no">Light</span><span class="o">::</span><span class="no">Type</span><span class="o">::</span><span class="no">kPoint</span><span class="p">:</span>
<a id="__codelineno-47-69" name="__codelineno-47-69" href="#__codelineno-47-69"></a><span class="w">          </span><span class="n">lighting_shader</span><span class="o">-&gt;</span><span class="n">SetVec3</span><span class="p">(</span><span class="n">light_name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.position&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="o">-&gt;</span><span class="n">GetPosition</span><span class="p">().</span><span class="n">GetData</span><span class="p">());</span>
<a id="__codelineno-47-70" name="__codelineno-47-70" href="#__codelineno-47-70"></a><span class="w">          </span><span class="n">lighting_shader</span><span class="o">-&gt;</span><span class="n">SetVec3</span><span class="p">(</span><span class="n">light_name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.attenuation&quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-47-71" name="__codelineno-47-71" href="#__codelineno-47-71"></a><span class="w">              </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">graphics</span><span class="o">::</span><span class="n">PointLight</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">light</span><span class="p">.</span><span class="n">get</span><span class="p">())</span><span class="o">-&gt;</span><span class="n">GetAttenuation</span><span class="p">().</span><span class="n">GetData</span><span class="p">());</span>
<a id="__codelineno-47-72" name="__codelineno-47-72" href="#__codelineno-47-72"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-47-73" name="__codelineno-47-73" href="#__codelineno-47-73"></a><span class="w">        </span><span class="k">case</span><span class="w"> </span><span class="no">graphics</span><span class="o">::</span><span class="no">Light</span><span class="o">::</span><span class="no">Type</span><span class="o">::</span><span class="no">kSpot</span><span class="p">:</span>
<a id="__codelineno-47-74" name="__codelineno-47-74" href="#__codelineno-47-74"></a><span class="w">          </span><span class="n">lighting_shader</span><span class="o">-&gt;</span><span class="n">SetVec3</span><span class="p">(</span><span class="n">light_name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.position&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="o">-&gt;</span><span class="n">GetPosition</span><span class="p">().</span><span class="n">GetData</span><span class="p">());</span>
<a id="__codelineno-47-75" name="__codelineno-47-75" href="#__codelineno-47-75"></a><span class="w">          </span><span class="n">lighting_shader</span><span class="o">-&gt;</span><span class="n">SetVec3</span><span class="p">(</span><span class="n">light_name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.direction&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">light</span><span class="o">-&gt;</span><span class="n">GetDirection</span><span class="p">().</span><span class="n">GetData</span><span class="p">());</span>
<a id="__codelineno-47-76" name="__codelineno-47-76" href="#__codelineno-47-76"></a><span class="w">          </span><span class="n">lighting_shader</span><span class="o">-&gt;</span><span class="n">SetVec2</span><span class="p">(</span><span class="n">light_name</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="s">&quot;.cutOff&quot;</span><span class="p">,</span><span class="w"> </span>
<a id="__codelineno-47-77" name="__codelineno-47-77" href="#__codelineno-47-77"></a><span class="w">              </span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span><span class="w"> </span><span class="n">graphics</span><span class="o">::</span><span class="n">SpotLight</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">light</span><span class="p">.</span><span class="n">get</span><span class="p">())</span><span class="o">-&gt;</span><span class="n">GetCutOff</span><span class="p">().</span><span class="n">GetData</span><span class="p">());</span>
<a id="__codelineno-47-78" name="__codelineno-47-78" href="#__codelineno-47-78"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-47-79" name="__codelineno-47-79" href="#__codelineno-47-79"></a><span class="w">        </span><span class="k">default</span><span class="o">:</span>
<a id="__codelineno-47-80" name="__codelineno-47-80" href="#__codelineno-47-80"></a><span class="w">          </span><span class="k">break</span><span class="p">;</span>
<a id="__codelineno-47-81" name="__codelineno-47-81" href="#__codelineno-47-81"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-47-82" name="__codelineno-47-82" href="#__codelineno-47-82"></a>
<a id="__codelineno-47-83" name="__codelineno-47-83" href="#__codelineno-47-83"></a><span class="w">      </span><span class="o">++</span><span class="n">light_index</span><span class="p">;</span>
<a id="__codelineno-47-84" name="__codelineno-47-84" href="#__codelineno-47-84"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-47-85" name="__codelineno-47-85" href="#__codelineno-47-85"></a>
<a id="__codelineno-47-86" name="__codelineno-47-86" href="#__codelineno-47-86"></a><span class="w">    </span><span class="c1">// Draw your objects here...</span>
<a id="__codelineno-47-87" name="__codelineno-47-87" href="#__codelineno-47-87"></a>
<a id="__codelineno-47-88" name="__codelineno-47-88" href="#__codelineno-47-88"></a><span class="w">    </span><span class="n">glfwSwapBuffers</span><span class="p">(</span><span class="n">window</span><span class="p">);</span>
<a id="__codelineno-47-89" name="__codelineno-47-89" href="#__codelineno-47-89"></a><span class="w">    </span><span class="n">glfwPollEvents</span><span class="p">();</span>
<a id="__codelineno-47-90" name="__codelineno-47-90" href="#__codelineno-47-90"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-47-91" name="__codelineno-47-91" href="#__codelineno-47-91"></a>
<a id="__codelineno-47-92" name="__codelineno-47-92" href="#__codelineno-47-92"></a><span class="w">  </span><span class="c1">// Cleanup and exit</span>
<a id="__codelineno-47-93" name="__codelineno-47-93" href="#__codelineno-47-93"></a><span class="w">  </span><span class="n">glfwTerminate</span><span class="p">();</span>
<a id="__codelineno-47-94" name="__codelineno-47-94" href="#__codelineno-47-94"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-47-95" name="__codelineno-47-95" href="#__codelineno-47-95"></a><span class="p">}</span>
</code></pre></div>
<p>This Light system provides a flexible foundation for managing different types of lights in a 3D graphics application. The <code>LightManager</code> class allows for easy addition, removal, and management of lights in the scene. </p>
<p>The system is designed to be easily extendable, so you could create other light types by inheriting from the <code>Light</code> base class and implementing the necessary behavior. The use of polymorphism allows for a unified interface when setting shader uniforms, regardless of the specific light type.</p>
<p>Remember to update your shader code to handle the different light types and perform the appropriate lighting calculations based on the light properties.</p>
<h4 id="particle-systems">Particle Systems</h4>
<p>Particle systems simulate and render a large number of small particles to create effects like fire, smoke, explosions, and rain.</p>
<ul>
<li>
<p><strong>Particle Emitters:</strong> Emit particles over time, specifying properties like position, velocity, lifespan, and color.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-48-1" name="__codelineno-48-1" href="#__codelineno-48-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ParticleEmitter</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-2" name="__codelineno-48-2" href="#__codelineno-48-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-48-3" name="__codelineno-48-3" href="#__codelineno-48-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">velocity</span><span class="p">;</span>
<a id="__codelineno-48-4" name="__codelineno-48-4" href="#__codelineno-48-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">emissionRate</span><span class="p">;</span>
<a id="__codelineno-48-5" name="__codelineno-48-5" href="#__codelineno-48-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">particleLifespan</span><span class="p">;</span>
<a id="__codelineno-48-6" name="__codelineno-48-6" href="#__codelineno-48-6"></a>
<a id="__codelineno-48-7" name="__codelineno-48-7" href="#__codelineno-48-7"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Emit</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-8" name="__codelineno-48-8" href="#__codelineno-48-8"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">emissionRate</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-9" name="__codelineno-48-9" href="#__codelineno-48-9"></a><span class="w">            </span><span class="n">CreateParticle</span><span class="p">();</span>
<a id="__codelineno-48-10" name="__codelineno-48-10" href="#__codelineno-48-10"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-48-11" name="__codelineno-48-11" href="#__codelineno-48-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-48-12" name="__codelineno-48-12" href="#__codelineno-48-12"></a>
<a id="__codelineno-48-13" name="__codelineno-48-13" href="#__codelineno-48-13"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CreateParticle</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-48-14" name="__codelineno-48-14" href="#__codelineno-48-14"></a><span class="w">        </span><span class="n">Particle</span><span class="w"> </span><span class="n">particle</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Particle</span><span class="p">();</span>
<a id="__codelineno-48-15" name="__codelineno-48-15" href="#__codelineno-48-15"></a><span class="w">        </span><span class="n">particle</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-48-16" name="__codelineno-48-16" href="#__codelineno-48-16"></a><span class="w">        </span><span class="n">particle</span><span class="p">.</span><span class="n">velocity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">velocity</span><span class="p">;</span>
<a id="__codelineno-48-17" name="__codelineno-48-17" href="#__codelineno-48-17"></a><span class="w">        </span><span class="n">particle</span><span class="p">.</span><span class="n">lifespan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">particleLifespan</span><span class="p">;</span>
<a id="__codelineno-48-18" name="__codelineno-48-18" href="#__codelineno-48-18"></a><span class="w">        </span><span class="c1">// Initialize other particle properties</span>
<a id="__codelineno-48-19" name="__codelineno-48-19" href="#__codelineno-48-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-48-20" name="__codelineno-48-20" href="#__codelineno-48-20"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Particle Updates:</strong> Update particle properties like position, velocity, and lifespan each frame.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-49-1" name="__codelineno-49-1" href="#__codelineno-49-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Particle</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-2" name="__codelineno-49-2" href="#__codelineno-49-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-49-3" name="__codelineno-49-3" href="#__codelineno-49-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">velocity</span><span class="p">;</span>
<a id="__codelineno-49-4" name="__codelineno-49-4" href="#__codelineno-49-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">lifespan</span><span class="p">;</span>
<a id="__codelineno-49-5" name="__codelineno-49-5" href="#__codelineno-49-5"></a>
<a id="__codelineno-49-6" name="__codelineno-49-6" href="#__codelineno-49-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Update</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">deltaTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-49-7" name="__codelineno-49-7" href="#__codelineno-49-7"></a><span class="w">        </span><span class="n">position</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">velocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">deltaTime</span><span class="p">;</span>
<a id="__codelineno-49-8" name="__codelineno-49-8" href="#__codelineno-49-8"></a><span class="w">        </span><span class="n">lifespan</span><span class="w"> </span><span class="o">-=</span><span class="w"> </span><span class="n">deltaTime</span><span class="p">;</span>
<a id="__codelineno-49-9" name="__codelineno-49-9" href="#__codelineno-49-9"></a><span class="w">        </span><span class="c1">// Update other properties like color and size</span>
<a id="__codelineno-49-10" name="__codelineno-49-10" href="#__codelineno-49-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-49-11" name="__codelineno-49-11" href="#__codelineno-49-11"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Particle Rendering:</strong> Render particles, often using billboarding techniques to ensure they always face the camera.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-50-1" name="__codelineno-50-1" href="#__codelineno-50-1"></a><span class="k">void</span><span class="w"> </span><span class="nf">RenderParticles</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Particle</span><span class="o">&gt;</span><span class="w"> </span><span class="n">particles</span><span class="p">,</span><span class="w"> </span><span class="n">Camera</span><span class="w"> </span><span class="n">camera</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-2" name="__codelineno-50-2" href="#__codelineno-50-2"></a><span class="w">    </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">particle</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">particles</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-50-3" name="__codelineno-50-3" href="#__codelineno-50-3"></a><span class="w">        </span><span class="c1">// Compute particle&#39;s screen position and render it</span>
<a id="__codelineno-50-4" name="__codelineno-50-4" href="#__codelineno-50-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-50-5" name="__codelineno-50-5" href="#__codelineno-50-5"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<p>By effectively managing these aspects of the rendering engine, game developers can create visually stunning and performant games that leverage advanced graphics techniques and efficient resource management.</p>
<h3 id="physics-engine">Physics Engine</h3>
<h4 id="collision-detection">Collision Detection</h4>
<p>Collision detection is the process of determining when two or more physical objects in a game world intersect or come into contact. Efficient collision detection is crucial for realistic physics simulation and gameplay mechanics.</p>
<ul>
<li>
<p><strong>Bounding Volume Hierarchies (BVH):</strong> Simplifies collision detection by encapsulating complex objects within simpler shapes (bounding volumes) like axis-aligned bounding boxes (AABBs), spheres, or oriented bounding boxes (OBBs).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-51-1" name="__codelineno-51-1" href="#__codelineno-51-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">BoundingBox</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-2" name="__codelineno-51-2" href="#__codelineno-51-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">min</span><span class="p">;</span>
<a id="__codelineno-51-3" name="__codelineno-51-3" href="#__codelineno-51-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">max</span><span class="p">;</span>
<a id="__codelineno-51-4" name="__codelineno-51-4" href="#__codelineno-51-4"></a>
<a id="__codelineno-51-5" name="__codelineno-51-5" href="#__codelineno-51-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">Intersects</span><span class="p">(</span><span class="n">BoundingBox</span><span class="w"> </span><span class="n">other</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-51-6" name="__codelineno-51-6" href="#__codelineno-51-6"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">(</span><span class="n">min</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">max</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-51-7" name="__codelineno-51-7" href="#__codelineno-51-7"></a><span class="w">               </span><span class="p">(</span><span class="n">min</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">max</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span>
<a id="__codelineno-51-8" name="__codelineno-51-8" href="#__codelineno-51-8"></a><span class="w">               </span><span class="p">(</span><span class="n">min</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">max</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">max</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">other</span><span class="p">.</span><span class="n">min</span><span class="p">.</span><span class="n">z</span><span class="p">);</span>
<a id="__codelineno-51-9" name="__codelineno-51-9" href="#__codelineno-51-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-51-10" name="__codelineno-51-10" href="#__codelineno-51-10"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Spatial Partitioning:</strong> Divides the game world into smaller regions to reduce the number of collision checks. Techniques include grids, quadtrees (2D), and octrees (3D).</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-52-1" name="__codelineno-52-1" href="#__codelineno-52-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Quadtree</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-2" name="__codelineno-52-2" href="#__codelineno-52-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">BoundingBox</span><span class="w"> </span><span class="n">bounds</span><span class="p">;</span>
<a id="__codelineno-52-3" name="__codelineno-52-3" href="#__codelineno-52-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">GameObject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">objects</span><span class="p">;</span>
<a id="__codelineno-52-4" name="__codelineno-52-4" href="#__codelineno-52-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Quadtree</span><span class="p">[]</span><span class="w"> </span><span class="n">children</span><span class="p">;</span>
<a id="__codelineno-52-5" name="__codelineno-52-5" href="#__codelineno-52-5"></a>
<a id="__codelineno-52-6" name="__codelineno-52-6" href="#__codelineno-52-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Insert</span><span class="p">(</span><span class="n">GameObject</span><span class="w"> </span><span class="n">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-7" name="__codelineno-52-7" href="#__codelineno-52-7"></a><span class="w">        </span><span class="c1">// Insert object into appropriate quadrant</span>
<a id="__codelineno-52-8" name="__codelineno-52-8" href="#__codelineno-52-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-52-9" name="__codelineno-52-9" href="#__codelineno-52-9"></a>
<a id="__codelineno-52-10" name="__codelineno-52-10" href="#__codelineno-52-10"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">GameObject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Query</span><span class="p">(</span><span class="n">BoundingBox</span><span class="w"> </span><span class="n">range</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-52-11" name="__codelineno-52-11" href="#__codelineno-52-11"></a><span class="w">        </span><span class="c1">// Return all objects within the specified range</span>
<a id="__codelineno-52-12" name="__codelineno-52-12" href="#__codelineno-52-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-52-13" name="__codelineno-52-13" href="#__codelineno-52-13"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Continuous Collision Detection:</strong> Prevents fast-moving objects from passing through each other by checking for collisions along their paths between frames.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-53-1" name="__codelineno-53-1" href="#__codelineno-53-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ContinuousCollisionDetection</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-2" name="__codelineno-53-2" href="#__codelineno-53-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">DetectCollision</span><span class="p">(</span><span class="n">Rigidbody</span><span class="w"> </span><span class="n">rb</span><span class="p">,</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">startPosition</span><span class="p">,</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">endPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-53-3" name="__codelineno-53-3" href="#__codelineno-53-3"></a><span class="w">        </span><span class="c1">// Check for collisions along the path</span>
<a id="__codelineno-53-4" name="__codelineno-53-4" href="#__codelineno-53-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-53-5" name="__codelineno-53-5" href="#__codelineno-53-5"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="rigid-body-dynamics">Rigid Body Dynamics</h4>
<p>Rigid body dynamics simulate the movement and interaction of solid, non-deformable objects. This includes calculating forces, velocities, and collisions.</p>
<ul>
<li>
<p><strong>Rigid Body Simulation:</strong> Governs the motion of objects using Newton's laws of motion, taking into account mass, velocity, acceleration, and applied forces.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-54-1" name="__codelineno-54-1" href="#__codelineno-54-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Rigidbody</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-2" name="__codelineno-54-2" href="#__codelineno-54-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-54-3" name="__codelineno-54-3" href="#__codelineno-54-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">velocity</span><span class="p">;</span>
<a id="__codelineno-54-4" name="__codelineno-54-4" href="#__codelineno-54-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">mass</span><span class="p">;</span>
<a id="__codelineno-54-5" name="__codelineno-54-5" href="#__codelineno-54-5"></a>
<a id="__codelineno-54-6" name="__codelineno-54-6" href="#__codelineno-54-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ApplyForce</span><span class="p">(</span><span class="n">Vector3</span><span class="w"> </span><span class="n">force</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-7" name="__codelineno-54-7" href="#__codelineno-54-7"></a><span class="w">        </span><span class="n">Vector3</span><span class="w"> </span><span class="n">acceleration</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">mass</span><span class="p">;</span>
<a id="__codelineno-54-8" name="__codelineno-54-8" href="#__codelineno-54-8"></a><span class="w">        </span><span class="n">velocity</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">acceleration</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span><span class="p">;</span>
<a id="__codelineno-54-9" name="__codelineno-54-9" href="#__codelineno-54-9"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-54-10" name="__codelineno-54-10" href="#__codelineno-54-10"></a>
<a id="__codelineno-54-11" name="__codelineno-54-11" href="#__codelineno-54-11"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Update</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-54-12" name="__codelineno-54-12" href="#__codelineno-54-12"></a><span class="w">        </span><span class="n">position</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="n">velocity</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">Time</span><span class="p">.</span><span class="n">deltaTime</span><span class="p">;</span>
<a id="__codelineno-54-13" name="__codelineno-54-13" href="#__codelineno-54-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-54-14" name="__codelineno-54-14" href="#__codelineno-54-14"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Collision Response:</strong> Calculates the outcome of collisions, including changes in velocity and position, based on physical properties like elasticity and friction.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-55-1" name="__codelineno-55-1" href="#__codelineno-55-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">CollisionResponse</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-55-2" name="__codelineno-55-2" href="#__codelineno-55-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ResolveCollision</span><span class="p">(</span><span class="n">Rigidbody</span><span class="w"> </span><span class="n">rb1</span><span class="p">,</span><span class="w"> </span><span class="n">Rigidbody</span><span class="w"> </span><span class="n">rb2</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-55-3" name="__codelineno-55-3" href="#__codelineno-55-3"></a><span class="w">        </span><span class="c1">// Calculate response based on velocities, masses, and restitution</span>
<a id="__codelineno-55-4" name="__codelineno-55-4" href="#__codelineno-55-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-55-5" name="__codelineno-55-5" href="#__codelineno-55-5"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="soft-body-physics">Soft Body Physics</h4>
<p>Soft body physics simulate the behavior of deformable objects like cloth, jelly, and muscles. These objects can bend, stretch, and compress.</p>
<ul>
<li>
<p><strong>Spring-Mass Systems:</strong>  Model soft bodies using a network of masses (particles) connected by springs. Forces applied to the particles result in realistic deformation.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-56-1" name="__codelineno-56-1" href="#__codelineno-56-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">SoftBody</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-2" name="__codelineno-56-2" href="#__codelineno-56-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Particle</span><span class="o">&gt;</span><span class="w"> </span><span class="n">particles</span><span class="p">;</span>
<a id="__codelineno-56-3" name="__codelineno-56-3" href="#__codelineno-56-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Spring</span><span class="o">&gt;</span><span class="w"> </span><span class="n">springs</span><span class="p">;</span>
<a id="__codelineno-56-4" name="__codelineno-56-4" href="#__codelineno-56-4"></a>
<a id="__codelineno-56-5" name="__codelineno-56-5" href="#__codelineno-56-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Update</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-6" name="__codelineno-56-6" href="#__codelineno-56-6"></a><span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">spring</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">springs</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-7" name="__codelineno-56-7" href="#__codelineno-56-7"></a><span class="w">            </span><span class="n">spring</span><span class="p">.</span><span class="n">ApplyForce</span><span class="p">();</span>
<a id="__codelineno-56-8" name="__codelineno-56-8" href="#__codelineno-56-8"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-56-9" name="__codelineno-56-9" href="#__codelineno-56-9"></a><span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">particle</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">particles</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-10" name="__codelineno-56-10" href="#__codelineno-56-10"></a><span class="w">            </span><span class="n">particle</span><span class="p">.</span><span class="n">Update</span><span class="p">();</span>
<a id="__codelineno-56-11" name="__codelineno-56-11" href="#__codelineno-56-11"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-56-12" name="__codelineno-56-12" href="#__codelineno-56-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-13" name="__codelineno-56-13" href="#__codelineno-56-13"></a><span class="p">}</span>
<a id="__codelineno-56-14" name="__codelineno-56-14" href="#__codelineno-56-14"></a>
<a id="__codelineno-56-15" name="__codelineno-56-15" href="#__codelineno-56-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">Spring</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-16" name="__codelineno-56-16" href="#__codelineno-56-16"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Particle</span><span class="w"> </span><span class="n">p1</span><span class="p">,</span><span class="w"> </span><span class="n">p2</span><span class="p">;</span>
<a id="__codelineno-56-17" name="__codelineno-56-17" href="#__codelineno-56-17"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">restLength</span><span class="p">;</span>
<a id="__codelineno-56-18" name="__codelineno-56-18" href="#__codelineno-56-18"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">stiffness</span><span class="p">;</span>
<a id="__codelineno-56-19" name="__codelineno-56-19" href="#__codelineno-56-19"></a>
<a id="__codelineno-56-20" name="__codelineno-56-20" href="#__codelineno-56-20"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ApplyForce</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-56-21" name="__codelineno-56-21" href="#__codelineno-56-21"></a><span class="w">        </span><span class="n">Vector3</span><span class="w"> </span><span class="n">delta</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">p2</span><span class="p">.</span><span class="n">position</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">p1</span><span class="p">.</span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-56-22" name="__codelineno-56-22" href="#__codelineno-56-22"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">dist</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delta</span><span class="p">.</span><span class="n">magnitude</span><span class="p">;</span>
<a id="__codelineno-56-23" name="__codelineno-56-23" href="#__codelineno-56-23"></a><span class="w">        </span><span class="kt">float</span><span class="w"> </span><span class="n">forceMagnitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">stiffness</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="p">(</span><span class="n">dist</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">restLength</span><span class="p">);</span>
<a id="__codelineno-56-24" name="__codelineno-56-24" href="#__codelineno-56-24"></a><span class="w">        </span><span class="n">Vector3</span><span class="w"> </span><span class="n">force</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">delta</span><span class="p">.</span><span class="n">normalized</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">forceMagnitude</span><span class="p">;</span>
<a id="__codelineno-56-25" name="__codelineno-56-25" href="#__codelineno-56-25"></a><span class="w">        </span><span class="n">p1</span><span class="p">.</span><span class="n">ApplyForce</span><span class="p">(</span><span class="n">force</span><span class="p">);</span>
<a id="__codelineno-56-26" name="__codelineno-56-26" href="#__codelineno-56-26"></a><span class="w">        </span><span class="n">p2</span><span class="p">.</span><span class="n">ApplyForce</span><span class="p">(</span><span class="o">-</span><span class="n">force</span><span class="p">);</span>
<a id="__codelineno-56-27" name="__codelineno-56-27" href="#__codelineno-56-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-56-28" name="__codelineno-56-28" href="#__codelineno-56-28"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Finite Element Method (FEM):</strong> Divides the soft body into smaller elements and solves the physical equations governing their deformation. FEM is more accurate but computationally intensive.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-57-1" name="__codelineno-57-1" href="#__codelineno-57-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">FiniteElement</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-57-2" name="__codelineno-57-2" href="#__codelineno-57-2"></a><span class="w">    </span><span class="c1">// Implementation of FEM for soft body physics</span>
<a id="__codelineno-57-3" name="__codelineno-57-3" href="#__codelineno-57-3"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="ragdoll-physics">Ragdoll Physics</h4>
<p>Ragdoll physics simulate the movement of a character's limbs when they lose muscle control, typically after being knocked out or killed. It provides a realistic depiction of how bodies react to forces.</p>
<ul>
<li>
<p><strong>Ragdoll Setup:</strong> Constructs a skeleton of rigid bodies connected by joints, allowing for realistic limb movement.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-58-1" name="__codelineno-58-1" href="#__codelineno-58-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Ragdoll</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-2" name="__codelineno-58-2" href="#__codelineno-58-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Rigidbody</span><span class="o">&gt;</span><span class="w"> </span><span class="n">bones</span><span class="p">;</span>
<a id="__codelineno-58-3" name="__codelineno-58-3" href="#__codelineno-58-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Joint</span><span class="o">&gt;</span><span class="w"> </span><span class="n">joints</span><span class="p">;</span>
<a id="__codelineno-58-4" name="__codelineno-58-4" href="#__codelineno-58-4"></a>
<a id="__codelineno-58-5" name="__codelineno-58-5" href="#__codelineno-58-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Initialize</span><span class="p">(</span><span class="n">Character</span><span class="w"> </span><span class="n">character</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-6" name="__codelineno-58-6" href="#__codelineno-58-6"></a><span class="w">        </span><span class="c1">// Create rigid bodies and joints based on character&#39;s skeleton</span>
<a id="__codelineno-58-7" name="__codelineno-58-7" href="#__codelineno-58-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-8" name="__codelineno-58-8" href="#__codelineno-58-8"></a>
<a id="__codelineno-58-9" name="__codelineno-58-9" href="#__codelineno-58-9"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Enable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-10" name="__codelineno-58-10" href="#__codelineno-58-10"></a><span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">bone</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">bones</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-11" name="__codelineno-58-11" href="#__codelineno-58-11"></a><span class="w">            </span><span class="n">bone</span><span class="p">.</span><span class="n">isKinematic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<a id="__codelineno-58-12" name="__codelineno-58-12" href="#__codelineno-58-12"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-58-13" name="__codelineno-58-13" href="#__codelineno-58-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-14" name="__codelineno-58-14" href="#__codelineno-58-14"></a>
<a id="__codelineno-58-15" name="__codelineno-58-15" href="#__codelineno-58-15"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Disable</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-16" name="__codelineno-58-16" href="#__codelineno-58-16"></a><span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">bone</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">bones</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-58-17" name="__codelineno-58-17" href="#__codelineno-58-17"></a><span class="w">            </span><span class="n">bone</span><span class="p">.</span><span class="n">isKinematic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<a id="__codelineno-58-18" name="__codelineno-58-18" href="#__codelineno-58-18"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-58-19" name="__codelineno-58-19" href="#__codelineno-58-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-58-20" name="__codelineno-58-20" href="#__codelineno-58-20"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Joint Constraints:</strong> Define the limits and behavior of joints connecting the bones, preventing unnatural movement and ensuring stability.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-59-1" name="__codelineno-59-1" href="#__codelineno-59-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Joint</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-2" name="__codelineno-59-2" href="#__codelineno-59-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Rigidbody</span><span class="w"> </span><span class="n">bodyA</span><span class="p">,</span><span class="w"> </span><span class="n">bodyB</span><span class="p">;</span>
<a id="__codelineno-59-3" name="__codelineno-59-3" href="#__codelineno-59-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">anchor</span><span class="p">;</span>
<a id="__codelineno-59-4" name="__codelineno-59-4" href="#__codelineno-59-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">minLimit</span><span class="p">,</span><span class="w"> </span><span class="n">maxLimit</span><span class="p">;</span>
<a id="__codelineno-59-5" name="__codelineno-59-5" href="#__codelineno-59-5"></a>
<a id="__codelineno-59-6" name="__codelineno-59-6" href="#__codelineno-59-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ApplyConstraints</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-59-7" name="__codelineno-59-7" href="#__codelineno-59-7"></a><span class="w">        </span><span class="c1">// Apply joint constraints to prevent unrealistic movement</span>
<a id="__codelineno-59-8" name="__codelineno-59-8" href="#__codelineno-59-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-59-9" name="__codelineno-59-9" href="#__codelineno-59-9"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<p>By incorporating these advanced physics techniques, a game engine can deliver highly realistic and immersive physical interactions, enhancing the overall gameplay experience.</p>
<h3 id="audio-system">Audio System</h3>
<h4 id="sound-playback-and-mixing">Sound Playback and Mixing</h4>
<p>Sound playback and mixing are fundamental aspects of an audio system, allowing for the simultaneous playing and blending of multiple audio tracks.</p>
<ul>
<li>
<p><strong>Sound Playback:</strong> Handles loading, playing, pausing, and stopping audio files.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-60-1" name="__codelineno-60-1" href="#__codelineno-60-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AudioClip</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-60-2" name="__codelineno-60-2" href="#__codelineno-60-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">filePath</span><span class="p">;</span>
<a id="__codelineno-60-3" name="__codelineno-60-3" href="#__codelineno-60-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">isPlaying</span><span class="p">;</span>
<a id="__codelineno-60-4" name="__codelineno-60-4" href="#__codelineno-60-4"></a>
<a id="__codelineno-60-5" name="__codelineno-60-5" href="#__codelineno-60-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Play</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-60-6" name="__codelineno-60-6" href="#__codelineno-60-6"></a><span class="w">        </span><span class="c1">// Implementation for playing the audio clip</span>
<a id="__codelineno-60-7" name="__codelineno-60-7" href="#__codelineno-60-7"></a><span class="w">        </span><span class="n">isPlaying</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<a id="__codelineno-60-8" name="__codelineno-60-8" href="#__codelineno-60-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-60-9" name="__codelineno-60-9" href="#__codelineno-60-9"></a>
<a id="__codelineno-60-10" name="__codelineno-60-10" href="#__codelineno-60-10"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Pause</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-60-11" name="__codelineno-60-11" href="#__codelineno-60-11"></a><span class="w">        </span><span class="c1">// Implementation for pausing the audio clip</span>
<a id="__codelineno-60-12" name="__codelineno-60-12" href="#__codelineno-60-12"></a><span class="w">        </span><span class="n">isPlaying</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<a id="__codelineno-60-13" name="__codelineno-60-13" href="#__codelineno-60-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-60-14" name="__codelineno-60-14" href="#__codelineno-60-14"></a>
<a id="__codelineno-60-15" name="__codelineno-60-15" href="#__codelineno-60-15"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Stop</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-60-16" name="__codelineno-60-16" href="#__codelineno-60-16"></a><span class="w">        </span><span class="c1">// Implementation for stopping the audio clip</span>
<a id="__codelineno-60-17" name="__codelineno-60-17" href="#__codelineno-60-17"></a><span class="w">        </span><span class="n">isPlaying</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<a id="__codelineno-60-18" name="__codelineno-60-18" href="#__codelineno-60-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-60-19" name="__codelineno-60-19" href="#__codelineno-60-19"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Audio Mixing:</strong> Combines multiple audio tracks into a single output stream, adjusting the volume, pitch, and balance of each track to create the final sound.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-61-1" name="__codelineno-61-1" href="#__codelineno-61-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AudioMixer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-2" name="__codelineno-61-2" href="#__codelineno-61-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">AudioClip</span><span class="o">&gt;</span><span class="w"> </span><span class="n">audioClips</span><span class="p">;</span>
<a id="__codelineno-61-3" name="__codelineno-61-3" href="#__codelineno-61-3"></a>
<a id="__codelineno-61-4" name="__codelineno-61-4" href="#__codelineno-61-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Mix</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-61-5" name="__codelineno-61-5" href="#__codelineno-61-5"></a><span class="w">        </span><span class="c1">// Implementation for mixing audio clips</span>
<a id="__codelineno-61-6" name="__codelineno-61-6" href="#__codelineno-61-6"></a><span class="w">        </span><span class="c1">// Adjust volume, pitch, and other parameters</span>
<a id="__codelineno-61-7" name="__codelineno-61-7" href="#__codelineno-61-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-61-8" name="__codelineno-61-8" href="#__codelineno-61-8"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Volume Control:</strong> Allows adjusting the volume of individual audio clips or the overall mix.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-62-1" name="__codelineno-62-1" href="#__codelineno-62-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AudioClip</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-62-2" name="__codelineno-62-2" href="#__codelineno-62-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">volume</span><span class="p">;</span>
<a id="__codelineno-62-3" name="__codelineno-62-3" href="#__codelineno-62-3"></a>
<a id="__codelineno-62-4" name="__codelineno-62-4" href="#__codelineno-62-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetVolume</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">newVolume</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-62-5" name="__codelineno-62-5" href="#__codelineno-62-5"></a><span class="w">        </span><span class="n">volume</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newVolume</span><span class="p">;</span>
<a id="__codelineno-62-6" name="__codelineno-62-6" href="#__codelineno-62-6"></a><span class="w">        </span><span class="c1">// Update audio playback with new volume</span>
<a id="__codelineno-62-7" name="__codelineno-62-7" href="#__codelineno-62-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-62-8" name="__codelineno-62-8" href="#__codelineno-62-8"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="3d-spatial-audio">3D Spatial Audio</h4>
<p>3D spatial audio creates a realistic audio environment by simulating how sound interacts with the surroundings and the listener's position.</p>
<ul>
<li>
<p><strong>Positional Audio:</strong> Positions sounds in a 3D space relative to the listener, adjusting the volume and panning based on the distance and direction.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-63-1" name="__codelineno-63-1" href="#__codelineno-63-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AudioListener</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-2" name="__codelineno-63-2" href="#__codelineno-63-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-63-3" name="__codelineno-63-3" href="#__codelineno-63-3"></a>
<a id="__codelineno-63-4" name="__codelineno-63-4" href="#__codelineno-63-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UpdateListenerPosition</span><span class="p">(</span><span class="n">Vector3</span><span class="w"> </span><span class="n">newPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-5" name="__codelineno-63-5" href="#__codelineno-63-5"></a><span class="w">        </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newPosition</span><span class="p">;</span>
<a id="__codelineno-63-6" name="__codelineno-63-6" href="#__codelineno-63-6"></a><span class="w">        </span><span class="c1">// Update spatial audio calculations</span>
<a id="__codelineno-63-7" name="__codelineno-63-7" href="#__codelineno-63-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-63-8" name="__codelineno-63-8" href="#__codelineno-63-8"></a><span class="p">}</span>
<a id="__codelineno-63-9" name="__codelineno-63-9" href="#__codelineno-63-9"></a>
<a id="__codelineno-63-10" name="__codelineno-63-10" href="#__codelineno-63-10"></a><span class="k">class</span><span class="w"> </span><span class="nc">AudioSource</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-11" name="__codelineno-63-11" href="#__codelineno-63-11"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-63-12" name="__codelineno-63-12" href="#__codelineno-63-12"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">AudioClip</span><span class="w"> </span><span class="n">clip</span><span class="p">;</span>
<a id="__codelineno-63-13" name="__codelineno-63-13" href="#__codelineno-63-13"></a>
<a id="__codelineno-63-14" name="__codelineno-63-14" href="#__codelineno-63-14"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Play</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-15" name="__codelineno-63-15" href="#__codelineno-63-15"></a><span class="w">        </span><span class="c1">// Play audio clip with 3D spatial effects</span>
<a id="__codelineno-63-16" name="__codelineno-63-16" href="#__codelineno-63-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-63-17" name="__codelineno-63-17" href="#__codelineno-63-17"></a>
<a id="__codelineno-63-18" name="__codelineno-63-18" href="#__codelineno-63-18"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UpdatePosition</span><span class="p">(</span><span class="n">Vector3</span><span class="w"> </span><span class="n">newPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-63-19" name="__codelineno-63-19" href="#__codelineno-63-19"></a><span class="w">        </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newPosition</span><span class="p">;</span>
<a id="__codelineno-63-20" name="__codelineno-63-20" href="#__codelineno-63-20"></a><span class="w">        </span><span class="c1">// Update spatial audio calculations</span>
<a id="__codelineno-63-21" name="__codelineno-63-21" href="#__codelineno-63-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-63-22" name="__codelineno-63-22" href="#__codelineno-63-22"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Doppler Effect:</strong> Simulates the change in frequency and pitch of a sound as the source moves relative to the listener.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-64-1" name="__codelineno-64-1" href="#__codelineno-64-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AudioSource</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-64-2" name="__codelineno-64-2" href="#__codelineno-64-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">velocity</span><span class="p">;</span>
<a id="__codelineno-64-3" name="__codelineno-64-3" href="#__codelineno-64-3"></a>
<a id="__codelineno-64-4" name="__codelineno-64-4" href="#__codelineno-64-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ApplyDopplerEffect</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-64-5" name="__codelineno-64-5" href="#__codelineno-64-5"></a><span class="w">        </span><span class="c1">// Calculate and apply Doppler effect to audio playback</span>
<a id="__codelineno-64-6" name="__codelineno-64-6" href="#__codelineno-64-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-64-7" name="__codelineno-64-7" href="#__codelineno-64-7"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Occlusion and Obstruction:</strong> Simulates how objects in the environment block or reflect sound, affecting the perceived volume and quality.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-65-1" name="__codelineno-65-1" href="#__codelineno-65-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AudioOcclusion</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-2" name="__codelineno-65-2" href="#__codelineno-65-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsOccluded</span><span class="p">(</span><span class="n">Vector3</span><span class="w"> </span><span class="n">sourcePosition</span><span class="p">,</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">listenerPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-3" name="__codelineno-65-3" href="#__codelineno-65-3"></a><span class="w">        </span><span class="c1">// Check for obstacles between source and listener</span>
<a id="__codelineno-65-4" name="__codelineno-65-4" href="#__codelineno-65-4"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">isOccluded</span><span class="p">;</span>
<a id="__codelineno-65-5" name="__codelineno-65-5" href="#__codelineno-65-5"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-65-6" name="__codelineno-65-6" href="#__codelineno-65-6"></a>
<a id="__codelineno-65-7" name="__codelineno-65-7" href="#__codelineno-65-7"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ApplyOcclusionEffect</span><span class="p">(</span><span class="n">AudioClip</span><span class="w"> </span><span class="n">clip</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-8" name="__codelineno-65-8" href="#__codelineno-65-8"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">IsOccluded</span><span class="p">(</span><span class="n">clip</span><span class="p">.</span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">AudioListener</span><span class="p">.</span><span class="n">position</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-65-9" name="__codelineno-65-9" href="#__codelineno-65-9"></a><span class="w">            </span><span class="c1">// Adjust audio properties to simulate occlusion</span>
<a id="__codelineno-65-10" name="__codelineno-65-10" href="#__codelineno-65-10"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-65-11" name="__codelineno-65-11" href="#__codelineno-65-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-65-12" name="__codelineno-65-12" href="#__codelineno-65-12"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="audio-effects-and-processing">Audio Effects and Processing</h4>
<p>Audio effects and processing enhance the audio experience by applying various transformations and enhancements to the sound.</p>
<ul>
<li>
<p><strong>Reverb:</strong> Simulates the natural reverberation of sound in different environments, such as a small room or a large hall.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-66-1" name="__codelineno-66-1" href="#__codelineno-66-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ReverbEffect</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-2" name="__codelineno-66-2" href="#__codelineno-66-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">reverbTime</span><span class="p">;</span>
<a id="__codelineno-66-3" name="__codelineno-66-3" href="#__codelineno-66-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">decay</span><span class="p">;</span>
<a id="__codelineno-66-4" name="__codelineno-66-4" href="#__codelineno-66-4"></a>
<a id="__codelineno-66-5" name="__codelineno-66-5" href="#__codelineno-66-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ApplyReverb</span><span class="p">(</span><span class="n">AudioClip</span><span class="w"> </span><span class="n">clip</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-66-6" name="__codelineno-66-6" href="#__codelineno-66-6"></a><span class="w">        </span><span class="c1">// Apply reverb effect to audio clip</span>
<a id="__codelineno-66-7" name="__codelineno-66-7" href="#__codelineno-66-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-66-8" name="__codelineno-66-8" href="#__codelineno-66-8"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Echo:</strong> Adds delayed repetitions of a sound to create an echo effect.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-67-1" name="__codelineno-67-1" href="#__codelineno-67-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">EchoEffect</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-67-2" name="__codelineno-67-2" href="#__codelineno-67-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">delay</span><span class="p">;</span>
<a id="__codelineno-67-3" name="__codelineno-67-3" href="#__codelineno-67-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">decay</span><span class="p">;</span>
<a id="__codelineno-67-4" name="__codelineno-67-4" href="#__codelineno-67-4"></a>
<a id="__codelineno-67-5" name="__codelineno-67-5" href="#__codelineno-67-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ApplyEcho</span><span class="p">(</span><span class="n">AudioClip</span><span class="w"> </span><span class="n">clip</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-67-6" name="__codelineno-67-6" href="#__codelineno-67-6"></a><span class="w">        </span><span class="c1">// Apply echo effect to audio clip</span>
<a id="__codelineno-67-7" name="__codelineno-67-7" href="#__codelineno-67-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-67-8" name="__codelineno-67-8" href="#__codelineno-67-8"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Equalization (EQ):</strong> Adjusts the balance between different frequency components of an audio signal to enhance or reduce certain aspects of the sound.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-68-1" name="__codelineno-68-1" href="#__codelineno-68-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Equalizer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-2" name="__codelineno-68-2" href="#__codelineno-68-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="p">[]</span><span class="w"> </span><span class="n">bands</span><span class="p">;</span>
<a id="__codelineno-68-3" name="__codelineno-68-3" href="#__codelineno-68-3"></a>
<a id="__codelineno-68-4" name="__codelineno-68-4" href="#__codelineno-68-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ApplyEQ</span><span class="p">(</span><span class="n">AudioClip</span><span class="w"> </span><span class="n">clip</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-68-5" name="__codelineno-68-5" href="#__codelineno-68-5"></a><span class="w">        </span><span class="c1">// Apply equalization to audio clip</span>
<a id="__codelineno-68-6" name="__codelineno-68-6" href="#__codelineno-68-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-68-7" name="__codelineno-68-7" href="#__codelineno-68-7"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Distortion:</strong> Alters the sound to create a distorted, overdriven effect.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-69-1" name="__codelineno-69-1" href="#__codelineno-69-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">DistortionEffect</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-69-2" name="__codelineno-69-2" href="#__codelineno-69-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">gain</span><span class="p">;</span>
<a id="__codelineno-69-3" name="__codelineno-69-3" href="#__codelineno-69-3"></a>
<a id="__codelineno-69-4" name="__codelineno-69-4" href="#__codelineno-69-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ApplyDistortion</span><span class="p">(</span><span class="n">AudioClip</span><span class="w"> </span><span class="n">clip</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-69-5" name="__codelineno-69-5" href="#__codelineno-69-5"></a><span class="w">        </span><span class="c1">// Apply distortion effect to audio clip</span>
<a id="__codelineno-69-6" name="__codelineno-69-6" href="#__codelineno-69-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-69-7" name="__codelineno-69-7" href="#__codelineno-69-7"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Chorus:</strong> Simulates the effect of multiple voices or instruments playing together by adding slight variations in pitch and timing.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-70-1" name="__codelineno-70-1" href="#__codelineno-70-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">ChorusEffect</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-2" name="__codelineno-70-2" href="#__codelineno-70-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">depth</span><span class="p">;</span>
<a id="__codelineno-70-3" name="__codelineno-70-3" href="#__codelineno-70-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">rate</span><span class="p">;</span>
<a id="__codelineno-70-4" name="__codelineno-70-4" href="#__codelineno-70-4"></a>
<a id="__codelineno-70-5" name="__codelineno-70-5" href="#__codelineno-70-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ApplyChorus</span><span class="p">(</span><span class="n">AudioClip</span><span class="w"> </span><span class="n">clip</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-70-6" name="__codelineno-70-6" href="#__codelineno-70-6"></a><span class="w">        </span><span class="c1">// Apply chorus effect to audio clip</span>
<a id="__codelineno-70-7" name="__codelineno-70-7" href="#__codelineno-70-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-70-8" name="__codelineno-70-8" href="#__codelineno-70-8"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<p>By implementing these aspects of an audio system, a game engine can provide rich and immersive soundscapes, enhancing the overall gaming experience and drawing players deeper into the virtual world.</p>
<h3 id="input-system">Input System</h3>
<h4 id="keyboard-and-mouse-input">Keyboard and Mouse Input</h4>
<p>Keyboard and mouse input are the primary methods for user interaction on PCs. Handling these inputs involves capturing key presses, mouse movements, and clicks, then mapping them to in-game actions.</p>
<ul>
<li>
<p><strong>Keyboard Input:</strong> Detects and processes key presses and releases.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-71-1" name="__codelineno-71-1" href="#__codelineno-71-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Keyboard</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-71-2" name="__codelineno-71-2" href="#__codelineno-71-2"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Keys</span><span class="o">&gt;</span><span class="w"> </span><span class="n">keysPressed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="n">Keys</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-71-3" name="__codelineno-71-3" href="#__codelineno-71-3"></a>
<a id="__codelineno-71-4" name="__codelineno-71-4" href="#__codelineno-71-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">KeyDown</span><span class="p">(</span><span class="n">Keys</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-71-5" name="__codelineno-71-5" href="#__codelineno-71-5"></a><span class="w">        </span><span class="n">keysPressed</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<a id="__codelineno-71-6" name="__codelineno-71-6" href="#__codelineno-71-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-71-7" name="__codelineno-71-7" href="#__codelineno-71-7"></a>
<a id="__codelineno-71-8" name="__codelineno-71-8" href="#__codelineno-71-8"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">KeyUp</span><span class="p">(</span><span class="n">Keys</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-71-9" name="__codelineno-71-9" href="#__codelineno-71-9"></a><span class="w">        </span><span class="n">keysPressed</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<a id="__codelineno-71-10" name="__codelineno-71-10" href="#__codelineno-71-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-71-11" name="__codelineno-71-11" href="#__codelineno-71-11"></a>
<a id="__codelineno-71-12" name="__codelineno-71-12" href="#__codelineno-71-12"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsKeyPressed</span><span class="p">(</span><span class="n">Keys</span><span class="w"> </span><span class="n">key</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-71-13" name="__codelineno-71-13" href="#__codelineno-71-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">keysPressed</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
<a id="__codelineno-71-14" name="__codelineno-71-14" href="#__codelineno-71-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-71-15" name="__codelineno-71-15" href="#__codelineno-71-15"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Mouse Input:</strong> Captures mouse movements and button clicks.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-72-1" name="__codelineno-72-1" href="#__codelineno-72-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Mouse</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-2" name="__codelineno-72-2" href="#__codelineno-72-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Vector2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-72-3" name="__codelineno-72-3" href="#__codelineno-72-3"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="n">MouseButtons</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buttonsPressed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="n">MouseButtons</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-72-4" name="__codelineno-72-4" href="#__codelineno-72-4"></a>
<a id="__codelineno-72-5" name="__codelineno-72-5" href="#__codelineno-72-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">MouseMove</span><span class="p">(</span><span class="n">Vector2</span><span class="w"> </span><span class="n">newPosition</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-6" name="__codelineno-72-6" href="#__codelineno-72-6"></a><span class="w">        </span><span class="n">position</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newPosition</span><span class="p">;</span>
<a id="__codelineno-72-7" name="__codelineno-72-7" href="#__codelineno-72-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-72-8" name="__codelineno-72-8" href="#__codelineno-72-8"></a>
<a id="__codelineno-72-9" name="__codelineno-72-9" href="#__codelineno-72-9"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">MouseDown</span><span class="p">(</span><span class="n">MouseButtons</span><span class="w"> </span><span class="n">button</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-10" name="__codelineno-72-10" href="#__codelineno-72-10"></a><span class="w">        </span><span class="n">buttonsPressed</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">button</span><span class="p">);</span>
<a id="__codelineno-72-11" name="__codelineno-72-11" href="#__codelineno-72-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-72-12" name="__codelineno-72-12" href="#__codelineno-72-12"></a>
<a id="__codelineno-72-13" name="__codelineno-72-13" href="#__codelineno-72-13"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">MouseUp</span><span class="p">(</span><span class="n">MouseButtons</span><span class="w"> </span><span class="n">button</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-14" name="__codelineno-72-14" href="#__codelineno-72-14"></a><span class="w">        </span><span class="n">buttonsPressed</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">button</span><span class="p">);</span>
<a id="__codelineno-72-15" name="__codelineno-72-15" href="#__codelineno-72-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-72-16" name="__codelineno-72-16" href="#__codelineno-72-16"></a>
<a id="__codelineno-72-17" name="__codelineno-72-17" href="#__codelineno-72-17"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsButtonPressed</span><span class="p">(</span><span class="n">MouseButtons</span><span class="w"> </span><span class="n">button</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-72-18" name="__codelineno-72-18" href="#__codelineno-72-18"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">buttonsPressed</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">button</span><span class="p">);</span>
<a id="__codelineno-72-19" name="__codelineno-72-19" href="#__codelineno-72-19"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-72-20" name="__codelineno-72-20" href="#__codelineno-72-20"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Input Mapping:</strong> Maps raw input data to game-specific actions.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-73-1" name="__codelineno-73-1" href="#__codelineno-73-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">InputMapper</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-73-2" name="__codelineno-73-2" href="#__codelineno-73-2"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">Keyboard</span><span class="w"> </span><span class="n">keyboard</span><span class="p">;</span>
<a id="__codelineno-73-3" name="__codelineno-73-3" href="#__codelineno-73-3"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">Mouse</span><span class="w"> </span><span class="n">mouse</span><span class="p">;</span>
<a id="__codelineno-73-4" name="__codelineno-73-4" href="#__codelineno-73-4"></a>
<a id="__codelineno-73-5" name="__codelineno-73-5" href="#__codelineno-73-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">InputMapper</span><span class="p">(</span><span class="n">Keyboard</span><span class="w"> </span><span class="n">keyboard</span><span class="p">,</span><span class="w"> </span><span class="n">Mouse</span><span class="w"> </span><span class="n">mouse</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-73-6" name="__codelineno-73-6" href="#__codelineno-73-6"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">keyboard</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">keyboard</span><span class="p">;</span>
<a id="__codelineno-73-7" name="__codelineno-73-7" href="#__codelineno-73-7"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">mouse</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mouse</span><span class="p">;</span>
<a id="__codelineno-73-8" name="__codelineno-73-8" href="#__codelineno-73-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-73-9" name="__codelineno-73-9" href="#__codelineno-73-9"></a>
<a id="__codelineno-73-10" name="__codelineno-73-10" href="#__codelineno-73-10"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsActionTriggered</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">action</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-73-11" name="__codelineno-73-11" href="#__codelineno-73-11"></a><span class="w">        </span><span class="c1">// Map keys or buttons to game actions</span>
<a id="__codelineno-73-12" name="__codelineno-73-12" href="#__codelineno-73-12"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Jump&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">keyboard</span><span class="p">.</span><span class="n">IsKeyPressed</span><span class="p">(</span><span class="n">Keys</span><span class="p">.</span><span class="n">Space</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<a id="__codelineno-73-13" name="__codelineno-73-13" href="#__codelineno-73-13"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Shoot&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">mouse</span><span class="p">.</span><span class="n">IsButtonPressed</span><span class="p">(</span><span class="n">MouseButtons</span><span class="p">.</span><span class="n">Left</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<a id="__codelineno-73-14" name="__codelineno-73-14" href="#__codelineno-73-14"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<a id="__codelineno-73-15" name="__codelineno-73-15" href="#__codelineno-73-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-73-16" name="__codelineno-73-16" href="#__codelineno-73-16"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="gamepad-and-controller-support">Gamepad and Controller Support</h4>
<p>Gamepads and controllers provide an alternative input method, especially for console gaming. Supporting these devices involves handling analog sticks, triggers, and buttons.</p>
<ul>
<li>
<p><strong>Gamepad Input:</strong> Reads the state of buttons, analog sticks, and triggers.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-74-1" name="__codelineno-74-1" href="#__codelineno-74-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Gamepad</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-2" name="__codelineno-74-2" href="#__codelineno-74-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Vector2</span><span class="w"> </span><span class="n">leftStick</span><span class="p">;</span>
<a id="__codelineno-74-3" name="__codelineno-74-3" href="#__codelineno-74-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Vector2</span><span class="w"> </span><span class="n">rightStick</span><span class="p">;</span>
<a id="__codelineno-74-4" name="__codelineno-74-4" href="#__codelineno-74-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">leftTrigger</span><span class="p">;</span>
<a id="__codelineno-74-5" name="__codelineno-74-5" href="#__codelineno-74-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">rightTrigger</span><span class="p">;</span>
<a id="__codelineno-74-6" name="__codelineno-74-6" href="#__codelineno-74-6"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="n">GamepadButtons</span><span class="o">&gt;</span><span class="w"> </span><span class="n">buttonsPressed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">HashSet</span><span class="o">&lt;</span><span class="n">GamepadButtons</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-74-7" name="__codelineno-74-7" href="#__codelineno-74-7"></a>
<a id="__codelineno-74-8" name="__codelineno-74-8" href="#__codelineno-74-8"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UpdateStickPositions</span><span class="p">(</span><span class="n">Vector2</span><span class="w"> </span><span class="n">left</span><span class="p">,</span><span class="w"> </span><span class="n">Vector2</span><span class="w"> </span><span class="n">right</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-9" name="__codelineno-74-9" href="#__codelineno-74-9"></a><span class="w">        </span><span class="n">leftStick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">left</span><span class="p">;</span>
<a id="__codelineno-74-10" name="__codelineno-74-10" href="#__codelineno-74-10"></a><span class="w">        </span><span class="n">rightStick</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">right</span><span class="p">;</span>
<a id="__codelineno-74-11" name="__codelineno-74-11" href="#__codelineno-74-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-74-12" name="__codelineno-74-12" href="#__codelineno-74-12"></a>
<a id="__codelineno-74-13" name="__codelineno-74-13" href="#__codelineno-74-13"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UpdateTriggers</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">left</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">right</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-14" name="__codelineno-74-14" href="#__codelineno-74-14"></a><span class="w">        </span><span class="n">leftTrigger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">left</span><span class="p">;</span>
<a id="__codelineno-74-15" name="__codelineno-74-15" href="#__codelineno-74-15"></a><span class="w">        </span><span class="n">rightTrigger</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">right</span><span class="p">;</span>
<a id="__codelineno-74-16" name="__codelineno-74-16" href="#__codelineno-74-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-74-17" name="__codelineno-74-17" href="#__codelineno-74-17"></a>
<a id="__codelineno-74-18" name="__codelineno-74-18" href="#__codelineno-74-18"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ButtonDown</span><span class="p">(</span><span class="n">GamepadButtons</span><span class="w"> </span><span class="n">button</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-19" name="__codelineno-74-19" href="#__codelineno-74-19"></a><span class="w">        </span><span class="n">buttonsPressed</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">button</span><span class="p">);</span>
<a id="__codelineno-74-20" name="__codelineno-74-20" href="#__codelineno-74-20"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-74-21" name="__codelineno-74-21" href="#__codelineno-74-21"></a>
<a id="__codelineno-74-22" name="__codelineno-74-22" href="#__codelineno-74-22"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ButtonUp</span><span class="p">(</span><span class="n">GamepadButtons</span><span class="w"> </span><span class="n">button</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-23" name="__codelineno-74-23" href="#__codelineno-74-23"></a><span class="w">        </span><span class="n">buttonsPressed</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">button</span><span class="p">);</span>
<a id="__codelineno-74-24" name="__codelineno-74-24" href="#__codelineno-74-24"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-74-25" name="__codelineno-74-25" href="#__codelineno-74-25"></a>
<a id="__codelineno-74-26" name="__codelineno-74-26" href="#__codelineno-74-26"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsButtonPressed</span><span class="p">(</span><span class="n">GamepadButtons</span><span class="w"> </span><span class="n">button</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-74-27" name="__codelineno-74-27" href="#__codelineno-74-27"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">buttonsPressed</span><span class="p">.</span><span class="n">Contains</span><span class="p">(</span><span class="n">button</span><span class="p">);</span>
<a id="__codelineno-74-28" name="__codelineno-74-28" href="#__codelineno-74-28"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-74-29" name="__codelineno-74-29" href="#__codelineno-74-29"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Input Mapping:</strong> Maps gamepad inputs to game actions.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-75-1" name="__codelineno-75-1" href="#__codelineno-75-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">GamepadInputMapper</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-75-2" name="__codelineno-75-2" href="#__codelineno-75-2"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">Gamepad</span><span class="w"> </span><span class="n">gamepad</span><span class="p">;</span>
<a id="__codelineno-75-3" name="__codelineno-75-3" href="#__codelineno-75-3"></a>
<a id="__codelineno-75-4" name="__codelineno-75-4" href="#__codelineno-75-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">GamepadInputMapper</span><span class="p">(</span><span class="n">Gamepad</span><span class="w"> </span><span class="n">gamepad</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-75-5" name="__codelineno-75-5" href="#__codelineno-75-5"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">gamepad</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gamepad</span><span class="p">;</span>
<a id="__codelineno-75-6" name="__codelineno-75-6" href="#__codelineno-75-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-75-7" name="__codelineno-75-7" href="#__codelineno-75-7"></a>
<a id="__codelineno-75-8" name="__codelineno-75-8" href="#__codelineno-75-8"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsActionTriggered</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">action</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-75-9" name="__codelineno-75-9" href="#__codelineno-75-9"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Jump&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">gamepad</span><span class="p">.</span><span class="n">IsButtonPressed</span><span class="p">(</span><span class="n">GamepadButtons</span><span class="p">.</span><span class="n">A</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<a id="__codelineno-75-10" name="__codelineno-75-10" href="#__codelineno-75-10"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Shoot&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">gamepad</span><span class="p">.</span><span class="n">IsButtonPressed</span><span class="p">(</span><span class="n">GamepadButtons</span><span class="p">.</span><span class="n">RightTrigger</span><span class="p">))</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<a id="__codelineno-75-11" name="__codelineno-75-11" href="#__codelineno-75-11"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<a id="__codelineno-75-12" name="__codelineno-75-12" href="#__codelineno-75-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-75-13" name="__codelineno-75-13" href="#__codelineno-75-13"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="touch-and-gesture-recognition">Touch and Gesture Recognition</h4>
<p>Touch and gesture recognition are essential for mobile devices and tablets. This involves handling touch inputs, multi-touch gestures, and swipe or pinch actions.</p>
<ul>
<li>
<p><strong>Touch Input:</strong> Captures single and multi-touch events.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-76-1" name="__codelineno-76-1" href="#__codelineno-76-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">TouchInput</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-76-2" name="__codelineno-76-2" href="#__codelineno-76-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Touch</span><span class="o">&gt;</span><span class="w"> </span><span class="n">touches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Touch</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-76-3" name="__codelineno-76-3" href="#__codelineno-76-3"></a>
<a id="__codelineno-76-4" name="__codelineno-76-4" href="#__codelineno-76-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">UpdateTouches</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Touch</span><span class="o">&gt;</span><span class="w"> </span><span class="n">newTouches</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-76-5" name="__codelineno-76-5" href="#__codelineno-76-5"></a><span class="w">        </span><span class="n">touches</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">newTouches</span><span class="p">;</span>
<a id="__codelineno-76-6" name="__codelineno-76-6" href="#__codelineno-76-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-76-7" name="__codelineno-76-7" href="#__codelineno-76-7"></a><span class="p">}</span>
<a id="__codelineno-76-8" name="__codelineno-76-8" href="#__codelineno-76-8"></a>
<a id="__codelineno-76-9" name="__codelineno-76-9" href="#__codelineno-76-9"></a><span class="k">class</span><span class="w"> </span><span class="nc">Touch</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-76-10" name="__codelineno-76-10" href="#__codelineno-76-10"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">id</span><span class="p">;</span>
<a id="__codelineno-76-11" name="__codelineno-76-11" href="#__codelineno-76-11"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Vector2</span><span class="w"> </span><span class="n">position</span><span class="p">;</span>
<a id="__codelineno-76-12" name="__codelineno-76-12" href="#__codelineno-76-12"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">TouchPhase</span><span class="w"> </span><span class="n">phase</span><span class="p">;</span>
<a id="__codelineno-76-13" name="__codelineno-76-13" href="#__codelineno-76-13"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Gesture Recognition:</strong> Detects and interprets gestures like swipes, pinches, and taps.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-77-1" name="__codelineno-77-1" href="#__codelineno-77-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">GestureRecognizer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-77-2" name="__codelineno-77-2" href="#__codelineno-77-2"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">TouchInput</span><span class="w"> </span><span class="n">touchInput</span><span class="p">;</span>
<a id="__codelineno-77-3" name="__codelineno-77-3" href="#__codelineno-77-3"></a>
<a id="__codelineno-77-4" name="__codelineno-77-4" href="#__codelineno-77-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">GestureRecognizer</span><span class="p">(</span><span class="n">TouchInput</span><span class="w"> </span><span class="n">touchInput</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-77-5" name="__codelineno-77-5" href="#__codelineno-77-5"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">touchInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">touchInput</span><span class="p">;</span>
<a id="__codelineno-77-6" name="__codelineno-77-6" href="#__codelineno-77-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-77-7" name="__codelineno-77-7" href="#__codelineno-77-7"></a>
<a id="__codelineno-77-8" name="__codelineno-77-8" href="#__codelineno-77-8"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsSwipeGesture</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-77-9" name="__codelineno-77-9" href="#__codelineno-77-9"></a><span class="w">        </span><span class="c1">// Detect swipe gesture</span>
<a id="__codelineno-77-10" name="__codelineno-77-10" href="#__codelineno-77-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-77-11" name="__codelineno-77-11" href="#__codelineno-77-11"></a>
<a id="__codelineno-77-12" name="__codelineno-77-12" href="#__codelineno-77-12"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsPinchGesture</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-77-13" name="__codelineno-77-13" href="#__codelineno-77-13"></a><span class="w">        </span><span class="c1">// Detect pinch gesture</span>
<a id="__codelineno-77-14" name="__codelineno-77-14" href="#__codelineno-77-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-77-15" name="__codelineno-77-15" href="#__codelineno-77-15"></a>
<a id="__codelineno-77-16" name="__codelineno-77-16" href="#__codelineno-77-16"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsTapGesture</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-77-17" name="__codelineno-77-17" href="#__codelineno-77-17"></a><span class="w">        </span><span class="c1">// Detect tap gesture</span>
<a id="__codelineno-77-18" name="__codelineno-77-18" href="#__codelineno-77-18"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-77-19" name="__codelineno-77-19" href="#__codelineno-77-19"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Input Mapping:</strong> Maps touch and gesture inputs to game actions.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-78-1" name="__codelineno-78-1" href="#__codelineno-78-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">TouchInputMapper</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-2" name="__codelineno-78-2" href="#__codelineno-78-2"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">TouchInput</span><span class="w"> </span><span class="n">touchInput</span><span class="p">;</span>
<a id="__codelineno-78-3" name="__codelineno-78-3" href="#__codelineno-78-3"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">GestureRecognizer</span><span class="w"> </span><span class="n">gestureRecognizer</span><span class="p">;</span>
<a id="__codelineno-78-4" name="__codelineno-78-4" href="#__codelineno-78-4"></a>
<a id="__codelineno-78-5" name="__codelineno-78-5" href="#__codelineno-78-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">TouchInputMapper</span><span class="p">(</span><span class="n">TouchInput</span><span class="w"> </span><span class="n">touchInput</span><span class="p">,</span><span class="w"> </span><span class="n">GestureRecognizer</span><span class="w"> </span><span class="n">gestureRecognizer</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-6" name="__codelineno-78-6" href="#__codelineno-78-6"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">touchInput</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">touchInput</span><span class="p">;</span>
<a id="__codelineno-78-7" name="__codelineno-78-7" href="#__codelineno-78-7"></a><span class="w">        </span><span class="k">this</span><span class="p">.</span><span class="n">gestureRecognizer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">gestureRecognizer</span><span class="p">;</span>
<a id="__codelineno-78-8" name="__codelineno-78-8" href="#__codelineno-78-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-78-9" name="__codelineno-78-9" href="#__codelineno-78-9"></a>
<a id="__codelineno-78-10" name="__codelineno-78-10" href="#__codelineno-78-10"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">IsActionTriggered</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">action</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-78-11" name="__codelineno-78-11" href="#__codelineno-78-11"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Jump&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">gestureRecognizer</span><span class="p">.</span><span class="n">IsTapGesture</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<a id="__codelineno-78-12" name="__codelineno-78-12" href="#__codelineno-78-12"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">action</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;Zoom&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">gestureRecognizer</span><span class="p">.</span><span class="n">IsPinchGesture</span><span class="p">())</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="k">true</span><span class="p">;</span>
<a id="__codelineno-78-13" name="__codelineno-78-13" href="#__codelineno-78-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="k">false</span><span class="p">;</span>
<a id="__codelineno-78-14" name="__codelineno-78-14" href="#__codelineno-78-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-78-15" name="__codelineno-78-15" href="#__codelineno-78-15"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<p>By incorporating these input systems, a game engine can effectively handle various input methods, providing a seamless and responsive gaming experience across different platforms and devices.</p>
<h4 id="overview_1">Overview</h4>
<p>An effective input system in a game engine should:</p>
<ol>
<li>Abstract hardware-specific input</li>
<li>Support multiple input devices (keyboard, mouse, gamepad, etc.)</li>
<li>Allow for flexible action mapping</li>
<li>Provide both immediate and buffered input handling</li>
<li>Support input modifiers (e.g., Shift, Ctrl, Alt)</li>
<li>Be easily extensible for new input devices or actions</li>
</ol>
<p>Here's an implementation that demonstrates these concepts:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-79-1" name="__codelineno-79-1" href="#__codelineno-79-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-79-2" name="__codelineno-79-2" href="#__codelineno-79-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unordered_map&gt;</span>
<a id="__codelineno-79-3" name="__codelineno-79-3" href="#__codelineno-79-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-79-4" name="__codelineno-79-4" href="#__codelineno-79-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;functional&gt;</span>
<a id="__codelineno-79-5" name="__codelineno-79-5" href="#__codelineno-79-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-79-6" name="__codelineno-79-6" href="#__codelineno-79-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;algorithm&gt;</span>
<a id="__codelineno-79-7" name="__codelineno-79-7" href="#__codelineno-79-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdexcept&gt;</span>
<a id="__codelineno-79-8" name="__codelineno-79-8" href="#__codelineno-79-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-79-9" name="__codelineno-79-9" href="#__codelineno-79-9"></a>
<a id="__codelineno-79-10" name="__codelineno-79-10" href="#__codelineno-79-10"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">engine</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-11" name="__codelineno-79-11" href="#__codelineno-79-11"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">input</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-12" name="__codelineno-79-12" href="#__codelineno-79-12"></a>
<a id="__codelineno-79-13" name="__codelineno-79-13" href="#__codelineno-79-13"></a><span class="c1">// Forward declarations</span>
<a id="__codelineno-79-14" name="__codelineno-79-14" href="#__codelineno-79-14"></a><span class="k">class</span><span class="w"> </span><span class="nc">InputDevice</span><span class="p">;</span>
<a id="__codelineno-79-15" name="__codelineno-79-15" href="#__codelineno-79-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">InputManager</span><span class="p">;</span>
<a id="__codelineno-79-16" name="__codelineno-79-16" href="#__codelineno-79-16"></a><span class="k">class</span><span class="w"> </span><span class="nc">ActionMap</span><span class="p">;</span>
<a id="__codelineno-79-17" name="__codelineno-79-17" href="#__codelineno-79-17"></a>
<a id="__codelineno-79-18" name="__codelineno-79-18" href="#__codelineno-79-18"></a><span class="c1">// Enumeration for different types of input</span>
<a id="__codelineno-79-19" name="__codelineno-79-19" href="#__codelineno-79-19"></a><span class="k">enum</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">InputType</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-20" name="__codelineno-79-20" href="#__codelineno-79-20"></a><span class="w">  </span><span class="n">kButton</span><span class="p">,</span>
<a id="__codelineno-79-21" name="__codelineno-79-21" href="#__codelineno-79-21"></a><span class="w">  </span><span class="n">kAxis</span><span class="p">,</span>
<a id="__codelineno-79-22" name="__codelineno-79-22" href="#__codelineno-79-22"></a><span class="p">};</span>
<a id="__codelineno-79-23" name="__codelineno-79-23" href="#__codelineno-79-23"></a>
<a id="__codelineno-79-24" name="__codelineno-79-24" href="#__codelineno-79-24"></a><span class="c1">// Structure to represent an input state</span>
<a id="__codelineno-79-25" name="__codelineno-79-25" href="#__codelineno-79-25"></a><span class="k">struct</span><span class="w"> </span><span class="nc">InputState</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-26" name="__codelineno-79-26" href="#__codelineno-79-26"></a><span class="w">  </span><span class="n">InputType</span><span class="w"> </span><span class="n">type</span><span class="p">;</span>
<a id="__codelineno-79-27" name="__codelineno-79-27" href="#__codelineno-79-27"></a><span class="w">  </span><span class="k">union</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-28" name="__codelineno-79-28" href="#__codelineno-79-28"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">button_state</span><span class="p">;</span>
<a id="__codelineno-79-29" name="__codelineno-79-29" href="#__codelineno-79-29"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">axis_value</span><span class="p">;</span>
<a id="__codelineno-79-30" name="__codelineno-79-30" href="#__codelineno-79-30"></a><span class="w">  </span><span class="p">};</span>
<a id="__codelineno-79-31" name="__codelineno-79-31" href="#__codelineno-79-31"></a><span class="p">};</span>
<a id="__codelineno-79-32" name="__codelineno-79-32" href="#__codelineno-79-32"></a>
<a id="__codelineno-79-33" name="__codelineno-79-33" href="#__codelineno-79-33"></a><span class="c1">// Class to represent an input device (e.g., keyboard, mouse, gamepad)</span>
<a id="__codelineno-79-34" name="__codelineno-79-34" href="#__codelineno-79-34"></a><span class="k">class</span><span class="w"> </span><span class="nc">InputDevice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-35" name="__codelineno-79-35" href="#__codelineno-79-35"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-79-36" name="__codelineno-79-36" href="#__codelineno-79-36"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">InputDevice</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-79-37" name="__codelineno-79-37" href="#__codelineno-79-37"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Update</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-79-38" name="__codelineno-79-38" href="#__codelineno-79-38"></a><span class="w">  </span><span class="k">virtual</span><span class="w"> </span><span class="n">InputState</span><span class="w"> </span><span class="nf">GetState</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">input_name</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-79-39" name="__codelineno-79-39" href="#__codelineno-79-39"></a><span class="p">};</span>
<a id="__codelineno-79-40" name="__codelineno-79-40" href="#__codelineno-79-40"></a>
<a id="__codelineno-79-41" name="__codelineno-79-41" href="#__codelineno-79-41"></a><span class="c1">// Keyboard input device</span>
<a id="__codelineno-79-42" name="__codelineno-79-42" href="#__codelineno-79-42"></a><span class="k">class</span><span class="w"> </span><span class="nc">Keyboard</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">InputDevice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-43" name="__codelineno-79-43" href="#__codelineno-79-43"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-79-44" name="__codelineno-79-44" href="#__codelineno-79-44"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">Update</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-45" name="__codelineno-79-45" href="#__codelineno-79-45"></a><span class="w">    </span><span class="c1">// In a real implementation, this would update the keyboard state</span>
<a id="__codelineno-79-46" name="__codelineno-79-46" href="#__codelineno-79-46"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Updating keyboard state</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-79-47" name="__codelineno-79-47" href="#__codelineno-79-47"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-79-48" name="__codelineno-79-48" href="#__codelineno-79-48"></a>
<a id="__codelineno-79-49" name="__codelineno-79-49" href="#__codelineno-79-49"></a><span class="w">  </span><span class="n">InputState</span><span class="w"> </span><span class="n">GetState</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">input_name</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-50" name="__codelineno-79-50" href="#__codelineno-79-50"></a><span class="w">    </span><span class="c1">// Simulated keyboard input</span>
<a id="__codelineno-79-51" name="__codelineno-79-51" href="#__codelineno-79-51"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">input_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-52" name="__codelineno-79-52" href="#__codelineno-79-52"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">InputType</span><span class="o">::</span><span class="n">kButton</span><span class="p">,</span><span class="w"> </span><span class="p">{.</span><span class="n">button_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">}};</span>
<a id="__codelineno-79-53" name="__codelineno-79-53" href="#__codelineno-79-53"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-79-54" name="__codelineno-79-54" href="#__codelineno-79-54"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">InputType</span><span class="o">::</span><span class="n">kButton</span><span class="p">,</span><span class="w"> </span><span class="p">{.</span><span class="n">button_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">}};</span>
<a id="__codelineno-79-55" name="__codelineno-79-55" href="#__codelineno-79-55"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-79-56" name="__codelineno-79-56" href="#__codelineno-79-56"></a><span class="p">};</span>
<a id="__codelineno-79-57" name="__codelineno-79-57" href="#__codelineno-79-57"></a>
<a id="__codelineno-79-58" name="__codelineno-79-58" href="#__codelineno-79-58"></a><span class="c1">// Mouse input device</span>
<a id="__codelineno-79-59" name="__codelineno-79-59" href="#__codelineno-79-59"></a><span class="k">class</span><span class="w"> </span><span class="nc">Mouse</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">InputDevice</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-60" name="__codelineno-79-60" href="#__codelineno-79-60"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-79-61" name="__codelineno-79-61" href="#__codelineno-79-61"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">Update</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-62" name="__codelineno-79-62" href="#__codelineno-79-62"></a><span class="w">    </span><span class="c1">// In a real implementation, this would update the mouse state</span>
<a id="__codelineno-79-63" name="__codelineno-79-63" href="#__codelineno-79-63"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Updating mouse state</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-79-64" name="__codelineno-79-64" href="#__codelineno-79-64"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-79-65" name="__codelineno-79-65" href="#__codelineno-79-65"></a>
<a id="__codelineno-79-66" name="__codelineno-79-66" href="#__codelineno-79-66"></a><span class="w">  </span><span class="n">InputState</span><span class="w"> </span><span class="n">GetState</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">input_name</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-67" name="__codelineno-79-67" href="#__codelineno-79-67"></a><span class="w">    </span><span class="c1">// Simulated mouse input</span>
<a id="__codelineno-79-68" name="__codelineno-79-68" href="#__codelineno-79-68"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">input_name</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s">&quot;MouseX&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-69" name="__codelineno-79-69" href="#__codelineno-79-69"></a><span class="w">      </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">InputType</span><span class="o">::</span><span class="n">kAxis</span><span class="p">,</span><span class="w"> </span><span class="p">{.</span><span class="n">axis_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.5f</span><span class="p">}};</span>
<a id="__codelineno-79-70" name="__codelineno-79-70" href="#__codelineno-79-70"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-79-71" name="__codelineno-79-71" href="#__codelineno-79-71"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">InputType</span><span class="o">::</span><span class="n">kAxis</span><span class="p">,</span><span class="w"> </span><span class="p">{.</span><span class="n">axis_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">}};</span>
<a id="__codelineno-79-72" name="__codelineno-79-72" href="#__codelineno-79-72"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-79-73" name="__codelineno-79-73" href="#__codelineno-79-73"></a><span class="p">};</span>
<a id="__codelineno-79-74" name="__codelineno-79-74" href="#__codelineno-79-74"></a>
<a id="__codelineno-79-75" name="__codelineno-79-75" href="#__codelineno-79-75"></a><span class="c1">// Class to manage input devices and handle input mapping</span>
<a id="__codelineno-79-76" name="__codelineno-79-76" href="#__codelineno-79-76"></a><span class="k">class</span><span class="w"> </span><span class="nc">InputManager</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-77" name="__codelineno-79-77" href="#__codelineno-79-77"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-79-78" name="__codelineno-79-78" href="#__codelineno-79-78"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">AddDevice</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">InputDevice</span><span class="o">&gt;</span><span class="w"> </span><span class="n">device</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-79" name="__codelineno-79-79" href="#__codelineno-79-79"></a><span class="w">    </span><span class="n">devices_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">device</span><span class="p">));</span>
<a id="__codelineno-79-80" name="__codelineno-79-80" href="#__codelineno-79-80"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-79-81" name="__codelineno-79-81" href="#__codelineno-79-81"></a>
<a id="__codelineno-79-82" name="__codelineno-79-82" href="#__codelineno-79-82"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">Update</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-83" name="__codelineno-79-83" href="#__codelineno-79-83"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">devices_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-84" name="__codelineno-79-84" href="#__codelineno-79-84"></a><span class="w">      </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">Update</span><span class="p">();</span>
<a id="__codelineno-79-85" name="__codelineno-79-85" href="#__codelineno-79-85"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-79-86" name="__codelineno-79-86" href="#__codelineno-79-86"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-79-87" name="__codelineno-79-87" href="#__codelineno-79-87"></a>
<a id="__codelineno-79-88" name="__codelineno-79-88" href="#__codelineno-79-88"></a><span class="w">  </span><span class="n">InputState</span><span class="w"> </span><span class="n">GetState</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">input_name</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-89" name="__codelineno-79-89" href="#__codelineno-79-89"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">device</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">devices_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-90" name="__codelineno-79-90" href="#__codelineno-79-90"></a><span class="w">      </span><span class="n">InputState</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">device</span><span class="o">-&gt;</span><span class="n">GetState</span><span class="p">(</span><span class="n">input_name</span><span class="p">);</span>
<a id="__codelineno-79-91" name="__codelineno-79-91" href="#__codelineno-79-91"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InputType</span><span class="o">::</span><span class="n">kButton</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">button_state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-92" name="__codelineno-79-92" href="#__codelineno-79-92"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">state</span><span class="p">;</span>
<a id="__codelineno-79-93" name="__codelineno-79-93" href="#__codelineno-79-93"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-79-94" name="__codelineno-79-94" href="#__codelineno-79-94"></a><span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">InputType</span><span class="o">::</span><span class="n">kAxis</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">axis_value</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mf">0.0f</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-95" name="__codelineno-79-95" href="#__codelineno-79-95"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">state</span><span class="p">;</span>
<a id="__codelineno-79-96" name="__codelineno-79-96" href="#__codelineno-79-96"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-79-97" name="__codelineno-79-97" href="#__codelineno-79-97"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-79-98" name="__codelineno-79-98" href="#__codelineno-79-98"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="p">{</span><span class="n">InputType</span><span class="o">::</span><span class="n">kButton</span><span class="p">,</span><span class="w"> </span><span class="p">{.</span><span class="n">button_state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">}};</span>
<a id="__codelineno-79-99" name="__codelineno-79-99" href="#__codelineno-79-99"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-79-100" name="__codelineno-79-100" href="#__codelineno-79-100"></a>
<a id="__codelineno-79-101" name="__codelineno-79-101" href="#__codelineno-79-101"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-79-102" name="__codelineno-79-102" href="#__codelineno-79-102"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">InputDevice</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">devices_</span><span class="p">;</span>
<a id="__codelineno-79-103" name="__codelineno-79-103" href="#__codelineno-79-103"></a><span class="p">};</span>
<a id="__codelineno-79-104" name="__codelineno-79-104" href="#__codelineno-79-104"></a>
<a id="__codelineno-79-105" name="__codelineno-79-105" href="#__codelineno-79-105"></a><span class="c1">// Class to represent an action mapping</span>
<a id="__codelineno-79-106" name="__codelineno-79-106" href="#__codelineno-79-106"></a><span class="k">class</span><span class="w"> </span><span class="nc">ActionMap</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-107" name="__codelineno-79-107" href="#__codelineno-79-107"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-79-108" name="__codelineno-79-108" href="#__codelineno-79-108"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">MapAction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">action_name</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">input_name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-109" name="__codelineno-79-109" href="#__codelineno-79-109"></a><span class="w">    </span><span class="n">action_map_</span><span class="p">[</span><span class="n">action_name</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">input_name</span><span class="p">;</span>
<a id="__codelineno-79-110" name="__codelineno-79-110" href="#__codelineno-79-110"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-79-111" name="__codelineno-79-111" href="#__codelineno-79-111"></a>
<a id="__codelineno-79-112" name="__codelineno-79-112" href="#__codelineno-79-112"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">UnmapAction</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">action_name</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-113" name="__codelineno-79-113" href="#__codelineno-79-113"></a><span class="w">    </span><span class="n">action_map_</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">action_name</span><span class="p">);</span>
<a id="__codelineno-79-114" name="__codelineno-79-114" href="#__codelineno-79-114"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-79-115" name="__codelineno-79-115" href="#__codelineno-79-115"></a>
<a id="__codelineno-79-116" name="__codelineno-79-116" href="#__codelineno-79-116"></a><span class="w">  </span><span class="n">InputState</span><span class="w"> </span><span class="n">GetActionState</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">InputManager</span><span class="o">&amp;</span><span class="w"> </span><span class="n">input_manager</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">action_name</span><span class="p">)</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-117" name="__codelineno-79-117" href="#__codelineno-79-117"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">action_map_</span><span class="p">.</span><span class="n">find</span><span class="p">(</span><span class="n">action_name</span><span class="p">);</span>
<a id="__codelineno-79-118" name="__codelineno-79-118" href="#__codelineno-79-118"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">it</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">action_map_</span><span class="p">.</span><span class="n">end</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-119" name="__codelineno-79-119" href="#__codelineno-79-119"></a><span class="w">      </span><span class="k">throw</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;Action not mapped: &quot;</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">action_name</span><span class="p">);</span>
<a id="__codelineno-79-120" name="__codelineno-79-120" href="#__codelineno-79-120"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-79-121" name="__codelineno-79-121" href="#__codelineno-79-121"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">input_manager</span><span class="p">.</span><span class="n">GetState</span><span class="p">(</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">second</span><span class="p">);</span>
<a id="__codelineno-79-122" name="__codelineno-79-122" href="#__codelineno-79-122"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-79-123" name="__codelineno-79-123" href="#__codelineno-79-123"></a>
<a id="__codelineno-79-124" name="__codelineno-79-124" href="#__codelineno-79-124"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-79-125" name="__codelineno-79-125" href="#__codelineno-79-125"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span><span class="w"> </span><span class="n">action_map_</span><span class="p">;</span>
<a id="__codelineno-79-126" name="__codelineno-79-126" href="#__codelineno-79-126"></a><span class="p">};</span>
<a id="__codelineno-79-127" name="__codelineno-79-127" href="#__codelineno-79-127"></a>
<a id="__codelineno-79-128" name="__codelineno-79-128" href="#__codelineno-79-128"></a><span class="c1">// Class to handle input context (e.g., menu input, gameplay input)</span>
<a id="__codelineno-79-129" name="__codelineno-79-129" href="#__codelineno-79-129"></a><span class="k">class</span><span class="w"> </span><span class="nc">InputContext</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-130" name="__codelineno-79-130" href="#__codelineno-79-130"></a><span class="w"> </span><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-79-131" name="__codelineno-79-131" href="#__codelineno-79-131"></a><span class="w">  </span><span class="n">InputContext</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ActionMap</span><span class="o">&gt;</span><span class="w"> </span><span class="n">action_map</span><span class="p">)</span>
<a id="__codelineno-79-132" name="__codelineno-79-132" href="#__codelineno-79-132"></a><span class="w">      </span><span class="o">:</span><span class="w"> </span><span class="n">action_map_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">action_map</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-79-133" name="__codelineno-79-133" href="#__codelineno-79-133"></a>
<a id="__codelineno-79-134" name="__codelineno-79-134" href="#__codelineno-79-134"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">AddCallback</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">action_name</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">InputState</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span><span class="w"> </span><span class="n">callback</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-135" name="__codelineno-79-135" href="#__codelineno-79-135"></a><span class="w">    </span><span class="n">callbacks_</span><span class="p">[</span><span class="n">action_name</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">callback</span><span class="p">));</span>
<a id="__codelineno-79-136" name="__codelineno-79-136" href="#__codelineno-79-136"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-79-137" name="__codelineno-79-137" href="#__codelineno-79-137"></a>
<a id="__codelineno-79-138" name="__codelineno-79-138" href="#__codelineno-79-138"></a><span class="w">  </span><span class="kt">void</span><span class="w"> </span><span class="n">ProcessInput</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">InputManager</span><span class="o">&amp;</span><span class="w"> </span><span class="n">input_manager</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-139" name="__codelineno-79-139" href="#__codelineno-79-139"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="p">[</span><span class="n">action_name</span><span class="p">,</span><span class="w"> </span><span class="n">callbacks</span><span class="p">]</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">callbacks_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-140" name="__codelineno-79-140" href="#__codelineno-79-140"></a><span class="w">      </span><span class="n">InputState</span><span class="w"> </span><span class="n">state</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">action_map_</span><span class="o">-&gt;</span><span class="n">GetActionState</span><span class="p">(</span><span class="n">input_manager</span><span class="p">,</span><span class="w"> </span><span class="n">action_name</span><span class="p">);</span>
<a id="__codelineno-79-141" name="__codelineno-79-141" href="#__codelineno-79-141"></a><span class="w">      </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">callback</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">callbacks</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-142" name="__codelineno-79-142" href="#__codelineno-79-142"></a><span class="w">        </span><span class="n">callback</span><span class="p">(</span><span class="n">state</span><span class="p">);</span>
<a id="__codelineno-79-143" name="__codelineno-79-143" href="#__codelineno-79-143"></a><span class="w">      </span><span class="p">}</span>
<a id="__codelineno-79-144" name="__codelineno-79-144" href="#__codelineno-79-144"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-79-145" name="__codelineno-79-145" href="#__codelineno-79-145"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-79-146" name="__codelineno-79-146" href="#__codelineno-79-146"></a>
<a id="__codelineno-79-147" name="__codelineno-79-147" href="#__codelineno-79-147"></a><span class="w"> </span><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-79-148" name="__codelineno-79-148" href="#__codelineno-79-148"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">shared_ptr</span><span class="o">&lt;</span><span class="n">ActionMap</span><span class="o">&gt;</span><span class="w"> </span><span class="n">action_map_</span><span class="p">;</span>
<a id="__codelineno-79-149" name="__codelineno-79-149" href="#__codelineno-79-149"></a><span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">unordered_map</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">InputState</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;&gt;&gt;</span><span class="w"> </span><span class="n">callbacks_</span><span class="p">;</span>
<a id="__codelineno-79-150" name="__codelineno-79-150" href="#__codelineno-79-150"></a><span class="p">};</span>
<a id="__codelineno-79-151" name="__codelineno-79-151" href="#__codelineno-79-151"></a>
<a id="__codelineno-79-152" name="__codelineno-79-152" href="#__codelineno-79-152"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace input</span>
<a id="__codelineno-79-153" name="__codelineno-79-153" href="#__codelineno-79-153"></a><span class="p">}</span><span class="w">  </span><span class="c1">// namespace engine</span>
<a id="__codelineno-79-154" name="__codelineno-79-154" href="#__codelineno-79-154"></a>
<a id="__codelineno-79-155" name="__codelineno-79-155" href="#__codelineno-79-155"></a><span class="c1">// Example usage</span>
<a id="__codelineno-79-156" name="__codelineno-79-156" href="#__codelineno-79-156"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-157" name="__codelineno-79-157" href="#__codelineno-79-157"></a><span class="w">  </span><span class="n">engine</span><span class="o">::</span><span class="n">input</span><span class="o">::</span><span class="n">InputManager</span><span class="w"> </span><span class="n">input_manager</span><span class="p">;</span>
<a id="__codelineno-79-158" name="__codelineno-79-158" href="#__codelineno-79-158"></a><span class="w">  </span><span class="n">input_manager</span><span class="p">.</span><span class="n">AddDevice</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">engine</span><span class="o">::</span><span class="n">input</span><span class="o">::</span><span class="n">Keyboard</span><span class="o">&gt;</span><span class="p">());</span>
<a id="__codelineno-79-159" name="__codelineno-79-159" href="#__codelineno-79-159"></a><span class="w">  </span><span class="n">input_manager</span><span class="p">.</span><span class="n">AddDevice</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">engine</span><span class="o">::</span><span class="n">input</span><span class="o">::</span><span class="n">Mouse</span><span class="o">&gt;</span><span class="p">());</span>
<a id="__codelineno-79-160" name="__codelineno-79-160" href="#__codelineno-79-160"></a>
<a id="__codelineno-79-161" name="__codelineno-79-161" href="#__codelineno-79-161"></a><span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">action_map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_shared</span><span class="o">&lt;</span><span class="n">engine</span><span class="o">::</span><span class="n">input</span><span class="o">::</span><span class="n">ActionMap</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-79-162" name="__codelineno-79-162" href="#__codelineno-79-162"></a><span class="w">  </span><span class="n">action_map</span><span class="o">-&gt;</span><span class="n">MapAction</span><span class="p">(</span><span class="s">&quot;Jump&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;A&quot;</span><span class="p">);</span>
<a id="__codelineno-79-163" name="__codelineno-79-163" href="#__codelineno-79-163"></a><span class="w">  </span><span class="n">action_map</span><span class="o">-&gt;</span><span class="n">MapAction</span><span class="p">(</span><span class="s">&quot;Look&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MouseX&quot;</span><span class="p">);</span>
<a id="__codelineno-79-164" name="__codelineno-79-164" href="#__codelineno-79-164"></a>
<a id="__codelineno-79-165" name="__codelineno-79-165" href="#__codelineno-79-165"></a><span class="w">  </span><span class="n">engine</span><span class="o">::</span><span class="n">input</span><span class="o">::</span><span class="n">InputContext</span><span class="w"> </span><span class="nf">gameplay_context</span><span class="p">(</span><span class="n">action_map</span><span class="p">);</span>
<a id="__codelineno-79-166" name="__codelineno-79-166" href="#__codelineno-79-166"></a><span class="w">  </span><span class="n">gameplay_context</span><span class="p">.</span><span class="n">AddCallback</span><span class="p">(</span><span class="s">&quot;Jump&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="k">const</span><span class="w"> </span><span class="n">engine</span><span class="o">::</span><span class="n">input</span><span class="o">::</span><span class="n">InputState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-167" name="__codelineno-79-167" href="#__codelineno-79-167"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">engine</span><span class="o">::</span><span class="n">input</span><span class="o">::</span><span class="n">InputType</span><span class="o">::</span><span class="n">kButton</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">button_state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-168" name="__codelineno-79-168" href="#__codelineno-79-168"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Player jumped!</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-79-169" name="__codelineno-79-169" href="#__codelineno-79-169"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-79-170" name="__codelineno-79-170" href="#__codelineno-79-170"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-79-171" name="__codelineno-79-171" href="#__codelineno-79-171"></a>
<a id="__codelineno-79-172" name="__codelineno-79-172" href="#__codelineno-79-172"></a><span class="w">  </span><span class="n">gameplay_context</span><span class="p">.</span><span class="n">AddCallback</span><span class="p">(</span><span class="s">&quot;Look&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">[](</span><span class="k">const</span><span class="w"> </span><span class="n">engine</span><span class="o">::</span><span class="n">input</span><span class="o">::</span><span class="n">InputState</span><span class="o">&amp;</span><span class="w"> </span><span class="n">state</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-173" name="__codelineno-79-173" href="#__codelineno-79-173"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">state</span><span class="p">.</span><span class="n">type</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">engine</span><span class="o">::</span><span class="n">input</span><span class="o">::</span><span class="n">InputType</span><span class="o">::</span><span class="n">kAxis</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-174" name="__codelineno-79-174" href="#__codelineno-79-174"></a><span class="w">      </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Player looked with value: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">state</span><span class="p">.</span><span class="n">axis_value</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-79-175" name="__codelineno-79-175" href="#__codelineno-79-175"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-79-176" name="__codelineno-79-176" href="#__codelineno-79-176"></a><span class="w">  </span><span class="p">});</span>
<a id="__codelineno-79-177" name="__codelineno-79-177" href="#__codelineno-79-177"></a>
<a id="__codelineno-79-178" name="__codelineno-79-178" href="#__codelineno-79-178"></a><span class="w">  </span><span class="c1">// Main game loop</span>
<a id="__codelineno-79-179" name="__codelineno-79-179" href="#__codelineno-79-179"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">3</span><span class="p">;</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-79-180" name="__codelineno-79-180" href="#__codelineno-79-180"></a><span class="w">    </span><span class="n">input_manager</span><span class="p">.</span><span class="n">Update</span><span class="p">();</span>
<a id="__codelineno-79-181" name="__codelineno-79-181" href="#__codelineno-79-181"></a><span class="w">    </span><span class="n">gameplay_context</span><span class="p">.</span><span class="n">ProcessInput</span><span class="p">(</span><span class="n">input_manager</span><span class="p">);</span>
<a id="__codelineno-79-182" name="__codelineno-79-182" href="#__codelineno-79-182"></a><span class="w">  </span><span class="p">}</span>
<a id="__codelineno-79-183" name="__codelineno-79-183" href="#__codelineno-79-183"></a>
<a id="__codelineno-79-184" name="__codelineno-79-184" href="#__codelineno-79-184"></a><span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-79-185" name="__codelineno-79-185" href="#__codelineno-79-185"></a><span class="p">}</span>
</code></pre></div>
<p>This implementation demonstrates several key concepts:</p>
<ol>
<li>An <code>InputDevice</code> interface for abstracting different input devices.</li>
<li>Concrete implementations for <code>Keyboard</code> and <code>Mouse</code> devices.</li>
<li>An <code>InputManager</code> class that manages multiple input devices and provides a unified interface for querying input states.</li>
<li>An <code>ActionMap</code> class that handles mapping between game actions and specific inputs.</li>
<li>An <code>InputContext</code> class that manages callbacks for different actions in a specific game context (e.g., gameplay, menu).</li>
<li>Support for both button (boolean) and axis (float) input types.</li>
</ol>
<p>The code follows best practices such as:</p>
<ul>
<li>Using namespaces to organize code.</li>
<li>Employing the PIMPL idiom to hide implementation details.</li>
<li>Using smart pointers for memory management.</li>
<li>Utilizing polymorphism for different input devices.</li>
<li>Implementing a flexible callback system for action handling.</li>
<li>Using enums for type safety.</li>
</ul>
<p>This implementation provides a solid foundation for an input system in a game engine. In a real-world scenario, you might want to extend this system with features like:</p>
<ul>
<li>Support for more input devices (e.g., gamepad, touch screen).</li>
<li>Input modifiers (e.g., Shift, Ctrl, Alt).</li>
<li>Input buffering for frame-independent input handling.</li>
<li>Support for analog buttons (e.g., trigger buttons on gamepads).</li>
<li>Input recording and playback for debugging or replays.</li>
<li>Integration with a user interface system for rebinding controls.</li>
<li>Support for multiple simultaneous input contexts (e.g., gameplay and UI at the same time).</li>
</ul>
<h3 id="scripting-system">Scripting System</h3>
<h4 id="scripting-language-integration">Scripting Language Integration</h4>
<p>Integrating a scripting language into a game engine allows developers to write game logic and other features in a more flexible and dynamic manner than using the engine's core language. Popular scripting languages include Lua, Python, and JavaScript.</p>
<ul>
<li>
<p><strong>Choosing a Scripting Language:</strong> Considerations include ease of use, performance, and community support. Lua is commonly used due to its lightweight nature and fast execution.</p>
</li>
<li>
<p><strong>Embedding a Scripting Language:</strong> Integrate the scripting language runtime into the game engine, enabling the execution of scripts.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-80-1" name="__codelineno-80-1" href="#__codelineno-80-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">LuaScriptEngine</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-80-2" name="__codelineno-80-2" href="#__codelineno-80-2"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">Lua</span><span class="w"> </span><span class="n">lua</span><span class="p">;</span>
<a id="__codelineno-80-3" name="__codelineno-80-3" href="#__codelineno-80-3"></a>
<a id="__codelineno-80-4" name="__codelineno-80-4" href="#__codelineno-80-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">LuaScriptEngine</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-80-5" name="__codelineno-80-5" href="#__codelineno-80-5"></a><span class="w">        </span><span class="n">lua</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Lua</span><span class="p">();</span>
<a id="__codelineno-80-6" name="__codelineno-80-6" href="#__codelineno-80-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-80-7" name="__codelineno-80-7" href="#__codelineno-80-7"></a>
<a id="__codelineno-80-8" name="__codelineno-80-8" href="#__codelineno-80-8"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ExecuteScript</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">script</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-80-9" name="__codelineno-80-9" href="#__codelineno-80-9"></a><span class="w">        </span><span class="n">lua</span><span class="p">.</span><span class="n">DoString</span><span class="p">(</span><span class="n">script</span><span class="p">);</span>
<a id="__codelineno-80-10" name="__codelineno-80-10" href="#__codelineno-80-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-80-11" name="__codelineno-80-11" href="#__codelineno-80-11"></a>
<a id="__codelineno-80-12" name="__codelineno-80-12" href="#__codelineno-80-12"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">RegisterFunction</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">functionName</span><span class="p">,</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="n">function</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-80-13" name="__codelineno-80-13" href="#__codelineno-80-13"></a><span class="w">        </span><span class="n">lua</span><span class="p">.</span><span class="n">RegisterFunction</span><span class="p">(</span><span class="n">functionName</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">.</span><span class="n">Target</span><span class="p">,</span><span class="w"> </span><span class="n">function</span><span class="p">.</span><span class="n">Method</span><span class="p">);</span>
<a id="__codelineno-80-14" name="__codelineno-80-14" href="#__codelineno-80-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-80-15" name="__codelineno-80-15" href="#__codelineno-80-15"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Binding Engine Functions:</strong> Expose engine functionalities to the scripting language so that scripts can interact with the game engine.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-81-1" name="__codelineno-81-1" href="#__codelineno-81-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">GameEngine</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-81-2" name="__codelineno-81-2" href="#__codelineno-81-2"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">LuaScriptEngine</span><span class="w"> </span><span class="n">scriptEngine</span><span class="p">;</span>
<a id="__codelineno-81-3" name="__codelineno-81-3" href="#__codelineno-81-3"></a>
<a id="__codelineno-81-4" name="__codelineno-81-4" href="#__codelineno-81-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="nf">GameEngine</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-81-5" name="__codelineno-81-5" href="#__codelineno-81-5"></a><span class="w">        </span><span class="n">scriptEngine</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">LuaScriptEngine</span><span class="p">();</span>
<a id="__codelineno-81-6" name="__codelineno-81-6" href="#__codelineno-81-6"></a><span class="w">        </span><span class="n">scriptEngine</span><span class="p">.</span><span class="n">RegisterFunction</span><span class="p">(</span><span class="s">&quot;MovePlayer&quot;</span><span class="p">,</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Action</span><span class="o">&lt;</span><span class="kt">float</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">MovePlayer</span><span class="p">));</span>
<a id="__codelineno-81-7" name="__codelineno-81-7" href="#__codelineno-81-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-81-8" name="__codelineno-81-8" href="#__codelineno-81-8"></a>
<a id="__codelineno-81-9" name="__codelineno-81-9" href="#__codelineno-81-9"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">MovePlayer</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">y</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-81-10" name="__codelineno-81-10" href="#__codelineno-81-10"></a><span class="w">        </span><span class="c1">// Implementation of player movement</span>
<a id="__codelineno-81-11" name="__codelineno-81-11" href="#__codelineno-81-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-81-12" name="__codelineno-81-12" href="#__codelineno-81-12"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="game-logic-implementation">Game Logic Implementation</h4>
<p>Game logic, which defines the rules and behaviors of the game, can be implemented using the scripting language to allow for quick iteration and easier modifications.</p>
<ul>
<li>
<p><strong>Scripted Behaviors:</strong> Write scripts to control character behaviors, game events, and other dynamic elements.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-82-1" name="__codelineno-82-1" href="#__codelineno-82-1"></a><span class="c1">-- player.lua</span>
<a id="__codelineno-82-2" name="__codelineno-82-2" href="#__codelineno-82-2"></a><span class="kr">function</span> <span class="nf">MovePlayer</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a id="__codelineno-82-3" name="__codelineno-82-3" href="#__codelineno-82-3"></a>    <span class="n">player</span><span class="p">:</span><span class="n">SetPosition</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
<a id="__codelineno-82-4" name="__codelineno-82-4" href="#__codelineno-82-4"></a><span class="kr">end</span>
<a id="__codelineno-82-5" name="__codelineno-82-5" href="#__codelineno-82-5"></a>
<a id="__codelineno-82-6" name="__codelineno-82-6" href="#__codelineno-82-6"></a><span class="kr">function</span> <span class="nf">OnCollision</span><span class="p">(</span><span class="n">player</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
<a id="__codelineno-82-7" name="__codelineno-82-7" href="#__codelineno-82-7"></a>    <span class="kr">if</span> <span class="n">other</span><span class="p">:</span><span class="n">IsEnemy</span><span class="p">()</span> <span class="kr">then</span>
<a id="__codelineno-82-8" name="__codelineno-82-8" href="#__codelineno-82-8"></a>        <span class="n">player</span><span class="p">:</span><span class="n">TakeDamage</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-82-9" name="__codelineno-82-9" href="#__codelineno-82-9"></a>    <span class="kr">end</span>
<a id="__codelineno-82-10" name="__codelineno-82-10" href="#__codelineno-82-10"></a><span class="kr">end</span>
</code></pre></div>
</li>
<li>
<p><strong>Event Handling:</strong> Use scripts to respond to in-game events, such as collisions, triggers, and user input.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-83-1" name="__codelineno-83-1" href="#__codelineno-83-1"></a><span class="c1">-- event_handler.lua</span>
<a id="__codelineno-83-2" name="__codelineno-83-2" href="#__codelineno-83-2"></a><span class="kr">function</span> <span class="nf">OnEnemyDefeated</span><span class="p">(</span><span class="n">enemy</span><span class="p">)</span>
<a id="__codelineno-83-3" name="__codelineno-83-3" href="#__codelineno-83-3"></a>    <span class="n">Game</span><span class="p">:</span><span class="n">SpawnLoot</span><span class="p">(</span><span class="n">enemy</span><span class="p">:</span><span class="n">GetPosition</span><span class="p">())</span>
<a id="__codelineno-83-4" name="__codelineno-83-4" href="#__codelineno-83-4"></a>    <span class="n">Game</span><span class="p">:</span><span class="n">IncreaseScore</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
<a id="__codelineno-83-5" name="__codelineno-83-5" href="#__codelineno-83-5"></a><span class="kr">end</span>
</code></pre></div>
</li>
<li>
<p><strong>State Management:</strong> Manage game states and transitions through scripts, allowing for more complex and adaptable gameplay.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-84-1" name="__codelineno-84-1" href="#__codelineno-84-1"></a><span class="c1">-- game_state.lua</span>
<a id="__codelineno-84-2" name="__codelineno-84-2" href="#__codelineno-84-2"></a><span class="kr">function</span> <span class="nf">OnEnterState</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<a id="__codelineno-84-3" name="__codelineno-84-3" href="#__codelineno-84-3"></a>    <span class="kr">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;MainMenu&quot;</span> <span class="kr">then</span>
<a id="__codelineno-84-4" name="__codelineno-84-4" href="#__codelineno-84-4"></a>        <span class="n">UI</span><span class="p">:</span><span class="n">ShowMainMenu</span><span class="p">()</span>
<a id="__codelineno-84-5" name="__codelineno-84-5" href="#__codelineno-84-5"></a>    <span class="kr">elseif</span> <span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;Gameplay&quot;</span> <span class="kr">then</span>
<a id="__codelineno-84-6" name="__codelineno-84-6" href="#__codelineno-84-6"></a>        <span class="n">Game</span><span class="p">:</span><span class="n">StartLevel</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-84-7" name="__codelineno-84-7" href="#__codelineno-84-7"></a>    <span class="kr">end</span>
<a id="__codelineno-84-8" name="__codelineno-84-8" href="#__codelineno-84-8"></a><span class="kr">end</span>
<a id="__codelineno-84-9" name="__codelineno-84-9" href="#__codelineno-84-9"></a>
<a id="__codelineno-84-10" name="__codelineno-84-10" href="#__codelineno-84-10"></a><span class="kr">function</span> <span class="nf">OnExitState</span><span class="p">(</span><span class="n">state</span><span class="p">)</span>
<a id="__codelineno-84-11" name="__codelineno-84-11" href="#__codelineno-84-11"></a>    <span class="kr">if</span> <span class="n">state</span> <span class="o">==</span> <span class="s2">&quot;Gameplay&quot;</span> <span class="kr">then</span>
<a id="__codelineno-84-12" name="__codelineno-84-12" href="#__codelineno-84-12"></a>        <span class="n">Game</span><span class="p">:</span><span class="n">SaveProgress</span><span class="p">()</span>
<a id="__codelineno-84-13" name="__codelineno-84-13" href="#__codelineno-84-13"></a>    <span class="kr">end</span>
<a id="__codelineno-84-14" name="__codelineno-84-14" href="#__codelineno-84-14"></a><span class="kr">end</span>
</code></pre></div>
</li>
</ul>
<h4 id="modding-support">Modding Support</h4>
<p>Supporting mods allows players to extend and modify the game, creating new content and features, which can greatly increase the game's longevity and community engagement.</p>
<ul>
<li>
<p><strong>Modding API:</strong> Provide a well-documented API that modders can use to interact with the game engine.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-85-1" name="__codelineno-85-1" href="#__codelineno-85-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ModdingAPI</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-85-2" name="__codelineno-85-2" href="#__codelineno-85-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">RegisterMod</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">modName</span><span class="p">,</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="n">initFunction</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-85-3" name="__codelineno-85-3" href="#__codelineno-85-3"></a><span class="w">        </span><span class="c1">// Register the mod and its initialization function</span>
<a id="__codelineno-85-4" name="__codelineno-85-4" href="#__codelineno-85-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-85-5" name="__codelineno-85-5" href="#__codelineno-85-5"></a>
<a id="__codelineno-85-6" name="__codelineno-85-6" href="#__codelineno-85-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">RegisterCommand</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">commandName</span><span class="p">,</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="n">commandFunction</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-85-7" name="__codelineno-85-7" href="#__codelineno-85-7"></a><span class="w">        </span><span class="c1">// Register a custom command for the mod</span>
<a id="__codelineno-85-8" name="__codelineno-85-8" href="#__codelineno-85-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-85-9" name="__codelineno-85-9" href="#__codelineno-85-9"></a>
<a id="__codelineno-85-10" name="__codelineno-85-10" href="#__codelineno-85-10"></a><span class="w">    </span><span class="c1">// Other API functions for modders</span>
<a id="__codelineno-85-11" name="__codelineno-85-11" href="#__codelineno-85-11"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Loading Mods:</strong> Load and initialize mods at runtime, allowing for dynamic changes and extensions.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-86-1" name="__codelineno-86-1" href="#__codelineno-86-1"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">ModLoader</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-2" name="__codelineno-86-2" href="#__codelineno-86-2"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Mod</span><span class="o">&gt;</span><span class="w"> </span><span class="n">mods</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Mod</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-86-3" name="__codelineno-86-3" href="#__codelineno-86-3"></a>
<a id="__codelineno-86-4" name="__codelineno-86-4" href="#__codelineno-86-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">LoadMod</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">modPath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-5" name="__codelineno-86-5" href="#__codelineno-86-5"></a><span class="w">        </span><span class="c1">// Load the mod from the specified path</span>
<a id="__codelineno-86-6" name="__codelineno-86-6" href="#__codelineno-86-6"></a><span class="w">        </span><span class="c1">// Initialize the mod and register its functions</span>
<a id="__codelineno-86-7" name="__codelineno-86-7" href="#__codelineno-86-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-86-8" name="__codelineno-86-8" href="#__codelineno-86-8"></a>
<a id="__codelineno-86-9" name="__codelineno-86-9" href="#__codelineno-86-9"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">InitializeMods</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-10" name="__codelineno-86-10" href="#__codelineno-86-10"></a><span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">mod</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">mods</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-11" name="__codelineno-86-11" href="#__codelineno-86-11"></a><span class="w">            </span><span class="n">mod</span><span class="p">.</span><span class="n">Initialize</span><span class="p">();</span>
<a id="__codelineno-86-12" name="__codelineno-86-12" href="#__codelineno-86-12"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-86-13" name="__codelineno-86-13" href="#__codelineno-86-13"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-86-14" name="__codelineno-86-14" href="#__codelineno-86-14"></a><span class="p">}</span>
<a id="__codelineno-86-15" name="__codelineno-86-15" href="#__codelineno-86-15"></a>
<a id="__codelineno-86-16" name="__codelineno-86-16" href="#__codelineno-86-16"></a><span class="k">public</span><span class="w"> </span><span class="k">class</span><span class="w"> </span><span class="nc">Mod</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-86-17" name="__codelineno-86-17" href="#__codelineno-86-17"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">Name</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-86-18" name="__codelineno-86-18" href="#__codelineno-86-18"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Action</span><span class="w"> </span><span class="n">Initialize</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-86-19" name="__codelineno-86-19" href="#__codelineno-86-19"></a>
<a id="__codelineno-86-20" name="__codelineno-86-20" href="#__codelineno-86-20"></a><span class="w">    </span><span class="c1">// Other mod properties and methods</span>
<a id="__codelineno-86-21" name="__codelineno-86-21" href="#__codelineno-86-21"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Script-Based Modding:</strong> Allow modders to write scripts to create custom game logic, behaviors, and content.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-87-1" name="__codelineno-87-1" href="#__codelineno-87-1"></a><span class="c1">-- custom_mod.lua</span>
<a id="__codelineno-87-2" name="__codelineno-87-2" href="#__codelineno-87-2"></a><span class="kr">function</span> <span class="nf">Initialize</span><span class="p">()</span>
<a id="__codelineno-87-3" name="__codelineno-87-3" href="#__codelineno-87-3"></a>    <span class="n">ModdingAPI</span><span class="p">:</span><span class="n">RegisterCommand</span><span class="p">(</span><span class="s2">&quot;SpawnEnemy&quot;</span><span class="p">,</span> <span class="kr">function</span><span class="p">()</span>
<a id="__codelineno-87-4" name="__codelineno-87-4" href="#__codelineno-87-4"></a>        <span class="n">Game</span><span class="p">:</span><span class="n">SpawnEnemy</span><span class="p">(</span><span class="s2">&quot;Orc&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-87-5" name="__codelineno-87-5" href="#__codelineno-87-5"></a>    <span class="kr">end</span><span class="p">)</span>
<a id="__codelineno-87-6" name="__codelineno-87-6" href="#__codelineno-87-6"></a><span class="kr">end</span>
<a id="__codelineno-87-7" name="__codelineno-87-7" href="#__codelineno-87-7"></a>
<a id="__codelineno-87-8" name="__codelineno-87-8" href="#__codelineno-87-8"></a><span class="n">ModdingAPI</span><span class="p">:</span><span class="n">RegisterMod</span><span class="p">(</span><span class="s2">&quot;CustomMod&quot;</span><span class="p">,</span> <span class="n">Initialize</span><span class="p">)</span>
</code></pre></div>
</li>
</ul>
<p>By incorporating a robust scripting system, game developers can create more dynamic and flexible game logic, while also providing modding support to empower the community to enhance and extend the game.</p>
<h3 id="networking">Networking</h3>
<h4 id="client-server-architecture">Client-Server Architecture</h4>
<p>In a client-server architecture, the game logic is primarily processed on a central server, while clients connect to this server to send and receive game data. This architecture helps ensure consistency and control over the game state.</p>
<ul>
<li>
<p><strong>Server:</strong> Manages the game state, processes client inputs, and sends updates to clients.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-88-1" name="__codelineno-88-1" href="#__codelineno-88-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">GameServer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-88-2" name="__codelineno-88-2" href="#__codelineno-88-2"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ClientConnection</span><span class="o">&gt;</span><span class="w"> </span><span class="n">clients</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">ClientConnection</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-88-3" name="__codelineno-88-3" href="#__codelineno-88-3"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">GameState</span><span class="w"> </span><span class="n">gameState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GameState</span><span class="p">();</span>
<a id="__codelineno-88-4" name="__codelineno-88-4" href="#__codelineno-88-4"></a>
<a id="__codelineno-88-5" name="__codelineno-88-5" href="#__codelineno-88-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">StartServer</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-88-6" name="__codelineno-88-6" href="#__codelineno-88-6"></a><span class="w">        </span><span class="c1">// Initialize server and start listening for client connections</span>
<a id="__codelineno-88-7" name="__codelineno-88-7" href="#__codelineno-88-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-88-8" name="__codelineno-88-8" href="#__codelineno-88-8"></a>
<a id="__codelineno-88-9" name="__codelineno-88-9" href="#__codelineno-88-9"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnClientConnected</span><span class="p">(</span><span class="n">ClientConnection</span><span class="w"> </span><span class="n">client</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-88-10" name="__codelineno-88-10" href="#__codelineno-88-10"></a><span class="w">        </span><span class="n">clients</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
<a id="__codelineno-88-11" name="__codelineno-88-11" href="#__codelineno-88-11"></a><span class="w">        </span><span class="c1">// Send initial game state to the client</span>
<a id="__codelineno-88-12" name="__codelineno-88-12" href="#__codelineno-88-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-88-13" name="__codelineno-88-13" href="#__codelineno-88-13"></a>
<a id="__codelineno-88-14" name="__codelineno-88-14" href="#__codelineno-88-14"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OnClientDisconnected</span><span class="p">(</span><span class="n">ClientConnection</span><span class="w"> </span><span class="n">client</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-88-15" name="__codelineno-88-15" href="#__codelineno-88-15"></a><span class="w">        </span><span class="n">clients</span><span class="p">.</span><span class="n">Remove</span><span class="p">(</span><span class="n">client</span><span class="p">);</span>
<a id="__codelineno-88-16" name="__codelineno-88-16" href="#__codelineno-88-16"></a><span class="w">        </span><span class="c1">// Handle client disconnection</span>
<a id="__codelineno-88-17" name="__codelineno-88-17" href="#__codelineno-88-17"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-88-18" name="__codelineno-88-18" href="#__codelineno-88-18"></a>
<a id="__codelineno-88-19" name="__codelineno-88-19" href="#__codelineno-88-19"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ProcessClientInput</span><span class="p">(</span><span class="n">ClientConnection</span><span class="w"> </span><span class="n">client</span><span class="p">,</span><span class="w"> </span><span class="n">ClientInput</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-88-20" name="__codelineno-88-20" href="#__codelineno-88-20"></a><span class="w">        </span><span class="c1">// Update game state based on client input</span>
<a id="__codelineno-88-21" name="__codelineno-88-21" href="#__codelineno-88-21"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-88-22" name="__codelineno-88-22" href="#__codelineno-88-22"></a>
<a id="__codelineno-88-23" name="__codelineno-88-23" href="#__codelineno-88-23"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SendGameStateUpdates</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-88-24" name="__codelineno-88-24" href="#__codelineno-88-24"></a><span class="w">        </span><span class="k">foreach</span><span class="w"> </span><span class="p">(</span><span class="kt">var</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">clients</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-88-25" name="__codelineno-88-25" href="#__codelineno-88-25"></a><span class="w">            </span><span class="n">client</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">gameState</span><span class="p">.</span><span class="n">GetUpdate</span><span class="p">());</span>
<a id="__codelineno-88-26" name="__codelineno-88-26" href="#__codelineno-88-26"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-88-27" name="__codelineno-88-27" href="#__codelineno-88-27"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-88-28" name="__codelineno-88-28" href="#__codelineno-88-28"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Client:</strong> Sends user inputs to the server and updates its local game state based on the server's updates.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-89-1" name="__codelineno-89-1" href="#__codelineno-89-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">GameClient</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-89-2" name="__codelineno-89-2" href="#__codelineno-89-2"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">ServerConnection</span><span class="w"> </span><span class="n">serverConnection</span><span class="p">;</span>
<a id="__codelineno-89-3" name="__codelineno-89-3" href="#__codelineno-89-3"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">GameState</span><span class="w"> </span><span class="n">gameState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">GameState</span><span class="p">();</span>
<a id="__codelineno-89-4" name="__codelineno-89-4" href="#__codelineno-89-4"></a>
<a id="__codelineno-89-5" name="__codelineno-89-5" href="#__codelineno-89-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ConnectToServer</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">ipAddress</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-89-6" name="__codelineno-89-6" href="#__codelineno-89-6"></a><span class="w">        </span><span class="c1">// Connect to the server</span>
<a id="__codelineno-89-7" name="__codelineno-89-7" href="#__codelineno-89-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-89-8" name="__codelineno-89-8" href="#__codelineno-89-8"></a>
<a id="__codelineno-89-9" name="__codelineno-89-9" href="#__codelineno-89-9"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SendInput</span><span class="p">(</span><span class="n">ClientInput</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-89-10" name="__codelineno-89-10" href="#__codelineno-89-10"></a><span class="w">        </span><span class="n">serverConnection</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
<a id="__codelineno-89-11" name="__codelineno-89-11" href="#__codelineno-89-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-89-12" name="__codelineno-89-12" href="#__codelineno-89-12"></a>
<a id="__codelineno-89-13" name="__codelineno-89-13" href="#__codelineno-89-13"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ReceiveGameStateUpdate</span><span class="p">(</span><span class="n">GameStateUpdate</span><span class="w"> </span><span class="n">update</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-89-14" name="__codelineno-89-14" href="#__codelineno-89-14"></a><span class="w">        </span><span class="n">gameState</span><span class="p">.</span><span class="n">ApplyUpdate</span><span class="p">(</span><span class="n">update</span><span class="p">);</span>
<a id="__codelineno-89-15" name="__codelineno-89-15" href="#__codelineno-89-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-89-16" name="__codelineno-89-16" href="#__codelineno-89-16"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="peer-to-peer-networking">Peer-to-Peer Networking</h4>
<p>In peer-to-peer (P2P) networking, each players game client communicates directly with other clients, distributing the game state management among all players. This can reduce server load but introduces challenges in synchronization and cheating prevention.</p>
<ul>
<li>
<p><strong>Peer Connection:</strong> Each client connects to and communicates with other peers directly.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-90-1" name="__codelineno-90-1" href="#__codelineno-90-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">PeerConnection</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-90-2" name="__codelineno-90-2" href="#__codelineno-90-2"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Peer</span><span class="o">&gt;</span><span class="w"> </span><span class="n">peers</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Peer</span><span class="o">&gt;</span><span class="p">();</span>
<a id="__codelineno-90-3" name="__codelineno-90-3" href="#__codelineno-90-3"></a>
<a id="__codelineno-90-4" name="__codelineno-90-4" href="#__codelineno-90-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ConnectToPeer</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">ipAddress</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-90-5" name="__codelineno-90-5" href="#__codelineno-90-5"></a><span class="w">        </span><span class="c1">// Connect to a peer</span>
<a id="__codelineno-90-6" name="__codelineno-90-6" href="#__codelineno-90-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-90-7" name="__codelineno-90-7" href="#__codelineno-90-7"></a>
<a id="__codelineno-90-8" name="__codelineno-90-8" href="#__codelineno-90-8"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SendDataToPeer</span><span class="p">(</span><span class="n">Peer</span><span class="w"> </span><span class="n">peer</span><span class="p">,</span><span class="w"> </span><span class="n">GameData</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-90-9" name="__codelineno-90-9" href="#__codelineno-90-9"></a><span class="w">        </span><span class="n">peer</span><span class="p">.</span><span class="n">Send</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-90-10" name="__codelineno-90-10" href="#__codelineno-90-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-90-11" name="__codelineno-90-11" href="#__codelineno-90-11"></a>
<a id="__codelineno-90-12" name="__codelineno-90-12" href="#__codelineno-90-12"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ReceiveDataFromPeer</span><span class="p">(</span><span class="n">Peer</span><span class="w"> </span><span class="n">peer</span><span class="p">,</span><span class="w"> </span><span class="n">GameData</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-90-13" name="__codelineno-90-13" href="#__codelineno-90-13"></a><span class="w">        </span><span class="c1">// Process received data from a peer</span>
<a id="__codelineno-90-14" name="__codelineno-90-14" href="#__codelineno-90-14"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-90-15" name="__codelineno-90-15" href="#__codelineno-90-15"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Synchronization:</strong> Ensure all peers maintain a consistent game state through periodic state updates and conflict resolution mechanisms.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-91-1" name="__codelineno-91-1" href="#__codelineno-91-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Peer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-91-2" name="__codelineno-91-2" href="#__codelineno-91-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">ipAddress</span><span class="p">;</span>
<a id="__codelineno-91-3" name="__codelineno-91-3" href="#__codelineno-91-3"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">port</span><span class="p">;</span>
<a id="__codelineno-91-4" name="__codelineno-91-4" href="#__codelineno-91-4"></a>
<a id="__codelineno-91-5" name="__codelineno-91-5" href="#__codelineno-91-5"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Send</span><span class="p">(</span><span class="n">GameData</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-91-6" name="__codelineno-91-6" href="#__codelineno-91-6"></a><span class="w">        </span><span class="c1">// Send data to the peer</span>
<a id="__codelineno-91-7" name="__codelineno-91-7" href="#__codelineno-91-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-91-8" name="__codelineno-91-8" href="#__codelineno-91-8"></a>
<a id="__codelineno-91-9" name="__codelineno-91-9" href="#__codelineno-91-9"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">Receive</span><span class="p">(</span><span class="n">GameData</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-91-10" name="__codelineno-91-10" href="#__codelineno-91-10"></a><span class="w">        </span><span class="c1">// Receive data from the peer</span>
<a id="__codelineno-91-11" name="__codelineno-91-11" href="#__codelineno-91-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-91-12" name="__codelineno-91-12" href="#__codelineno-91-12"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="state-synchronization">State Synchronization</h4>
<p>State synchronization ensures that all clients have a consistent view of the game state, which is crucial for both client-server and P2P architectures.</p>
<ul>
<li>
<p><strong>State Updates:</strong> Regularly send game state updates from the server to clients or between peers.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-92-1" name="__codelineno-92-1" href="#__codelineno-92-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">GameState</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-92-2" name="__codelineno-92-2" href="#__codelineno-92-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">GameObject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">objects</span><span class="p">;</span>
<a id="__codelineno-92-3" name="__codelineno-92-3" href="#__codelineno-92-3"></a>
<a id="__codelineno-92-4" name="__codelineno-92-4" href="#__codelineno-92-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">GameStateUpdate</span><span class="w"> </span><span class="nf">GetUpdate</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-92-5" name="__codelineno-92-5" href="#__codelineno-92-5"></a><span class="w">        </span><span class="c1">// Generate a state update containing changed objects</span>
<a id="__codelineno-92-6" name="__codelineno-92-6" href="#__codelineno-92-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-92-7" name="__codelineno-92-7" href="#__codelineno-92-7"></a>
<a id="__codelineno-92-8" name="__codelineno-92-8" href="#__codelineno-92-8"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ApplyUpdate</span><span class="p">(</span><span class="n">GameStateUpdate</span><span class="w"> </span><span class="n">update</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-92-9" name="__codelineno-92-9" href="#__codelineno-92-9"></a><span class="w">        </span><span class="c1">// Apply the received state update to the local game state</span>
<a id="__codelineno-92-10" name="__codelineno-92-10" href="#__codelineno-92-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-92-11" name="__codelineno-92-11" href="#__codelineno-92-11"></a><span class="p">}</span>
<a id="__codelineno-92-12" name="__codelineno-92-12" href="#__codelineno-92-12"></a>
<a id="__codelineno-92-13" name="__codelineno-92-13" href="#__codelineno-92-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">GameStateUpdate</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-92-14" name="__codelineno-92-14" href="#__codelineno-92-14"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">Dictionary</span><span class="o">&lt;</span><span class="kt">int</span><span class="p">,</span><span class="w"> </span><span class="n">GameObject</span><span class="o">&gt;</span><span class="w"> </span><span class="n">updatedObjects</span><span class="p">;</span>
<a id="__codelineno-92-15" name="__codelineno-92-15" href="#__codelineno-92-15"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Delta Compression:</strong> Optimize bandwidth usage by only sending changes (deltas) in the game state rather than the entire state.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-93-1" name="__codelineno-93-1" href="#__codelineno-93-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">GameState</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-93-2" name="__codelineno-93-2" href="#__codelineno-93-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">GameStateUpdate</span><span class="w"> </span><span class="nf">GetDeltaUpdate</span><span class="p">(</span><span class="n">GameState</span><span class="w"> </span><span class="n">previousState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-93-3" name="__codelineno-93-3" href="#__codelineno-93-3"></a><span class="w">        </span><span class="c1">// Compare current state with previous state and generate a delta update</span>
<a id="__codelineno-93-4" name="__codelineno-93-4" href="#__codelineno-93-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-93-5" name="__codelineno-93-5" href="#__codelineno-93-5"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="latency-compensation">Latency Compensation</h4>
<p>Latency compensation techniques help mitigate the effects of network latency, ensuring a smooth and responsive gameplay experience.</p>
<ul>
<li>
<p><strong>Client-Side Prediction:</strong> Clients predict the results of their actions locally and later reconcile with the server's authoritative state.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-94-1" name="__codelineno-94-1" href="#__codelineno-94-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Client</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-94-2" name="__codelineno-94-2" href="#__codelineno-94-2"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">GameState</span><span class="w"> </span><span class="n">predictedState</span><span class="p">;</span>
<a id="__codelineno-94-3" name="__codelineno-94-3" href="#__codelineno-94-3"></a>
<a id="__codelineno-94-4" name="__codelineno-94-4" href="#__codelineno-94-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ApplyInput</span><span class="p">(</span><span class="n">ClientInput</span><span class="w"> </span><span class="n">input</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-94-5" name="__codelineno-94-5" href="#__codelineno-94-5"></a><span class="w">        </span><span class="n">predictedState</span><span class="p">.</span><span class="n">ApplyInput</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
<a id="__codelineno-94-6" name="__codelineno-94-6" href="#__codelineno-94-6"></a><span class="w">        </span><span class="n">SendInputToServer</span><span class="p">(</span><span class="n">input</span><span class="p">);</span>
<a id="__codelineno-94-7" name="__codelineno-94-7" href="#__codelineno-94-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-94-8" name="__codelineno-94-8" href="#__codelineno-94-8"></a>
<a id="__codelineno-94-9" name="__codelineno-94-9" href="#__codelineno-94-9"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ReconcileWithServer</span><span class="p">(</span><span class="n">GameState</span><span class="w"> </span><span class="n">serverState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-94-10" name="__codelineno-94-10" href="#__codelineno-94-10"></a><span class="w">        </span><span class="c1">// Reconcile the predicted state with the server state</span>
<a id="__codelineno-94-11" name="__codelineno-94-11" href="#__codelineno-94-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-94-12" name="__codelineno-94-12" href="#__codelineno-94-12"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Server Reconciliation:</strong> The server periodically corrects the clients predicted state with the authoritative state.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-95-1" name="__codelineno-95-1" href="#__codelineno-95-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Server</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-95-2" name="__codelineno-95-2" href="#__codelineno-95-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ProcessClientInput</span><span class="p">(</span><span class="n">ClientInput</span><span class="w"> </span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">clientId</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-95-3" name="__codelineno-95-3" href="#__codelineno-95-3"></a><span class="w">        </span><span class="c1">// Update the game state and send the authoritative state back to the client</span>
<a id="__codelineno-95-4" name="__codelineno-95-4" href="#__codelineno-95-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-95-5" name="__codelineno-95-5" href="#__codelineno-95-5"></a>
<a id="__codelineno-95-6" name="__codelineno-95-6" href="#__codelineno-95-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SendReconciliationData</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">clientId</span><span class="p">,</span><span class="w"> </span><span class="n">GameState</span><span class="w"> </span><span class="n">serverState</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-95-7" name="__codelineno-95-7" href="#__codelineno-95-7"></a><span class="w">        </span><span class="c1">// Send the authoritative state to the client for reconciliation</span>
<a id="__codelineno-95-8" name="__codelineno-95-8" href="#__codelineno-95-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-95-9" name="__codelineno-95-9" href="#__codelineno-95-9"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Lag Compensation:</strong> Adjust calculations to account for latency, such as rewinding the game state to when a shot was fired to determine hits.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-96-1" name="__codelineno-96-1" href="#__codelineno-96-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Server</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-96-2" name="__codelineno-96-2" href="#__codelineno-96-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">HandleShot</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="n">clientId</span><span class="p">,</span><span class="w"> </span><span class="n">ShotData</span><span class="w"> </span><span class="n">shotData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-96-3" name="__codelineno-96-3" href="#__codelineno-96-3"></a><span class="w">        </span><span class="n">GameState</span><span class="w"> </span><span class="n">rewindedState</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">RewindGameStateTo</span><span class="p">(</span><span class="n">shotData</span><span class="p">.</span><span class="n">timestamp</span><span class="p">);</span>
<a id="__codelineno-96-4" name="__codelineno-96-4" href="#__codelineno-96-4"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">CheckHit</span><span class="p">(</span><span class="n">rewindedState</span><span class="p">,</span><span class="w"> </span><span class="n">shotData</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-96-5" name="__codelineno-96-5" href="#__codelineno-96-5"></a><span class="w">            </span><span class="n">ApplyDamage</span><span class="p">();</span>
<a id="__codelineno-96-6" name="__codelineno-96-6" href="#__codelineno-96-6"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-96-7" name="__codelineno-96-7" href="#__codelineno-96-7"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-96-8" name="__codelineno-96-8" href="#__codelineno-96-8"></a>
<a id="__codelineno-96-9" name="__codelineno-96-9" href="#__codelineno-96-9"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="n">GameState</span><span class="w"> </span><span class="nf">RewindGameStateTo</span><span class="p">(</span><span class="kt">long</span><span class="w"> </span><span class="n">timestamp</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-96-10" name="__codelineno-96-10" href="#__codelineno-96-10"></a><span class="w">        </span><span class="c1">// Rewind the game state to the specified timestamp</span>
<a id="__codelineno-96-11" name="__codelineno-96-11" href="#__codelineno-96-11"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-96-12" name="__codelineno-96-12" href="#__codelineno-96-12"></a>
<a id="__codelineno-96-13" name="__codelineno-96-13" href="#__codelineno-96-13"></a><span class="w">    </span><span class="k">private</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">CheckHit</span><span class="p">(</span><span class="n">GameState</span><span class="w"> </span><span class="n">state</span><span class="p">,</span><span class="w"> </span><span class="n">ShotData</span><span class="w"> </span><span class="n">shotData</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-96-14" name="__codelineno-96-14" href="#__codelineno-96-14"></a><span class="w">        </span><span class="c1">// Check if the shot hits the target in the rewinded state</span>
<a id="__codelineno-96-15" name="__codelineno-96-15" href="#__codelineno-96-15"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-96-16" name="__codelineno-96-16" href="#__codelineno-96-16"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<p>By implementing these networking concepts, a game engine can provide a robust multiplayer experience, ensuring smooth gameplay, consistent state synchronization, and effective handling of network latency.</p>
<h3 id="tools-and-asset-pipeline">Tools and Asset Pipeline</h3>
<h4 id="level-editors">Level Editors</h4>
<p>Level editors are tools that allow designers to create and modify game levels, environments, and worlds. These editors provide a graphical interface to place objects, define terrain, and set up gameplay elements.</p>
<ul>
<li>
<p><strong>Basic Components:</strong>
        - <strong>Object Placement:</strong> Drag-and-drop functionality for placing objects like buildings, trees, and NPCs in the game world.
        - <strong>Terrain Editing:</strong> Tools to sculpt terrain, paint textures, and add details like foliage and water.
        - <strong>Lighting and Effects:</strong> Options to adjust lighting, shadows, and visual effects.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-97-1" name="__codelineno-97-1" href="#__codelineno-97-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">LevelEditor</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-97-2" name="__codelineno-97-2" href="#__codelineno-97-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">PlaceObject</span><span class="p">(</span><span class="n">GameObject</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-97-3" name="__codelineno-97-3" href="#__codelineno-97-3"></a><span class="w">        </span><span class="c1">// Place the object at the specified position</span>
<a id="__codelineno-97-4" name="__codelineno-97-4" href="#__codelineno-97-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-97-5" name="__codelineno-97-5" href="#__codelineno-97-5"></a>
<a id="__codelineno-97-6" name="__codelineno-97-6" href="#__codelineno-97-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">EditTerrain</span><span class="p">(</span><span class="n">Terrain</span><span class="w"> </span><span class="n">terrain</span><span class="p">,</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">heightDelta</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-97-7" name="__codelineno-97-7" href="#__codelineno-97-7"></a><span class="w">        </span><span class="c1">// Modify the terrain height at the specified position</span>
<a id="__codelineno-97-8" name="__codelineno-97-8" href="#__codelineno-97-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-97-9" name="__codelineno-97-9" href="#__codelineno-97-9"></a>
<a id="__codelineno-97-10" name="__codelineno-97-10" href="#__codelineno-97-10"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetLighting</span><span class="p">(</span><span class="n">Light</span><span class="w"> </span><span class="n">light</span><span class="p">,</span><span class="w"> </span><span class="n">Vector3</span><span class="w"> </span><span class="n">position</span><span class="p">,</span><span class="w"> </span><span class="n">Color</span><span class="w"> </span><span class="n">color</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-97-11" name="__codelineno-97-11" href="#__codelineno-97-11"></a><span class="w">        </span><span class="c1">// Adjust lighting settings</span>
<a id="__codelineno-97-12" name="__codelineno-97-12" href="#__codelineno-97-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-97-13" name="__codelineno-97-13" href="#__codelineno-97-13"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Advanced Features:</strong></p>
<ul>
<li><strong>Scripting Integration:</strong> Allow custom scripts to define complex behaviors and interactions.</li>
<li><strong>Pathfinding Setup:</strong> Define navigation meshes or waypoints for AI pathfinding.</li>
<li><strong>Physics and Collision:</strong> Visualize and edit collision boundaries and physical properties of objects.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-98-1" name="__codelineno-98-1" href="#__codelineno-98-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">LevelEditor</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-2" name="__codelineno-98-2" href="#__codelineno-98-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AttachScript</span><span class="p">(</span><span class="n">GameObject</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">Script</span><span class="w"> </span><span class="n">script</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-3" name="__codelineno-98-3" href="#__codelineno-98-3"></a><span class="w">        </span><span class="c1">// Attach a script to the specified object</span>
<a id="__codelineno-98-4" name="__codelineno-98-4" href="#__codelineno-98-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-98-5" name="__codelineno-98-5" href="#__codelineno-98-5"></a>
<a id="__codelineno-98-6" name="__codelineno-98-6" href="#__codelineno-98-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DefineNavMesh</span><span class="p">(</span><span class="n">NavMesh</span><span class="w"> </span><span class="n">navMesh</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-7" name="__codelineno-98-7" href="#__codelineno-98-7"></a><span class="w">        </span><span class="c1">// Set up navigation mesh for AI pathfinding</span>
<a id="__codelineno-98-8" name="__codelineno-98-8" href="#__codelineno-98-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-98-9" name="__codelineno-98-9" href="#__codelineno-98-9"></a>
<a id="__codelineno-98-10" name="__codelineno-98-10" href="#__codelineno-98-10"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetCollision</span><span class="p">(</span><span class="n">GameObject</span><span class="w"> </span><span class="n">obj</span><span class="p">,</span><span class="w"> </span><span class="n">CollisionShape</span><span class="w"> </span><span class="n">shape</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-98-11" name="__codelineno-98-11" href="#__codelineno-98-11"></a><span class="w">        </span><span class="c1">// Define collision boundaries</span>
<a id="__codelineno-98-12" name="__codelineno-98-12" href="#__codelineno-98-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-98-13" name="__codelineno-98-13" href="#__codelineno-98-13"></a><span class="p">}</span>
</code></pre></div>
<h5 id="overview_2">Overview</h5>
</li>
</ul>
<p>A Level Editor in a game engine typically includes:</p>
<ol>
<li>Map representation and management</li>
<li>Entity placement and manipulation</li>
<li>Terrain editing</li>
<li>Asset management</li>
<li>Undo/Redo functionality</li>
<li>Scene serialization and deserialization</li>
</ol>
<p>Here's an implementation that demonstrates these concepts:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-99-1" name="__codelineno-99-1" href="#__codelineno-99-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;string&gt;</span>
<a id="__codelineno-99-2" name="__codelineno-99-2" href="#__codelineno-99-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;vector&gt;</span>
<a id="__codelineno-99-3" name="__codelineno-99-3" href="#__codelineno-99-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;memory&gt;</span>
<a id="__codelineno-99-4" name="__codelineno-99-4" href="#__codelineno-99-4"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unordered_map&gt;</span>
<a id="__codelineno-99-5" name="__codelineno-99-5" href="#__codelineno-99-5"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;functional&gt;</span>
<a id="__codelineno-99-6" name="__codelineno-99-6" href="#__codelineno-99-6"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;fstream&gt;</span>
<a id="__codelineno-99-7" name="__codelineno-99-7" href="#__codelineno-99-7"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;iostream&gt;</span>
<a id="__codelineno-99-8" name="__codelineno-99-8" href="#__codelineno-99-8"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stack&gt;</span>
<a id="__codelineno-99-9" name="__codelineno-99-9" href="#__codelineno-99-9"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;nlohmann/json.hpp&gt;</span>
<a id="__codelineno-99-10" name="__codelineno-99-10" href="#__codelineno-99-10"></a>
<a id="__codelineno-99-11" name="__codelineno-99-11" href="#__codelineno-99-11"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">engine</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-12" name="__codelineno-99-12" href="#__codelineno-99-12"></a><span class="k">namespace</span><span class="w"> </span><span class="nn">editor</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-13" name="__codelineno-99-13" href="#__codelineno-99-13"></a>
<a id="__codelineno-99-14" name="__codelineno-99-14" href="#__codelineno-99-14"></a><span class="c1">// Forward declarations</span>
<a id="__codelineno-99-15" name="__codelineno-99-15" href="#__codelineno-99-15"></a><span class="k">class</span><span class="w"> </span><span class="nc">Entity</span><span class="p">;</span>
<a id="__codelineno-99-16" name="__codelineno-99-16" href="#__codelineno-99-16"></a><span class="k">class</span><span class="w"> </span><span class="nc">Map</span><span class="p">;</span>
<a id="__codelineno-99-17" name="__codelineno-99-17" href="#__codelineno-99-17"></a><span class="k">class</span><span class="w"> </span><span class="nc">LevelEditor</span><span class="p">;</span>
<a id="__codelineno-99-18" name="__codelineno-99-18" href="#__codelineno-99-18"></a>
<a id="__codelineno-99-19" name="__codelineno-99-19" href="#__codelineno-99-19"></a><span class="c1">// Vector3 class for 3D coordinates</span>
<a id="__codelineno-99-20" name="__codelineno-99-20" href="#__codelineno-99-20"></a><span class="k">struct</span><span class="w"> </span><span class="nc">Vector3</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-21" name="__codelineno-99-21" href="#__codelineno-99-21"></a><span class="w">    </span><span class="kt">float</span><span class="w"> </span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
<a id="__codelineno-99-22" name="__codelineno-99-22" href="#__codelineno-99-22"></a><span class="p">};</span>
<a id="__codelineno-99-23" name="__codelineno-99-23" href="#__codelineno-99-23"></a>
<a id="__codelineno-99-24" name="__codelineno-99-24" href="#__codelineno-99-24"></a><span class="c1">// Entity class representing game objects</span>
<a id="__codelineno-99-25" name="__codelineno-99-25" href="#__codelineno-99-25"></a><span class="k">class</span><span class="w"> </span><span class="nc">Entity</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-26" name="__codelineno-99-26" href="#__codelineno-99-26"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-99-27" name="__codelineno-99-27" href="#__codelineno-99-27"></a><span class="w">    </span><span class="n">Entity</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">position</span><span class="p">)</span>
<a id="__codelineno-99-28" name="__codelineno-99-28" href="#__codelineno-99-28"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">type_</span><span class="p">(</span><span class="n">type</span><span class="p">),</span><span class="w"> </span><span class="n">position_</span><span class="p">(</span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-99-29" name="__codelineno-99-29" href="#__codelineno-99-29"></a>
<a id="__codelineno-99-30" name="__codelineno-99-30" href="#__codelineno-99-30"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">Entity</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-99-31" name="__codelineno-99-31" href="#__codelineno-99-31"></a>
<a id="__codelineno-99-32" name="__codelineno-99-32" href="#__codelineno-99-32"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="w"> </span><span class="nf">Serialize</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-33" name="__codelineno-99-33" href="#__codelineno-99-33"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-34" name="__codelineno-99-34" href="#__codelineno-99-34"></a><span class="w">            </span><span class="p">{</span><span class="s">&quot;type&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">type_</span><span class="p">},</span>
<a id="__codelineno-99-35" name="__codelineno-99-35" href="#__codelineno-99-35"></a><span class="w">            </span><span class="p">{</span><span class="s">&quot;position&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="n">position_</span><span class="p">.</span><span class="n">x</span><span class="p">,</span><span class="w"> </span><span class="n">position_</span><span class="p">.</span><span class="n">y</span><span class="p">,</span><span class="w"> </span><span class="n">position_</span><span class="p">.</span><span class="n">z</span><span class="p">}}</span>
<a id="__codelineno-99-36" name="__codelineno-99-36" href="#__codelineno-99-36"></a><span class="w">        </span><span class="p">};</span>
<a id="__codelineno-99-37" name="__codelineno-99-37" href="#__codelineno-99-37"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-38" name="__codelineno-99-38" href="#__codelineno-99-38"></a>
<a id="__codelineno-99-39" name="__codelineno-99-39" href="#__codelineno-99-39"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Deserialize</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-40" name="__codelineno-99-40" href="#__codelineno-99-40"></a><span class="w">        </span><span class="n">type_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="s">&quot;type&quot;</span><span class="p">];</span>
<a id="__codelineno-99-41" name="__codelineno-99-41" href="#__codelineno-99-41"></a><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="s">&quot;position&quot;</span><span class="p">];</span>
<a id="__codelineno-99-42" name="__codelineno-99-42" href="#__codelineno-99-42"></a><span class="w">        </span><span class="n">position_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]};</span>
<a id="__codelineno-99-43" name="__codelineno-99-43" href="#__codelineno-99-43"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-44" name="__codelineno-99-44" href="#__codelineno-99-44"></a>
<a id="__codelineno-99-45" name="__codelineno-99-45" href="#__codelineno-99-45"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">GetType</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">type_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-99-46" name="__codelineno-99-46" href="#__codelineno-99-46"></a><span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="nf">GetPosition</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">return</span><span class="w"> </span><span class="n">position_</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-99-47" name="__codelineno-99-47" href="#__codelineno-99-47"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="nf">SetPosition</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">position_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">position</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-99-48" name="__codelineno-99-48" href="#__codelineno-99-48"></a>
<a id="__codelineno-99-49" name="__codelineno-99-49" href="#__codelineno-99-49"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-99-50" name="__codelineno-99-50" href="#__codelineno-99-50"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="n">type_</span><span class="p">;</span>
<a id="__codelineno-99-51" name="__codelineno-99-51" href="#__codelineno-99-51"></a><span class="w">    </span><span class="n">Vector3</span><span class="w"> </span><span class="n">position_</span><span class="p">;</span>
<a id="__codelineno-99-52" name="__codelineno-99-52" href="#__codelineno-99-52"></a><span class="p">};</span>
<a id="__codelineno-99-53" name="__codelineno-99-53" href="#__codelineno-99-53"></a>
<a id="__codelineno-99-54" name="__codelineno-99-54" href="#__codelineno-99-54"></a><span class="c1">// Map class representing the game world</span>
<a id="__codelineno-99-55" name="__codelineno-99-55" href="#__codelineno-99-55"></a><span class="k">class</span><span class="w"> </span><span class="nc">Map</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-56" name="__codelineno-99-56" href="#__codelineno-99-56"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-99-57" name="__codelineno-99-57" href="#__codelineno-99-57"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">AddEntity</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entity</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-58" name="__codelineno-99-58" href="#__codelineno-99-58"></a><span class="w">        </span><span class="n">entities_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">entity</span><span class="p">));</span>
<a id="__codelineno-99-59" name="__codelineno-99-59" href="#__codelineno-99-59"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-60" name="__codelineno-99-60" href="#__codelineno-99-60"></a>
<a id="__codelineno-99-61" name="__codelineno-99-61" href="#__codelineno-99-61"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">RemoveEntity</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-62" name="__codelineno-99-62" href="#__codelineno-99-62"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">entities_</span><span class="p">.</span><span class="n">size</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-63" name="__codelineno-99-63" href="#__codelineno-99-63"></a><span class="w">            </span><span class="n">entities_</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span><span class="n">entities_</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">index</span><span class="p">);</span>
<a id="__codelineno-99-64" name="__codelineno-99-64" href="#__codelineno-99-64"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-99-65" name="__codelineno-99-65" href="#__codelineno-99-65"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-66" name="__codelineno-99-66" href="#__codelineno-99-66"></a>
<a id="__codelineno-99-67" name="__codelineno-99-67" href="#__codelineno-99-67"></a><span class="w">    </span><span class="n">Entity</span><span class="o">*</span><span class="w"> </span><span class="n">GetEntity</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">index</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-68" name="__codelineno-99-68" href="#__codelineno-99-68"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">index</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">entities_</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">entities_</span><span class="p">[</span><span class="n">index</span><span class="p">].</span><span class="n">get</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<a id="__codelineno-99-69" name="__codelineno-99-69" href="#__codelineno-99-69"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-70" name="__codelineno-99-70" href="#__codelineno-99-70"></a>
<a id="__codelineno-99-71" name="__codelineno-99-71" href="#__codelineno-99-71"></a><span class="w">    </span><span class="kt">size_t</span><span class="w"> </span><span class="n">GetEntityCount</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-72" name="__codelineno-99-72" href="#__codelineno-99-72"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">entities_</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
<a id="__codelineno-99-73" name="__codelineno-99-73" href="#__codelineno-99-73"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-74" name="__codelineno-99-74" href="#__codelineno-99-74"></a>
<a id="__codelineno-99-75" name="__codelineno-99-75" href="#__codelineno-99-75"></a><span class="w">    </span><span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="w"> </span><span class="n">Serialize</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-76" name="__codelineno-99-76" href="#__codelineno-99-76"></a><span class="w">        </span><span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-99-77" name="__codelineno-99-77" href="#__codelineno-99-77"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">entities_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-78" name="__codelineno-99-78" href="#__codelineno-99-78"></a><span class="w">            </span><span class="n">data</span><span class="p">[</span><span class="s">&quot;entities&quot;</span><span class="p">].</span><span class="n">push_back</span><span class="p">(</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">Serialize</span><span class="p">());</span>
<a id="__codelineno-99-79" name="__codelineno-99-79" href="#__codelineno-99-79"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-99-80" name="__codelineno-99-80" href="#__codelineno-99-80"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-99-81" name="__codelineno-99-81" href="#__codelineno-99-81"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-82" name="__codelineno-99-82" href="#__codelineno-99-82"></a>
<a id="__codelineno-99-83" name="__codelineno-99-83" href="#__codelineno-99-83"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Deserialize</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="o">&amp;</span><span class="w"> </span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-84" name="__codelineno-99-84" href="#__codelineno-99-84"></a><span class="w">        </span><span class="n">entities_</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
<a id="__codelineno-99-85" name="__codelineno-99-85" href="#__codelineno-99-85"></a><span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">entity_data</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">data</span><span class="p">[</span><span class="s">&quot;entities&quot;</span><span class="p">])</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-86" name="__codelineno-99-86" href="#__codelineno-99-86"></a><span class="w">            </span><span class="k">auto</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">Vector3</span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">});</span>
<a id="__codelineno-99-87" name="__codelineno-99-87" href="#__codelineno-99-87"></a><span class="w">            </span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">Deserialize</span><span class="p">(</span><span class="n">entity_data</span><span class="p">);</span>
<a id="__codelineno-99-88" name="__codelineno-99-88" href="#__codelineno-99-88"></a><span class="w">            </span><span class="n">entities_</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">entity</span><span class="p">));</span>
<a id="__codelineno-99-89" name="__codelineno-99-89" href="#__codelineno-99-89"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-99-90" name="__codelineno-99-90" href="#__codelineno-99-90"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-91" name="__codelineno-99-91" href="#__codelineno-99-91"></a>
<a id="__codelineno-99-92" name="__codelineno-99-92" href="#__codelineno-99-92"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-99-93" name="__codelineno-99-93" href="#__codelineno-99-93"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">entities_</span><span class="p">;</span>
<a id="__codelineno-99-94" name="__codelineno-99-94" href="#__codelineno-99-94"></a><span class="p">};</span>
<a id="__codelineno-99-95" name="__codelineno-99-95" href="#__codelineno-99-95"></a>
<a id="__codelineno-99-96" name="__codelineno-99-96" href="#__codelineno-99-96"></a><span class="c1">// Command interface for undo/redo functionality</span>
<a id="__codelineno-99-97" name="__codelineno-99-97" href="#__codelineno-99-97"></a><span class="k">class</span><span class="w"> </span><span class="nc">Command</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-98" name="__codelineno-99-98" href="#__codelineno-99-98"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-99-99" name="__codelineno-99-99" href="#__codelineno-99-99"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">Command</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">default</span><span class="p">;</span>
<a id="__codelineno-99-100" name="__codelineno-99-100" href="#__codelineno-99-100"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Execute</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-99-101" name="__codelineno-99-101" href="#__codelineno-99-101"></a><span class="w">    </span><span class="k">virtual</span><span class="w"> </span><span class="kt">void</span><span class="w"> </span><span class="nf">Undo</span><span class="p">()</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-99-102" name="__codelineno-99-102" href="#__codelineno-99-102"></a><span class="p">};</span>
<a id="__codelineno-99-103" name="__codelineno-99-103" href="#__codelineno-99-103"></a>
<a id="__codelineno-99-104" name="__codelineno-99-104" href="#__codelineno-99-104"></a><span class="c1">// AddEntityCommand for adding entities to the map</span>
<a id="__codelineno-99-105" name="__codelineno-99-105" href="#__codelineno-99-105"></a><span class="k">class</span><span class="w"> </span><span class="nc">AddEntityCommand</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">Command</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-106" name="__codelineno-99-106" href="#__codelineno-99-106"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-99-107" name="__codelineno-99-107" href="#__codelineno-99-107"></a><span class="w">    </span><span class="n">AddEntityCommand</span><span class="p">(</span><span class="n">Map</span><span class="o">&amp;</span><span class="w"> </span><span class="n">map</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entity</span><span class="p">)</span>
<a id="__codelineno-99-108" name="__codelineno-99-108" href="#__codelineno-99-108"></a><span class="w">        </span><span class="o">:</span><span class="w"> </span><span class="n">map_</span><span class="p">(</span><span class="n">map</span><span class="p">),</span><span class="w"> </span><span class="n">entity_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">entity</span><span class="p">))</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-99-109" name="__codelineno-99-109" href="#__codelineno-99-109"></a>
<a id="__codelineno-99-110" name="__codelineno-99-110" href="#__codelineno-99-110"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Execute</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-111" name="__codelineno-99-111" href="#__codelineno-99-111"></a><span class="w">        </span><span class="n">map_</span><span class="p">.</span><span class="n">AddEntity</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">entity_</span><span class="p">));</span>
<a id="__codelineno-99-112" name="__codelineno-99-112" href="#__codelineno-99-112"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-113" name="__codelineno-99-113" href="#__codelineno-99-113"></a>
<a id="__codelineno-99-114" name="__codelineno-99-114" href="#__codelineno-99-114"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Undo</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-115" name="__codelineno-99-115" href="#__codelineno-99-115"></a><span class="w">        </span><span class="n">entity_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span><span class="p">(</span><span class="n">map_</span><span class="p">.</span><span class="n">GetEntity</span><span class="p">(</span><span class="n">map_</span><span class="p">.</span><span class="n">GetEntityCount</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">));</span>
<a id="__codelineno-99-116" name="__codelineno-99-116" href="#__codelineno-99-116"></a><span class="w">        </span><span class="n">map_</span><span class="p">.</span><span class="n">RemoveEntity</span><span class="p">(</span><span class="n">map_</span><span class="p">.</span><span class="n">GetEntityCount</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span>
<a id="__codelineno-99-117" name="__codelineno-99-117" href="#__codelineno-99-117"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-118" name="__codelineno-99-118" href="#__codelineno-99-118"></a>
<a id="__codelineno-99-119" name="__codelineno-99-119" href="#__codelineno-99-119"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-99-120" name="__codelineno-99-120" href="#__codelineno-99-120"></a><span class="w">    </span><span class="n">Map</span><span class="o">&amp;</span><span class="w"> </span><span class="n">map_</span><span class="p">;</span>
<a id="__codelineno-99-121" name="__codelineno-99-121" href="#__codelineno-99-121"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span><span class="w"> </span><span class="n">entity_</span><span class="p">;</span>
<a id="__codelineno-99-122" name="__codelineno-99-122" href="#__codelineno-99-122"></a><span class="p">};</span>
<a id="__codelineno-99-123" name="__codelineno-99-123" href="#__codelineno-99-123"></a>
<a id="__codelineno-99-124" name="__codelineno-99-124" href="#__codelineno-99-124"></a><span class="c1">// LevelEditor class for managing the editing process</span>
<a id="__codelineno-99-125" name="__codelineno-99-125" href="#__codelineno-99-125"></a><span class="k">class</span><span class="w"> </span><span class="nc">LevelEditor</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-126" name="__codelineno-99-126" href="#__codelineno-99-126"></a><span class="k">public</span><span class="o">:</span>
<a id="__codelineno-99-127" name="__codelineno-99-127" href="#__codelineno-99-127"></a><span class="w">    </span><span class="n">LevelEditor</span><span class="p">()</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">current_map_</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&gt;</span><span class="p">())</span><span class="w"> </span><span class="p">{}</span>
<a id="__codelineno-99-128" name="__codelineno-99-128" href="#__codelineno-99-128"></a>
<a id="__codelineno-99-129" name="__codelineno-99-129" href="#__codelineno-99-129"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">AddEntity</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">Vector3</span><span class="o">&amp;</span><span class="w"> </span><span class="n">position</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-130" name="__codelineno-99-130" href="#__codelineno-99-130"></a><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">command</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">AddEntityCommand</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">current_map_</span><span class="p">,</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;</span><span class="p">(</span><span class="n">type</span><span class="p">,</span><span class="w"> </span><span class="n">position</span><span class="p">));</span>
<a id="__codelineno-99-131" name="__codelineno-99-131" href="#__codelineno-99-131"></a><span class="w">        </span><span class="n">ExecuteCommand</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">command</span><span class="p">));</span>
<a id="__codelineno-99-132" name="__codelineno-99-132" href="#__codelineno-99-132"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-133" name="__codelineno-99-133" href="#__codelineno-99-133"></a>
<a id="__codelineno-99-134" name="__codelineno-99-134" href="#__codelineno-99-134"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Undo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-135" name="__codelineno-99-135" href="#__codelineno-99-135"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">undo_stack_</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-136" name="__codelineno-99-136" href="#__codelineno-99-136"></a><span class="w">            </span><span class="n">undo_stack_</span><span class="p">.</span><span class="n">top</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Undo</span><span class="p">();</span>
<a id="__codelineno-99-137" name="__codelineno-99-137" href="#__codelineno-99-137"></a><span class="w">            </span><span class="n">redo_stack_</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">undo_stack_</span><span class="p">.</span><span class="n">top</span><span class="p">()));</span>
<a id="__codelineno-99-138" name="__codelineno-99-138" href="#__codelineno-99-138"></a><span class="w">            </span><span class="n">undo_stack_</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-99-139" name="__codelineno-99-139" href="#__codelineno-99-139"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-99-140" name="__codelineno-99-140" href="#__codelineno-99-140"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-141" name="__codelineno-99-141" href="#__codelineno-99-141"></a>
<a id="__codelineno-99-142" name="__codelineno-99-142" href="#__codelineno-99-142"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">Redo</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-143" name="__codelineno-99-143" href="#__codelineno-99-143"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">redo_stack_</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-144" name="__codelineno-99-144" href="#__codelineno-99-144"></a><span class="w">            </span><span class="n">redo_stack_</span><span class="p">.</span><span class="n">top</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">Execute</span><span class="p">();</span>
<a id="__codelineno-99-145" name="__codelineno-99-145" href="#__codelineno-99-145"></a><span class="w">            </span><span class="n">undo_stack_</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">redo_stack_</span><span class="p">.</span><span class="n">top</span><span class="p">()));</span>
<a id="__codelineno-99-146" name="__codelineno-99-146" href="#__codelineno-99-146"></a><span class="w">            </span><span class="n">redo_stack_</span><span class="p">.</span><span class="n">pop</span><span class="p">();</span>
<a id="__codelineno-99-147" name="__codelineno-99-147" href="#__codelineno-99-147"></a><span class="w">        </span><span class="p">}</span>
<a id="__codelineno-99-148" name="__codelineno-99-148" href="#__codelineno-99-148"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-149" name="__codelineno-99-149" href="#__codelineno-99-149"></a>
<a id="__codelineno-99-150" name="__codelineno-99-150" href="#__codelineno-99-150"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">SaveMap</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">filename</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-151" name="__codelineno-99-151" href="#__codelineno-99-151"></a><span class="w">        </span><span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">current_map_</span><span class="o">-&gt;</span><span class="n">Serialize</span><span class="p">();</span>
<a id="__codelineno-99-152" name="__codelineno-99-152" href="#__codelineno-99-152"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">ofstream</span><span class="w"> </span><span class="nf">file</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
<a id="__codelineno-99-153" name="__codelineno-99-153" href="#__codelineno-99-153"></a><span class="w">        </span><span class="n">file</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">data</span><span class="p">.</span><span class="n">dump</span><span class="p">(</span><span class="mi">4</span><span class="p">);</span>
<a id="__codelineno-99-154" name="__codelineno-99-154" href="#__codelineno-99-154"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-155" name="__codelineno-99-155" href="#__codelineno-99-155"></a>
<a id="__codelineno-99-156" name="__codelineno-99-156" href="#__codelineno-99-156"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">LoadMap</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">filename</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-157" name="__codelineno-99-157" href="#__codelineno-99-157"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">ifstream</span><span class="w"> </span><span class="nf">file</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
<a id="__codelineno-99-158" name="__codelineno-99-158" href="#__codelineno-99-158"></a><span class="w">        </span><span class="n">nlohmann</span><span class="o">::</span><span class="n">json</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-99-159" name="__codelineno-99-159" href="#__codelineno-99-159"></a><span class="w">        </span><span class="n">file</span><span class="w"> </span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">data</span><span class="p">;</span>
<a id="__codelineno-99-160" name="__codelineno-99-160" href="#__codelineno-99-160"></a><span class="w">        </span><span class="n">current_map_</span><span class="o">-&gt;</span><span class="n">Deserialize</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>
<a id="__codelineno-99-161" name="__codelineno-99-161" href="#__codelineno-99-161"></a><span class="w">        </span><span class="n">undo_stack_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">stack</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Command</span><span class="o">&gt;&gt;</span><span class="p">();</span>
<a id="__codelineno-99-162" name="__codelineno-99-162" href="#__codelineno-99-162"></a><span class="w">        </span><span class="n">redo_stack_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">stack</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Command</span><span class="o">&gt;&gt;</span><span class="p">();</span>
<a id="__codelineno-99-163" name="__codelineno-99-163" href="#__codelineno-99-163"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-164" name="__codelineno-99-164" href="#__codelineno-99-164"></a>
<a id="__codelineno-99-165" name="__codelineno-99-165" href="#__codelineno-99-165"></a><span class="w">    </span><span class="n">Map</span><span class="o">*</span><span class="w"> </span><span class="n">GetCurrentMap</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-166" name="__codelineno-99-166" href="#__codelineno-99-166"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">current_map_</span><span class="p">.</span><span class="n">get</span><span class="p">();</span>
<a id="__codelineno-99-167" name="__codelineno-99-167" href="#__codelineno-99-167"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-168" name="__codelineno-99-168" href="#__codelineno-99-168"></a>
<a id="__codelineno-99-169" name="__codelineno-99-169" href="#__codelineno-99-169"></a><span class="k">private</span><span class="o">:</span>
<a id="__codelineno-99-170" name="__codelineno-99-170" href="#__codelineno-99-170"></a><span class="w">    </span><span class="kt">void</span><span class="w"> </span><span class="n">ExecuteCommand</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Command</span><span class="o">&gt;</span><span class="w"> </span><span class="n">command</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-171" name="__codelineno-99-171" href="#__codelineno-99-171"></a><span class="w">        </span><span class="n">command</span><span class="o">-&gt;</span><span class="n">Execute</span><span class="p">();</span>
<a id="__codelineno-99-172" name="__codelineno-99-172" href="#__codelineno-99-172"></a><span class="w">        </span><span class="n">undo_stack_</span><span class="p">.</span><span class="n">push</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">command</span><span class="p">));</span>
<a id="__codelineno-99-173" name="__codelineno-99-173" href="#__codelineno-99-173"></a><span class="w">        </span><span class="n">redo_stack_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">stack</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Command</span><span class="o">&gt;&gt;</span><span class="p">();</span>
<a id="__codelineno-99-174" name="__codelineno-99-174" href="#__codelineno-99-174"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-175" name="__codelineno-99-175" href="#__codelineno-99-175"></a>
<a id="__codelineno-99-176" name="__codelineno-99-176" href="#__codelineno-99-176"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Map</span><span class="o">&gt;</span><span class="w"> </span><span class="n">current_map_</span><span class="p">;</span>
<a id="__codelineno-99-177" name="__codelineno-99-177" href="#__codelineno-99-177"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stack</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Command</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">undo_stack_</span><span class="p">;</span>
<a id="__codelineno-99-178" name="__codelineno-99-178" href="#__codelineno-99-178"></a><span class="w">    </span><span class="n">std</span><span class="o">::</span><span class="n">stack</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Command</span><span class="o">&gt;&gt;</span><span class="w"> </span><span class="n">redo_stack_</span><span class="p">;</span>
<a id="__codelineno-99-179" name="__codelineno-99-179" href="#__codelineno-99-179"></a><span class="p">};</span>
<a id="__codelineno-99-180" name="__codelineno-99-180" href="#__codelineno-99-180"></a>
<a id="__codelineno-99-181" name="__codelineno-99-181" href="#__codelineno-99-181"></a><span class="p">}</span><span class="w"> </span><span class="c1">// namespace editor</span>
<a id="__codelineno-99-182" name="__codelineno-99-182" href="#__codelineno-99-182"></a><span class="p">}</span><span class="w"> </span><span class="c1">// namespace engine</span>
<a id="__codelineno-99-183" name="__codelineno-99-183" href="#__codelineno-99-183"></a>
<a id="__codelineno-99-184" name="__codelineno-99-184" href="#__codelineno-99-184"></a><span class="c1">// Example usage</span>
<a id="__codelineno-99-185" name="__codelineno-99-185" href="#__codelineno-99-185"></a><span class="kt">int</span><span class="w"> </span><span class="n">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-186" name="__codelineno-99-186" href="#__codelineno-99-186"></a><span class="w">    </span><span class="n">engine</span><span class="o">::</span><span class="n">editor</span><span class="o">::</span><span class="n">LevelEditor</span><span class="w"> </span><span class="n">editor</span><span class="p">;</span>
<a id="__codelineno-99-187" name="__codelineno-99-187" href="#__codelineno-99-187"></a>
<a id="__codelineno-99-188" name="__codelineno-99-188" href="#__codelineno-99-188"></a><span class="w">    </span><span class="c1">// Add entities</span>
<a id="__codelineno-99-189" name="__codelineno-99-189" href="#__codelineno-99-189"></a><span class="w">    </span><span class="n">editor</span><span class="p">.</span><span class="n">AddEntity</span><span class="p">(</span><span class="s">&quot;Player&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">});</span>
<a id="__codelineno-99-190" name="__codelineno-99-190" href="#__codelineno-99-190"></a><span class="w">    </span><span class="n">editor</span><span class="p">.</span><span class="n">AddEntity</span><span class="p">(</span><span class="s">&quot;Enemy&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">});</span>
<a id="__codelineno-99-191" name="__codelineno-99-191" href="#__codelineno-99-191"></a><span class="w">    </span><span class="n">editor</span><span class="p">.</span><span class="n">AddEntity</span><span class="p">(</span><span class="s">&quot;Pickup&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">-3</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">});</span>
<a id="__codelineno-99-192" name="__codelineno-99-192" href="#__codelineno-99-192"></a>
<a id="__codelineno-99-193" name="__codelineno-99-193" href="#__codelineno-99-193"></a><span class="w">    </span><span class="c1">// Undo last action</span>
<a id="__codelineno-99-194" name="__codelineno-99-194" href="#__codelineno-99-194"></a><span class="w">    </span><span class="n">editor</span><span class="p">.</span><span class="n">Undo</span><span class="p">();</span>
<a id="__codelineno-99-195" name="__codelineno-99-195" href="#__codelineno-99-195"></a>
<a id="__codelineno-99-196" name="__codelineno-99-196" href="#__codelineno-99-196"></a><span class="w">    </span><span class="c1">// Redo last undone action</span>
<a id="__codelineno-99-197" name="__codelineno-99-197" href="#__codelineno-99-197"></a><span class="w">    </span><span class="n">editor</span><span class="p">.</span><span class="n">Redo</span><span class="p">();</span>
<a id="__codelineno-99-198" name="__codelineno-99-198" href="#__codelineno-99-198"></a>
<a id="__codelineno-99-199" name="__codelineno-99-199" href="#__codelineno-99-199"></a><span class="w">    </span><span class="c1">// Save the map</span>
<a id="__codelineno-99-200" name="__codelineno-99-200" href="#__codelineno-99-200"></a><span class="w">    </span><span class="n">editor</span><span class="p">.</span><span class="n">SaveMap</span><span class="p">(</span><span class="s">&quot;level1.json&quot;</span><span class="p">);</span>
<a id="__codelineno-99-201" name="__codelineno-99-201" href="#__codelineno-99-201"></a>
<a id="__codelineno-99-202" name="__codelineno-99-202" href="#__codelineno-99-202"></a><span class="w">    </span><span class="c1">// Load the map</span>
<a id="__codelineno-99-203" name="__codelineno-99-203" href="#__codelineno-99-203"></a><span class="w">    </span><span class="n">editor</span><span class="p">.</span><span class="n">LoadMap</span><span class="p">(</span><span class="s">&quot;level1.json&quot;</span><span class="p">);</span>
<a id="__codelineno-99-204" name="__codelineno-99-204" href="#__codelineno-99-204"></a>
<a id="__codelineno-99-205" name="__codelineno-99-205" href="#__codelineno-99-205"></a><span class="w">    </span><span class="c1">// Print entities in the loaded map</span>
<a id="__codelineno-99-206" name="__codelineno-99-206" href="#__codelineno-99-206"></a><span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">map</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">editor</span><span class="p">.</span><span class="n">GetCurrentMap</span><span class="p">();</span>
<a id="__codelineno-99-207" name="__codelineno-99-207" href="#__codelineno-99-207"></a><span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">map</span><span class="o">-&gt;</span><span class="n">GetEntityCount</span><span class="p">();</span><span class="w"> </span><span class="o">++</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-99-208" name="__codelineno-99-208" href="#__codelineno-99-208"></a><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">entity</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">map</span><span class="o">-&gt;</span><span class="n">GetEntity</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
<a id="__codelineno-99-209" name="__codelineno-99-209" href="#__codelineno-99-209"></a><span class="w">        </span><span class="k">auto</span><span class="w"> </span><span class="n">pos</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">GetPosition</span><span class="p">();</span>
<a id="__codelineno-99-210" name="__codelineno-99-210" href="#__codelineno-99-210"></a><span class="w">        </span><span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Entity: &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">GetType</span><span class="p">()</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot; at position (&quot;</span>
<a id="__codelineno-99-211" name="__codelineno-99-211" href="#__codelineno-99-211"></a><span class="w">                  </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;, &quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">pos</span><span class="p">.</span><span class="n">z</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;)</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">;</span>
<a id="__codelineno-99-212" name="__codelineno-99-212" href="#__codelineno-99-212"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-99-213" name="__codelineno-99-213" href="#__codelineno-99-213"></a>
<a id="__codelineno-99-214" name="__codelineno-99-214" href="#__codelineno-99-214"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<a id="__codelineno-99-215" name="__codelineno-99-215" href="#__codelineno-99-215"></a><span class="p">}</span>
</code></pre></div>
<p>This implementation demonstrates several key concepts:</p>
<ol>
<li>A <code>Vector3</code> struct for representing 3D coordinates.</li>
<li>An <code>Entity</code> class for game objects with serialization support.</li>
<li>A <code>Map</code> class to manage entities and represent the game world.</li>
<li>A <code>Command</code> interface and <code>AddEntityCommand</code> for undo/redo functionality.</li>
<li>A <code>LevelEditor</code> class that manages the editing process, including undo/redo stacks.</li>
<li>Serialization and deserialization of maps using JSON (with the nlohmann/json library).</li>
</ol>
<p>The code follows best practices such as:</p>
<ul>
<li>Using namespaces to organize code.</li>
<li>Employing smart pointers for memory management.</li>
<li>Utilizing the Command pattern for undo/redo functionality.</li>
<li>Implementing serialization for save/load features.</li>
<li>Using virtual functions for polymorphic behavior.</li>
<li>Following the Single Responsibility Principle for classes.</li>
</ul>
<p>This implementation provides a foundation for a level editor in a game engine. In a real-world scenario, you might want to extend this system with features like:</p>
<ul>
<li>More sophisticated entity types with custom properties.</li>
<li>Terrain editing tools (e.g., heightmap manipulation).</li>
<li>Asset management for textures, models, and other resources.</li>
<li>A graphical user interface for the editor.</li>
<li>Support for multiple layers or sub-maps.</li>
<li>Collision detection and physics simulation in the editor.</li>
<li>Prefab system for reusable entity configurations.</li>
<li>Real-time collaboration features for team-based level design.</li>
</ul>
<h4 id="animation-tools">Animation Tools</h4>
<p>Animation tools are used to create and manage character and object animations. These tools support importing, editing, and previewing animations.</p>
<ul>
<li>
<p><strong>Keyframe Animation:</strong></p>
<ul>
<li><strong>Timeline Editor:</strong> A visual timeline for keyframe animation, allowing animators to set and adjust keyframes for various properties like position, rotation, and scale.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-100-1" name="__codelineno-100-1" href="#__codelineno-100-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AnimationEditor</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-100-2" name="__codelineno-100-2" href="#__codelineno-100-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AddKeyframe</span><span class="p">(</span><span class="n">AnimationClip</span><span class="w"> </span><span class="n">clip</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">Transform</span><span class="w"> </span><span class="n">transform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-100-3" name="__codelineno-100-3" href="#__codelineno-100-3"></a><span class="w">        </span><span class="c1">// Add a keyframe to the animation clip at the specified time</span>
<a id="__codelineno-100-4" name="__codelineno-100-4" href="#__codelineno-100-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-100-5" name="__codelineno-100-5" href="#__codelineno-100-5"></a>
<a id="__codelineno-100-6" name="__codelineno-100-6" href="#__codelineno-100-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">EditKeyframe</span><span class="p">(</span><span class="n">AnimationClip</span><span class="w"> </span><span class="n">clip</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">Transform</span><span class="w"> </span><span class="n">transform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-100-7" name="__codelineno-100-7" href="#__codelineno-100-7"></a><span class="w">        </span><span class="c1">// Edit an existing keyframe</span>
<a id="__codelineno-100-8" name="__codelineno-100-8" href="#__codelineno-100-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-100-9" name="__codelineno-100-9" href="#__codelineno-100-9"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Skeletal Animation:</strong></p>
<ul>
<li><strong>Rigging Tools:</strong> Tools for creating and editing skeletal rigs for characters.</li>
<li><strong>Bone Manipulation:</strong> Adjust bone positions and rotations to create animations.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-101-1" name="__codelineno-101-1" href="#__codelineno-101-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Skeleton</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-2" name="__codelineno-101-2" href="#__codelineno-101-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">List</span><span class="o">&lt;</span><span class="n">Bone</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Bones</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="k">get</span><span class="p">;</span><span class="w"> </span><span class="k">set</span><span class="p">;</span><span class="w"> </span><span class="p">}</span>
<a id="__codelineno-101-3" name="__codelineno-101-3" href="#__codelineno-101-3"></a>
<a id="__codelineno-101-4" name="__codelineno-101-4" href="#__codelineno-101-4"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AddBone</span><span class="p">(</span><span class="n">Bone</span><span class="w"> </span><span class="n">bone</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-5" name="__codelineno-101-5" href="#__codelineno-101-5"></a><span class="w">        </span><span class="n">Bones</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">bone</span><span class="p">);</span>
<a id="__codelineno-101-6" name="__codelineno-101-6" href="#__codelineno-101-6"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-101-7" name="__codelineno-101-7" href="#__codelineno-101-7"></a>
<a id="__codelineno-101-8" name="__codelineno-101-8" href="#__codelineno-101-8"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetBoneTransform</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">boneName</span><span class="p">,</span><span class="w"> </span><span class="n">Transform</span><span class="w"> </span><span class="n">transform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-9" name="__codelineno-101-9" href="#__codelineno-101-9"></a><span class="w">        </span><span class="c1">// Set the transform for the specified bone</span>
<a id="__codelineno-101-10" name="__codelineno-101-10" href="#__codelineno-101-10"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-101-11" name="__codelineno-101-11" href="#__codelineno-101-11"></a><span class="p">}</span>
<a id="__codelineno-101-12" name="__codelineno-101-12" href="#__codelineno-101-12"></a>
<a id="__codelineno-101-13" name="__codelineno-101-13" href="#__codelineno-101-13"></a><span class="k">class</span><span class="w"> </span><span class="nc">AnimationEditor</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-14" name="__codelineno-101-14" href="#__codelineno-101-14"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AddBoneKeyframe</span><span class="p">(</span><span class="n">AnimationClip</span><span class="w"> </span><span class="n">clip</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">boneName</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">time</span><span class="p">,</span><span class="w"> </span><span class="n">Transform</span><span class="w"> </span><span class="n">transform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-101-15" name="__codelineno-101-15" href="#__codelineno-101-15"></a><span class="w">        </span><span class="c1">// Add a keyframe for a specific bone</span>
<a id="__codelineno-101-16" name="__codelineno-101-16" href="#__codelineno-101-16"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-101-17" name="__codelineno-101-17" href="#__codelineno-101-17"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Blend Trees:</strong> Blend trees allow smooth transitions between different animations based on parameters like speed or direction.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-102-1" name="__codelineno-102-1" href="#__codelineno-102-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">BlendTree</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-102-2" name="__codelineno-102-2" href="#__codelineno-102-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">AddAnimation</span><span class="p">(</span><span class="n">AnimationClip</span><span class="w"> </span><span class="n">clip</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="n">weight</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-102-3" name="__codelineno-102-3" href="#__codelineno-102-3"></a><span class="w">        </span><span class="c1">// Add an animation clip to the blend tree with a specified weight</span>
<a id="__codelineno-102-4" name="__codelineno-102-4" href="#__codelineno-102-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-102-5" name="__codelineno-102-5" href="#__codelineno-102-5"></a>
<a id="__codelineno-102-6" name="__codelineno-102-6" href="#__codelineno-102-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">SetParameter</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="kt">float</span><span class="w"> </span><span class="k">value</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-102-7" name="__codelineno-102-7" href="#__codelineno-102-7"></a><span class="w">        </span><span class="c1">// Set the parameter that influences the blend tree</span>
<a id="__codelineno-102-8" name="__codelineno-102-8" href="#__codelineno-102-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-102-9" name="__codelineno-102-9" href="#__codelineno-102-9"></a>
<a id="__codelineno-102-10" name="__codelineno-102-10" href="#__codelineno-102-10"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="n">AnimationClip</span><span class="w"> </span><span class="nf">GetBlendedAnimation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-102-11" name="__codelineno-102-11" href="#__codelineno-102-11"></a><span class="w">        </span><span class="c1">// Get the resulting blended animation</span>
<a id="__codelineno-102-12" name="__codelineno-102-12" href="#__codelineno-102-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-102-13" name="__codelineno-102-13" href="#__codelineno-102-13"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="asset-conversion-and-optimization">Asset Conversion and Optimization</h4>
<p>Assets like textures, models, and audio files often need to be converted and optimized for use in the game engine.</p>
<ul>
<li>
<p><strong>Conversion:</strong></p>
<ul>
<li><strong>Format Conversion:</strong> Convert assets to the formats supported by the game engine (e.g., converting .fbx models to engine-specific formats).</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-103-1" name="__codelineno-103-1" href="#__codelineno-103-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AssetConverter</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-103-2" name="__codelineno-103-2" href="#__codelineno-103-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ConvertModel</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">inputPath</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">outputPath</span><span class="p">,</span><span class="w"> </span><span class="n">ModelFormat</span><span class="w"> </span><span class="n">format</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-103-3" name="__codelineno-103-3" href="#__codelineno-103-3"></a><span class="w">        </span><span class="c1">// Convert the model to the specified format</span>
<a id="__codelineno-103-4" name="__codelineno-103-4" href="#__codelineno-103-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-103-5" name="__codelineno-103-5" href="#__codelineno-103-5"></a>
<a id="__codelineno-103-6" name="__codelineno-103-6" href="#__codelineno-103-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ConvertTexture</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">inputPath</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">outputPath</span><span class="p">,</span><span class="w"> </span><span class="n">TextureFormat</span><span class="w"> </span><span class="n">format</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-103-7" name="__codelineno-103-7" href="#__codelineno-103-7"></a><span class="w">        </span><span class="c1">// Convert the texture to the specified format</span>
<a id="__codelineno-103-8" name="__codelineno-103-8" href="#__codelineno-103-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-103-9" name="__codelineno-103-9" href="#__codelineno-103-9"></a>
<a id="__codelineno-103-10" name="__codelineno-103-10" href="#__codelineno-103-10"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">ConvertAudio</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">inputPath</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">outputPath</span><span class="p">,</span><span class="w"> </span><span class="n">AudioFormat</span><span class="w"> </span><span class="n">format</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-103-11" name="__codelineno-103-11" href="#__codelineno-103-11"></a><span class="w">        </span><span class="c1">// Convert the audio file to the specified format</span>
<a id="__codelineno-103-12" name="__codelineno-103-12" href="#__codelineno-103-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-103-13" name="__codelineno-103-13" href="#__codelineno-103-13"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Optimization:</strong></p>
<ul>
<li><strong>Mesh Optimization:</strong> Reduce polygon count and optimize meshes for better performance.</li>
<li><strong>Texture Compression:</strong> Compress textures to reduce memory usage.</li>
<li><strong>Audio Compression:</strong> Compress audio files to reduce file size without significant quality loss.</li>
</ul>
<div class="highlight"><pre><span></span><code><a id="__codelineno-104-1" name="__codelineno-104-1" href="#__codelineno-104-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">AssetOptimizer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-104-2" name="__codelineno-104-2" href="#__codelineno-104-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">OptimizeMesh</span><span class="p">(</span><span class="n">Model</span><span class="w"> </span><span class="n">model</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-104-3" name="__codelineno-104-3" href="#__codelineno-104-3"></a><span class="w">        </span><span class="c1">// Optimize the mesh for better performance</span>
<a id="__codelineno-104-4" name="__codelineno-104-4" href="#__codelineno-104-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-104-5" name="__codelineno-104-5" href="#__codelineno-104-5"></a>
<a id="__codelineno-104-6" name="__codelineno-104-6" href="#__codelineno-104-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CompressTexture</span><span class="p">(</span><span class="n">Texture</span><span class="w"> </span><span class="n">texture</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-104-7" name="__codelineno-104-7" href="#__codelineno-104-7"></a><span class="w">        </span><span class="c1">// Compress the texture to reduce memory usage</span>
<a id="__codelineno-104-8" name="__codelineno-104-8" href="#__codelineno-104-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-104-9" name="__codelineno-104-9" href="#__codelineno-104-9"></a>
<a id="__codelineno-104-10" name="__codelineno-104-10" href="#__codelineno-104-10"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">CompressAudio</span><span class="p">(</span><span class="n">AudioClip</span><span class="w"> </span><span class="n">audio</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-104-11" name="__codelineno-104-11" href="#__codelineno-104-11"></a><span class="w">        </span><span class="c1">// Compress the audio file to reduce file size</span>
<a id="__codelineno-104-12" name="__codelineno-104-12" href="#__codelineno-104-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-104-13" name="__codelineno-104-13" href="#__codelineno-104-13"></a><span class="p">}</span>
</code></pre></div>
</li>
</ul>
<h4 id="build-systems-and-deployment">Build Systems and Deployment</h4>
<p>Building and deploying a game involves compiling the code, packaging assets, and creating executables for various platforms.</p>
<ul>
<li>
<p><strong>Build Systems:</strong> Automate the process of compiling code and packaging assets into a distributable format.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-105-1" name="__codelineno-105-1" href="#__codelineno-105-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">BuildSystem</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-105-2" name="__codelineno-105-2" href="#__codelineno-105-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">BuildGame</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">targetPlatform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-105-3" name="__codelineno-105-3" href="#__codelineno-105-3"></a><span class="w">        </span><span class="c1">// Compile code and package assets for the specified platform</span>
<a id="__codelineno-105-4" name="__codelineno-105-4" href="#__codelineno-105-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-105-5" name="__codelineno-105-5" href="#__codelineno-105-5"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Deployment:</strong> Handle the deployment of the game to different platforms, including PCs, consoles, and mobile devices.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-106-1" name="__codelineno-106-1" href="#__codelineno-106-1"></a><span class="k">class</span><span class="w"> </span><span class="nc">Deployer</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-106-2" name="__codelineno-106-2" href="#__codelineno-106-2"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DeployToPC</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">buildPath</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-106-3" name="__codelineno-106-3" href="#__codelineno-106-3"></a><span class="w">        </span><span class="c1">// Deploy the game build to PC</span>
<a id="__codelineno-106-4" name="__codelineno-106-4" href="#__codelineno-106-4"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-106-5" name="__codelineno-106-5" href="#__codelineno-106-5"></a>
<a id="__codelineno-106-6" name="__codelineno-106-6" href="#__codelineno-106-6"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DeployToConsole</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">buildPath</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">consoleType</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-106-7" name="__codelineno-106-7" href="#__codelineno-106-7"></a><span class="w">        </span><span class="c1">// Deploy the game build to the specified console</span>
<a id="__codelineno-106-8" name="__codelineno-106-8" href="#__codelineno-106-8"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-106-9" name="__codelineno-106-9" href="#__codelineno-106-9"></a>
<a id="__codelineno-106-10" name="__codelineno-106-10" href="#__codelineno-106-10"></a><span class="w">    </span><span class="k">public</span><span class="w"> </span><span class="k">void</span><span class="w"> </span><span class="nf">DeployToMobile</span><span class="p">(</span><span class="kt">string</span><span class="w"> </span><span class="n">buildPath</span><span class="p">,</span><span class="w"> </span><span class="kt">string</span><span class="w"> </span><span class="n">mobilePlatform</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<a id="__codelineno-106-11" name="__codelineno-106-11" href="#__codelineno-106-11"></a><span class="w">        </span><span class="c1">// Deploy the game build to the specified mobile platform</span>
<a id="__codelineno-106-12" name="__codelineno-106-12" href="#__codelineno-106-12"></a><span class="w">    </span><span class="p">}</span>
<a id="__codelineno-106-13" name="__codelineno-106-13" href="#__codelineno-106-13"></a><span class="p">}</span>
</code></pre></div>
</li>
<li>
<p><strong>Continuous Integration:</strong> Integrate continuous integration (CI) systems to automate builds and tests, ensuring stability and quick feedback.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-107-1" name="__codelineno-107-1" href="#__codelineno-107-1"></a><span class="c1"># Example CI configuration (e.g., for Jenkins, Travis CI)</span>
<a id="__codelineno-107-2" name="__codelineno-107-2" href="#__codelineno-107-2"></a><span class="nt">stages</span><span class="p">:</span>
<a id="__codelineno-107-3" name="__codelineno-107-3" href="#__codelineno-107-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
<a id="__codelineno-107-4" name="__codelineno-107-4" href="#__codelineno-107-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<a id="__codelineno-107-5" name="__codelineno-107-5" href="#__codelineno-107-5"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<a id="__codelineno-107-6" name="__codelineno-107-6" href="#__codelineno-107-6"></a>
<a id="__codelineno-107-7" name="__codelineno-107-7" href="#__codelineno-107-7"></a><span class="nt">build_job</span><span class="p">:</span>
<a id="__codelineno-107-8" name="__codelineno-107-8" href="#__codelineno-107-8"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">build</span>
<a id="__codelineno-107-9" name="__codelineno-107-9" href="#__codelineno-107-9"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<a id="__codelineno-107-10" name="__codelineno-107-10" href="#__codelineno-107-10"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./build_system.sh --build</span>
<a id="__codelineno-107-11" name="__codelineno-107-11" href="#__codelineno-107-11"></a>
<a id="__codelineno-107-12" name="__codelineno-107-12" href="#__codelineno-107-12"></a><span class="nt">test_job</span><span class="p">:</span>
<a id="__codelineno-107-13" name="__codelineno-107-13" href="#__codelineno-107-13"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">test</span>
<a id="__codelineno-107-14" name="__codelineno-107-14" href="#__codelineno-107-14"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<a id="__codelineno-107-15" name="__codelineno-107-15" href="#__codelineno-107-15"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./test_system.sh --run</span>
<a id="__codelineno-107-16" name="__codelineno-107-16" href="#__codelineno-107-16"></a>
<a id="__codelineno-107-17" name="__codelineno-107-17" href="#__codelineno-107-17"></a><span class="nt">deploy_job</span><span class="p">:</span>
<a id="__codelineno-107-18" name="__codelineno-107-18" href="#__codelineno-107-18"></a><span class="w">  </span><span class="nt">stage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deploy</span>
<a id="__codelineno-107-19" name="__codelineno-107-19" href="#__codelineno-107-19"></a><span class="w">  </span><span class="nt">script</span><span class="p">:</span>
<a id="__codelineno-107-20" name="__codelineno-107-20" href="#__codelineno-107-20"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./deploy_system.sh --deploy</span>
</code></pre></div>
</li>
</ul>
<p>By integrating robust tools and an efficient asset pipeline, game developers can streamline the creation, optimization, and deployment of game assets, ensuring high performance and smooth workflows.</p>
<p>This page provides an overview of game engine architecture concepts. Each section can be expanded with more detailed information, code examples, and best practices as needed.</p>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "toc.integrate", "navigation.top", "search.suggest", "search.highlight", "content.tabs.link", "content.code.annotation", "content.code.copy"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>